define("registernamespace",[],function(){!function(){function e(){for(var e=0,n=arguments.length;n>e;e++)for(var i=this,r=arguments[e].split("."),o=0,a=r.length;a>o;o++){var s=r[o],l=i[s];l||(l=i[s]={}),l.__namespace||(0===o&&"Sys"!==arguments[e]&&(t.Sys.__rootNamespaces[Sys.__rootNamespaces.length]=l),l.__namespace=!0,l.__typeName=r.slice(0,o+1).join("."),l.getName=function(){return this.__typeName}),i=l}return i}var t=window;t.registerNamespace=e,e("Sys"),t.Sys.__rootNamespaces||(t.Sys.__rootNamespaces=[t.Sys])}()}),define("dependancies",["jquery-1.7.2","debug","validateconfig"],function(){!function(){{var e,t=window;t.Debug}e=t.wLive?t.wLive:t.wLive={},e.Core={},e.Controls={};var n=t.$Config;if(n.handlerBaseUrl=n.handlerBaseUrl||"",!n.sd){var i=document.domain,r=i.split(".");n.sd=1===r.length?"":"."+r[r.length-2]+".com"}n.mkt=n.mkt||"na",n.prop=n.prop||"X","undefined"!=typeof window.SymRealWinOpen&&(window.open=window.SymRealWinOpen)}(window.originaljQuery||jQuery)}),define("truncateellipsis",["dependancies","lightstring"],function(){!function(){var e=window,t=e.wLive;t.truncateEllipsis=function(e,t){return t=Math.max(parseInt(t,10)||1e5,4),e?e.length>t?e.substring(0,t-3)+"...":e:""}}()}),define("bsi",["validateconfig","jquery-1.7.2","cookie"],function(){!function(e){function t(){var t=e(document),i=e(L);t.bind("click",o),t.bind("mousedown",r),t.bind("mouseup",s),t.bind("keydown",l),t.bind("keyup",c),t.bind("touchstart",u),t.bind("touchend",d),ct&&ct.suppressBrowserRightClickMenu&&t.bind("contextmenu",a),ht=1,lt.ignoreWindowOnload||(lt.useJQueryReady?i.ready(function(){setTimeout(w,0)}):i.bind("load",w)),i.bind("unload",C),ct&&ct.capture&&(tt=n())}function n(){var e={sw:screen.width,sh:screen.height,c:screen.colorDepth};return document.documentElement.clientWidth&&(e.bw=document.documentElement.clientWidth,e.bh=document.documentElement.clientHeight),e}function i(){U&&U.href!=j&&(U.href=j,e(U).unbind("mouseout",i),U=0)}function r(e){i(),f(e)}function o(e){2==e.which||F||B||(h(e),at=!F&&!N&&!M,A=1,p(e.target,null,e),at=1)}function a(t){if(t.shiftKey)return!0;if(t.target){var n=e(t.target),i=n.closest("a");if(i.length>0){var r=i.attr("href");if(r&&"#"!==r)return!0}var o=n.closest("input");if(o.length>0){var a=o.attr("type");if(a&&"text"==a.toLowerCase())return!0}var s=n.closest("textarea");if(s.length>0)return!0}return!1}function s(e){f(e),(1!=A||F)&&(at=0,p(e.target,3==A,e),at=1)}function l(e){93==e.keyCode&&(A=3,p(e.target,1,e))}function c(e){var t=e.keyCode;(27==t||18==t||13==t)&&i()}function u(){i(),R=k()}function d(e){k()-R>1e3&&(at=0,A=3,p(e.target,null,e),at=1)}function f(e){A=e.which,h(e)}function h(e){N=e.shiftKey,F=e.ctrlKey,M=e.altKey,B=e.metaKey}function p(e,t,n){for(i();e;){if("A"==e.tagName){var r;try{r=e.href}catch(o){}if(r){if(st.AjaxHistory&&st.AjaxHistory.fullAjax&&-1==r.indexOf("#")){var a;L.$PF&&(a=L.$PF.getAppFrameDocument());var s=a?a.location.href:document.location.href,l=s.indexOf("#");l>-1&&(s=s.substr(0,l));var c=s.indexOf("?");c>-1&&(s=s.substr(0,c)),s+="?",0==r.toLowerCase().indexOf(s)&&(r=e.href="#"+r.substr(s.length))}var u=!1;if($U.isLinkABookmark(r)){var d=$U.getUrlFragment(r);d.indexOf("=")>-1&&(u=!0)}else u=!0;u&&$.informNav(r,0,e,t,null,n)}break}e=e.parentNode}}function g(e){for(var t=X;e&&e.getAttribute;){var n=e.getAttribute("lid");if(n){t=n;break}e=e.parentNode}return t}function m(e){var t=X;if(e)for(var n in e){var i=e[n];i=i.encodeUrl?i.encodeUrl():i,t+=K+n+J+i}return t}function v(){ht&&!lt.ignoreWindowOnload&&$.informLoaded(1,1)}function y(){var e="U";return 3==A?e="R":1==A?e="L":2==A&&(e="M"),F&&(e+="C"),M&&(e+="A"),N&&(e+="S"),e}function _(e,t){for(var n in t)e[n]=t[n]}function w(){ft=1,b()}function b(){ft&&0==dt.length&&$.informLoaded()}function C(){S(),i();var t=e(document);t.unbind("click",o),t.unbind("mousedown",r),t.unbind("mouseup",s),t.unbind("keydown",l),t.unbind("keyup",c),t.unbind("touchstart",u),t.unbind("touchend",d);var n=e(L);lt.ignoreWindowOnload||n.unbind("load",w),n.unbind("unload",C)}function S(){v(),O||x("U")}function k(){return(new Date).getTime()}function I(e){return(e?e:k())-$.headTime}function x(e,t,n,i){if(ct&&ct.enableLD){var r=e+I(n)+(t?t:X),o=D.getCookie(V,1);if(!o&&!i){var a=D.getCookie(q,1);if(a){var s=parseInt(a);if(!isNaN(s)){rt-1>s&&(s=rt-1),s>ot&&(s=ot),s>=rt&&(it.splice(0,s+1-rt),rt=s+1);var l=ot-s;if(l>0){for(ot=s;l-->0;){var c=ot+1-rt;if(c<it.length){var u=it[c];if(!x(u.logKey,u.logValue,u.logTime,!0)){$.flush();{x(u.logKey,u.logValue,u.logTime,!0)}}}ot++}o=D.getCookie(V,1)}}}}var d=E.deserialize(o,G,0,1),f=[lt.xid,lt.rid,st.di,$.headTime].join("_"),h=d[f];if(h?h+="|"+r:h=r,d[f]=h,o=E.serialize(d,G,1),o.length>512)return 0;i||(it.push({logKey:e,logValue:t,logTime:n?n:k()}),ot++,D.setCookie(q,ot,$Config.sd,0,new Date(2020,1,1),1)),D.setCookie(V,o,$Config.sd,0,new Date(2020,1,1),1)}return 1}function T(e){var t=0,n=e.clone(),i=n.length,r=!1,o=L.$WebWatson;if(o)for(;i>t;t++)r=o.wrapCallback(n[t],0,Array.prototype.slice.call(arguments,1))()||r;return r}var L=window,P=(L.Debug,L.$Beacon),D=L.$Cookie,E=L.$Utility,$=window.$BSI;$.headTime||($.headTime=(new Date).getTime());var A,F,N,M,B,R,H,O,U,j,W=[],Q=[],V="LD",q="LDH",G="&",z="?",K="~",J=":",X="",Y=".com",Z="-int.com",et={},tt={},nt=!0,it=[],rt=-1,ot=-1,at=1,st=L.$Config,lt=st.BSI,ct=lt.BICI,ut=st.sd.endsWith(Z)?Z:Y,dt=[],ft=lt.ignoreWindowOnload,ht=0;$.informLoaded=function(e,t){if(st=L.$Config,lt=st.BSI,ct=lt.BICI,document.body.id=lt.pn?lt.pn.encodeHtmlAttribute():X,$.headTime!=H){var n=k();H=$.headTime,ht=0,dt=[],t&&$.addLogParams({x:"1"}),T(W,t),x("L",m(tt),n),tt={},ct&&ct.beaconUrl&&nt&&P.fire(ct.beaconUrl,et),et={}}},$.sendToIdss=function(e){return"undefined"!=typeof e&&(nt=e),nt},$.informPVHead=function(){S(),$.headTime=k(),ht=1},$.addBeaconParams=function(e){_(et,e)},$.addLogParams=function(e){_(tt,e)},$.addLoadedCallback=function(e){W.push(e)},$.removeLoadedCallback=function(e){setTimeout(function(){for(var t=0,n=W.length;n>t;t++)if(W[t]==e)return W.splice(t,1),void 0},0)},$.isLoading=function(){return ht},$.addNavCallback=function(e){Q.push(e)},$.navigateTo=function(e,t,n){if(n&&($.currentScenarioObject=n),!$.informNav(e,0,0,0,0,0,0,t))try{t?window.open(e,t):window.location.href=e}catch(i){}},$.addLoadEvent=function(e){ht&&dt.push(e)},$.eventLoaded=function(e){for(var t=0,n=dt.length;n>t;t++)if(dt[t]==e){dt.splice(t,1),b();break}},$.addHandlerDPs=function(e){return e.biciPrevious=lt.biciPrevious,e.mmn=st.mmn,e},$.addLDToHash=function(e){return e.bicild=D.getCookie(V,1),D.deleteCookie(V,$Config.sd),e},$.informNav=function(t,n,r,o,a,s,l,c){at=at&&!a&&(!r||"_blank"!=r.getAttribute("target"));var u=k(),d=r?r.href:0;i(),v(),n=n||g(r),t=t||X;var f=$U.doesMatchHost(t,"live"+ut),h=$U.isAbsoluteUrl(t)&&$U.doesMatchHost(t,"g.live"+ut);if(x("N",K+K+n.encodeUrl()+K+y(),u),O=O||at,ct&&ct.urlHash){var p=ct.urlHash+u;ct.fid&&(p+=G+ct.fid+G+(at?"1":"0")+(o?"0":"1")),D.setCookie("LN",p,$Config.sd)}var m=T(Q,t,r,o,at,f,s,l,c);!m&&$B.IE&&$B.V<8&&"function"==typeof ieImgAnchorFix&&r&&ieImgAnchorFix(r);var _=["WLXID=",lt.xid,"&RID=",lt.rid,"&TID=",$.headTime,"&lid=",n].join(X);if(h){if(r&&ct&&ct.enableGlinkExtra){var w;w=d.indexOf(z)<0?z+z:d.indexOf(z+z)<0&&d.indexOf(G+G)<0?G+G:G,r.href=d+w+_}}else f||ct&&ct.enableGlinkCall&&P.fireAndHold("//g.live"+Y+"/_9uxp9en-us/mike?"+t.encodeUrl()+G+G+_);return r&&d!=r.href&&(U=r,j=d,3==A?$B.Safari||$B.Firefox||e(r).bind("mouseout",i):setTimeout(i,100)),m},$.reportEvent=function(e,t){var n=K+e+m(t);if(!x("E",n)){$.flush();{x("E",n)}}},$.flush=function(){it.splice(0,ot-rt+1),rt=ot,D.setCookie(q,ot,$Config.sd,0,new Date(2020,1,1),1),P.fire(st.handlerBaseUrl+"/Handlers/NoOp.mvc",$.addLDToHash({}))},t(),$Do.register("$BSI.addNavCallback",$.addNavCallback),$Do.register("$BSI")}(window.originaljQuery||jQuery)}),define("css",["validateconfig","jquery-1.7.2"],function(){!function(){function e(e){var t=n[e];return t||(n[e]=t=new RegExp("\\b"+e+"\\b","ig")),t}var t=window,n={},i=t.$css={has:function(t,n){var i=!1;if(t&&t.className){var r=e(n);r.lastIndex=0;try{i=r.test(t.className)}catch(o){}}return i},remove:function(e,t){i.swap(e,t)},swap:function(t,n,r){r=r||"",i.has(t,n)&&(t.className=t.className.replace(e(n),r).replace(/^\s|\s\s|\s$/g,function(e){return e.substr(1)}))},add:function(e,t){e&&(e.className?i.has(e,t)||(e.className+=" "+t):e.className=t)}}}(window.originaljQuery||jQuery)}),define("sutra",["validateconfig","jquery-1.7.2","debug"],function(){!function(e){function t(e){for(var t=e.split("."),i=n,r=0,o=t.length;o>r;r++)i=i[t[r]];return i}var n=window;n.sutra=function(i,r,o){if(n.$Sutra){var a=e(i);a.attr("sutra")&&o||a.attr("sutra",t(r))}},n.sutra.load=function(t,i){n.$Sutra&&(e(document.body).attr(t,i),e(document.body).removeAttr("sutravisited"))},n.unsutra=function(t){n.$Sutra&&e(t).removeAttr("sutra")}}(window.originaljQuery||jQuery)}),define("setup",["jquery-1.7.2","lightobject","lightstring","debug","validateconfig","dependancies","truncateellipsis","utilityextensions","beacon","lightfunction","lightarray","watson","do","cookie","bsi","css","sutra"],function(){!function(e){function t(){var e=document.title,t=document.location.hash;e!=o&&t&&e.indexOf(t)==e.length-t.length&&(document.title=o),o=document.title}var n=window,i=n.wLive;n.$Version="9.090519.0",n.CompatVersion="9.100709.0",n.$Debug||(n.$Debug={enabled:!1,trace:function(){}});var r=n.document;n._d=r,n._ce=function(e){return r.createElement(e)},n._ge=function(e){return r.getElementById(e)},n._$ge=function(t){return e(n._ge(t))},n._get=function(e){return r.getElementsByTagName(e)},n._dh=r.head=r.head||n._get("head")[0],i.dh=e("#head")[0]||n._dh;var o;e(document).bind("propertychange",t)}(window.originaljQuery||jQuery)}),define("lightenums",["setup"],function(){!function(){function e(e){return function(){for(var t=arguments.length,n=0;t>n;n+=e)this[arguments[n]]=arguments[n+e-1]}}{var t=window;t.jQuery}t.$Flags=e(2),t.$Enum=e(1)}()}),define("settimeout",["lightenums"],function(){!function(){function e(){var r=i.length;if(r>0){try{i.pop()()}catch(o){var a=t.$WebWatson;a&&a.submitFromException(o)}r>1&&n(e,0)}}var t=window,n=window.setTimeout,i=[];window.smartSetTimeout=function r(t,o,a){function s(){r(t,0,a)}o?n(s,o):(a?i.splice(0,0,t):i.push(t),1==i.length&&n(e,0))}}(window.originaljQuery||jQuery)}),define("helpcontext",["settimeout"],function(){!function(){var e=window,t=e.$HelpContext={},n=e.$Config;t.attachContextTo=function(e,t,i){t&&e.length>0&&(e[0].href=n.hc.url+"&errorCode="+(t+"").encodeUrl()+(i?"&errorMessage="+i.encodeUrl():""))},$Do.register("$HelpContext")}(window.originaljQuery||jQuery)}),define("lightnetwork",["helpcontext"],function(){!function(e){function t(){function t(e){if(e.indexOf("window.")<0)return!1;for(var t=e.split("."),n=window,i=1;i<t.length;i++)if(n=n[t[i]],void 0===n)return!1;return!0}function c(e,t){function n(){var e=!1;try{var t=o.contentWindow||o.contentDocument.parentWindow;t&&t.fetchXML&&(p.Proxy._registerProxy(t),e=!0)}catch(n){}return e}function i(){var i,r=v[e];if(r.attempts=(r.attempts||0)+1,r.attempts>2&&!r.fail&&!r.ready){if(!n())for(r.fail=!0;i=r.pop();)i.cb&&i.cb({status:5e3},i.c)}else r.ready||n()||c(e,t)}function r(){v[e].ready||v[e].fail||i()}u();var o=document.createElement("iframe");if(o.style.display="none",e.endsWith(f)||e.indexOf(":")>0&&e.substring(0,e.indexOf(":")).endsWith(f)){document.body.insertBefore(o,document.body.firstChild);var s=l.xmlProxyTimeout||3e4;setTimeout(r,s),y[e]=o,o.src=location.protocol+"//"+e+"/xmlProxy.htm?vn="+a+"&domain="+f}else t.cb&&t.cb({status:5e3},t.c)}function u(){if(!_)return f=document.domain,void 0;if(f=S,f.indexOf(":")>0&&(f=f.substring(0,f.indexOf(":"))),$Config.domain&&!$Config.domain.endsWith("."))document.domain=$Config.domain;else{if(!f.endsWith(".com"))throw new Error("Invalid $Config.domain");var e=f.indexOf(".");if(e>0){document.domain=f;try{for(;e>=0;)f=f.substring(e+1),"com"!=f?(document.domain=f,e=f.indexOf(".")):e=-1}catch(t){}}}f=document.domain,u=function(){}}function d(e,t){return e=p.resolveUrl(e).toLowerCase(),String(e).search(t?b:w)<0?"":RegExp.$1}var f,h,p=this,g=$B.IE,m=[],v={},y={},_=!0;p.requiresDomainLowering=function(e){_=e},p.getCookie=function(e){return r.getCookie(e,1)},p.fetchXML=function(t,n,i,r,o,a,s){function l(e){if(o)for(var t in o)e.setRequestHeader(t,o[t])}function u(e){n&&n(e,a)}var f,h,p=d(t);if(i=i||"GET",n=n||function(){},p===S)f=e.ajax({url:t,type:i,data:r,beforeSend:l,complete:u});else{var g=v[p]=v[p]||[],m={url:t,cb:n,v:i,verb:i,postString:r,headers:o,c:a,cbp:s};if(h=y[p]){if(g.ready)return h.contentWindow.fetchXML(m,null,null,n,s),f;if(g.fail)return n&&n({status:5e3},a),f;g.push(m)}else g.push(m),c(p,m)}return f},p.fetchCSS=function(e,t,r,o,a){function l(){var i;clearTimeout(u);var l=!g||$B.IE&&$B.V>=10;if(l&&(c.readyState="complete"),c.onreadystatechange=function(){c&&c.onreadystatechange&&("loaded"===c.readyState||"complete"===c.readyState)&&(t&&t(c),c.onreadystatechange=null)},o&&n.Css_Start&&(i=Css_Start(o,a),c.onload=function(){Css_Load(this,i)},c.onerror=function(){Css_Error(this,i)}),c.href=e,!r){var d=s.dh;d.appendChild(c)}l&&c.onreadystatechange()}var c=r||document.createElement("link"),u=setTimeout(l,9e3);return r||(c.rel="stylesheet",c.type="text/css"),i.fire(e,0,l,l,1),c},p.fetchScript=function(i,r,a,l,c){function u(){if(!v.handled&&("complete"===v.readyState||"loaded"===v.readyState))try{v.handled=!0,e(v).unbind(".fetch"),!a||m[a]||t(a)?r&&r(v):(f&&(f.errorCode=f.errorCode||"ParseFailure"),h.removeChild(v),p.fetchScript(i,r,void 0,l,c))}catch(o){throw o}finally{f&&n.$Static&&n.$Static.logQos(f)}}function d(e){f&&(f.errorCode="DownloadFailure"),u(),a&&e.stopPropagation()}var f,h=s.dh,v=document.createElement("script");return l&&(f={apiId:l,propertyId:c,startTime:(new Date).getTime()}),(!g||$B.IE&&$B.V>=10)&&(v.readyState="loaded"),v.async=!0,v.type="text/javascript",e(v).bind("readystatechange.fetch",u).bind("load.fetch",u).bind("error.fetch",d),o(function(){v.src=i,h.appendChild(v)}),v},p.registerScript=function(e){m[e]=!0},p.Proxy={_registerProxy:function(e){var t,n=d(e.location.href,!1),i=y[n],r=v[n],o=e.frameElement;if(r)for(r.ready||(i!=o&&(i=y[n]=o),r.fail=!1,r.ready=!0);t=r.pop();)i.contentWindow.fetchXML(t,null,null,t.cb,t.cbp)}},$Config.applyAppDomain&&u();var w=/^(?:http|https|ftp):\/\/([-.a-z0-9]+(?::[0-9]+)?)(?:\/|$)/i,b=/^((?:http|https|ftp):\/\/[-.a-z0-9]+(?::[0-9]+)?)(?:\/|$)/i,C=/\/[^\/]*\/\.\./;p.extractHost=d,p.resolveUrl=function(e,t){function i(e){for(;C.test(e);)e=e.replace(C,"");return e}if(e=e?e.toString():"",t)t=t.substring(0,t.toString().lastIndexOf("/")+1);else if(h)t=h;else{var r=n._ge("base");if(r&&""!=r.href)t=h=r.href;else{var o=location.protocol+"//"+location.host+location.pathname;t=h=o.substring(0,o.lastIndexOf("file:"===location.protocol?"\\":"/")+1)}}return e.startsWith("/")&&(e=location.protocol+"//"+location.host+e),-1===e.indexOf("//")&&(e=t+e),i(e)};var S=d(document.location.href);p.currentDomain=S}var n=window,i=n.$Beacon,r=n.$Cookie,o=(n.Debug,n.smartSetTimeout),a=n.$Version,s=n.wLive,l=n.$Network=new t;n.$LightNetwork=l}(window.originaljQuery||jQuery)}),define("scenarioqos",["lightnetwork"],function(){!function(){function e(e,t){h.deferPosting?(h.deferredPosts=h.deferredPosts||[],h.deferredPosts.push({url:e,postString:t})):c.fetchXML(e,null,"POST",t)}function t(){if(h.enabled)if(h.ids&&h.guids&&h.startTimes&&h.propertyIds){for(var e=h.ids.split(m),t=h.guids.split(m),i=h.startTimes.split(m),o=h.propertyIds.split(m),a=e.length,s=f.xid,u=[],g=[],v=[],y=[],_=a-1;_>=0;_--){var b=e[_],C=i[_],S=o[_],k=t[_];_>=a-w&&(u.push(b),g.push(k),v.push(C),y.push(S));var I=r(b,k);if(0!=I.apiArray.length){var x={sc:b,ppd:S,api:I.apiArray.join(m),dur:I.durationArray.join(m),err:I.errArray.join(m),errtp:I.errTypeArray.join(m),st:I.stackTraceArray.join(m),dep:I.dependentArray.join(m),stt:I.startTimeArray.join(m),ac:I.actionIdArray.join(m),pac:I.parentActionIdArray.join(m),xp:s},T=$Utility.serialize(x);c.fetchXML(d.handlerBaseUrl+h.handlerPath,null,"POST",T)}}var L=u.join(m)+"&"+v.join(m)+"&"+y.join(m)+"&"+g.join(m);$BSI.currentScenarioObject&&(L=$BSI.currentScenarioObject.id+"&"+$BSI.currentScenarioObject.startTime+"&"+$BSI.currentScenarioObject.propertyId+"&"+$BSI.currentScenarioObject.guid);var P=new Date;P.setSeconds(P.getSeconds()+5),l.setCookie(p,L.encodeUrl(),d.sd,null,P,1),setTimeout(n,500)}else l.deleteCookie(p,d.sd)}function n(){l&&l.deleteCookie(p,d.sd)}function i(e,t){for(var n=b.d,i=n.length,r=0;i>r;r++){var o=n[r];o.scenarioId===e&&o.transactionGuid===t&&(n.splice(r,1),r--,i--)}}function r(e,t){for(var n=[],i=[],r=[],o=[],a=[],s=[],l=[],c=[],u=[],d=b.d,f=d.length,h=0;f>h;h++){var p=d[h];if(p.scenarioId===e&&p.transactionGuid===t){var m=p.api||g,w=p.clientStart,C=p.error||v,S=p.errorType||(p.error?y:_),k=p.stackTrace||g,I=p.actionId||0,x=p.parentActionId||0;n.push(m),i.push(p.clientLength),r.push(C),o.push(S),a.push(k),s.push(p.dependent||g),l.push(w),c.push(I),u.push(x)}}return{apiArray:n,durationArray:i,errArray:r,errTypeArray:o,stackTraceArray:a,dependentArray:s,startTimeArray:l,actionIdArray:c,parentActionIdArray:u}}function o(e,t){return e=e?e+m+t.toString():t.toString()}function a(e,t,n,i){var r={id:e,propertyId:n,guid:t,startTime:i};return r}var s=window,l=(s.$Beacon,s.$Cookie),c=s.$Network,u=s.$ScenarioQoS={},d=$Config,f=d.BSI||{},h=f.Scenario||{},p="Sce",g="na",m="#",v="ok",y="f",_="s",w=3;s.wLive.ScenarioQoSStats={d:[],add:function(e,t,n,i){if(e&&t&&n&&h.ids&&h.guids){var r=h.ids.split(m),o=h.guids.split(m),a=r.length;e.scenarioId=n.id,e.transactionGuid=n.guid;for(var l=0;a>l;l++)if(r[l]===e.scenarioId&&o[l]===e.transactionGuid){var c=s.wLive.ScenarioQoSStats;void 0===i&&(i=(new Date).valueOf()-t),e.clientStart=t,e.clientLength=i,c.d.push(e);break}}}};var b=s.wLive.ScenarioQoSStats;u.addScenarioToHttpHeader=function(e,t){t&&(e.scenarioid=t.id||g,e.transactionguid=t.guid||g,e.scenariopropertyid=t.propertyId||g)},u.getScenarioObject=function(e){if(h.enabled&&h.ids&&h.guids&&h.startTimes&&h.propertyIds)for(var t=h.ids.split(m),n=h.guids.split(m),i=h.startTimes.split(m),r=h.propertyIds.split(m),o=t.length,s=0;o>s;s++)if(n[s]===e)return a(t[s],n[s],r[s],i[s]);return null},u.startScenario=function(e,t){var n=(new Date).valueOf(),i=$Utility.generateGuid();return h.ids=o(h.ids,e),h.propertyIds=o(h.propertyIds,t),h.startTimes=o(h.startTimes,n),h.guids=o(h.guids,i),a(e,i,t,n)},u.stopScenario=function(t,n,o,a,s){if(h.enabled&&h.ids&&h.guids&&h.startTimes&&h.propertyIds)for(var l=n===!1?!1:!0,c=t.id,u=f.xid,p=t.guid,w=h.ids.split(m),b=h.guids.split(m),C=h.startTimes.split(m),S=h.propertyIds.split(m),k=w.length,I=0;k>I;I++)if(w[I]===c&&b[I]===p){var x=r(c,p),T=(new Date).valueOf()-C[I],L=l?v:o||g,P=l?_:a||y;x.apiArray.push(c),x.durationArray.push(T),x.errArray.push(L),x.errTypeArray.push(P),x.stackTraceArray.push(s||g),x.dependentArray.push(g),x.startTimeArray.push(C[I]),x.actionIdArray.push(0),x.parentActionIdArray.push(0);var D={sc:c,ppd:S[I],api:x.apiArray.join(m),dur:x.durationArray.join(m),err:x.errArray.join(m),errtp:x.errTypeArray.join(m),st:x.stackTraceArray.join(m),dep:x.dependentArray.join(m),stt:x.startTimeArray.join(m),ac:x.actionIdArray.join(m),pac:x.parentActionIdArray.join(m),ctx:p,xp:u},E=$Utility.serialize(D);e(d.handlerBaseUrl+h.handlerPath,E),w.splice(I,1),b.splice(I,1),C.splice(I,1),S.splice(I,1),h.ids=w.join(m),h.guids=b.join(m),h.startTimes=C.join(m),h.propertyIds=S.join(m),i(c,p);break}},u.stopAllScenarios=function(e,t,n,i){if(h.enabled&&h.ids&&h.guids)for(var r=h.ids.split(m),o=h.guids.split(m),a=r.length,s=t===!1?!1:!0,l=0;a>l;l++)(e===g||e===r[l])&&u.stopScenario({id:r[l],guid:o[l]},s,n,null,i)},u.postDeferredScenarios=function(){if(h.deferPosting=!1,h.deferredPosts){for(var t=0;t<h.deferredPosts.length;t++){var n=h.deferredPosts[t];e(n.url,n.postString)}delete h.deferredPosts}},$BSI.addNavCallback(t)}(window.originaljQuery||jQuery)}),define("pagestats",["scenarioqos"],function(){!function(e){var t=window;t.wLive.PageStats={d:[],o:$BSI.headTime,add:function(n,i){var r=t.wLive.PageStats;i=i||r.o,n=n||{url:"Missing page stats.",tasks:[],executionTimeMs:0,schedulerTimeMs:0};var o=new Date;n.clientStart=i,n.clientLength=o.getTime()-i,n.clientTime=o,r.d.push(n),e(r).trigger("go")}}}(window.originaljQuery||jQuery)}),define("baseutil",["validateconfig","jquery-1.7.2","do","lightstring"],function(){!function(e){var t=window;t.$f={cancelEvent:function(e){return e=e||t.event,e.stopPropagation?(e.preventDefault(),e.stopPropagation()):e.returnValue=!1,!1},getSelectedText:function(){if(document.selection)return document.selection.createRange();var e;try{e=t.getSelection().rangeCount>0?t.getSelection().getRangeAt(0):t.document.createRange()}catch(n){e=t.document.createRange()}return e},createIframe:function(){var e=document.createElement("IFRAME");return e.frameBorder="no",e.src="javascript:''",e.scrolling="no",e},px:function(e){return e+"px"},updateTitle:function(e){try{top.document.title=top.document.title.replace(/.*?( PLT: [0-9]+ms)?$/i,e+"$1")}catch(t){}},replaceQs:function(e,t,n){var i="([?|&])"+t+"=([^&]+)",r=new RegExp(i,"i"),o=e,a="",s=e.indexOf("#");return s>-1&&(o=e.substr(0,s),a=e.substr(s)),o.replace(r,"$1"+t+"="+n)+a},doc:document,docEl:document.documentElement,getDocType:function(){var e,t=$f.doc,n=t.doctype,i=t.all;return n?e=n.publicId:i&&i.length&&(e=i[0].nodeValue),e||""},createLoading:function(t,n,i,r,o,a,s){var l,c=t;"object"==typeof t&&(c=t.returnMarkup,n=t.type,i=t.width,r=t.height,o=t.size,a=t.color,s=t.text,l=t.useTransparentFallback),n=n||$f.loadingType.spinning,i=i||"20px",r=r||i,o=o||"3px",a=a&&a.toLowerCase()||"#666";var u,d="c_spinningDots",f=$Config.imgsBase+"common/";n==$f.loadingType.flying?(d="c_flyingDots",u="flyingdots.gif"):(u="spinner_",u+="#fff"==a?"white_":"grey_","60px"==i?u+="120":"30px"==i?u+="60":(u+="40",l&&"#fff"!=a&&(u+="_transparent")),u+=".gif");var h=f+u,p=document.createElement("div");e(p).css({width:i,height:r,"font-size":o}),p.className=d+" c_loadingDots c_dotsPlaying";var g='<div class="c_loadingFallback"><img src="'+h+'" alt="" width="'+i+'" height="'+r+'" /></div>';g+='<div class="c_loadingTracks">';for(var m=5;m>0;m--)g+='<div class="c_loadingTrack c_loadingTrack'+m+'"><div class="c_loadingDot" style="background-color:'+a+";width:"+o+";height:"+o+'"></div></div>';g+="</div>",p.innerHTML=g;var v=e("<div></div>").append(p);if(n==$f.loadingType.flying&&v.css({width:i}),s&&v.append('<span class="c_loadingText">'+s.encodeHtml()+"</span>"),c){var y=e("<span></span>").append(v),_=y.html();return y.remove(),_}return v[0]},loadingType:{spinning:0,flying:1},hideLoading:function(e){e&&(e.hide(),e.removeClass("c_dotsPlaying"))},showLoading:function(e){e&&(e.show(),e.addClass("c_dotsPlaying"))}},$Do.register("$f")}(window.originaljQuery||jQuery)}),define("domutils",["validateconfig","jquery-1.7.2","lightstring","baseutil","css"],function(){!function(e){function t(){c.bind(d,i),c.bind(f,n)}function n(){clearTimeout(s),c.unbind(f,n),c.unbind(d,i)}function i(){clearTimeout(s),s=setTimeout(r,100)}function r(){o=a=null}var o,a,s,l=window,c=e(l),u=l.$f,d="resize",f="unload";u.dockIt=function(e,t,n,i,r,o,a,s,l,c){var d=0;r=r||!1,n="undefined"==typeof n?0:n,i=i||{x:0,y:0},s=s||{},"object"!=typeof i&&(d=i,i={x:0,y:0}),s.top=s.top||0,s.bottom=s.bottom||0,s.left=s.left||0,s.right=s.right||0;var f=e.offsetParent,h=f==document.body||f==u.docEl||l,p=u.getLocation(e,r);c=c||u.getLocation(t,r,h);var g,m,v=i.x*($B.rtl?-1:1),y={x:p.bodyX+v,y:p.bodyY+i.y,width:p.width,height:p.height,targetLoc:c,spaceY:0};if(!a){var _=u.clientHeight(),w=u.clientWidth(),b=-1!=c.addScrollTop?u.scrollTop():0,C=u.scrollLeft(),S=p.width+v,k=p.height+i.y,I=_+b-c.bottom-s.bottom,x=c.top-b-s.top,T=w+C-c.right-s.right,L=c.left-C-s.left,P=I>k,D=x>k,E=T>S,$=L>S;!P&&D?(2>n?(n+=2,m=1):(4==n||6==n)&&(n+=1,m=1),y.spaceY=x):!D&&P?(n>=2&&4>n?(n-=2,m=1):(5==n||7==n)&&(n-=1,m=1),y.spaceY=I):y.spaceY=2>n||4==n||6==n?I:x,!E&&$?$B.rtl?n>=4&&6>n?(n+=2,g=1):(1==n||3==n)&&(n-=1,g=1):n>5?(n-=2,g=1):(0==n||2==n)&&(n+=1,g=1):!$&&E&&($B.rtl?n>5?(n-=2,g=1):(0==n||2==n)&&(n+=1,g=1):n>=4&&6>n?(n+=2,g=1):(1==n||3==n)&&(n-=1,g=1))}var A=n%2;return o?(y.x=i.x,y.y=i.y+c.bottom):n>=0&&(4>n?(y.x+=A?$B.rtl?c.left:c.right-p.width:$B.rtl?c.right-p.width:c.left,y.y+=2>n?c.bottom+d:c.top-p.height-d):($B.rtl&&(6>n?n+=2:n-=2),y.x+=6>n?c.left-p.width-d:c.right+d,y.y+=A?c.bottom-p.height:c.top)),!$B.Mobile||D||P||(y.y=u.scrollTop()),g&&(y.x+=-2*i.x),m&&(y.y+=-2*i.y),e.style.left=y.x+"px",e.style.top=y.y+"px",y},u.getLocation=function(e,t,n){for(var i=!1,r=u.getStyle,o="offsetTop",a="offsetLeft",s="position",l={x:e[a],y:e[o],top:0,right:0,bottom:0,left:0,bodyX:0,bodyY:0,width:e.offsetWidth,height:e.offsetHeight},c=e;c=c.offsetParent;){if(i="relative"==r(c,s),2!=t&&(l.bodyX-=c[a],l.bodyY-=c[o]),i){var d=u.toInt(r(c,"padding-left")),f=u.toInt(r(c,"padding-top"));l.x=1==t?l.x:d,l.y=1==t?l.y:f}l.x+=c[a],l.y+=c[o]}e=e.parentNode;for(var h=0,p=0;e&&e!=document.body;){var g=r(e,s);"relative"!=g?("fixed"==g&&n&&(h=1),n||!p&&"absolute"!=g?l.y-=u.toInt(e.scrollTop):"fixed"==g&&(h=-1),e=e.parentNode):(p=1,e=e.parentNode)}return 1==h&&(l.y+=u.toInt(u.scrollTop())),l.left=l.x,l.top=l.y,l.right=l.x+l.width,l.bottom=l.y+l.height,l.addScrollTop=h,l},u.toInt=function(e){return e=parseInt(e),isNaN(e)?0:e},u.locCompare=function(e,t){return e.bodyX!=t.bodyX||e.bodyY!=t.bodyY||e.top!=t.top||e.left!=t.left||e.bottom!=t.bottom||e.right!=t.right?1:0},u.getStyle=function(e,t){var n="";if(u.doc.defaultView&&u.doc.defaultView.getComputedStyle){var i=u.doc.defaultView.getComputedStyle(e,"");n=i?i.getPropertyValue(t):""}else if(e.currentStyle){if(t.indexOf("-")>=0){var r=t.split("-");r[1]=r[1].substr(0,1).toUpperCase()+r[1].substr(1),t=r.join("")}n=e.currentStyle[t]}return n},u.isChildOf=function(e,t,n){try{for(n||(n=window.document);t&&t!==e&&t!=n;)t=t.parentNode;return t===e}catch(i){return!1}},u.pn=function(e,t){for(var n=$css.has(e,t),i=n?e:null;!i&&(e=e.parentNode)&&"undefined"!=typeof e;)$css.has(e,t)&&(i=e);return i},u.docHeight=function(e){if(e||!o){var t=u.doc.documentElement.clientHeight,n=u.doc.body.clientHeight,i=void 0!=n?n:window.innerHeight+window.scrollMaxY;o=Math.max(i,t)}return o},u.docWidth=function(){if(!a){var e=u.doc.body.clientWidth;a=void 0!=e?e:document.width}return a},u.scrollTop=function(){var e=u.toInt(u.docEl.scrollTop),t=u.toInt(window.scrollY);return Math.max(e,t)},u.scrollLeft=function(){var e=u.toInt(u.docEl.scrollLeft),t=u.toInt(window.scrollX);return Math.max(e,t)},u.clientHeight=function(){return u.docEl.clientHeight-($B.IE?16:0)},u.clientWidth=function(){return u.docEl.clientWidth-($B.IE?16:0)},t()}(window.originaljQuery||jQuery)}),define("wlivecss",["validateconfig","jquery-1.7.2","css","debug"],function(){!function(e){var t=window,n=(t.Debug,t.$css);n.getCN=function(e,t,i){var r=[];if(i&&i.getElementsByTagName)for(var o=i.getElementsByTagName(t),a=0;a<o.length;a++)n.has(o[a],e)&&(r[r.length]=o[a]);return r},n.addHideBorder=function(t,n){n=n||this,e(n).addClass("c_nobdr")},n.removeHideBorder=function(t,n){n=n||this,e(n).removeClass("c_nobdr")},n.addPressedState=function(t,n){n=n||this,e(n).addClass("t_prs")},n.removePressedState=function(t,n){n=n||this,e(n).removeClass("t_prs")};t.$edh={e:function(e,t){var n=t||"inline";if("span"==e.nodeName.toLowerCase()&&-1!=e.className.indexOf("c_ld")){var i=e.lastChild;i&&(e.parentNode.insertBefore(i,e),i.style.display=n,e.parentNode.removeChild(e))}},d:function(e){if("a"==e.nodeName.toLowerCase()&&("span"!=e.parentNode.nodeName.toLowerCase()||-1==e.parentNode.className.indexOf("c_ld"))){var t=document.createElement("span");t.innerHTML=e.innerHTML,t.className=e.className?e.className+" c_ld":"c_ld";var n=e.getAttribute("title");n&&t.setAttribute("title",n),e.style.display="none",e.parentNode.insertBefore(t,e),t.appendChild(e)}}};$B&&$B.SF_iPhone&&e(function(){e(".sc").length>0&&e(t.document).bind("touchmove",function(t){0===e(t.target).closest(".sc").length&&t.preventDefault()})})}(window.originaljQuery||jQuery)}),define("wliveimagestrip",["validateconfig","jquery-1.7.2","lightstring","do","wlivecss"],function(){!function(e){function t(e,t,n,i,r,o){o?(e[C][g]=n+_,e[C][m]=t+_,l()||(e[C][v]=p(n)+i+_,e[C][y]=p(t)+r+_)):e[C][w]=t+_+" "+n+_}function n(e,t,n,i,r,o,a,s,l){s=s||""==s?s:a;var c='<span class="{0}"><img class="{1}" src="{2}" onload="this.onload=null;$Do.when(\'$IS.Init\',0,this);" style="width:{3};height:{4};background-position:{5};background-image:{6};" alt="{7}" title="{8}"/></span>',u=c.format(x,"is_img",r+"is/invis.gif",n+_,i+_,"-"+e+_+" -"+t+_,"url('"+o+"')",a?a.encodeHtmlAttribute():"",s?s.encodeHtmlAttribute():"");if(l)return u;var d=_ce("span");return d.innerHTML=u,d.firstChild}function i(e,t,n,i){e=r(e.split(",")),t=r(t.split(",")),n=n?n.trim():n;var o=$B.rtl&&e[1]?e[1]:e[0];return f.Create(t[0],t[1],t[2],t[3],n,n+o,t[4],null,i)}function r(e){for(var t=0;t<e.length;t++){var n=e[t];n&&(e[t]=n.trim())}return e}function o(e){if(e)for(var t,n=e.getElementsByTagName("span"),i=n.length,r=-1;i>r&&!t;r++){var o=-1==r?e:n[r],a=h(o,x),s=h(o,T);if(a||s)return o}return null}function a(e){if(e.tagName!=I&&(e=o(e).getElementsByTagName(I)[0]),e&&h(e,"is_img")){var t=e[C],n=e[S];if(n){n.dir=$B.ltr?"ltr":"rtl";var i=l();if(L||!i){var r='"style="width:{2}px;height:{3}px;"',a='<span class="',s='<img src="{6}"',d="</span>",f=[a,"is_o",r,">",a,"is_i",r,">",s,'class="is_hcimg {11}"alt="{1}"{10}style="left:-{4}px;top:-{5}px;width:{7};height:{8};{9}"/>',d,d,s,'class="is_p',r,"/>"].join(""),g=n[S];if(g)for(var m=g.getElementsByTagName("span"),v=0;v<m.length;v++)m[v][C].zoom=1;var y=t[b],_=y.indexOf("http");-1===_&&(_=y.indexOf('url("')+5),y=y.substr(_,y.length-_-(y.endsWith('")')?2:1));var w,P,D=u(e),E=c(e),$=p(E.x),A=p(E.y);i||(w=$+D.w,P=A+D.h);var F=e.title,N=f.format(e.src.encodeHtmlAttribute(),e.alt.encodeHtmlAttribute(),D.w,D.h,$,A,(i?y:e.src).encodeHtmlAttribute(),i?k:w+"px",i?k:P+"px",i?"":"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+y.encodeHtmlAttribute()+"',sizingMethod='crop');",F||""==F?'title="'+F.encodeHtmlAttribute()+'"':"",e.className.replace("is_img",""));$css.swap(n,x,T),n.innerHTML=N}}}}function s(e){for(var t=e.getElementsByTagName(I),n=0,i=t.length;i>n;n++){var r=t[n],o=r.className;("is_img"==o||"is_hcimg"==o||"is_p"==o)&&(r.onload=null,r[C][b]="")}}function l(){return!$B.IE_M6||$B.IEM_M8}function c(t){var n=e(t),i=t[C],r=(i[w]||n.css(w)||"").split(" "),o=parseInt(i[w+"X"]||n.css(w+"X")||r[0]),a=parseInt(i[w+"Y"]||n.css(w+"Y")||r[1]);return{x:o,y:a}}function u(t){var n=e(t),i=t[C],r=t.currentStyle||(window.getComputedStyle?window.getComputedStyle(t,0):{}),o=parseInt(i[y]||r[y]||n.css(y)),a=parseInt(i[v]||r[v])||n.css(v);return{w:o,h:a}}{var d=window;d.Debug}d.$IS={};var f=d.$IS,h=$css.has,p=Math.abs,g="top",m="left",v="height",y="width",_="px",w="backgroundPosition",b="backgroundImage",C="style",S="parentNode",k="auto",I="IMG",x="is_c",T="is_hc",L=d.$Utility.isHighContrast();f.setClass=function(n,i){if(n){var r=o(n);if(r){var a=r.getElementsByTagName(I)[0],s=h(r,T);if(a.className=(s?"is_hcimg ":"is_img ")+i,s){var d=a[S],f=(e(a),c(a));l()||(a[C][y]="",a[C][v]="");var p=u(d);t(a,f.x,f.y,p.h,p.w,s)}}}},f.toggle=function(n,i,r){if(n&&0!=i){var a=o(n);if(a){var s=a.getElementsByTagName(I)[0],l=h(a,x),d=s;l||(d=s[S]),r&&(s.alt=r,null!=s.title&&(s.title=r));var f=e(s),p=f.css(m)||s[C][m],v=f.css(g)||s[C][g];if(l){var y=c(s);p=y.x,v=y.y}p=parseInt(p),v=parseInt(v);var _=u(d),w=v-_.h*i;t(s,p,w,_.h,_.w,!l)}}},f.Create=n,f.CreateFromConfig=i,f.Init=a,f.disposeAll=s,$Do.register("$IS.Init",a),$Do.register("$IS.disposeAll",s)}(window.originaljQuery||jQuery)}),define("wlivemenu",["validateconfig","jquery-1.7.2","css","debug","baseutil","domutils","sutra"],function(){!function(e){function t(n,p,b,S,k,I,x,T,L,P,D,E,$,A,F,N,M,B,R,H,O,U,j,W,Q){function V(){It=!0,n.binding=ii,i(o,c,ii.dispose),i(n,ln,yt),i(p,ln,yt),i(p,un,bt),i(p,sn,ft),i(C,gn,pt),i(C,sn,pt),i(C,"touchend",ht),i(C,cn,gt),i(C,yn,pt),$B.Firefox&&i(C,_n,pt),Bt=p.tagName==h,ii.isHoverMenu=("mouseover"===x||"mousemove"===x||"focus"===x)&&!Bt,P||(P=250,jt=1e3),D=D||200,ii.isHoverMenu?(i(p,pn,ii.menuOnmouseout),i(p,l,ii.menuOnmouseover),i(n,pn,ii.menuOnmouseout),i(n,l,ii.menuOnmouseover),i(p,dn,ii.menuOnmouseover)):x&&!M&&(!Q||"keyup"!==x&&"mousedown"!==x&&"click"!==x?o.setTimeout(function(){i(p,x,ii.toggleState)
},0):o.setTimeout(function(){e(p).bind("keyup"+g,function(e){13===e.which&&ii.toggleState(e)}).bind("mousedown"+g,function(e){ii.toggleState(e)})},0)),!w||$B.IE&&$B.V<7||($t=C.createElement("div"),$t[Kt]="c_m_sbox",St($t,50),(ni||$B.S60_Symbian)&&o.$Config&&$Config.ImagesBaseUrl&&($t[u].background="url("+$Config.ImagesBaseUrl+"/imgs/black_50.png)"),C.body.insertBefore($t,C.body.firstChild),$B.SF_iPhone&&i($t,sn,pt)),En[Jt]=Yt,q(),K(),i(o,mn,z)}function q(){var t,a=n.getElementsByTagName("*");Ut=0,Wt=null,Dt=[];for(var s=null,l=0,c=a.length;c>l;l++){var d=a[l],p=e(d),g="SPAN"==d.tagName&&$css.has(d,"c-NavLinkDisabled"),m="SPAN"==d.tagName&&$css.has(d,"c-InformationRow");if("UL"===d.tagName&&$css.has(d,"c_m")&&"absolute"===p.css("position")&&(s&&$f.isChildOf(s,d,n)||(s=d)),!("A"!=d.tagName&&d.tagName!=h&&!g&&!m||s&&$f.isChildOf(s,d,n))){var v=kt(d);if(v==n||v&&v.binding&&v.binding.isOpen()){m||Dt.push(d);var y,_=d[f];try{y="LI"==_.tagName||"DIV"==_.tagName}catch(b){}y&&(w||(r(d,fn,G),r(d,hn,G),r(d,vn,$f.cancelEvent),i(d,fn,G),i(d,hn,G),i(d,vn,$f.cancelEvent),!$B.RE_WebKit||d.getAttribute("tabindex")||g||m||d.setAttribute("tabindex",1),d[u].zoom="0",($css.has(d,"uxfa_ml")||$css.has(d,"c_ml"))&&(Ut=1),d.setAttribute("role","menuitem"),g&&d.setAttribute("aria-disabled","true"),o.$Sutra&&$Sutra.Shared&&$Sutra.Shared.MenuItemLink&&!_.getAttribute("sutra")&&sutra(_,"$Sutra.Shared.MenuItemLink")),"none"===_.style.display||$css.has(_,"NoDisplay")||(Wt=Wt||_,Qt=_),!Ft&&$css.has(d,bn)&&(Ht=d),Mt&&Mt.id&&Mt.id==d.id&&(t=1,wt(Dt.length)))}}}Nn=Dt.length,Nn>0?(Dn&&Nt&&at(),Dn=0,Lt=Dt[0],Pt=Dt[Nn-1],i(Lt,un,bt),i(Pt,un,bt),Wt?(Tn.removeClass(In),e(Wt).addClass("c_m_firstchild"),e(Qt).addClass("c_m_lastchild")):Tn.addClass(In)):(Y(),Dn=1),!t&&Ht&&wt(-1)}function G(e){if(!Bt){e=e||event;var t=e.target||e.srcElement;"A"==t.nodeName&&("focusin"==e.type?setTimeout(function(){$css.add(t,wn)},0):setTimeout(function(){$css.remove(t,wn)},0))}}function z(e){if(Pn=1,!$css.has(n,"noresize")){var t=$f.docWidth();On!=t&&(On=t,st(e,1))}}function K(){if(!Dn){En[Xt]=Zt;var t=kt(p);t&&t!=p?Ot=t.binding:void 0!=L&&(b=L),A&&(Ft&&(n[u][d]="auto",$css.remove(n,"c_m_maxw")),n.offsetWidth>A&&(n[u][d]=A+s,$css.add(n,"c_m_maxw")));var r=3,a=r,l=$B.rtl,c=1;if(!Et&&w&&J(),At||w||(At=$f.createIframe(),An=At[u],An[nn]=$f.getStyle(n,nn),n[f].insertBefore(At,n),i(At,dn,Ct)),Vn=F||p,$css.has(p,"c_m_usep")&&(Vn=p[f]),ni||(o.$WLXIM&&o.$WLXIM.isSidebarOpened()&&(Gn.right=y),!S&&e(n).parents(".c_m").length>0&&(S={y:-_,x:0}),Qn=$f.dockIt(n,Vn,b,S,k,T,E,Gn,zn,Kn),Un=Qn.targetLoc),w){var h=$f.docWidth(),g=$f.docHeight(),m=Mn,v=o.screen[d],C=0;if($t&&($t[u][rn]=g?g+s:"100%",$t[u][d]=h?h+s:"100%"),(!h||h>v&&!$B.SF_iPhone)&&(h=v),l=0,h>Mn&&!ni){var I=$f.getLocation(p,k,Wn),x=$B.rtl?I.right:I.left;x>h/2&&(C=h-Mn,l=1),c=0}else m=h,a=0;Qn.x=C,n[u][on]=Qn.x+s,En[d]=$n[d]=m-2+s,ni&&(n[u][an]=Hn+s),X()}var P=function(){Qn.height+=w&&c?2*r:0,$n[Jt]=Yt,w||($n[d]=Qn.width+s),$n[rn]=Qn.height+s,$n[on]=Qn.x+(l?-a:a)+s,$n[an]=Qn.y+(w&&c?-r:r)+s,$n[Jt]=en};!w||ni||$B.S60_Symbian||setTimeout(P,0),At&&(An[Jt]=Yt,An[d]=Qn.width+s,An[rn]=Qn.height+s,An[on]=Qn.x+s,An[an]=Qn.y+s),Pn=0,Nt?Ft&&ii.show(0,1):Y()}}function J(){for(Et=n;Et[Kt]!=Cn&&Et[zt];)Et=Et[zt];Et&&Et[Kt]==Cn||(Et=C.createElement("div"),$n=Et[u],$n[nn]=$f.getStyle(n,nn),$n[an]=0,$n[on]=0,Et[Kt]=Cn,n[f].appendChild(Et)),$n=Et[u],$n[Xt]=tn,$n.backgroundColor="#000",St(Et,20)}function X(){for(var e,t=0,i=[],r=n.getElementsByTagName("UL"),o=0;o<r.length;o++)e=r[o],$css.has(e,"c_gll")&&(i.push(e),dt(e),e.offsetTop>e.previousSibling.offsetTop&&(t=1));if(t)for(var a=0;a<i.length;a++)ut(i[a])}function Y(){It&&(ei&&!Yn?(xn.stop(),Zn=!1,Yn=!0,clearTimeout(Xn),Xn=setTimeout(function(){et(),ot(),xn.animate({height:0},ti,"linear",nt)},10)):(Z(),w||ot()),$t&&($t[u][Xt]=tn),wt(-1),setTimeout(function(){e(Dt).removeClass(wn)},100),Tn.attr("aria-expanded","false"),Tn.removeAttr("aria-owns"))}function Z(){Nt||(tt(),An[Jt]=$n[Jt]=En[Jt]=Yt,An[Xt]=$n[Xt]=En[Xt]=tn,Pn&&(En[an]=$n[an]=0,En[on]=$n[on]=0)),e(wLive.Controls).trigger("aftermenudismiss",{menu:ii,parent:Ot})}function et(){xn.css({overflow:"hidden"}),xn.removeClass("pause")}function tt(){xn.css({overflow:"",height:"auto"}),xn.addClass("pause")}function nt(){Yn=!1,Z()}function it(){Zn=!1,tt()}function rt(e){e=e||xn.height();var t=Qn.spaceY;if(t>0&&e>=t&&!Ut&&(xn.css("max-height",t+s),xn.addClass(kn),!xn.hasClass("c_mfw")&&(!$B.IE||$B.V<=8))){var n=xn.width()+16;xn.css("min-width",n+s)}}function ot(){xn.hasClass(kn)&&(xn.css({"max-height":"","min-width":""}),xn.removeClass(kn))}function at(){if(e(wLive.Controls).trigger("beforemenushow",{menu:ii,parent:Ot}),$t&&($t[u][Xt]=Zt),An[Xt]=$n[Xt]=En[Xt]=Zt,ei&&!Zn){clearTimeout(Xn),xn.stop(),Zn=!0,Yn=!1,tt();var t=xn.height();et(),xn.css({height:0}),xn.animate({height:t},ti,"linear",it),rt(t)}else w||rt();An[Jt]=$n[Jt]=En[Jt]=en,Ht==Lt&&wt(0),$B.IE_M7&&(xn.find(".c_ms").each(function(){var t=e(this);t.css("width",t.parents("ul").width()-m+s)}),xn.find(".c_ml").each(function(){var t=e(this);t.css("width",t.parents("ul").width()-v+s)})),Tn.attr("aria-expanded","true"),n.id&&Tn.attr("aria-owns",n.id)}function st(n,i){(i||lt()&&Nt)&&(ri=(new Date).getTime(),Nt=0,ii.closeEventSource(n&&n.srcElement),Dn||Y(),t.current=Ot,Ot&&(Ot.isHoverMenu&&(Ot.tempHoverCloseDelay=Rn),$B.IE&&xt&&p.focus(),setTimeout(function(){Ot.update(1)},0)),qn.removeClass(Sn),ct(),$B.IE&&$B.V<=8&&(xn.find(".c_ms").each(function(){e(this).css("width","")}),xn.find(".c_ml").each(function(){e(this).css("width","")})))}function lt(){var e=500;return(new Date).getTime()-ri>e}function ct(){for(var e=0,t=Bn.length;t>e;e++)try{Bn[e]()}catch(n){a.submitFromException(n,Gt,99)}}function ut(e){e[u][Xt]=tn,e.previousSibling[Kt]=""}function dt(e){e[u][Xt]=Zt,e.previousSibling[Kt]="c_gl"}function ft(){if(!Bt&&ii.isHoverMenu){var e=p.getAttribute("href");if((!e||e.endsWith("#"))&&Nt&&!I)try{Lt.focus()}catch(t){}}}function ht(e){qt?(pt(e),Nt||(qt=!1)):qt=!0}function pt(e){e=e||event;var t=e.target||e.srcElement;Nt&&t&&!$f.isChildOf(n,t)&&p!=t&&!$f.isChildOf(p,t)&&ii.hide(e)}function gt(e){e=e||event;var t=27,i=e.target||e.srcElement,r=e.keyCode||e.which;9==r&&(Tt=!1),Nt&&(r==t?(Rt=i.value,ii.hide(e)):xt||Ln!=p&&(9!=r||$f.isChildOf(n,Ln))||!Lt||I||-1!==Fn||_t(1)),Bt&&i==p&&(Nt||i.value==Rt||mt()?Nt&&mt()&&ii.hide(e):ii.show())}function mt(){return!N&&Bt&&""==p.value?!0:!1}function vt(){return!Bt||!e(p).is(":focus")}function yt(n){n=n||event;var i=n.target||n.srcElement,r=n.keyCode||n.which,o=0;if(Tt=9==r,xt=n.shiftKey,Ln=i,Nt&&(Bt||W)){if(i==p||W)if(40==r)_t(1),o=1;else if(38==r)_t(-1),o=1;else if(13==r){if(""!=i.value||R)if(Mt){try{Mt.focus()}catch(a){}e(ii).trigger("EnterEvent",Mt)}else if(Ht){try{Ht.focus()}catch(a){}e(Ht).click(),e(ii).trigger("EnterEvent",Ht)}}else Tt&&!xt?(e(ii).trigger("TabEvent",n),wt(-1),t.closeCurrent(n),Bt||(o=1)):27==r&&Nt?o=1:Tt&&xt&&(wt(-1),t.closeCurrent(n),Bt||(o=1));else Tt&&(xt?xt&&wt(Fn-1):Ln!=Pt?wt(Fn+1):wt(-1));if(o)return $f.cancelEvent(n)}return!0}function _t(t){if(Nn){for(var n=Fn+t;Nn>n&&n>=0&&!e(Dt[n]).is(":visible");)n+=t;n>=Nn?n=Nn-1:0>n&&(n=0),wt(n)}}function wt(e){Nn&&(Mt&&$css.remove(Mt,wn),Fn=e,Fn>-1?(Mt=Dt[Fn],$css.remove(Ht,bn),Mt&&($css.add(Mt,wn),setTimeout(function(){try{Mt.focus()}catch(e){}},0))):(Mt=Gt,$css.add(Ht,bn)))}function bt(e){Tt&&xt&&Ln==p?(ii.hide(e),ii.menuOnmouseout()):!Dn&&(!xt&&Tt&&Ln==Pt||xt&&Tt&&Ln==Lt)?(ii.hide(e),ii.menuOnmouseout()):Nt||Ln!=p||ii.menuOnmouseout()}function Ct(){var e=Tt&&!xt?Lt:p;try{e.focus()}catch(t){}}function St(e,t){var n="opacity";$B.IE&&$B.V<=9&&(n="filter"),e[u][n]="filter"==n?"alpha(opacity="+t+")":.01*t}function kt(e){for(var t=e.binding&&e.binding.toggleState?e:null;!t&&(e=e.parentNode)&&"undefined"!=typeof e;)e.binding&&e.binding.toggleState&&(t=e);return t}var It,xt,Tt,Lt,Pt,Dt,Et,$t,At,Ft,Nt,Mt,Bt,Rt,Ht,Ot,Ut,jt,Wt,Qt,Vt,qt,Gt=null,zt="nextSibling",Kt="className",Jt="visibility",Xt="display",Yt="hidden",Zt="block",en="visible",tn="none",nn="position",rn="height",on="left",an="top",sn="click",ln="keydown",cn="keyup",un="blur",dn="focus",fn="focusin",hn="focusout",pn="mouseout",gn="mousedown",mn="resize",vn="dragstart",yn="mousewheel",_n="DOMMouseScroll",wn="t_seli",bn="t_hov",Cn="c_shad",Sn="c_mf",kn="c_m_scroll",In="c_emptymenu",xn=e(n),Tn=e(p),Ln=Gt,Pn=1,Dn=1,En=n[u],$n={display:0,visibility:0},An=$n,Fn=0,Nn=0,Mn=320,Bn=[],Rn=1e3,Hn=($f.docEl,0),On=$f.docWidth(),Un={},jn=n.offsetParent,Wn=jn==document.body||jn==$f.docEl,Qn={},Vn=p,qn=B?e(B):Tn.parent(),Gn=H||{},zn=O,Kn=j,Jn="";"undefined"==typeof W&&(W=!0);var Xn,Yn,Zn,ei=!(w||$B.IE&&$B.V<=9||$B.SF_iPhone||U),ti=150,ni=$B.BlackBerry,ii=this;void 0===b&&(b=Gt),ii.isHoverMenu=0,ii.tempHoverCloseDelay=0,ii.parentEl=Gt,ii.keepHoverMenuOpen=0,ii.dispose=function(){if(r(n,ln,yt),r(p,ln,yt),r(p,un,bt),r(C,gn,pt),r(C,sn,pt),r(C,cn,gt),r(o,mn,z),r(C,yn,pt),$B.Firefox&&r(C,_n,pt),ii.isHoverMenu?(r(p,pn,ii.menuOnmouseout),r(p,l,ii.menuOnmouseover),r(n,pn,ii.menuOnmouseout),r(n,l,ii.menuOnmouseover),r(p,dn,ii.menuOnmouseover)):x&&(!Q||"keyup"!==x&&"mousedown"!==x&&"click"!==x?r(p,x,ii.toggleState):(e(p).unbind("keyup"+g),e(p).unbind("mousedown"+g))),$t&&(r($t,sn,pt),e($t).remove()),At&&(r(At,dn,Ct),e(At).remove()),!w)for(var i=0;i<Dt.length;i++)r(Dt[i],fn,G),r(Dt[i],hn,G);r(Lt,un,bt),r(Pt,un,bt),n.binding=p.menu=Gt,t.current==ii&&(t.current=null),ei&&tt(),r(o,c,ii.dispose),Bn=[]},ii.update=function(t){Ft=!0,r(Lt,un,bt),r(Pt,un,bt);for(var n=0;n<Dt.length;n++){var i=Dt[n];r(i,fn,G),r(i,hn,G),r(i,vn,$f.cancelEvent),$css.remove(i,wn),e(i).parent().removeClass("c_m_firstchild"),e(i).parent().removeClass("c_m_lastchild")}if(q(),!t){var o=ei;ei=!1,K(),ei=o}Ft=!1,Ot&&setTimeout(function(){Ot.update(t)},0)},ii.deactivate=function(){clearTimeout(Xn),tt(),It=!1},ii.activate=function(){It=!0},ii.convertToSubMenu=function(e){ii.setLoc(e)},ii.convertFromSubMenu=function(e){ii.setLoc(e)},ii.updateBinding=function(e){e=e||{},Gn=e.edgeOffsets||Gn},ii.hide=st,ii.show=function(e,n){var i;if(Wt||xn.hasClass("c_msem")){if(!n){var r=$f.scrollTop();(Hn!=r||!Un||$f.locCompare(Un,$f.getLocation(Vn,k,Wn)))&&(Hn=r,Pn=1),Nt||!Pn&&!$||(K(),i=1)}if(Ot||t.current==ii||t.closeAll(),Nt=1,Dn||at(),Ot&&Ot.update(1),!Ft&&!e&&!ii.isHoverMenu)try{p.focus()}catch(o){}qn.addClass(Sn),ct(),t.current=ii}};var ri=0;ii.toggleState=function(e){e&&e.originalEvent&&ii.triggerEventType(e.originalEvent.type),lt()&&(ri=(new Date).getTime(),Nt||mt()?vt()&&st(e,1):ii.show())},ii.isOpen=function(){return Nt},ii.addStateListener=function(e){Bn.push(e)},ii.removeStateListener=function(e){for(var t=0,n=Bn.length;n>t;t++)if(Bn[t]==e)return Bn.splice(t,1),void 0},ii.setOffset=function(e){S=e,Pn=1},ii.invalidatePosition=function(){Pn=1},ii.setLoc=function(e){b=e,Pn=1},ii.menuOnmouseover=function(){if(p.unhover&&(clearTimeout(p.unhover),p.unhover=Gt),!Nt&&!p.hover){var e=P;t.tempOpenDelayTimer&&jt&&(e=1),p.hover=setTimeout(function(){Nt||ii.show()},e)}},t.tempOpenDelayTimer=0,ii.menuOnmouseout=function(){p.hover&&(clearTimeout(p.hover),p.hover=Gt),!Nt||p.unhover||ii.keepHoverMenuOpen||(ii.tempHoverCloseDelay=ii.tempHoverCloseDelay||D,p.unhover=setTimeout(function(){st()},ii.tempHoverCloseDelay),ii.tempHoverCloseDelay=0,jt&&(clearTimeout(t.tempOpenDelayTimer),t.tempOpenDelayTimer=setTimeout(function(){t.tempOpenDelayTimer=null},jt)))},ii.getSelectedEl=function(){return Mt?Mt:Ht},ii.triggerEventType=function(e){return"undefined"!=typeof e&&(Jn=e),Jn},ii.closeEventSource=function(e){return"undefined"!=typeof e&&(Vt=e),Vt},V()}function n(){($B.Chrome||$B.Safari)&&(r(C,l,t.emptyFunction),r(o,c,n))}function i(t,n,i){t&&e(t).bind(n,i)}function r(t,n,i){t&&e(t).unbind(n,i)}var o=window,a=o.$WebWatson,s="px",l="mouseover",c="unload",u="style",d="width",f="parentNode",h="INPUT",p="h/c7.png,h/c7_rtl.png,",g=".wliveMenu",m=30,v=35,y=300,_=10,w=$B.Mobile,b=$B.IE_M6,C=$f.doc,S='<ul class="uxfa_m c_m t_hovl"></ul>',k='<li class="c_mcp"></li>',I='<a class="uxfa_ml c_ml"><span class="c_mlu"></span></a>',x='<span class="c_chev"></span>',T="click";t.closeCurrent=function(e){t.current&&t.current.hide(e,1)},t.current=null,t.closeAll=function(){for(;t.current;)t.closeCurrent()},t.chevronTypes={SmallLeftDark:["154,17,6,8","&#9668;"],SmallLeftLight:["154,33,6,8","&#9668;"],SmallRightDark:["192,17,6,8","&#9658;"],SmallRightLight:["192,33,6,8","&#9658;"],SmallUpDark:["67,17,8,8","&#9650;"],SmallUpLight:["67,33,8,8","&#9650;"],SmallDownDark:["114,17,8,8","&#9660;"],SmallDownLight:["114,33,8,8","&#9660;"],SmallPlusLeftDark:["145,17,8,9","&#9668;"],SmallPlusLeftLight:["145,33,8,9","&#9668;"],SmallPlusRightDark:["184,17,8,9","&#9658;"],SmallPlusRightLight:["184,33,8,9","&#9658;"],SmallPlusUpDark:["57,17,9,8","&#9650;"],SmallPlusUpLight:["57,33,9,8","&#9650;"],SmallPlusDownDark:["104,17,9,8","&#9660;"],SmallPlusDownLight:["104,33,9,8","&#9660;"],MediumLeftDark:["135,17,9,11","&#9668;"],MediumLeftLight:["135,33,9,11","&#9668;"],MediumRightDark:["175,17,9,11","&#9658;"],MediumRightLight:["175,33,9,11","&#9658;"],MediumUpDark:["45,17,11,9","&#9650;"],MediumUpLight:["45,33,11,9","&#9650;"],MediumDownDark:["92,17,11,9","&#9660;"],MediumDownLight:["92,33,11,9","&#9660;"],LargeLeftDark:["123,17,11,15","&#9668;"],LargeLeftLight:["123,33,11,15","&#9668;"],LargeRightDark:["162,17,11,15","&#9658;"],LargeRightLight:["162,33,11,15","&#9658;"],LargeUpDark:["29,17,15,11","&#9650;"],LargeUpLight:["29,33,15,11","&#9650;"],LargeDownDark:["76,17,15,11","&#9660;"],LargeDownLight:["76,33,15,11","&#9660;"],EllipsisDark:["232,1,16,4",""],EllipsisLight:["232,17,16,4",""],SmallCheckDark:["1,1,12,12",""],SmallCheckMedium:["1,17,12,11",""],SmallCheckDisabled:["1,33,12,11",""],SmallCheckLight:["1,49,12,11",""],LargeCheckDark:["14,1,14,12",""],LargeCheckMedium:["14,17,14,12",""],LargeCheckDisabled:["14,33,14,12",""],LargeCheckLight:["14,49,14,12",""],LargeDotDark:["249,1,8,8",""],LargeDotLight:["249,17,8,8",""],SquareDark:["276,1,8,8",""],SquareLight:["276,17,8,8",""]},t.createChevron=function(e,t){if(b||w)return e[1];var n=e[0]+",",i=$IS.CreateFromConfig(p,n,$Config.imgsBase,t);return i},t.emptyFunction=function(){},function(){($B.Chrome||$B.Safari)&&(i(o,c,n),i(C,l,t.emptyFunction))}(),t.bind=function(e,n,i,r,o,a,s,l,c,u,d,f,h,p){var g={offset:i,alt:void 0==r?0:r,nofocus:o,posabs:a,defaultLoc:s,hoverDelay:l,hoverCloseDelay:c,forceDispose:u,parentEl:d,menuEl:f,eventType:h,sourceEl:p};return t.create(e,n,g)},t.create=function(e,n,i){function r(){var i=!1,r=0,o=1,a=2,s=r;return S.binding?(s=o,S.binding.updateBinding({edgeOffsets:A})):S&&I&&(k=k||e.type,S.binding=new t(S,I,n,c,p,g,k,m,v,y,_,x,T,L,P,D,w,E,$,A,F,N,M,B,R),s=o,"mouseover"!=k&&"focus"!=k||I.tagName==h||(s=a),I.menu=S.binding,i=!0),S.binding.triggerEventType(e.type),s==o?S.binding.toggleState():s==a&&S.binding.menuOnmouseover(),i}e=e||event,i=i||{};var o=e.target||e.srcElement,a=["c_ml","c_mcp","c_m"],l=o,c=i.offset,p=void 0==i.alt?1:i.alt,g=i.nofocus,m=i.posabs,v=i.defaultLoc,y=i.hoverDelay,_=i.hoverCloseDelay,w=i.forceDispose,C=i.parentEl,S=i.menuEl,k=i.eventType,I=i.sourceEl,x=i.skipEdgeDetection,T=i.noDockCache,L=i.maxWidth,P=i.dockEl,D=i.showOnEmptyInput,E=i.pressedStateEl,$=i.allowClickOnEmptyInput,A=i.edgeOffsets||{},F=i.sourceRelativeToBody,N=i.disableAnimations,M=i.targetLoc,B=i.arrowKeysNavigate,R=i.bindEnterKey;if(I=I||$f.pn(l,a[0]),I&&("undefined"==typeof I.menu||null===I.menu||w||i.edgeOffsets)&&(C=C||$f.pn(l,a[1])||I[f])){b&&"LI"==C.tagName&&$css.has(C[f],"c_m")&&(C[u][d]=C.offsetWidth+s);for(var H=C.childNodes,O=H.length;O--&&!S;)S=$css.has(H[O],a[2])?H[O]:null;return w&&S&&S.binding&&S.binding.dispose(),r()}return!1},t.createSubmenuContainer=function(){return e(S)},t.createSubmenuA=function(t,n){var i=e(I);return e("span",i).append(t),n&&n.length>0&&i.append(n),i},t.createSubmenuChevron=function(n){var i=n||t.chevronTypes.SmallRightDark,r=e(x);return r.append(t.createChevron(i)),r},t.createSubmenuItem=function(t,n,i){var r=e(k);return t&&t.length>0&&r.append(t),n&&n.length>0&&r.append(n),i&&r.bind(T,i),r},o.$menu=t}(window.originaljQuery||jQuery)}),define("csiperf",["validateconfig","jquery-1.7.2","cookie","dependancies","bsi"],function(){!function(e){function t(e,t,s){var l=t[z]||"NA*NA*",c=o(t),u=i(c.time),d=vt(pt("ANON",1)).A||X,f=O.$WebWatson,h=f&&f.foundException()?1:0,p=a(yt.latency),g=a(_t.thr),m=l+":"+n(at.prop,20)+"*"+n(e)+"."+bt,v={ANON:d,NL:p,TP:g,CL:at.mmn||X,MA:at.mkt,B:at.build,TR:m,PLT:c.time,IR:!wt||c.nostart||s?0:1,EX:h};return r(v,c.lapseReport,u),S(v),B(v,rt),v}function n(e,t){t=t||V;var n=e.length;return e=n>t?e.substr(n-t):e,e.encodeUrl()}function i(e){return nt>0&&!s(e)&&e>0?{tprs:Math.round(nt/1024*8/(e/1e3)),size:Math.round(nt/1024*10)/10}:J}function r(e,t,n){if(_t.plt&&(e.PLM=_t.plt),_t.com&&(e.PCT=_t.com),_t.req&&(e.PCD=_t.req),n&&(e.SZ=n.size,e.TPRS=n.tprs),t)for(var i=0;i<t.length;i++){var r=t[i];e[r.key]=r.val}}function o(e){Z._ttg&&Z.lapse.push({s:"ttg",t:Z._ttg});var t=ft.timeStamp;(s(t)||0==t)&&(t=I());var n=e.ST||0;0==n&&window.performance&&window.performance.timing&&(n=window.performance.timing.navigationStart,wt=1),Z.ttxDeferred.resolve(n),Z.TTxDeferred.resolve(n),Z.addCsd("st",n);var i=t-n,r=d(n,t,Z.lapse);return{nostart:0==n,time:i>0?i:0,lapseReport:r}}function a(e){var t=parseInt(e);return isNaN(t)?0:t}function s(e){return"undefined"==typeof e||!e||X==e}function l(){var e={latency:yt.latency,throughput:yt.throughput};D(e),yt=e}function c(){p(),l(),j.deleteCookie(Q,at.sd)}function u(){try{var e=window.location;return e.hostname+e.pathname}catch(t){return document.domain}}function d(e,t,n){var i=[];if(n&&n.length>1&&t-e>0){n[0]={s:"Start",t:e};for(var r=0;r<n.length-1;r++){var o=(n[r],n[r+1]);if(!s(o)){var a=o.t-e;if(a>0){i[i.length]={key:"L."+o.s,val:a}}}}}return i}function f(e,n,i,r){e=e||u(),nt=a(i.p),(s(nt)||0>=nt)&&(nt=s(n)?0:a(n));var o=yt[K],c=yt[z];c&&o&&(i[z]="0*"+c+"*",i[K]=o,wt=1,l()),Z.GT1Param=t(e,i,r),Z.payloadHash=H(Z.GT1Param)}function h(e){e[z]=X,e[K]=X,L(e)}function p(){nt=0,ft.timeStamp=0,it={},rt={},Z.csd={},Z.lapse=[{}],Z._ttg=0,Z.payloadLength=0,lt.rt=0}function g(e,t){if(!ct.enabled)return c(),void 0;!$BSI.sendToIdss()&&Z.payloadHash.ANON&&Z.fireCsiPerfBeacon(),s(e)&&(e=u());var n=T();n[z]=e+"."+bt,n[K]=I(),n.p=s(t)?0:a(t),L(n)}function m(){var e=window.performance;if(e){var t=e.timing;if(t){var n=t.navigationStart;v("jsPlt",n,t.loadEventEnd),v("1Pnt",n,t.msFirstPaint),v("domIn",n,t.domInteractive),v("rdir",t.redirectStart,t.redirectEnd),v("dns",t.domainLookupStart,t.domainLookupEnd),v("tcp",t.connectStart,t.connectEnd),v("req",t.requestStart,t.responseEnd),v("resp",t.responseStart,t.responseEnd)}var i=e.navigation;i&&($CSIPerf.addNtd("navType",i.type),$CSIPerf.addNtd("redirectCount",i.redirectCount))}}function v(e,t,n){t&&n&&n>t&&$CSIPerf.addNtd(e,n-t)}function y(e){if(!ct.enabled)return c(),void 0;var t=T();m(),f(st.pn,Z.payloadLength,t,e)}function _(){if(ct.enabled){var e=Z.GT1Param,t=k(e)||!e.IR?"nostart":mt(e);ut.enabled&&$BSI.addBeaconParams({csiperf:t})}}function w(){if(ct.enabled){var e=Z.GT1Param;ht.enabled&&lt.enabled&&e&&Z.fireOnLoad&&(delete e.ANON,delete e.MA,delete e.CL,e.RT=lt.rt,e.bicild="",U.fire(at.handlerBaseUrl+"/Handlers/PerfMonitor.mvc",$BSI.addHandlerDPs(e),lt.render?C:0,0,1))}Z.GT1Param=null}function b(e,t){if(e){var n=e.indexOf(" PLT: ");n>-1&&(e=e.substr(0,n)),e+=t}else e=t;return e}function C(){var e=pt("SBSPLT");if(e){var t=" PLT: "+parseInt(e)+"ms";try{window.top.document.title=b(window.top.document.title,t)}catch(n){document.title=b(document.title,t)}}}function S(e){k(Z.csd)||M(e,Z.csd),k(it)||M(e,it)}function k(e){if(e)for(var t in e)return!1;return!0}function I(){return(new Date).getTime()}function x(e){if(at=$Config,st=at.BSI||{},lt=st.SBSPLT||{},ct=st.CSIPerf||{},ut=ct.IDSS||{},dt=ct.Trace||{},ft=ct.page||{},ht=ct.WLXFD||{},_csiPerfConfigOmniture=ct.Omniture||{},!ct.disableTimers){if(!ct.skipStopTimer&&(y(e),_(),w(),ct.enabled&&!ct.pltDetectionDisabled)){var t=T(),n=at.prop;t.l!=n&&(t.l=n,L(t),setTimeout(P,Y))}h(T()),$BSI.sendToIdss()&&p(),et=(new Date).getTime()}}function T(){var e=pt(Q,1);return e==tt?ot:(tt=e,ot=vt(e))}function L(e){ot=e,tt=mt(e),gt(Q,tt,at.sd,J,J,1)}function P(){function e(){var e=(new Date).getTime()-t;"1"==pt("pltmode",1)&&(yt.latency=e,D(yt),j.deleteCookie("pltmode",at.sd,"/"))}var t=(new Date).getTime(),n={bicild:"",v:at.build};U.fire(at.handlerBaseUrl+"/Handlers/Plt.mvc",n,e,e,1)}function D(e){var t=new Date;gt(q,mt(e),at.sd,J,new Date(t.getUTCFullYear()+1,t.getUTCMonth(),t.getUTCDay()),1)}function E(e,t,i,r,o){if(!i&&o&&!ct.disableTimers){var a=s(st.pn)?u():st.pn;Z.setPerformanceId(bt||$(t));var l=n(at.prop,20)+"*"+n(a);g(l,Z.payloadLength),wt=1}}function $(e){for(var t=X;e&&e.getAttribute;){var n=e.getAttribute("pid");if(n){t=n;break}e=e.parentNode}return t}function A(e){ct.enabled&&dt.enabled&&lt.enabled&&U.fire(at.handlerBaseUrl+"/Handlers/Bandwidth.mvc",$BSI.addLDToHash($BSI.addHandlerDPs(e)))}function F(e,t,n){var i,r=this,o=(new Date).getTime(),a={};r.lapse=[],r.addCsd=function(e,t){N(a,e,t)},r.addLapse=function(e){r.lapse.push({s:e,t:(new Date).getTime()})},r.endTrace=function(){if(!i&&(i=1,ct.enabled&&dt.enabled&&lt.enabled)){var s=(new Date).getTime(),l={tc:e,tcs:t,ti:s-o,th:o-$BSI.headTime,to:et?o-et:-1};R(l,r.lapse,o,s),M(l,a);var c=at.handlerBaseUrl+"/Handlers/Trace.mvc";n&&(l.wli="csi",c=st.BICI.beaconUrl),U.fire(c,$BSI.addLDToHash($BSI.addHandlerDPs(l)))}}}function N(e,t,n){e[t]=n}function M(e,t){for(var n in t)e["C."+n]=t[n]}function B(e,t){for(var n in t)e["N."+n]=t[n]}function R(e,t,n,i){for(var r=t.length,o=0;r>o;o++){var a=t[o];e["L."+a.s]=a.t-n}}function H(e){var t={};for(var n in e)(0===n.indexOf("C.")||0===n.indexOf("N.")||"ANON"===n||"CL"===n||"B"===n||"TR"===n||"IR"===n||"PLT"===n)&&(t[n]=e[n]);if(t["C.TR"]&&0==t["C.TR"].indexOf("0-")&&t.TR){var i=t.TR.substring(0,t.TR.indexOf(":"));t["C.TR"]=t["C.TR"].replace("0-",i+".")}return e["L.ttg"]&&(t[Z.timingPrefix+"g"]=e["L.ttg"]),t}var O=window,U=O.$Beacon,j=O.$Cookie,W=O.$Utility,Q=(O.Debug,"BP"),V=40,q="wlidperf",G="wl_preperf",z="FR",K="ST",J=null,X="",Y=5e3,Z=$CSIPerf;Z.GT1Param=null,Z.payloadLength=0,Z.TTxDeferred=e.Deferred(),Z.ttxDeferred=e.Deferred(),Z.payloadHash={},Z.fireOnLoad=!0,Z.timingPrefix="T.";var et,tt,nt=0,it={},rt={},ot={},at=O.$Config,st=at.BSI||{},lt=st.SBSPLT||{},ct=st.CSIPerf||{},ut=ct.IDSS||{},dt=ct.Trace||{},ft=ct.page||{},ht=ct.WLXFD||{},pt=j.getCookie,gt=j.setCookie,mt=W.serialize,vt=W.deserialize,yt=vt(pt(q,1)),_t=vt(pt(G,1)),wt=st.ir,bt=X;Z.lapseTimer=function(e,t){var n;n=t&&t>0?t:a(I()),Z.lapse.push({s:e,t:n})},Z.setUploadTP=function(e,t,n,i){var r={dir:"up",sz:e,ti:t,d:i,pn:st.pn,ext:n};A(r)},Z.setDownloadTP=function(e){var t={dir:"down",pn:st.pn,rate:e};A(t)},Z.startTrace=function(e,t,n){return new F(e,t,n)},Z.endTrace=function(){},Z.setPerformanceId=function(e){bt=n(e,20)},Z.addCsd=function(e,t){N(it,e,t)},Z.csdContains=function(e){return it[e]},Z.addNtd=function(e,t){N(rt,e,t)},Z.clearTTxDeferred=function(){Z.TTxDeferred=null},Z.fireCsiPerfBeacon=function(){U.fire(st.BICI.beaconUrl,Z.payloadHash),p(),Z.ttxDeferred=e.Deferred(),Z.payloadHash={}},Z.addTTxEvent=function(e,t){Z.ttxDeferred&&Z.ttxDeferred.done(function(n){Z.payloadHash[Z.timingPrefix+e]=t-n})},Z.dontFireOnLoad=function(){Z.fireOnLoad=!1,$BSI.sendToIdss(!1)},$BSI.addLoadedCallback(x),$BSI.addNavCallback(E)}(window.originaljQuery||jQuery)}),define("date",[],function(){!function(){Date.now||(Date.now=function(){return(new Date).getTime()})}()}),define("reporter",["jquery-1.7.2","pagestats"],function(){!function(){function e(e){var t=e.error;t&&(e.errorCode=e.errorCode||v.getErrorCode(t),e.stackTrace=e.stackTrace||t.stack,e.resultDetails=e.resultDetails||{},t.name&&(e.resultDetails.name=t.name),t.message&&(e.resultDetails.message=t.message))}function t(){r&&(o.clearTimeout(r),r=null);var e=o.$Config,t=e.ContactCache;if(t&&t.logEnabled){var n=JSON.stringify({actions:v.actionHistory});v.actionHistory=[],$Network.fetchXML(e.handlerBaseUrl+"/Handlers/PeopleApi/log.mvc?canary="+t.canary.encodeURIComponent(),function(){},"POST",n)}}function n(e){var n=window.$Config.ContactCache;if(n){var a=n.logVerbose;a&&i(e),v.actionHistory.length>=n.actionHistoryMaxLength?(n&&n.logVerbose&&t(),v.actionHistory.shift()):n.logVerbose&&n.logEnabled&&!r&&(r=o.setTimeout(t,5e3)),v.actionHistory.push(e)}}function i(e){if(o[d]&&o[d][p]){var t=[e.eventType];if(e.message&&t.push(e.message),e.resultCode&&t.push(e.resultCode),e.stackTrace&&t.push(e.stackTrace),e.resultDetails)for(var n in e.resultDetails)t.push(n+":"+e.resultDetails[n]);o[d][p]("People: "+t.join(" - "))}}var r,o=window,a=o.wLive,s=a.People={},l=o.$ScenarioQoS,c=a.ScenarioQoSStats,u="WL_People_Cache",d="console",f="error",h="errorType",p="log",g="undefined",m={MissingTicket:{type:"c"},PassportAuthFail:{type:"c"},InvalidPassportUser:{type:"c"},401:{type:"c"},5000:{type:"f",name:"ProxyLoadFailure"},CantAccessIframeStorage:{type:"c"},15:{type:"c"},18:{type:"c"},22:{type:"c",name:"StorageExceededOrDisabled"},NoStorage:{type:"c"}},v=s.Reporter={isQosEnabled:!1,lastError:null,actionHistory:[],logAction:function(e){v.log({eventType:e})},logError:function(e,t,n){v.log({eventType:e,error:t},n)},logDetails:function(e,t,n){v.log({eventType:e,resultDetails:t},n)},log:function(i,r){i&&i.eventType&&(e(i),n(i),r&&t())},verbose:function(){for(var e=0;e<v.actionHistory.length;e++)i(v.actionHistory[e]);var t=window.$Config.ContactCache;t&&(t.logVerbose=!0)},handleError:function(e,t,n,i,r,o,a,s,l,c){v.log({eventType:"PageError",resultCode:i,stackTrace:a,resultDetails:{message:e,jsUrl:t,jsLine:n,data:l,hostname:r,action:s,isHidden:c}},!0)},startScenario:function(e){var t=u+"_"+e;return v.isQosEnabled?l.startScenario(t,u):null},stopScenario:function(e,t,n){if(n&&!v.lastError&&(v.lastError=n),v.isQosEnabled){var i=void 0,r=!1;if(!t&&n){var o=m[n];o&&o.type&&(i=o.type,r="f"===i)}if(e.id){var a=!t,s=t?null:n;v.log({eventType:e.id,resultCode:s,success:t,isQosImpacting:r},a)}l.stopScenario(e,t,n,i)}},addStats:function(e,t,n,i){var r=u+"_"+e,o=n?m[n]:null,a=o&&o.name?o.name:n;a&&(this.lastError=a);var s=o?"f"==o.type:!1,l=i?i.id:null;if(v.log({eventType:r,resultCode:a,success:!!n,isQosImpacting:s,resultDetails:{api:r,property:u,scenario:l}}),v.isQosEnabled&&i){var d={api:r,dependent:u};o&&(d[h]=o.type),a&&(d[f]=a),c.add(d,t,i)}},getErrorCode:function(e,t){return t=t||"Unknown",e.errorCode?e.errorCode:e.code?e.code:t},isNullOrUndefined:function(e){return typeof e===g||null==e}}}()}),define("idletimer",["reporter"],function(){!function(e){function t(t,l){function c(){s.clearTimeout(h),h=s.setTimeout(f,n)}function d(){y&&(l&&l(),y=!1),c()}function f(){y||(t&&t(),y=!0)}var h,p=this,g=u.IE?"MSPointerDown":"touchstart",m=u.IE?"MSPointerMove":"touchmove",v=u.IE?"MSPointerUp":"touchend",y=!1,_=e(s.document);_.bind(a,d),_.bind(r,d),_.bind(o,d),_.bind(g,d),_.bind(m,d),_.bind(v,d),d(),p.dispose=function(){s.clearTimeout(h),e(s).unbind(i,p.dispose);try{_.unbind(a,d),_.unbind(r,d),_.unbind(o,d),_.unbind(g,d),_.unbind(m,d),_.unbind(v,d)}catch(n){}t=null,l=null},e(s).bind(i,p.dispose)}var n=3e5,i="unload",r="mousedown",o="mousewheel",a="keydown",s=window,l=s.wLive,c=l.People,u=(c.Reporter,s.$B);c.IdleTimer=t}(window.originaljQuery||jQuery)}),define("names",["idletimer"],function(){!function(){function e(e,t,n,o,a){function l(e){return u(e,["personal","work","other"])}function c(e){return u(e,["mobile","home","home2","work","work2","pager","homeFax","workFax","mobile2","companyPhone","other"])}function u(e,t,n){var i={};if(e)for(var r=0;r<t.length;r++)s.Reporter.isNullOrUndefined(e[r])||(i[t[r]]=n?u(e[r],n):e[r]);return i}function d(){return t||"0"}function f(e){var t=v[e];return t||(t=h(e),v[e]=t),t}function h(e){for(var t=e.split("|"),n=["if (!firstName && !lastName) { return null }; var n = [], s = '';"],i=0,o=t.length;o>i;i+=2){var a=r[t[i]];n.push("if ("+a+") {"),n.push(" if (n.length) { n.push(s); } "),n.push(" n.push("+a+"); "),n.push("s = '"+t[i+1]+"';"),n.push("} else {s = s || '"+t[i+1]+"';}")}return n.push("return n.join('').trim();"),new Function("title","firstName","middleName","lastName","suffix",n.join(""))}function p(e,t,n,i,r){return g(e,t,null,i,r)}function g(e,t,n,i,r){var o=[];return t||i?(i&&o.push(i),r&&i&&(o.push(" "),o.push(r)),t&&(i&&o.push(", "),e&&(o.push(e),o.push(" ")),o.push(t)),n&&(!t&&i?o.push(", "):o.push(" "),o.push(n)),o.join("").trim()):null}for(var m=this,v=[],y=0;11>=y;y++){var _=i[y+""];_.fullName=f(_.fn),_.fullNameReverse=_.lnf?_.fullName:g,_.displayName=f(_.dn),_.displayNameReverse=_.lnf?_.displayName:p,_.sortName=f(_.sn),_.sortNameReverse=_.snr?f(_.snr):_.sortName}m.noNameString=n||"",m.profileUrl=o||"",m.photosUrl=a||"",m.isLastNameFirst=function(){return e},m.formatName=function(e,t,n,r,o,a,s){var l=e||d(),c=i[l][t];return c(n,r,o,a,s)},m.getDefaultNameType=d,m._isLastNameFirstForNameType=function(e){e=e||d();var t=i[e];return t&&t.lnf},m._buildDate=function(e){var t=null;return e&&(t=u(e,["year","month","day"]),(1900==t.year||1904==t.year)&&(t.year=null)),t},m._buildEmails=l,m._buildEmailFlags=function(e){return l(e)},m._buildEmailCapabilities=function(e){return l(e)},m._buildPhones=c,m._buildPhoneFlags=function(e){return c(e)},m._buildAddresses=function(e){return u(e,["home","work","other"],["street","city","state","zipCode","country"])}}var t="F| |L",n="L| |F",i={0:{fn:"T| |F| |M| |L| |S",dn:"T| |F| |L| |S",sn:t,snr:n,lnf:!1},1:{fn:"F| |L| |M| |T| |S",dn:"F| |L| |T| |S",sn:t,snr:n,lnf:!1},2:{fn:"F| |L| |M| |T| |S",dn:"F| |L| |T| |S",sn:t,snr:n,lnf:!1},3:{fn:"F| |M| |L| |T| |S",dn:"F| |L| |T| |S",sn:t,snr:n,lnf:!1},4:{fn:"F| |M| |L| |T| |S",dn:"F| |L| |T| |S",sn:t,snr:n,lnf:!1},5:{fn:"L| |F| |M| |T| |S",dn:"L| |F| |T| |S",sn:"L| |F",lnf:!0},6:{fn:"T| |F| |M| |L| |S",dn:"T| |F| |L| |S",sn:t,snr:n,lnf:!1},7:{fn:"T| |F| |L| |M| |S",dn:"T| |F| |L| |S",sn:t,snr:n,lnf:!1},8:{fn:"T| |L||F| |M| |S",dn:"T| |L||F| |S",sn:"L||F",lnf:!0},9:{fn:"T| |L| |F| |M| |S",dn:"T| |L| |F| |S",sn:"L| |F",lnf:!0},10:{fn:"T| |L| |F| |M| |S",dn:"T| |L| |F| |S",sn:"L| |F",lnf:!0},11:{fn:"T| |L| |M| |F| |S",dn:"T| |L| |F| |S",sn:"L| |F",lnf:!0}},r={T:"title",F:"firstName",M:"middleName",L:"lastName",S:"suffix"},o=window,a=o.wLive,s=a.People;s.Names=e}()}),define("messagingaddress",["names"],function(){!function(e){function t(e,t){var n=this;n._c=e,n._mri=t,n._aa=!1,n._p=0,n._ccl=!1,n._cch=!1,n._cgch=!1}var n="changed";window.wLive.People.MessagingAddress=t;var i=t.prototype;i.isActiveAddress=function(){return this._aa},i.getPresence=function(){return this._p},i.canCall=function(){return this._ccl},i.canChat=function(){return this._cch},i.canGroupChat=function(){return this._cgch},i.getDifferentiator=function(){var e=this,t=e._c,n=t.getSourceId();return"GOOG"==n?e._getMri():"SCD"==n||"SKYPE"==n?t.getNickname():t.getDisplayNameWithFallback()},i._getContact=function(){return this._c},i._getMri=function(){return this._mri},i._setProperty=function(t,i,r,o,a){(this._aa!=t||this._p!=i||this._ccl!=r||this._cch!=o||this._cgch!=a)&&(this._aa=t,this._p=i,this._ccl=r,this._cch=o,this._cgch=a,e(this._getContact().getPerson()).triggerHandler(n))}}(window.originaljQuery||jQuery)}),define("peoplecontactdetails",["messagingaddress"],function(){!function(){function e(e,t,n){var i=this;i._d=e,i._pd=t,i._n=n,i._b=e[2],i._a=null,i._an=null}var t=window.wLive.People;t.ContactDetails=e;var n=e.prototype;n.getAddresses=function(){var e=this;if(!e._a){var t=e._b,n=e._pd[24]||[],i=e._d[25]||[],r=[65536&t?n[0]:i[0],t&1<<17?n[1]:i[1],t&1<<18?n[2]:i[2]];e._a=e._n._buildAddresses(r)}return e._a},n.getSignificantOther=function(){var e=this;return e._b&1<<20?e._pd[25]:e._d[26]},n.getAnniversary=function(){var e=this;if(!e._an){var t=e._b&1<<20?e._pd[26]:e._d[27];e._an=e._n._buildDate(t)}return e._an},n.getWebsite=function(){var e=this;return e._b&1<<21?e._pd[27]:e._d[28]},n.getJobTitle=function(){var e=this;return 16&e._b?e._pd[28]:e._d[29]},n.getNotes=function(){var e=this;return e._b&1<<22?e._pd[29]:e._d[30]
}}()}),define("peoplecontact",["peoplecontactdetails"],function(){!function(){function e(e,t,n,i){var r=this;r._d=e,r._p=t,r._pd=n,r._n=i,r._b=e[2],r._cd=null,r._bd=null,r._e=null,r._eie=null,r._ec=null,r._ph=null,r._m=null,r._pie=null}var t=8,n=window.wLive.People;n.ContactState={deleted:-1,shell:0,meContact:1,pending:2,follower:3,twoWay:4,rolodex:5,nonFriend:6,declined:7,implicitContact:8,shellContactFanPage:9,enhancedShellContact:10,implicitShellContact:11,invitationShellContact:12},n.Contact=e;var i=e.prototype;i.getPerson=function(){return this._p},i.getId=function(){var e=this;return 1&e._b?e._pd[0]:e._d[0]},i.getPassportMemberName=function(){var e=this;return"WL"===e._d[4]?e._p.getPassportMemberName():null},i.getMessagingAddresses=function(){var e=this;if(!e._m){e._m=[];for(var t=e.getMris(),i=0;i<t.length;i++)t[i]&&e._m.push(new n.MessagingAddress(e,t[i]))}return e._m},i.getDisplayName=function(){var e=this;return e._n.formatName(e.getNameType(),"displayName",e.getTitle(),e.getFirstName(),e.getMiddleName(),e.getLastName(),e.getSuffix())},i.getFullName=function(){var e=this;return e.getOrderedName()||e._n.formatName(e.getNameType(),"fullName",e.getTitle(),e.getFirstName(),e.getMiddleName(),e.getLastName(),e.getSuffix())},i.getDisplayNameWithFallback=function(){var e=this,t=e.getDisplayName();if(t=t||e.getNickname(),t=t||e.getCompanyName(),t=t||e.getPassportMemberName(),!t){var n=e.getEmails();t=t||n.personal,t=t||n.work,t=t||n.other}if(!t){var i=e.getPhones();t=t||i.mobile,t=t||i.home,t=t||i.home2,t=t||i.work,t=t||i.work2,t=t||i.other}return t||e._n.noNameString},i.getContactState=function(){return this._d[1]},i.getPromotionBitmap=function(){return this._b},i.getMris=function(){return this.getPerson().isMe()?["1:"+this.getPerson().getPassportMemberName()]:this._props()[0]||[]},i.getIsHidden=function(){return this._props()[1]},i.getOfflineImEnabled=function(){return this._props()[2]},i.getSourceId=function(){return this._d[4]},i.getObjectId=function(){return this._d[5]},i.getDomainTag=function(){return this._d[6]},i.getFirstName=function(){var e=this;return e._b&t?e._pd[2]:e._d[7]},i.getMiddleName=function(){var e=this;return e._b&t?e._pd[18]:e._d[18]},i.getLastName=function(){var e=this;return e._b&t?e._pd[3]:e._d[8]},i.getTitle=function(){var e=this;return e._b&t?e._pd[19]:e._d[20]},i.getSuffix=function(){var e=this;return e._b&t?e._pd[20]:e._d[21]},i.getEmails=function(){var e=this;if(!e._e){var t=e._b,n=e._pd[4],i=e._d[9]||[],r=[32&t?n[0]:i[0],64&t?n[1]:i[1],128&t?n[2]:i[2]];e._e=e._n._buildEmails(r)}return e._e},i.getPrimaryEmail=function(){var e=this,t=e.getEmails(),n=t.personal||t.work||t.other||e.getPassportMemberName();return n},i.getPhones=function(){var e=this;if(!e._ph){var t=e._b,n=e._pd[5],i=e._d[10]||[],r=[256&t?n[0]:i[0],512&t?n[1]:i[1],1024&t?n[2]:i[2],2048&t?n[3]:i[3],4096&t?n[4]:i[4],8192&t?n[5]:i[5],16384&t?n[6]:i[6],32768&t?n[7]:i[7],t&1<<23?n[8]:i[8],t&1<<24?n[9]:i[9],t&1<<25?n[10]:i[10]];e._ph=e._n._buildPhones(r)}return e._ph},i.getCompanyName=function(){var e=this;return 16&e._b?e._pd[10]:e._d[11]},i.getUserTile=function(){var e=this;return 4&e._b?e._pd[11]:e._d[12]},i.getEmailImEnabled=function(){var e=this;return e._eie||(e._eie=e._n._buildEmailFlags(e._d[13])),e._eie},i.getEmailCapabilities=function(){var e=this;return e._ec||(e._ec=e._n._buildEmailCapabilities(e._d[14])),e._ec},i.getPhoneImEnabled=function(){var e=this;return e._pie||(e._pie=e._n._buildPhoneFlags(e._d[15])),e._pie},i.getFavoriteOrder=function(){return this._d[16]},i.getBirthday=function(){var e=this;if(!e._bd){var t=e._bd&1<<19?e._pd[16]:e._d[17];e._bd=e._n._buildDate(t)}return e._bd},i.getNickname=function(){var e=this,n=e._b&t?e._pd[17]:e._d[19],i=e.getSourceId();return i&&"TWITR"===i.toUpperCase()&&n&&!n.startsWith("@")&&(n="@"+n),n},i.getYomiFirstName=function(){var e=this;return e._b&t?e._pd[21]:e._d[22]},i.getYomiLastName=function(){var e=this;return e._b&t?e._pd[22]:e._d[23]},i.getYomiCompanyName=function(){var e=this;return e._b&t?e._pd[23]:e._d[24]},i.getOrderedName=function(){var e=this;return e._b&t?e._pd[30]:e._d[31]},i.getNameType=function(){var e=this;return e._b&t?e._pd[31]:e._d[32]},i.getSkypeId=function(){return this._d[34]},i.getIsAnonymous=function(){return this._d[35]},i.getLinkedMsa=function(){return this._d[36]},i.getLinkedFacebookId=function(){return this._d[37]},i.getIsBidirectional=function(){return this._d[38]},i.getSkypePendingOutbound=function(){return this._d[39]},i.getIsBlocked=function(){return this._d[40]},i.getDetails=function(){var e=this;return e._cd||(e._cd=new n.ContactDetails(e._d,e._pd,e._n)),e._cd},i._props=function(){return this._d[3]||[]}}()}),define("persondetails",["peoplecontact"],function(){!function(){function e(e,t){var n=this;n._d=e,n._n=t,n._a=null,n._an=null}var t=window.wLive.People;t.PersonDetails=e;var n=e.prototype;n.getAddresses=function(){var e=this;return e._a||(e._a=e._n._buildAddresses(e._d[24])),e._a},n.getSignificantOther=function(){return this._d[25]},n.getAnniversary=function(){var e=this;return e._an||(e._an=e._n._buildDate(e._d[26])),e._an},n.getWebsite=function(){return this._d[27]},n.getJobTitle=function(){return this._d[28]},n.getNotes=function(){return this._d[29]},n.getAntilinks=function(){return this._d[32]}}()}),define("person",["persondetails"],function(){!function(e){function t(t,n){var i=this;i._d=t,i._n=n,i.$changes=e(this),i._c=null,i._e=null,i._p=null,i._b=null,i._ce=null,i._pd=null,i._m=null}var n=window,i=n.wLive.People;i.Person=t;var r=t.prototype;r.getId=function(){return this._d[0]},r.getContacts=function(){var e=this;if(!e._c){e._c=[];var t=this._d[1];if(t)for(var n=0;n<t.length;n++)e._c.push(new i.Contact(t[n],e,e._d,e._n))}return e._c},r.getMessagingRelevance=function(){var e=parseInt(this._d[33]);return isNaN(e)&&(e=0),e},r.getPeopleRelevance=function(){var e=parseInt(this._d[34]);return isNaN(e)&&(e=0),e},r.getMessagingAddresses=function(){var e=this;if(!e._m){for(var t=e.getContacts(),n=[],i=0;i<t.length;i++)"SKYPE"==t[i].getSourceId()&&n.addRange(t[i].getMessagingAddresses());for(i=0;i<t.length;i++)"WL"==t[i].getSourceId()&&n.addRange(t[i].getMessagingAddresses());for(i=0;i<t.length;i++)"SKYPE"!=t[i].getSourceId()&&"WL"!=t[i].getSourceId()&&n.addRange(t[i].getMessagingAddresses());e._m=n}return e._m},r.isOnline=function(e){for(var t=this,n=t.getMessagingAddresses(),i=0;i<n.length;i++)if((!e||n[i].isActiveAddress())&&1==n[i].getPresence())return!0;return!1},r.canCall=function(e){for(var t=this,n=t.getMessagingAddresses(),i=0;i<n.length;i++)if((!e||n[i].isActiveAddress())&&n[i].canCall())return!0;return!1},r.canChat=function(e){for(var t=this,n=t.getMessagingAddresses(),i=0;i<n.length;i++)if((!e||n[i].isActiveAddress())&&n[i].canChat())return!0;return!1},r.canGroupChat=function(e){for(var t=this,n=t.getMessagingAddresses(),i=0;i<n.length;i++)if((!e||n[i].isActiveAddress())&&n[i].canGroupChat())return!0;return!1},r.getDisplayName=function(){var e=this;return e._n.formatName(e.getNameType(),"displayName",e.getTitle(),e.getFirstName(),e.getMiddleName(),e.getLastName(),e.getSuffix())},r.getFullName=function(){var e=this;return e.getOrderedName()||e._n.formatName(e.getNameType(),"fullName",e.getTitle(),e.getFirstName(),e.getMiddleName(),e.getLastName(),e.getSuffix())},r.getDisplayNameWithFallback=function(){var e=this,t=e.getDisplayName();if(t=t||e.getNickname(),t=t||e.getCompanyName(),t=t||e.getPassportMemberName(),!t){var n=e.getEmails();t=t||n.personal,t=t||n.work,t=t||n.other}if(!t){var i=e.getPhones();t=t||i.mobile,t=t||i.home,t=t||i.home2,t=t||i.work,t=t||i.work2,t=t||i.other}return t||e._n.noNameString},r.isLastNameFirst=function(){var e=this,t=e.getNameType();return e._n._isLastNameFirstForNameType(t)},r.getProfileUrl=function(){var e=this,t=e._d[7];return t?e._n.profileUrl.replace("{cid}",e._d[7]):""},r.getPhotosUrl=function(){var e=this,t=e._d[7];return t?e._n.photosUrl.replace("{cid}",e._d[7]):""},r.isMe=function(){var e=this._d[1][0];return e&&1===e[1]},r.isPendingInbound=function(){for(var e=this._d[1],t=!1,n=Math.min(e.length,3),i=0;n>i;i++){var r=e[i];if(r&&2===r[1]){t=!0;break}}return t},r.isHidden=function(){for(var e=this._d[1],t=!1,n=Math.min(e.length,3),i=0;n>i;i++){var r=e[i];if(r&&(6===r[1]&&r[3]&&1===r[3][1]||2===r[1])){t=!0;break}}return t},r.isFanPage=function(){var e=this._d[1][0];return e&&9===e[1]},r.getFirstName=function(){return this._d[2]},r.getLastName=function(){return this._d[3]},r.getEmails=function(){var e=this;return e._e||(e._e=e._n._buildEmails(e._d[4])),e._e},r.getPhones=function(){var e=this;return e._p||(e._p=e._n._buildPhones(e._d[5])),e._p},r.getCid=function(){return this._d[6]},r.getHexCid=function(){return this._d[7]},r.getOnHideList=function(){return this._d[8]},r.getTrustLevel=function(){return this._d[9]},r.getCompanyName=function(){return this._d[10]},r.getUserTile=function(){return this._d[11]},r.getCategoryIds=function(){return this._d[12]?this._d[12]:[]},r.getIsFavorite=function(){return this._d[13]},r.getFavoriteOrder=function(){return this._d[14]},r.getPassportMemberName=function(){return this._d[15]},r.getBirthday=function(){var e=this;return e._b||(e._b=e._n._buildDate(e._d[16])),e._b},r.getNickname=function(){return this._d[17]},r.getMiddleName=function(){return this._d[18]},r.getTitle=function(){return this._d[19]},r.getSuffix=function(){return this._d[20]},r.getYomiFirstName=function(){return this._d[21]},r.getYomiLastName=function(){return this._d[22]},r.getYomiCompanyName=function(){return this._d[23]},r.getOrderedName=function(){return this._d[30]},r.getNameType=function(){return this._d[31]||this._n.getDefaultNameType()},r.getVersion=function(){return this._d[35]},r.getContactEmails=function(){function e(e,t,n){if(n){var i=n.toLowerCase();t[i]||(t[i]=1,e.push(n))}}var t=this;if(!t._ce){for(var n=[],i={},r=t.getContacts(),o=0;o<r.length;o++){var a=r[o].getEmails();e(n,i,a.personal),e(n,i,a.work),e(n,i,a.other)}e(n,i,t.getPassportMemberName()),t._ce=n}return t._ce},r.getDetails=function(){var e=this;return e._pd||(e._pd=new i.PersonDetails(e._d,e._n)),e._pd},r._update=function(e){var t=this;t._d=e,t._c=null,t._e=null,t._p=null,t._b=null,t._ce=null,t._pd=null,t._m=null},r._getHashKeys=function(){for(var e=this,t=e._d,n=[t[0],t[6],t[7]],i=t[1]||[],r=0;r<i.length;r++)n.push(i[r][0]);return n}}(window.originaljQuery||jQuery)}),define("group",["person"],function(){!function(e){function t(t){this._d=t,this.$changes=e(this)}window.wLive.People.Group=t;var n=t.prototype;n.getId=function(){return this._d[0]},n.getName=function(){return this._d[1]},n.getCid=function(){return this._d[2]},n.getHexCid=function(){return this._d[3]},n.getEmail=function(){return this._d[4]},n._update=function(e){return this._d=e},n._getHashKeys=function(){return[this._d[0]]}}(window.originaljQuery||jQuery)}),define("category",["group"],function(){!function(e){function t(t){this._d=t,this.$changes=e(this)}window.wLive.People.Category=t;var n=t.prototype;n.getId=function(){return this._d[0]},n.getName=function(){return this._d[1]},n.getIsFavorite=function(){return this._d[2]},n._update=function(e){return this._d=e},n._getHashKeys=function(){return[this._d[0]]}}(window.originaljQuery||jQuery)}),define("service",["category"],function(){!function(e){function t(t){this._d=t,this.$changes=e(this)}window.wLive.People.Service=t;var n=t.prototype;n.getId=function(){return this._d[0]},n.getName=function(){return this._d[1]},n.getTokenState=function(){return this._d[2]},n.getSupportsIm=function(){return this._d[3]},n.getSupportsContactAgg=function(){return this._d[4]},n.getIconUrlThumbnail=function(){return this._d[5]},n.getIconUrlMiniPhoto=function(){return this._d[6]},n.getIconUrlLargePhoto=function(){return this._d[7]},n.getProfileUrl=function(){return this._d[8]},n.getPhotosUrl=function(){return this._d[9]},n.getSendMessageUrl=function(){return this._d[10]},n.getReportAbuseUrl=function(){return this._d[11]},n.getRank=function(){return this._d[12]},n.getOnHideList=function(){return this._d[13]},n._getHashKeys=function(){return[this._d[0]]},n._update=function(e){this._d=e}}(window.originaljQuery||jQuery)}),define("settings",["service"],function(){!function(e){function t(t){this._d=t,this.$changes=e(this)}var n=t.prototype;n.getMessengerTrustLevel=function(){return this._d[0]},n.getImHistoryEnabled=function(){return 1==this._d[1]},n.getAbSettings=function(){return this._d[2]},n.getWebIMSettings=function(){return this._d[3]},n.getSkypePendingInboundCount=function(){return this._d[4]},window.wLive.People.Settings=t}(window.originaljQuery||jQuery)}),define("lazyhash",["settings"],function(){!function(){function e(e){function t(e,t){t=t||!1;for(var i=e.length,o=0;i>o;o++)for(var a=e[o],s=a._getHashKeys(),l=s.length,c=0;l>c;c++)t?n(s[c]):r(s[c],e[o])}function n(e){e&&s[e]&&delete s[e]}function r(e,t){i.Reporter.isNullOrUndefined(e)||(s[e]=t)}var o=this,a=!1,s=[];o.get=function(t){return a||(a=!0,o.update(e)),s[t]||null},o.clear=function(){a=!1,s=[]},o.update=function(n,i){!a&&i&&(a=!0,o.update(e)),a&&t(n,!1)},o.removeItemByKey=function(e){a&&n(e)},o.remove=function(e){a&&t(e,!0)}}var t=window,n=t.wLive,i=n.People;i.LazyHash=e}()}),define("crossdomainproxy",["lazyhash"],function(){!function(){function e(e,o,a){function l(e){s.logAction("Pwc_XmlProxyCallback");var t=e.status,r=null;200==t?(p.window=c(),p.window||(s.logAction("Pwc_XmlProxyIframeNotFound"),r=i.document.domain!=m.domain?"HostDomainInvalid":h?h:"UnknownProxyFailure")):r=t,s.addStats(n,g,r,o),a&&a()}function c(){for(var e=null,t=i.document.getElementsByTagName("iframe"),n=0,r=t.length;r>n;n++)try{var o=t[n],a=o.contentDocument?o.contentDocument:o.contentWindow.document;if(a&&a.location.href==d){e=o.contentWindow||o.contentDocument.parentWindow;break}}catch(l){s.logError("Pwc_FindProxyIframeFailure",l)}return e}function u(t){t.origin==i.location.protocol+"//"+e&&t.data&&t.data.startsWith&&t.data.startsWith("pwc:")&&(h=t.data.substring(4))}var d,f,h,p=this,g=(new Date).getTime(),m=i.$Config;if(p.window=null,i.addEventListener)try{i.addEventListener(t,u,0),f=!0}catch(v){}d=i.location.protocol+"//"+e+"/xmlProxy.htm?vn="+i.$Version.encodeURIComponent()+"&domain="+(m.d||m.domain).encodeURIComponent(),r.fetchXML(d,l,"GET",null,null),p.dispose=function(){f&&i.removeEventListener&&i.removeEventListener(t,u,0)}}var t="message",n="LoadXmlProxy",i=window,r=i.$Network,o=i.wLive,a=o.People,s=a.Reporter;o.People.CrossDomainProxy=e}()}),define("storageproxy",["crossdomainproxy"],function(){!function(){function e(){var e=this,n=[],i=null;e.errorCode=null,e.setProxyWindow=function(n,a){try{var s=a?a:t,l=n?s.localStorage:s.sessionStorage;if(l){var c="st_"+Math.round(1e5*Math.random());l.setItem(c,c),l.getItem(c)==c?(l.removeItem(c),i=l):e.errorCode="GetTestValueFailed"}else e.errorCode=a?"CantAccessIframeStorage":"NoStorage"}catch(u){r.logError("Pwc_RestoreAbError",u),e.errorCode=o(u)}a&&e.errorCode&&e.setProxyWindow(!1)},e.remove=function(t){if(i)try{i.removeItem(t)}catch(a){r.logError("Pwc_StorageRemove",a),e.errorCode=o(a)}else delete n[t]},e.get=function(t,a){var s;if(i)try{s=i.getItem(t)}catch(l){r.logError("Pwc_StorageGet",l),e.errorCode=o(l)}else s=n[t];return r.isNullOrUndefined(s)&&(s=a),s},e.getDate=function(t){var n=e.get(t);if(n)try{var i=parseInt(n);return new Date(i)}catch(a){r.logError("Pwc_StorageGetDate",a),e.errorCode=o(a)}return new Date(1)},e.getInt=function(t,n){var i=e.get(t);if(i)try{return parseInt(i)}catch(a){r.logError("Pwc_StorageGetInt",a),e.errorCode=o(a)}return n||0},e.set=function(t,a){if(i)try{i.setItem(t,a)}catch(s){r.logError("Pwc_StorageSet",s),e.errorCode=o(s)}else n[t]=a},e.setDate=function(t,n){n&&e.set(t,n.getTime())},e.dispose=function(){n=null,i=null}}var t=window,n=t.wLive,i=n.People,r=i.Reporter,o=r.getErrorCode;i.StorageProxy=e}()}),define("store",["storageproxy"],function(){!function(){function e(e,m,w,b,C){function S(e,t,n){for(var i=e.getInt(t+f,-1),r=n.length,o=[],a=0;i>=a;a++){for(var s={},l=0;r>l;l++){var c=e.get(t+n[l]+a,null);if(null==c)return _.logAction("Pwc_GetIncrementalResponsesMissingKey"),[];s[n[l]]=c}o[a]=s}return o}function k(){_.logAction("Pwc_ClearAb"),P.remove(r),P.remove(i),P.remove(n),P.remove(o),P.remove(a),P.remove(s),P.remove(c),P.remove(l),x(P,u,[h,p])}function I(e,t,n){var i=e.getInt(t+f,-1)+1;e.set(t+f,i);for(var r in n)"string"==typeof r&&e.set(t+r+i,n[r])}function x(e,t,n){if(e){for(var i=e.getInt(t+f,-1),r=n.length,o=0;i>=o;o++)for(var a=0;r>a;a++)e.remove(t+n[a]+o);e.remove(t+f)}}var T=this,L=null,P=new y,D=new y;T.init=function(t){function n(){var e=L.window?L.window:g;e&&(P.setProxyWindow(m,e),D.setProxyWindow(!0,e),(P.get(r)!==w||P.get(i)!==b)&&k()),C&&C()}L=new v.CrossDomainProxy(e,t,n)},T.setFullSyncRequired=function(e){P.set(c,e)},T.getFullSyncRequired=function(){return P.get(c)},T.setFullAb=function(e,d,f){var g,m=(new Date).getTime();try{P.errorCode=null,x(P,u,[h,p]),P.remove(l),P.set(r,w),P.set(n,e),P.set(i,b),P.setDate(o,f),P.setDate(a,f),P.remove(s),P.remove(c),g=P.errorCode}catch(v){_.logError("Pwc_SetFullAb",v),g=_.getErrorCode(v)}_.addStats(t,m,g,d)},T.clearAbErrorCode=function(){var e=P.errorCode;return P.errorCode=null,e},T.getFullAb=function(){return P.get(n,null)},T.setLastFullSync=function(e){P.setDate(o,e)},T.getLastFullSync=function(){return P.getDate(o)},T.setDeltaSyncRequired=function(e){P.set(s,e)},T.getDeltaSyncRequired=function(){return P.get(s)},T.removeDeltaSyncRequired=function(){P.remove(s)},T.setAbDelta=function(e,t){I(P,u,{json:e,syncKey:t})},T.getAbDeltas=function(){return S(P,u,[h,p])},T.setLastDeltaSync=function(e){P.setDate(a,e)},T.getLastDeltaSync=function(){return P.getDate(a)},T.setDeltaSyncCount=function(e){P.set(l,e)},T.getDeltaSyncCount=function(){return P.getInt(l)},T.setHost=function(e){D.set(d,e)},T.getHost=function(e){return D.get(d,e)},T.clearHost=function(){D.remove(d)},T.clearAb=k,T.dispose=function(){L&&(L.dispose(),L=null),P&&(P.dispose(),P=null),D&&(D.dispose(),D=null)}}var t="PersistAB",n="fullSyncResponse",i="mkt",r="abCid",o="lastFullSync",a="lastDeltaSync",s="deltaSyncRequired",l="deltaSyncCount",c="fullSyncRequired",u="deltaSyncResponse",d="preferredHostName",f="_e",h="json",p="syncKey",g=window,m=g.wLive,v=m.People,y=v.StorageProxy,_=v.Reporter;v.Store=e}()}),define("serviceproxy",["store"],function(){!function(){function ServiceProxy(store,market,peopleApiHostName,peopleApiAppId,handlersBaseUrl,canary){function PwcError(e,t){this.errorCode=t,this.message=e}function buildDefaultHeaders(e){var t={};return t.Pragma="no-cache",t["Cache-Control"]="no-cache",t.Expires="-1",Reporter.isQosEnabled&&e&&w.$ScenarioQoS.addScenarioToHttpHeader(t,e),t}function buildPeopleApiUrl(e,t){var n=store.getHost(peopleApiHostName),i="&cbus="+Math.random();if(!Reporter.isNullOrUndefined(t))for(var r in t)i+="&"+r+"="+t[r].encodeURIComponent();return w.location.protocol+"//"+n+"/people/"+e+"?SerializeAs=compact"+c_marketParam+market.encodeURIComponent()+"&appid="+peopleApiAppId.encodeURIComponent()+"&version="+c_schemaVersion.encodeURIComponent()+i}function buildHandlerUrl(e){return handlersBaseUrl+"/Handlers/PeopleApi/"+e+".mvc"}function parseGetProfilesResponse(e){var t=parseJson(e);if(t&&t.length>0&&t[0]==c_schemaVersion){var n=t[1];return n}return[]}function processPeopleResponse(e,t,n,i,r,o,a){var s=null,l=null,c=[];hasRequestSucceeded(e)||(s=getResponseStatusCode(e));try{l=stripJsonPrefix(e.responseText),c=parsePeopleResponse(l,a)}catch(u){Reporter.logError("Pwc_PeopleParseError",u,!0);var d=s;s=Reporter.getErrorCode(u,s?s:c_parseError),"MissingTicket"==s||"PassportAuthFail"==s||s==c_errorInvalidPassportUser||Reporter.isNullOrUndefined(d)||"200"==d||(s=d+"_"+s)}Reporter.addStats(t,r,getQosErrorCode(e,s),o),null==s?(updatePreferredHostName(e),n(e,l,c)):(store.clearHost(),i(e,s))}function parsePeopleResponse(e,t){var n,i=null,r=parseJson(e);if(r&&r.length){var o=r[1];if(o)o.length>=2?(i=o[0]||"EmptyEvalOrAbError",n=o[1]||"Unspecified error returned",(i==c_errorInvalidPassportUser||"BadArgument"==i&&(-1!=n.toLowerCase().indexOf("resolve the caller")||-1!=n.toLowerCase().indexOf("ticket")))&&(n="Invalid passport user",i=c_errorInvalidPassportUser)):(n="Invalid error response",i="InvalidErrorResponse");else{var a=r[0];a?t||a[2]==c_schemaVersion||(n="Schema mismatch (expected: {0}, returned: {1})".format(c_schemaVersion,a[2]||""),i="SchemaMismatch"):(n="Data is missing in the response",i="EmptyResponseArray")}}else n="Invalid response format",i="InvalidResponse";if(n)throw new PwcError(n,i);return r}function parseJson(rawResponse){var result;try{result=eval(rawResponse)}catch(ex){Reporter.logError("Pwc_ParseJsonFailure",ex),result=[,[ex.name,"Syntax error: "+ex.message]]}return result}function stripJsonPrefix(e){if(!e)throw new PwcError("Empty PWC response","EmptyResponse");if(e.indexOf("<json>")<0)throw new PwcError("JSON prefix not found on PWC response","JsonPrefixNotFound");return e.substring(6,e.length)}function getResponseStatusCode(e){var t=e?e.status:null;return null!==t&&"undefined"!==t?t:c_hostUnreachableError}function hasRequestSucceeded(e){return 200==getResponseStatusCode(e)}function getQosErrorCode(e,t){return hasRequestSucceeded(e)?t:t?t:getResponseStatusCode(e)}function updatePreferredHostName(e){try{var t=Boolean(e)&&Boolean(e.getResponseHeader)?e.getResponseHeader("PreferredHostName"):null;t&&store.setHost(t)}catch(n){Reporter.logError("Pwc_UpdatePreferredHost",n)}}PwcError.prototype=new Error,PwcError.prototype.constructor=PwcError;var _this=this;_this.fullSync=function(e,t,n){function i(i){processPeopleResponse(i,c_WL_People_Cache_Rest_FullSync_ApiId,e,t,r,n)}var r=(new Date).getTime(),o=buildPeopleApiUrl(c_abCore),a=buildDefaultHeaders(n);$Network.fetchXML(o,i,c_get,null,a)},_this.deltaSync=function(e,t,n,i){function r(e){processPeopleResponse(e,c_WL_People_Cache_Rest_DeltaSync_ApiId,t,n,o,i)}var o=(new Date).getTime(),a=buildPeopleApiUrl(c_abCore,{syncKey:e}),s=buildDefaultHeaders(i);$Network.fetchXML(a,r,c_get,null,s)},_this.loadPersonDetails=function(e,t,n,i){function r(e){processPeopleResponse(e,c_WL_People_Cache_Rest_PersonDetails_ApiId,t,n,o,i,!0)}var o=(new Date).getTime(),a=buildPeopleApiUrl(c_personDetails,{contactId:e}),s=buildDefaultHeaders(i);$Network.fetchXML(a,r,c_get,null,s)},_this.loadAllPersonDetails=function(e,t,n,i){function r(e){processPeopleResponse(e,c_WL_People_Cache_Rest_AllPersonDetails_ApiId,t,n,o,i,!0)}var o=(new Date).getTime(),a=null;e&&(a={filter:e});var s=buildPeopleApiUrl(c_allPersonDetails,a),l=buildDefaultHeaders(i);$Network.fetchXML(s,r,c_get,null,l)},_this.loadProfiles=function(e,t,n,i){function r(e){var r=null,a=[];if(hasRequestSucceeded(e))try{a=parseGetProfilesResponse(e.responseText)}catch(s){Reporter.logError("Pwc_ProfilesParseError",s,!0),r=Reporter.getErrorCode(s,c_parseError)}else r=getResponseStatusCode(e);Reporter.addStats(c_WL_People_Cache_Rest_GetProfiles,o,getQosErrorCode(e,r),i),r?n(e,r):t(e,a)}var o=(new Date).getTime(),a=e.join(","),s=buildHandlerUrl(c_getProfilesHandler),l="canary="+canary.encodeURIComponent()+"&cids="+a.encodeURIComponent()+c_marketParam+market.encodeURIComponent(),c=buildDefaultHeaders(i);$Network.fetchXML(s,r,c_post,l,c)},_this.parseProfiles=parseGetProfilesResponse,_this.parseAb=parsePeopleResponse,_this.blockOrUnblockMessenger=function(e,t,n,i){var r=e.getCid();if(r){var o=(t?"Hide":"Unhide")+"Contact";$Network.fetchXML(buildHandlerUrl(o),function(e){var t=e&&"200"===e.responseText,r=t?n:i;r&&r(e.responseText)},"POST","canary="+canary.encodeURIComponent()+"&cid="+encodeURIComponent(r))}}}var c_WL_People_Cache_Rest_GetProfiles="Rest_GetProfiles",c_WL_People_Cache_Rest_FullSync_ApiId="Rest_FullSync",c_WL_People_Cache_Rest_DeltaSync_ApiId="Rest_DeltaSync",c_WL_People_Cache_Rest_PersonDetails_ApiId="Rest_PersonDetails",c_WL_People_Cache_Rest_AllPersonDetails_ApiId="Rest_AllPersonDetails",c_errorInvalidPassportUser="InvalidPassportUser",c_hostUnreachableError="HostUnreachable",c_parseError="ParseError",c_schemaVersion="W5.M2",c_get="GET",c_post="POST",c_getProfilesHandler="GetProfiles",c_abCore="abcore",c_personDetails="PersonDetails",c_allPersonDetails="allPersonDetails",c_marketParam="&market=",w=window,$Network=w.$Network,wLive=w.wLive,People=wLive.People,Reporter=People.Reporter;People.ServiceProxy=ServiceProxy}()}),define("deltasync",["serviceproxy"],function(){!function(){function e(e,n,i){function s(e,t){var i=!1;if(e&&e.length>0){for(var r=n.settings,o=0;o<e.length;o++)e[o]&&e[o]!=r._d[o]&&(r._d[o]=e[o],i=!0);i&&t&&r.$changes.triggerHandler(n.changedEventName)}return i}function l(e,n,i,a,s,l){if(!e)return null;if(typeof e!==r){for(var c=[],u=[],d=[],f=0,h=e.length;h>f;f++){for(var p=e[f],g=-1,m=0,v=n.length;v>m;m++)if(n[m].getId()===p[o]){g=m;break}if(-1!==g){var y=n[g];1===p[s]?(u.push(y),a.remove([y]),n.splice(g,1)):(c.push(y),n[g]._update(p))}else if(1!==p[s]){var _=l(p);d.push(_),a.update([_]),n.push(_)}}if(d.length>0||c.length>0||u.length>0)return new t(i,d,c,u)}return null}function d(e){if(!e)return null;var i={},r=[],o=[],s=[],l=[];g(e,i),m(e,i,r);for(var c in i){var u=n._personHash.get(c),d=u._d;if(u){var f=d[a].length,h=n.getPersonDetails(c);h&&n._personDetailsHash.remove([h]),0===f?(n.persons.remove(u),n._personHash.remove([u]),s.push(u)):(A(d),u._update(d),n._personHash.update([u]),o.push(u))}}for(var p=0,v=r.length;v>p;p++){var y=r[p];A(y);var _=new L.Person(y,n.names);n.persons.push(_),n._personHash.update([_]),l.push(_)}return l.length>0||o.length>0||s.length>0?new t(n.$persons,l,o,s):null}function g(e,t){for(var i=0,r=e.length;r>i;i++)for(var s=e[i],l=s[a],c=0;c<l.length;){var u=l[c],d=u[h],f=n._personHash.get(d);if(f&&(u[1]===P.deleted||s[o]!==f.getId())){var p=f._d,g=p[a],m=x(p,d);-1!=m&&(n._personHash.removeItemByKey(d),t[f.getId()]=1,"WL"===g[m][4]&&(n._personHash.removeItemByKey(f.getCid()),n._personHash.removeItemByKey(f.getHexCid()),b(p)),g.splice(m,1))}u[1]===P.deleted?l.splice(c,1):c++}}function m(e,t,i){for(var r=0,s=e.length;s>r;r++){var l=e[r];if(l[a].length){var d=n._personHash.get(l[o]);if(d&&d.getId()===l[o]){for(var f=d._d,p=l[a],g=f[a],m=0,y=p.length;y>m;m++){var _=p[m],w=x(f,_[h]);t[d.getId()]=1,-1!=w?g[w]=_:g.push(_),"WL"===_[4]&&C(f,l)}v(g),f[c]=l[c],f[u]=l[u]}else i.push(l)}}}function v(e){e.sort(function(e,t){var n=k(e[4]),i=k(t[4]);if(n>i)return 1;if(i>n)return-1;var r=e[h],o=t[h];return r>o?-1:o>r?1:0})}function b(e){for(var t=0,n=y.length;n>t;t++)delete e[y[t]]}function C(e,t){for(var n,i=0,r=y.length;r>i;i++)n=y[i],e[n]=t[n]}function S(e,t){return e[a][t][h]||e[o]}function k(e){var t;if("ABCH"===e)t=-2;else{var i=n.getService(e);t=i?i.getRank():9999}return t}function I(e){var t,i,r=0;if(e[c]){for(t=0,i=e[c].length;i>t;t++){var o=n._categoryHash.get(e[c][t]);if(o&&o._d[2]){r=1;break}}e[u]=r}var s=e[a],l=s[0][16]||e[14]||0;for(t=1,i=s.length;i>t;t++){var d=s[t][16]||e[14]||0;l>d&&(l=d)}e[14]=l}function x(e,t){for(var n=-1,i=e[a],r=0,o=i.length;o>r;r++)if(S(e,r)===t){n=r;break}return n}function T(e){for(var t=e[a],n=e[o],i=0,r=_.length;r>i;i++){for(var s=_[i],l=s.mask,c=s.personFields,u=s.contactFields,d=s.arrayIndex,f=s.isArray,h=!1,g=0,m=t.length;m>g;g++){var v=t[g];if(v[p]&l){if(h=!0,f)for(var y=0,w=c.length;w>y;y++){var b=e[c[y]];b&&(v[u[y]]||(v[u[y]]=[]),v[u[y]][d]=b[d])}else for(var C=0,S=c.length;S>C;C++)v[u[C]]=e[c[C]];v[p]=v[p]&~l}}if(h)for(var k=0,I=s.personFields.length;I>k;k++)f?e[c[k]]&&(e[c[k]][d]=null):e[c[k]]=null}e[o]=n}function D(e,t,n,i,r){for(var o=!0,a=0,s=n.length;s>a;a++){var l=e[n[a]];i&&l&&(l=l[r]),l&&(t[a]=l,o=!1)}return o}function E(e,t,n,i){for(var r=0,o=t.length;o>r;r++){var a=t[r];e[a]&&(n?i<e[a].length&&(e[a][i]=null):e[a]=null)}}function $(e,t,n,i,o,a){for(var s=!0,l=0,c=n.length;c>l;l++){var u=e[n[l]];i&&u&&(u=u[o]);var d=t[l];if(a){if(!a(u,d)){s=!1;break}}else if((typeof u!==r||typeof d!==r)&&u!==d){s=!1;break}}return s}function A(e){T(e),F(e),I(e)}function F(e){for(var t=e[o],n=0,i=f;i>n;n++)w[n]&&delete e[n];e[o]=t,e[35]=(e[35]||0)+1;for(var r=0,s=_.length;s>r;r++){for(var l=_[r],c=l.mask,u=e[a],d=[],h=l.contactFields,g=l.personFields,m=l.isArray,v=l.arrayIndex,y=l.comparer,b=D(e,d,g,m,v),C=0,S=u.length;S>C;C++){var k=u[C];b&&(b=D(k,d,h,m,v)),!b&&$(k,d,h,m,v,y)&&(k[p]=(k[p]||0)|c,E(k,h,m,v))}if(l.isArray&&!e[g[0]]&&(e[g[0]]=[]),!b)for(var I=0,x=Math.min(g.length,d.length);x>I;I++)l.isArray?e[g[I]][l.arrayIndex]=d[I]:e[g[I]]=d[I]}}function N(e){for(var t=e.clone(),n=0,i=t.length;i>n;n++){var r=t[n];"object"==typeof r&&r instanceof Array&&(t[n]=N(r))}return t}var M=this;M.apply=function(e){var t=[],r=i[0],o=r[3],a=r[4],c=r[5],u=r[6],f=r[7],h=s(u,e);t.push(l(f,n.services,n.$services,n._serviceHash,20,function(e){return new L.Service(e)})),t.push(l(a,n.categories,n.$categories,n._categoryHash,3,function(e){return new L.Category(e)})),t.push(l(c,n.groups,n.$groups,n._groupHash,5,function(e){return new L.Group(e)})),t.push(d(o));for(var p=0,g=t.length;g>p;p++)if(null!==t[p]){if(e){var m=t[p];if(m.$event.triggerHandler(n.changedEventName,m),null!=m.changed)for(var v=0;v<m.changed.length;v++)m.changed[v].$changes.triggerHandler(n.changedEventName)}h=!0}return h},M.flatten=function(e){var t=N(e._d);return T(t),new L.Person(t,n.names)},M.clone=function(e){var t=N(e._d);return new L.Person(t,n.names)},M.dedupe=function(e){var t=N(e._d);return F(t),new L.Person(t,n.names)},M.sortContactsByRank=function(e){v(e._d[1]),e._update(e._d)}}function t(e,t,n,i){var r=this;r.$event=e,r.added=t,r.changed=n,r.removed=i}function n(e,t,n,i,r,o){var a=this;a.mask=e,a.personFields=t,a.contactFields=n,a.isArray=i,a.arrayIndex=r,a.comparer=o}function i(e,t){var n=!1;return e&&t&&e.length===t.length&&(n=!0,e.forEach(function(e,i){t[i]!=e&&(n=!1)})),n}for(var r="undefined",o=0,a=1,s=4,l=5,c=12,u=13,d=24,f=35,h=0,p=2,g=9,m=10,v=25,y=[6,7,9,8,15],_=[new n(1,[o],[h]),new n(4,[11],[12]),new n(8,[2,3,19,20,17,18,21,22,30,31],[7,8,20,21,19,18,22,23,31,32]),new n(16,[10,23,28],[11,24,29]),new n(32,[s],[g],1,0),new n(64,[s],[g],1,1),new n(128,[s],[g],1,2),new n(256,[l],[m],1,0),new n(1<<23,[l],[m],1,8),new n(512,[l],[m],1,1),new n(1024,[l],[m],1,2),new n(2048,[l],[m],1,3),new n(4096,[l],[m],1,4),new n(16384,[l],[m],1,6),new n(8192,[l],[m],1,5),new n(32768,[l],[m],1,7),new n(1<<24,[l],[m],1,9),new n(1<<25,[l],[m],1,10),new n(65536,[d],[v],1,0,i),new n(1<<17,[d],[v],1,1,i),new n(1<<18,[d],[v],1,2,i),new n(1<<20,[25,26],[26,27]),new n(1<<21,[27],[28]),new n(1<<22,[29],[30]),new n(1<<19,[16],[17],0,0,i)],w=[],b=0,C=_.length;C>b;b++)for(var S=_[b].personFields,k=0,I=S.length;I>k;k++)w[S[k]]||(w[S[k]]=1);var x=window,T=x.wLive,L=T.People,P=L.ContactState;L.DeltaSync=e,T.People.DeltaSyncEvent=t}()}),define("syncclient",["deltasync"],function(){!function(){function e(e,w,S,k,I){function x(e,t,n,i){for(var r,o=!0,a=null,s=0,l=M.length;l>s;s++){r=M[s];var f=r[g],v=r[d];if(f===e){v||(o=!1,a=r);break}if(e===u&&f===c&&!v){o=!1,a=r;break}}o?(r={},r[g]=e,r[h]=[t],r[p]=[n],r[m]=i,r[d]=!1,M.push(r)):a&&(t||n)&&(t&&a[h].push(t),n&&a[p].push(n),i&&(a[m]=i)),T()}function T(){function t(e,t,n){S.lastFullSync=S.lastDeltaSync=new Date,N.resetTimers(!1),L(t),P(n),S._personDetailsHash.clear(),N.fullSyncRequired=!1,N.deltaSyncRequired=!1,w.setFullAb(t,k[m],S.lastFullSync),M.shift(),D(k[h],"fsSuccess"),T()}function n(e,t){C(t,!1)}function v(n,r,o){S.lastDeltaSync=new Date,w.setLastDeltaSync(S.lastDeltaSync),N.resetTimers(!1);var a=o[0];if(a[8])t(n,r,o);else{w.removeDeltaSyncRequired(),_.setSessionCookie(i,null);var s=new b.DeltaSync(e,S,o),c=s.apply(!0);if(c){var u=a[0];S.syncKey=u,w.setAbDelta(r,u);var d=w.getDeltaSyncCount()+1;w.setDeltaSyncCount(d),d>=l&&(N.fullSyncRequired=!0,w.setFullSyncRequired(!0))}N.deltaSyncRequired=!1,M.shift(),D(k[h],"dsSuccess"),T()}}function y(e,t){C(t,!0)}function C(e,t){if(k[f]=(k[f]||0)+1,k[f]>=s||e===r||e===o||e===a){var n=t?"dsFailure":"fsFailure";M.shift(),t?S.lastDeltaSync=new Date:(S.lastFullSync=new Date,w.setLastFullSync(S.lastFullSync)),N.resetTimers(t,!0),D(k[p],n,[e])}else k[d]=!1;T()}if(0!==M.length){var k=M[0];
k[d]||k[g]===u&&R||(k[g]===c?e.fullSync(t,n,k[m]):k[g]===u&&e.deltaSync(S.syncKey,v,y,k[m]))}}function L(e){for(var t=0,n=0,i=S.persons.length;i>n;n++){var r=S.persons[n]._d[1];r&&r.length&&(t+=r.length)}var o={contactCount:t,responseLength:e.length};C.logDetails("Pwc_FullSync",o),y.reportEvent("View.WLPeopleCache.FullSync",o)}function P(e){for(var t=e[0]||[],n=t[3]||[],i=[],r=0;r<n.length;r++)i[r]=new b.Person(n[r],S.names);for(var o=t[4]||[],a=[],s=0;s<o.length;s++)a[s]=new b.Category(o[s]);for(var l=t[5]||[],c=[],u=0;u<l.length;u++)c[u]=new b.Group(l[u]);for(var d=t[7]||[],f=[],h=0;h<d.length;h++)f[h]=new b.Service(d[h]);var p=new b.Settings(t[6]||[]);S._applyFull(i,a,c,f,p),S.syncKey=t[0]}function D(e,t,n){n=n||[];for(var i=0;i<e.length;)E(e[i],t+"["+i+"]",n),i++;e.splice(0,e.length)}function E(e,t,n){if(e)try{n&&n.length>0?e.apply(null,n):e()}catch(i){C.logError("Pwc_Callback"+t+"Error",i)}}function $(){F=!0}function A(){F=!1,N.deltaSyncRequired&&N.queueDelta()}var F,N=this,M=[],B=new b.IdleTimer($,A),R=!1,H=0,O=null,U=null;N.deltaSyncRequired=!1,N.fullSyncRequired=!1,N.applyFull=function(t){var n=e.parseAb(t);P(n)},N.applyDelta=function(t){var n=e.parseAb(t),i=new b.DeltaSync(e,S,n);i.apply()},N.queueFull=function(e,n,i){function r(){a&&C.stopScenario(i,!0),e&&e()}function o(e){a&&C.stopScenario(i,!1,e),n&&n()}C.logAction("Pwc_FullSyncQueued");var a=!i;i=i||C.startScenario(t),x(c,r,o,i)},N.queueDelta=function(e,t,i){function r(){a&&C.stopScenario(i,!0),e&&e()}function o(e){a&&C.stopScenario(i,!1,e),t&&t()}if(C.logAction("Pwc_DeltaSyncQueued"),w.setDeltaSyncRequired(!0),S.isReady&&!F){if(N.fullSyncRequired)N.queueFull(e,t,i);else{var a=!i;i=i||C.startScenario(n),x(u,r,o,i)}N.deltaSyncRequired=!1}else N.deltaSyncRequired=!0},N.pause=function(){R=!0},N.resume=function(){R=!1,T()},N.resetTimers=function(e,t){if(t){if(++H>=3)return}else H=0;var n=new Date,i=k,r=S.lastFullSync||n,o=S.lastDeltaSync||r;e=e||!1,e||(null!==O&&v.clearTimeout(O),i=Math.max(i-(n.getTime()-r.getTime()),0),O=v.setTimeout(function(){N.queueFull()},i)),null!==U&&v.clearTimeout(U);var a=Math.max(I-(n.getTime()-o.getTime()),0);i>I&&(U=v.setTimeout(function(){N.queueDelta()},a))},N.dispose=function(){B&&B.dispose(),B=null,M=[]}}var t="FullSync",n="DeltaSync",i="wpd",r="InvalidPassportUser",o="PassportAuthFail",a="MissingTicket",s=3,l=20,c="full",u="delta",d="inProgress",f="attempts",h="successCallbacks",p="failureCallbacks",g="requestType",m="qosScenario",v=window,y=v.$BSI,_=v.$Cookie,w=v.wLive,b=w.People,C=b.Reporter;b.SyncClient=e}()}),define("client",["syncclient"],function(){!function(e){function t(t,a,s){var u=this;u.fullSync=function(e,t,n){a.queueFull(e,t,n)},u.deltaSync=function(e,t,n){a.queueDelta(e,t,n)},u.pauseDeltaSync=function(){a.pause()},u.resumeDeltaSync=function(){a.resume()},u.processABChangedEvent=function(t){c.logAction("Pwc_ProcessABChangedEvent");var n=!0;if(t)try{var i=e(e.parseXML(t)),r=i.find("LastModifiedDate");n=Date.parse(s.syncKey)!=Date.parse(r.text()),n||c.logAction("Pwc_ProcessABChangedNoDeltaSyncRequired")}catch(o){c.logError("Pwc_ProcessABChangedFailedEvent",o)}n&&a.queueDelta()};var d={};u.loadPersonDetails=function(e,n,i,o){function a(t,n,i){if(i.length<1)return u(t,"InvalidResponseArray"),void 0;var r=new l.Person(i[0],s.names);s._personDetailsHash.update([r],!0),f&&c.stopScenario(o,!0);for(var a=0;a<p.successCallbacks.length;a++)p.successCallbacks[a](r);d[e]=null}function u(t,n){c.logDetails("Pwc_DetailsData",{contactId:e,errorCode:n}),f&&c.stopScenario(o,!1,n);for(var i=0;i<p.failureCallbacks.length;i++)p.failureCallbacks[i](t,n);d[e]=null}var f=!o,h=!1;d[e]||(d[e]={successCallbacks:[],failureCallbacks:[]},h=!0);var p=d[e];n&&p.successCallbacks.push(n),i&&p.failureCallbacks.push(i),h&&(o=o||c.startScenario(r),t.loadPersonDetails(e,a,u,o))},u.loadAllPersonDetails=function(e,n,i,r){function a(e,t,i){if(i.length<1)return u(e,"InvalidResponseArray"),void 0;for(var o=i[0],a=[],f=0;f<o.length;f++)a[f]=new l.Person(o[f],s.names);s._personDetailsHash.update(a,!0),d&&c.stopScenario(r,!0),n&&n()}function u(e,t){d&&c.stopScenario(r,!1,t),i&&i()}var d=!r;r=r||c.startScenario(o),t.loadAllPersonDetails(e,a,u,r)},u.loadProfiles=function(e,r,o,a){function l(e,t,n){m++;var i=[],o=[];s._addProfiles(t);for(var l=0;l<n.length;l++)s.getPerson(n[l])?i.push(n[l]):o.push(n[l]);m>=g&&v&&c.stopScenario(a,!_,y),r&&r(i,o)}function u(e,t,n){m++,_=!0,y=t,m>=g&&v&&c.stopScenario(a,!_,y),o&&o(n)}for(var d=[],f=[],h=0,p=e.length;p>h;h++)s.getPerson(e[h])?f.push(e[h]):d.push(e[h]);var g=0,m=0,v=!1,y=null,_=!1;if(d.length>0)for(v=!a,a=a||c.startScenario(i);d.length>0;){var w=d.length>n?n:d.length,b=d.splice(0,w);t.loadProfiles(b,function(e,t){l(e,t,b)},function(e,t){u(e,t,b)},a)}(0==d.length||f.length>0)&&r&&r(f,[])},u.blockOrUnblockMessenger=function(e,n,i,r){t.blockOrUnblockMessenger(e,n,i,r)},u.dispose=function(){t=null,a=null,s=null}}var n=122,i="GetProfiles",r="PersonDetails",o="AllPersonDetails",a=window,s=a.wLive,l=s.People,c=l.Reporter;l.Client=t}(window.originaljQuery||jQuery)}),define("networkid",["client"],function(){!function(){var e=window.wLive.People.NetworkID=function(){};e.skype="SKYPE",e.windowsLive="WL",e.shortCircuit="SCD",e.facebook="FB",e.google="GOOG"}()}),define("sortorder",["networkid"],function(){!function(){var e=window.wLive.People.SortOrder=function(){};e.none=0,e.displayName=1,e.messagingRelevance=2,e.peopleRelevance=3}()}),define("cache",["sortorder"],function(){!function(e){function t(t,c,h){function p(e,t){e.splice(0,e.length),e.addRange(t||[])}function g(e,t,i){if(e)for(var r=0,o=e.length;o>r;r++){var a=e[r][t];if(typeof a!==n&&a===i)return e[r]}return null}function m(e,t){var n=[];if(e.filter)n=e.filter(t);else for(var i=0;i<e.length;i++)t(e[i])&&n.push(e[i]);return n}function v(){y.profiles.splice(0,y.profiles.length),y.persons.splice(0,y.persons.length),y.categories.splice(0,y.categories.length),y.groups.splice(0,y.groups.length),y.services.splice(0,y.services.length),k.clear(),_.clear(),b.clear(),C.clear(),S.clear()}var y=this;y.readyEventName=r,y.failureEventName=i,y.disposeEventName=o,y.changedEventName=a,y.fullSyncEventName=s,y.persons=[],y.categories=[],y.groups=[],y.services=[],y.profiles=[],y.settings=new u.Settings([]);var _=new d(y.persons),w=new d([]),b=new d(y.categories),C=new d(y.groups),S=new d(y.services),k=new d(y.profiles),I=[],x=[],T=!1;y.$persons=e({}),y.$categories=e({}),y.$groups=e({}),y.$services=e({}),y.$events=e(y),y.client=null,y.names=new u.Names(t.isLastNameFirst,t.nameType,t.nns,t.profileUrl,t.photosUrl),y.isReady=!1,y.isFailed=!1,y.lastFullSync=null,y.lastDeltaSync=null,y.syncKey=null,y._personHash=_,y._personDetailsHash=w,y._categoryHash=b,y._groupHash=C,y._serviceHash=S,y.getMe=function(){return y.getPerson(l.$Config.cid)},y.getPerson=function(e){var t=_.get(e);return null===t&&(t=k.get(e)),t},y.getPersons=function(e,t){var i=y.persons.slice(0);if(e){var r;typeof e.isOnline!==n&&(r=e.isOnline?function(e){return e.isOnline()}:function(e){return!e.isOnline()},i=m(i,r)),typeof e.isIMCapable!==n&&(r=e.isIMCapable?function(e){return e.getMessagingAddresses().length>0}:function(e){return 0==e.getMessagingAddresses().length},i=m(i,r)),typeof e.hasPicture!==n&&(r=e.hasPicture?function(e){return e.getUserTile()&&!0}:function(e){return!e.getUserTile()&&!0},i=m(i,r)),!t||t!=f.messagingRelevance&&t!=f.peopleRelevance||(r=t==f.messagingRelevance?function(e){return e.getMessagingRelevance()>=0}:function(e){return e.getPeopleRelevance()>=0},i=m(i,r)),e.networks&&e.networks instanceof Array&&e.networks.length>0&&(r=function(t){for(var n=t.getContacts(),i=0;i<n.length;i++)if(e.networks.contains(n[i].getSourceId()))return!0;return!1},i=m(i,r))}var o=t?t:f.none;switch(o){case f.displayName:i.sort(function(e,t){return e.getDisplayNameWithFallback().localeCompare(t.getDisplayNameWithFallback())});break;case f.messagingRelevance:i.sort(function(e,t){return t.getMessagingRelevance()-e.getMessagingRelevance()});break;case f.peopleRelevance:i.sort(function(e,t){return t.getPeopleRelevance()-e.getPeopleRelevance()});break;case f.none:}return i},y.getFavorites=function(){for(var e=[],t=0,n=y.categories.length;n>t;t++)if(y.categories[t].getIsFavorite()){e=y.getPersonsByCategory(y.categories[t].getId());break}return e},y.getPersonsByEmail=function(e){var t=[];if(e){e=e.toLowerCase();for(var n=0,i=y.persons.length;i>n;n++)for(var r=y.persons[n].getContactEmails(),o=0,a=r.length;a>o;o++)if(r[o]&&r[o].toLowerCase()===e){t.push(y.persons[n]);break}}return t},y.getPersonsByCategory=function(e){for(var t=[],n=0,i=y.persons.length;i>n;n++){var r=y.persons[n]._d[12];r&&r.contains(e)&&t.push(y.persons[n])}return t},y.getPersonsByService=function(e){for(var t=[],n=0,i=y.persons.length;i>n;n++){var r=y.persons[n],o=g(r._d[1],4,e);o&&t.push(r)}return t},y.getPersonDetails=function(e){var t=w.get(e);return t},y.removePersonDetails=function(e){var t=w.get(e);t&&w.remove(t)},y.getContactIdsForMri=function(e){var t=[];if(e){e=e.toLowerCase();for(var n=0,i=y.persons.length;i>n;n++)for(var r=y.persons[n]._d[1],o=0,a=r.length;a>o;o++){var s=r[o];if(s[3]){var l=s[3][0];if(l)for(var c=0,u=l.length;u>c;c++)if(l[c].toLowerCase()==e){t.push(s[0]);break}}}}return t},y.getCategory=function(e){var t=b.get(e);return t},y.getService=function(e){var t=S.get(e);return t},y.reset=function(){v(),c.clearAb(),c.clearHost()},y.callWhenReady=function(e,t){function n(){y.$events.unbind(i,n);for(var e=0;e<x.length;e++)x[e]();x=[]}function o(){y.$events.unbind(r,o);for(var e=0;e<I.length;e++)I[e]();I=[]}y.isReady&&e?e():(0===I.length&&y.$events.bind(r,o),I.push(e),t&&(y.isFailed?t():(0===x.length&&y.$events.bind(i,n),x.push(t))))},y.removeWhenReadyCallback=function(e,t){if(I){var n=I.indexOf(e);-1!=n&&I.splice(n,1),t&&(n=x.indexOf(t),-1!=n&&x.splice(n,1))}},y.dispose=function(){T=!0,y.$events.triggerHandler(o),y._disposeCache()},y.processABChangedEvent=function(e){y.client.processABChangedEvent(e)},y._flatten=function(e){var t=new u.DeltaSync(h,this,null);return t.flatten(e)},y._clone=function(e){var t=new u.DeltaSync(h,this,null);return t.clone(e)},y._sortContactsByRank=function(e){var t=new u.DeltaSync(h,this,null);t.sortContactsByRank(e)},y._dedupeContacts=function(e){var t=new u.DeltaSync(h,this,null);return t.dedupe(e)},y._addProfiles=function(e){for(var t=[],n=0;n<e.length;n++){var i=new u.Person(e[n],y.names);if(k.get(i.getId())){for(var r=0;r<y.profiles.length;r++)if(y.profiles[r].getId()==i.getId()){y.profiles[r]=i;break}}else y.profiles.push(i),t.push(i)}k.update(t)},y._applyFull=function(e,t,n,i,r){p(y.persons,e),p(y.categories,t),p(y.groups,n),p(y.services,i),y.settings=r,_.clear(),b.clear(),C.clear(),y.isReady&&y.$events.triggerHandler(s)},y._getProfile=function(e){var t=k.get(e);return t},y._find=function(e){function t(e,t){for(var n=0;n<e.length;n++){var i=e[n].getDisplayName();if(i&&t&&i.toLowerCase().indexOf(t.toLowerCase())>=0)return e[n]}return null}var n=t(y.persons,e);return n||t(y.profiles,e)},y._snapshot=function(){function e(t){if(t)if(t instanceof Array)for(var n=0;n<t.length;n++)e(t[n]);else{var i=[];for(var r in t)r.startsWith("get")&&"getPerson"!=r&&"function"==typeof t[r]&&i.push(r);for(var o=0;o<i.length;o++){var a=t[i[o]]();t[i[o].substr(3)]=a,a&&("function"==typeof a||a instanceof Array)&&e(a)}}}e(y.persons),e(y.profiles),e(y.categories),e(y.groups),e(y.services),e(y.settings)},y._disposeCache=function(){T||(y.$events.unbind(r),y.$events.unbind(i),y.$events.unbind(s),y.$persons.unbind(a),y.$categories.unbind(a),y.$groups.unbind(a),y.$services.unbind(a),y.profiles=null,y.services=null,y.categories=null,y.groups=null,y.persons=null,y.settings=null)}}var n="undefined",i="failure",r="ready",o="dispose",a="changed",s="fullSync",l=window,c=l.wLive,u=c.People,d=u.LazyHash,f=u.SortOrder;u.Cache=t}(window.originaljQuery||jQuery)}),define("pwcinitializer",["cache"],function(){!function(e){function t(){function t(){if(!b)if(L.isReady)h(I,!0);else{var e=x.getFullSyncRequired();if(f.logAction("Pwc_InitCacheFullSyncRequired"),!e&&s()){var t=S.deltaSyncInterval?parseInt(S.deltaSyncInterval):3e5;P.deltaSyncRequired&&(L.lastDeltaSync=new Date((new Date).getTime()-t),P.deltaSyncRequired=!1,f.logAction("Pwc_InitCacheDeltaSyncRequired")),P.resetTimers(),m()}else c()}}function s(){var e=!1,t=(new Date).getTime(),n=x.clearAbErrorCode(),r=x.getFullAb();if(n=x.clearAbErrorCode()||n,r){try{P.applyFull(r),L.lastFullSync=x.getLastFullSync(),L.lastDeltaSync=x.getLastDeltaSync();for(var a=x.getAbDeltas(),s=0;s<a.length;s++)P.applyDelta(a[s].json);e=!0,P.deltaSyncRequired=x.getDeltaSyncRequired()||"1"===g.getSessionCookie(o)}catch(l){f.logError("Pwc_RestoreAbError",l),n=f.getErrorCode(l)}e||x.clearAb()}return f.addStats(i,t,n,I),e}function c(){if(S.initOnPageLoad)if(p.isLoading()){var e,t=!1;e=function(){t||(e&&(p.removeLoadedCallback(e),t=!0),u())},p.addLoadedCallback(e)}else u();else h(I,!0)}function u(){L.isReady?P.resetTimers():S.fullSyncDelay?l.setTimeout(function(){D.fullSync(m,v,I)},S.fullSyncDelay):D.fullSync(m,v,I)}function m(){L.isReady=!0,L.isFailed=!1,g.setSessionCookie(a,"1"),h(I,!0),L.$events.triggerHandler(L.readyEventName)}function v(){L.isReady=!1,L.isFailed=!0,g.setSessionCookie(a,null),h(I,!1,"fullSyncFailure"),L.$events.triggerHandler(L.failureEventName)}function y(){L.reset()}function _(){b=!0,l.$Logout&&S.enabled&&!S.fullyDisabled&&C.hcid&&l.$Logout.remove(y),e(l).unbind(r,_),x&&(x.dispose(),x=null),L&&(L.$events.unbind(L.disposeEventName,_),L._disposeCache(),L=null),P&&(P.dispose(),P=null)}var w=this,b=!1,C=l.$Config||{},S=C.ContactCache||{},k=C.mkt?C.mkt.toLowerCase():"";f.isQosEnabled=S.qos;var I,x=new d.Store(S.peopleApiBaseUrl,S.localStorage,C.hcid,k,t),T=new d.ServiceProxy(x,k,S.peopleApiBaseUrl,S.peopleApiAppId,C.handlerBaseUrl,S.canary),L=new d.Cache(S,x,T),P=new d.SyncClient(T,x,L,S.fullSyncInterval,S.deltaSyncInterval),D=new d.Client(T,P,L);L.client=D,L.$events.bind(L.disposeEventName,_),w.cache=L,S.enabled&&!S.fullyDisabled&&C.hcid&&(I=f.startScenario(n),l.$Logout&&l.$Logout.add(y),x.init(I))}var n="Init",i="RestoreAB",r="unload",o="wpd",a="wpc",s="$pwc",l=window,c=l.$Do,u=l.wLive,d=u.People,f=d.Reporter,h=f.stopScenario,p=l.$BSI,g=l.$Cookie,m=new t;l[s]=m.cache,c.register(s,0,!0)}(window.originaljQuery||jQuery)}),define("iccommondata",["jquery-1.7.2","pagestats","pwcinitializer"],function(){!function(){function e(){function e(){return i||(i=t.ic_common_data),i||{}}function n(){return r||(r=t.ic_menu_data),r||{}}var i,r,o=this;o.getActionData=function(e){return n()[e]},o.getReturnUrl=function(){return e().ru||location.href},o.getActionDescription=function(e){return n()[e][0]||""}}var t=window,n=t.wLive||{};n.IC=n.IC||{};var i=n.IC;i.ICCommonData=new e}()}),define("ictemplate",["iccommondata"],function(){!function(e){function t(t,n,i){function r(e){return c>e?n[e]:null}function o(){return l++}var a,s=this,l=0,c=n.length;s.id=t,s.html=i.html(),s.getNewId=function(){return t+o()},s.getCid=function(){return r(0)},s.getShowCard=function(){return"1"==r(1)},s.getMenuActions=function(){return r(2)},s.getName=function(){return r(3)},s.getEmail=function(){return r(6)},s.getUserTileUrl=function(){return r(17)},s.getTileSize=function(){if(!a){var n=e("#{0}_{1}".format(t,"usertilecontainer"),i);if(n.length>0){var r=n.attr("class").split(" ");if(r&&r[1])return r[1].replace("c_ic_img_","")}else a="none"}return a},s.dispose=function(){i=null,n=null}}var n=window,i=n.wLive;i.IC=i.IC||{};var r=i.IC;r.ICTemplate=t}(window.originaljQuery||jQuery)}),define("ictemplates",["ictemplate"],function(){!function(e){function t(){function t(e){if(e.startsWith("icTm")){var t=e.indexOf("_template"),n=t>=0?t:e.length;return e.substring(4,n)}return e}var i=this,o={};i.init=function(){n.icPwcData&&i.addTemplates(n.icPwcData)},i.addTemplates=function(n){if(n)for(var i in n){var a=t(i);o[a]&&o[a].dispose(),o[a]=new r.ICTemplate(i,n[i],e("#{0}_template".format(i)))}},i.getTemplate=function(e){return e=t(e),o[e]?o[e]:null},i.dispose=function(){for(var e in o)o[e].dispose(),delete o[e];o=null},i.init()}var n=window,i=n.wLive;i.IC=i.IC||{};var r=i.IC;r.ICTemplates=t}(window.originaljQuery||jQuery)}),define("icaction",["ictemplates"],function(){!function(e){function t(e,n){var i=this;i.id=t.id,i.isEnabled=function(){return e&&e.getContactEmails().length>0||n},i.getAvailableOptions=function(){var t=[],i=e?e.getContactEmails():[];n&&t.push({id:n,displayName:n});for(var r=0;r<i.length;r++)n&&i[r]==n||t.push({id:i[r],displayName:i[r]});return t},i.performAction=function(e){if(p.getActionData(i.id)){var t=i.getAvailableOptions(),n=e||t.length>0&&t[0].id;if(n){var r=p.getActionData(i.id)[1].replace("$address$",n).replace("$ru$",encodeURIComponent(p.getReturnUrl())),o=c.wLive&&c.wLive.Hotmail?null:"_blank";$BSI.navigateTo(r,o)}}},i.dispose=function(){}}function n(e){var t=this;t.id=n.id,t.isEnabled=function(){return e&&!e.isMe()&&e.getId()},t.getAvailableOptions=function(){return[]},t.performAction=function(){if(e&&p.getActionData(t.id)){var n=p.getActionData(t.id)[1].replace("$contactid$",e.getId());c.open(n,"_blank")}},t.dispose=function(){}}function i(e){var t=this;t.id=i.id,t.isEnabled=function(){return e&&e.isMe()},t.getAvailableOptions=function(){return[]},t.performAction=function(){if(p.getActionData(t.id)){var e=p.getActionData(t.id)[1];c.open(e,"_blank")}},t.dispose=function(){}}function r(e,t,n){var i,o=this;o.id=r.id,o.setWebImContact=function(e){i=e},o.isEnabled=function(){return i&&e&&!e.isMe()&&e.canChat(t)},o.getAvailableOptions=function(){var t=[];if(e&&i)for(var n=e.getMessagingAddresses(),r=0;r<n.length;r++)n[r].canChat()&&t.push({id:n[r].get_id(),displayName:n[r].get_network().get_name()});return t},o.performAction=function(t,r){var o=s(e.getMessagingAddresses(),t);$WLXIM.startConversation(i,o?o.get_type():0,a(n),o?o.get_network():null,r)},o.dispose=function(){}}function o(e,t,n,i){var r,c=this;c.id=t?o.audioId:o.videoId,c.setWebImContact=function(e){r=e},c.isEnabled=function(){return r&&e&&!e.isMe()&&e.canCall(n)},c.getAvailableOptions=function(){var t=[];if(e&&r)for(var n=e.getMessagingAddresses(),i=0;i<n.length;i++)n[i].canCall()&&t.push({id:n[i].get_id(),displayName:n[i].get_network().get_name()});return t},c.performAction=function(n,o){var c=s(e.getMessagingAddresses());t?$WLXIM.startVideoCall(r,a(i),c,o):$WLXIM.startAudioCall(r,a(i),c,o),l()},c.dispose=function(){}}function a(e){return e=e||f,h[e]||e}function s(e,t){var n=null;if(t)for(var i=0;!n&&i<e.length;i++)e[i].get_id()==t&&(n=e[i])}function l(){function t(){e(n).unbind("pluginLoaded",t),e(n).unbind("callFinished",t),$header.hideLoading()}var n=window.Microsoft.Live.Messenger.Services.SkyJSHelper;n.skypeEnabled&&$header&&($header.showLoading(),e(n).bind("pluginLoaded",t),e(n).bind("callFinished",t))}var c=window,u=c.wLive,d=u.IC,f="identityControl",h={PeoplePane:"peoplePane"},p=d.ICCommonData;d.ICActionEmail=t,t.id="se",d.ICActionContactDetails=n,n.id="cd",d.ICActionEditProfile=i,i.id="ep",d.ICActionSendIm=r,r.id="si",d.ICActionCall=o,o.videoId="vc",o.audioId="ac"}(window.originaljQuery||jQuery)}),define("icpresence",["icaction"],function(){!function(e){function t(t,i){function s(){d=n.$WLXIM,d&&f&&!g&&!_&&(e(f).bind(o,c),m[r.ICActionEmail.id]=new r.ICActionEmail(f,h),m[r.ICActionEditProfile.id]=new r.ICActionEditProfile(f),m[r.ICActionContactDetails.id]=new r.ICActionContactDetails(f),m[r.ICActionSendIm.id]=new r.ICActionSendIm(f,t,i),m[r.ICActionCall.videoId]=new r.ICActionCall(f,!1,t,i),m[r.ICActionCall.audioId]=new r.ICActionCall(f,!0,t,i),g=!0,l(),$Do.when("$WLXIM.UserSignedIn",0,function(){!_&&f.getId()&&(u=f.isMe()?d.user.get_contact():d.user.findContactById(f.getContacts()[0].getId()),u&&(m[r.ICActionSendIm.id].setWebImContact(u),m[r.ICActionCall.videoId].setWebImContact(u),m[r.ICActionCall.audioId].setWebImContact(u),l()))}))}function l(){var t=p.isOnline(),n=v!=t;v=t;for(var i in m){var r=m[i].isEnabled();n=n||r!=y[i],y[i]=r}n&&e(p).trigger(a)}function c(){l()}var u,d,f,h,p=this,g=!1,m={},v=!1,y={},_=!1;y[r.ICActionEmail.id]=!1,y[r.ICActionContactDetails.id]=!1,y[r.ICActionEditProfile.id]=!1,y[r.ICActionSendIm.id]=!1,y[r.ICActionCall.videoId]=!1,y[r.ICActionCall.audioId]=!1,p.actions=m,p.setPerson=function(e,t){f=e,h=t,s()},p.isOnline=function(){return f&&f.isOnline(t)},p.dispose=function(){for(var t in m)m[t].dispose(),delete m[t];m=null,e(f).unbind(o,c),u=null,_=!0},$Do.when("wlxim",0,s)}var n=window,i=n.wLive,r=i.IC,o="changed",a="presenceChanged";r.ICPresence=t}(window.originaljQuery||jQuery)}),define("iccard",["icpresence"],function(){!function(e){function t(){if(!i){var t=e("#"+s);0==t.length?(i=e("<div>").prop("id",s),e("body").prepend(i),r.$Sutra&&sutra(i,d+"ICMenuList")):i=t}return i}function n(n,i){function o(){i&&e(i).bind(u,D)}function s(i){E=e("<ul>"),E.addClass(l),E.prop("id",n.id+"_menu_ul"),E.html(w()),b(),D(),t().append(E);var r={offset:{x:0,y:5},nofocus:1,hoverDelay:c,menuEl:E[0]};if($menu.create(i,0,r),$=E[0].binding,S(),A&&!A.isMe()){var o=P();o.Template=n.template.id,o.hasContactDetails=_(a.ICActionContactDetails.id),o.hasEmail=_(a.ICActionEmail.id),o.hasIM=_(a.ICActionSendIm.id),o.hasVideoVoiceCall=_(a.ICActionCall.videoId)||_(a.ICActionCall.audioId),$BSI.reportEvent("View.IC.Nav",o)}}function _(e){return i&&i.actions[e]&&i.actions[e].isEnabled()?1:0}function w(){var e="",t=_(a.ICActionContactDetails.id)?p:h,r=t.format(n.getName().encodeHtml(),n.getEmail().encodeHtml(),a.ICActionContactDetails.id);if(i){A&&A.isMe()&&(r=p.format(n.getName().encodeHtml(),y.getActionDescription(a.ICActionEditProfile.id).encodeHtml(),a.ICActionEditProfile.id));for(var o=0;o<m.length;o++){var s=m[o],l=y.getActionDescription(s).encodeHtml();e+=f.format(s,l,C(s))}}return r+e}function b(){r.$Sutra&&E&&E.length>0&&(sutra(E,d+"ICMenu"),sutra(e("#"+a.ICActionEditProfile.id,E),d+"ICMenuEditProfile"),sutra(e("#"+a.ICActionContactDetails.id,E),d+"ICMenuContactDetails"),sutra(e("#"+a.ICActionEmail.id,E),d+"ICMenuSendEmail"),sutra(e("#"+a.ICActionSendIm.id,E),d+"ICMenuStartIM"),sutra(e("#"+a.ICActionCall.videoId,E),d+"ICMenuVideoCall"),sutra(e("#"+a.ICActionCall.audioId,E),d+"ICMenuAudioCall"),sutra(e(".c_ic_menu_name",E),d+"ICMenuName"),sutra(e(".c_ic_menu_sub",E),d+"ICMenuSub"))}function C(t){var n;switch(t){case"si":n=g.IM;break;case"se":n=g.Mail;break;case"vc":n=g.Video;break;case"ac":n=g.Audio}return n?e($IS.CreateFromConfig("ic/icmenu2_gray.png,ic/icmenu2_gray.png,",n,$Config.imgsBase)).html():""}function S(){for(var t=0;t<m.length;t++)T(m[t]);e("#ep a",E).bind("click",function(){i.actions[a.ICActionEditProfile.id].performAction()}),e("#cd a",E).bind("click",function(){i.actions[a.ICActionContactDetails.id].performAction()})}function k(){for(var t=0;t<m.length;t++)x(m[t]);e("#ep a",E).unbind(),e("#cd a",E).unbind()}function I(){$&&($.dispose(),$=null),E&&(k(),E.remove(),E=null)}function x(t){e("#"+t,E).unbind()}function T(t){function r(e){$IS.toggle(o[0],e-a),a=e}var o=e("#"+t,E),a=1;o.hover(function(){r(2)},function(){r(1)}),o.bind("mousedown",function(){r(3)}),o.bind("mouseup",function(){r(1)}),o.bind("mouseup",function(){r(1)}),i.actions[t]&&o.bind("click",function(e){e&&e.preventDefault(),i.actions[t].performAction(null,o[0]),F.hide();var r=P();r.IdentityControlNav=L(t),r.Template=n.template.id,$BSI.reportEvent("SelectClick.IC.Nav",r)})}function L(e){switch(e){case a.ICActionEditProfile.id:return"Profile";case a.ICActionContactDetails.id:return"CDMenu";case a.ICActionEmail.id:return"Email";case a.ICActionSendIm.id:return"IM";case a.ICActionCall.videoId:return"Video";case a.ICActionCall.audioId:return"Voice"}return"UnknownAction"}function P(){var e={},t={};if(A)for(var n=A.getContacts(),i=0;i<n.length;i++)t[n[i].getSourceId()]=!0;for(var r=0;r<v.length;r++)e[v[r]]=t[v[r]]||!1;return e}function D(){if(E&&i){for(var t=0;t<m.length;t++){var n=m[t],r=e("#"+n,E);i.actions[n]&&i.actions[n].isEnabled()?r.css("display",""):r.hide()}$&&$.update()}}var E,$,A,F=this;F.setPerson=function(e){A=e},F.show=function(e){E||s(e),$&&!$.isOpen()&&$.show()},F.hide=function(){$&&$.isOpen()&&$.hide()},F.toggleVisibility=function(){$&&$.toggleState()},F.dispose=function(){i&&(e(i).unbind(u,D),i=null),I()},o()}var i,r=window,o=r.wLive,a=o.IC,s="c_ic_menus",l="c_ic_menu c_m t_hovl",c=625,u="presenceChanged",d="$Sutra.Shared.",f='<li id="{0}" class="c_ic_menu_glyph"><a href="#" alt="{1}" tabindex="1" role="menuitem"><span class="is_c">{2}</span></a></li>',h='<li id="{2}"><span><div class="c_ic_menu_name">{0}</div><div class="c_ic_menu_sub">{1}</div></span></li>',p='<li id="{2}"><a href"#" tabIndex="1" role="menuitem"><div class="c_ic_menu_name">{0}</div><div class="c_ic_menu_sub">{1}</div></a></li>',g={Mail:"1,0,30,31,",IM:"32,0,30,31,",Audio:"63,0,30,31,",Video:"94,0,30,31,"},m=[a.ICActionEmail.id,a.ICActionSendIm.id,a.ICActionCall.videoId,a.ICActionCall.audioId],v=["ABCH","FB","GOOG","LI","MYSP","SINWE","SKYPE","SCD","TWITR","WL"],y=a.ICCommonData;a.ICCard=n}(window.originaljQuery||jQuery)}),define("ic",["iccard"],function(){!function(e){function t(t,u,d){function f(){var e=t.getTileSize();if(!P.isMe()&&("mxl"==e||"mxxl"==e)){var n=P.getContacts(),i=n.length>0?n[0].getId():null;i&&($pwc.getPersonDetails(i)?(D=$pwc.getPersonDetails(i),p(!0)):$pwc.client.loadPersonDetails(i,function(){D=$pwc.getPersonDetails(i),p(!0)}))}}function h(){if($){var e=O;H=!1,R.deactivate(),R.render(),M.replaceWith($),U=!0,e&&R.activate()}}function p(e){var t=S();!B||H&&!e||(H=!0,B.prop("src")==t?g():(B.bind("load",g),B.bind("error",m),t?B.prop("src",n.$ssl.ensureSSLImageUrl(t)):B.prop("src",B.prop("errsrc")||$icerrsrc)))}function g(){try{c[B.prop("src")]=1,B.attr("class","c_ic_tile");var e,t,n=0;t=B[0].naturalWidth,e=B[0].naturalHeight;var i=B.css("width"),r=B.css("height");if(1==t&&1==e||"1px"==i&&"1px"==r)return m(),void 0;var o=Math.round;if(t&&e&&t!=e)if(t>e){var a=parseInt(r),s=parseInt(i),l=o(t*(a/e));n=-o((l-s)/2),B.css({width:"auto","max-width":"none",left:n+"px"})}else B.css({height:"auto","max-height":"none"});B.css("visibility","")}catch(u){N&&N.logError("IC_OnUserTileLoad_Error",u)}}function m(){var e;try{e=B.parent(),B.remove();var t=B.attr("errsrc")||$icerrsrc;B.attr("src")!=t&&(B.attr("class","c_ic_tile").css("top","").css("left","").css("height","").css("width",""),setTimeout(function(){B.attr("src",t).css("visibility","")},0))}catch(n){N&&N.logError("IC_OnUserTileError_Error",n)}finally{null!=e&&e.append(B)}}function v(){var t=e(x("frame"),M),n=e(x("bar"),M),i=!d.hidePresence&&A.isOnline();t.length>0?$IS.setClass(t[0],i?l:s):(n.removeClass(i?s:l),n.addClass(i?l:s))}function y(){var t=e(x("bar"),M);t.css("visibility","inherit")}function _(){var t=I(),n=k();R.getShowICCard()&&P&&(t=""),e(x("frame_clip"),M).attr("title",t),e(x("usertile"),M).attr("alt",t);var i=e(x("name"),M);i.attr("title")&&i.attr("title",n)}function w(){return P&&P.getIsFavorite()}function b(){return d.showICCard&&t.getShowCard()}function C(){var e=d.name||P&&P.getDisplayNameWithFallback(),n=t.getName();return n="{0}"==n?null:n,e||n||""}function S(){var e=t.getUserTileUrl(),n=P&&P.isMe()&&!L(e)?e:null;return n||d.userTileUrl||D&&D.getUserTile()||P&&P.getUserTile()||t.getUserTileUrl()}function k(){var e=d.email;if(!e&&P){var n=P.getContactEmails();n.length>=0&&(e=n[0])}return e||t.getEmail()}function I(){if("none"==d.toolTipType)return"";var e;return e=d.toolTipType&&"email"!=d.toolTipType&&C()?C():k(),e||""}function x(e){return"#{0}_{1}".format(E,e)}function T(e){return!o||null!=e&&""!=e?e:'""'}function L(e){return e.indexOf("blueman")>=0}d=d||{};var P,D,E,$,A,F,N,M,B,R=this,H=!1,O=!1,U=!0,j=!1;R.person=null,R.pwcId=u,R.template=t,R.init=function(){R.id=E=t.getNewId(),R.namespace=d.namespace,A=new r.ICPresence(d.useActiveMessagingAddress),F=new r.ICCard(R,A),u&&$Do.when("$pwc",0,function(){$pwc.callWhenReady(function(){j||(N=i.People.Reporter,R.person=P=$pwc.getPerson(u),P&&(A.setPerson(P,k()),F.setPerson(P),_(),f()),$&&h())})})},R.render=function(){var n=C().encodeHtmlAttribute(),i=I().encodeHtmlAttribute();$=t.html.replace(new RegExp(t.id,"g"),E).format(n,"","",T(i));var r=S();if(c[r]){var o=e("<div></div>").html($),a=e(x("usertile"),o);a.prop("src",r),a.addClass("c_ic_tile"),a.css("visibility",""),$=o.html()}return $},R.activate=function(n){if(!O&&!j){if(U){if(U=!1,M=n||e("#"+E),M.addClass("icpwc"),B=e(x("usertile"),M),_(),w()){var i=e(x("fstarp"),M);if(i.length>0){i.removeClass("c_ic_fstarp_hide");var r=e(x("name"),M);r.length>0&&r.parent().addClass("c_ic_name_fstar_"+t.getTileSize())}}R.getShowICCard()||e(x("usertilecontainer"),M).addClass("c_emptymenu"),y()}e(A).bind(a,v),v(),setTimeout(p,0),O=!0}},R.deactivate=function(){O&&!j&&(e(A).unbind(a,v),M&&(e(x("frame_clip"),M).unbind(".ic"),e(x("name"),M).unbind()),B&&B.unbind(),F.dispose(),F=new r.ICCard(R,A),O=!1)},R.isActive=function(){return O},R.getUserTileContainerElement=function(){return e(x("usertilecontainer"),M)},R.getPresence=function(){return A},R.dispose=function(){R.deactivate(),A&&(A.dispose(),A=null),M&&M.html(""),M=B=null,R.person=P=D=null,j=!0},R.getShowICCard=b,R.getName=C,R.getUserTileUrl=S,R.getEmail=k,R.getTooltip=I,R.init()}var n=window,i=n.wLive,r=i.IC,o=$B.IE,a="presenceChanged",s="c_ic_blueframe",l="c_ic_greenframe",c={};r.IC=t}(window.originaljQuery||jQuery)}),define("icmanager",["ic"],function(){!function(e){function t(){function t(e,t,n){var i=new r.IC(e,t,n);return a[i.id]=i,t&&(s[t]=s[t]||[],s[t].push(i)),n.namespace&&(l[n.namespace]=l[n.namespace]||[],l[n.namespace].push(i)),i}var i,o=this,a={},s={},l={},c=!1;o.init=function(){c||(c=!0,i=new r.ICTemplates,$Do.register("$icm",0,!0))},o.addTemplates=function(e){c&&i.addTemplates(e)},o.createICForPerson=function(e,n,r){if(!i)return null;r=r||{};var o=i.getTemplate(e);return n&&o?t(o,n,r):null},o.createNonContactIC=function(e,n,r){if(!i)return null;var o=i.getTemplate(e);return o?(r=r||{},r.email=n,t(o,null,r)):null},o.createICsFromCids=function(e,t,i,r){function a(t,n){var a=o.createICForPerson(e,n.getId()||t,r);i(c[t],a)}function s(e,t){for(var n=0;n<e.length;n++)a(e[n],l.getPerson(e[n]));for(n=0;n<t.length;n++)i(t[n],null)}var l,c={};$Do.when("$pwc",0,function(){l=n.$pwc,l.callWhenReady(function(){for(var e=[],n=0,i=t.length;i>n;n++){var r=t[n][0];if(c[r]=t[n][1],"0"!=r&&0!=r){var o=l.getPerson(r);o?a(r,o):e.push(r)}}e.length>0&&l.client.loadProfiles(e,s)})})},o.getICById=function(e){return a[e]||null},o.getICsForPerson=function(e){return s[e]},o.getICsForNamespace=function(e){return l[e]||[]},o.removeIC=function(e){if(delete a[e.id],e.pwcId){var t=e.pwcId;s[t]&&(s[t].remove(e),0==s[t].length&&delete s[t])}if(e.namespace){var n=e.namespace;l[n]&&(l[n].remove(e),0==l[n].length&&delete l[n])}e.dispose()},o.removeAllICsByNamespace=function(e){var t=l[e];if(t){t=t.clone();for(var n=0;n<t.length;n++)o.removeIC(t[n])}},o.removeAllICs=function(){for(var e in a)o.removeIC(a[e])},o.dispose=function(){e(n).unbind("unload",o.dispose),o.removeAllICs(),a=null,l=null,s=null,i&&i.dispose(),i=o.templates=null,n.$icm=null},e(n).bind("unload",o.dispose)}var n=window,i=n.wLive,r=i.IC;r.ICManager=t,n.$icm=new t,$Do.register("$icmCreated",0,!0)}(window.originaljQuery||jQuery)}),define("safelinks",["validateconfig","jquery-1.7.2","bsi"],function(){!function(){function e(e,n){var s=n&&n.getAttribute("wrap");if(s){var l=t.$Config,c=l.WS||{},u=c.SL||{},d=u.url;if(d){var f,h=s.split(r),p=h.slice(a).join(r),g={l:p,p:l.di,mkt:l.mkt};for(f=0;a>f;f++)h[f]&&(g[o[f]]=h[f]);n.href=d+"?"+i.serialize(g)}}}var t=window,n=t.$BSI,i=t.$Utility,r="|",o=["h","o","u","q1","q2","q3","q4","q5"],a=o.length;n.addNavCallback(e)}(window.originaljQuery||jQuery)}),define("ssl",["validateconfig","jquery-1.7.2","bsi"],function(){!function(e){function t(){n=a.$Config,i=n.Ssl||{},r=i.imu,o=i.d}var n,i,r,o,a=window,s=(a.$Utility,a.Debug,"http://"),l="https://";t(),a.$ssl={ensureSSLImageUrl:function(e){return o||document.location.href.toLowerCase().startsWith(l)&&e.toLowerCase().startsWith(s)&&r&&(e=r+e.encodeUrl()),e},copyOutConfig:function(t){t.$Config.Ssl={},e.extend(t.$Config.Ssl,$Config.Ssl,!0),t.$ssl.resetCachedValues()
},resetCachedValues:t}}(window.originaljQuery||jQuery)}),define("wlivenavlink",["registernamespace","pagestats","validateconfig","jquery-1.7.2","bsi","wlivecss","wlivemenu"],function(){!function(e){function t(){}function n(n,i){var o=this;o._id=t._getItemId(),o.$obj=e(n).first(),o._isDisposed=!1,i?(o._$a=o.$obj.children("a").first(),0==o._$a.length?o._$a=null:o.id=o._$a.attr("id"),sutra(o._$a,"$Sutra.Shared.NavLink",!0),o._$span=o.$obj.children("span:not(.is_c)").first(),0==o._$span.length&&(o._$span=null),o._$imageStrip=o.$obj.children("span.is_c").first(),0==o._$imageStrip.length&&(o._$imageStrip=null),o._$sep=o.$obj.children("span.c_ms").first(),0==o._$sep.length&&(o._$sep=null),o._$rchev=o.$obj.children("span.c_rchev").first(),0==o._$rchev.length&&(o._$rchev=null)):r(o,!1)}function i(t){t._$a&&0!=t._$a.length||(t._$a=e("<a></a>"),sutra(t._$a,"$Sutra.Shared.NavLink",!0),t.$obj.append(t._$a),t._isDisposed=!1)}function r(e,t){t&&(e.$obj=null),e._$a=null,e._$span=null,e._$sep=null,e._$rchev=null,e._$imageStrip=null}var o=window,a=o.wLive.Controls,s=o.$edh,l=0;a.NavItem=t,t._getItemId=function(){return"c_ci"+l++},a.NavLink=n;var c=n.prototype;c.setHtml=function(e){var t=this;return i(t),t._$a.html(e),sutra(t._$a,"$Sutra.Shared.NavLink",!0),t._$span&&(t._$a.detach(),t._$span.html(e),t._$span.append(t._$a)),t},c.setUrl=function(e){return this.setProperty("href",e)},c.setId=function(e){var t=this;return t.id=e,t.setProperty("id",e)},c.setProperty=function(e,t){var n=this;return i(n),n._$a.attr(e,t),n},c.enable=function(){var e=this;return e._$span&&(s.e(e._$span[0]),e._$a=e.$obj.find("a").first(),sutra(e._$a,"$Sutra.Shared.NavLink",!0),e._$span=null),e},c.disable=function(){var e=this;return e._$a&&(s.d(e._$a[0]),e._$span=e.$obj.find("span").first()),e},c.removeClick=function(){var e=this;return e._aclickHandler&&e._$a&&e._$a.unbind("click",e._aclickHandler),e},c.addClick=function(e,t){var n=this;return i(n),n.removeClick(),t||n.setUrl("#"),n._aclickHandler=function(t){var n;try{n=e(t)}catch(i){return $WebWatson.submitFromException(i),!1}return n},n._$a.click(n._aclickHandler),n},c.addMousedown=function(e){var t=this;return i(t),t._$a.mousedown(e),t},c.addSeparator=function(){var t=this;return t._$sep||(t._$sep=e('<span class="c_ms" role="presentation"></span>'),t.$obj.append(t._$sep)),t._$sep.css("display",""),t},c.removeSeparator=function(){var e=this;return e._$sep&&e._$sep.hide(),e},c.addRChev=function(){var t=this;return t._$rchev||(t._$rchev=e('<span class="c_rchev"></span>'),t.$obj.append(t._$rchev),t._$rchev.html($menu.createChevron($menu.chevronTypes.SmallRightDark,!0))),t._$rchev.show(),t},c.removeRChev=function(){var e=this;return e._$rchev&&e._$rchev.hide(),e},c.addImageStrip=function(t,n){var i=this;return i._$imageStrip||(i._$imageStrip=e(t),n?i._$a.append(i._$imageStrip):(i._$imageStrip.append(" "),i._$a.prepend(i._$imageStrip))),i},c.dispose=function(){var e=this;e._isDisposed||(e.removeClick(),r(e,!0),e._isDisposed=!0)},n.defaultOptions={html:"",separator:!1,url:"#",id:"",click:null,mousedown:null,container:"<li></li>",imageStrip:null},n.create=function(t){var i=e.extend({},n.defaultOptions,t),r=new n(i.container);return r.setHtml(i.html),r.setUrl(i.url),r.setId(i.id),i.separator&&r.addSeparator(),i.click&&r.addClick(i.click,i.url),i.mousedown&&r.addMousedown(i.mousedown),i.imageStrip&&r.addImageStrip(i.imageStrip),r}}(window.originaljQuery||jQuery)}),define("navigationcollections",["wlivenavlink"],function(){!function(e){function t(){var e=this;e._isItemsHashDirty=!0,e._itemsHashTable={},e._list=[],e.list=[]}function n(t,n,i,r,o){function a(e){s._menu||(n?s._menu=s._$ul[0].binding:(r.defaultLoc=P,$menu.create(e,D,r)&&(s._menu=s._$ul[0].binding)))}var s=this;s._id=S.NavItem._getItemId();var l=new S.MenuDataModel;if(s._items=[],s.$obj=e(t).first(),r=r||{},!n){var c,d,f=$Config.isLightTheme?$menu.chevronTypes.SmallDownDark:$menu.chevronTypes.SmallDownLight,h=$menu.createChevron(f,!0);o?(c='<span class="c_mlu">'+h+"  &nbsp;</span>",d=""):(c='<span class="c_mlu"></span>',d='<span class="c_chev"> '+h+"</span>");var g='<a href="#" class="uxfa_ml c_ml" onclick="return false">'+c+d+'</a><ul class="uxfa_m '+I+' t_hovl"></ul>';i?s.$obj.append(g):s.$obj.html(g)}s._$a=s.$obj.children("a.c_ml").first(),s._navLink=new k(s.$obj,!0),s._$mspan=s._$a.children("span.c_mlu").first(),s._$chev=s._$a.children("span.c_chev").first(),s._$ul=s.$obj.children("ul"),0==s._$ul.length&&(s._$ul=e('<ul class="uxfa_m '+I+' t_hovl"></ul>'),s.$obj.append(s._$ul)),s.id=s._$ul.attr("id"),s._menu=s._$ul[0].binding,p(s),l._list=s._items,s._$a.bind("click.menu",function(e){e.preventDefault(),a(e)}),s._$a.bind("mousedown.menu",a),sutra(s._$a,"$Sutra.Shared.MenuLink",!0),sutra(s._$ul,"$Sutra.Shared.MenuList",!0),s._dataModel=l,u(s,l._list),l.list=new ObservableArray(l._list)}function i(){var e=this;e.menu={}}function r(t,i,r){var o=this;o._id=S.NavItem._getItemId(),o._dataModel=new S.SplitMenuDataModel,o.$obj=e(t).first(),o._$a=new k(o.$obj,i),i?o._$sep=o.$obj.children(".c_ms"):(o._$a.setHtml("&nbsp;"),o._$sep=e('<span class="c_ms"> </span>'),o.$obj.append(o._$sep),o.$obj.addClass(x+" "+L)),o._$menu=new n(o.$obj,i,!0,{dockEl:o.$obj.get()[0]},r),o._dataModel.menu=o._$menu}function o(t){var n=this;n._isItemsHashDirty=!0,n._itemsHashTable={},n._logo=t&&t.logo||{containerWidth:"220px",imageStrip:"",text:"",title:"",url:"",hasPropertyText:!1},n._list=[],n.isLightTheme=t&&t.isLightTheme,n.getIndexById=function(e){if(n._isItemsHashDirty)for(var t=0;t<n._list.length;t++){var i=n._list[t]._id,r=n._list[t].id;n._itemsHashTable[i]=t,n._itemsHashTable[r]=t}return n._itemsHashTable[e]},n.getItemById=function(e){var t=n.getIndexById(e);return n._list[t]},n.getItemByIndex=function(e){return this._list[e]},n._dispose=function(){e(n.logo).unbind(),e([n.list]).unbind(),e(n.list).unbind()}}function a(t,n,i){var r=this;r._id=S.NavItem._getItemId(),r._needsToRender=!1,r.$obj=e(t);var o=new S.CommandBarDataModel(i);sutra(r.$obj,"$Sutra.Shared.CommandBarControl",!0),r._items=[],n||r.$obj.html('<div class="c_clogo"><a href="#"><h1><span class="c_clogoimg"></span><span class="c_clogot"></span></h1></a></div><ul class="c_cc"></ul><div class="c_cme">></div>'),r._$logo=r.$obj.children(".c_clogo"),r._$logoImage=r._$logo.find(".c_clogoimg"),r._$logoText=r._$logo.find("span.c_clogot"),r._$logoLink=r._$logo.find("a"),r._$ul=r.$obj.children("ul"),sutra(r._$ul,"$Sutra.Shared.CommandBar",!0),0==r._$logoImage.length&&(r._$logoImage=e('<span class="c_clogoimg"></span>'),r._$logoText.parent().prepend(r._$logoImage)),p(r,"$Sutra.Shared.CommandItem"),o._list=r._items,o._logo.imageStrip=r._$logoImage.html(),r._dataModel=o,c(r._$logoText,o._logo,"text","innerHTML"),c(r._$logoText,o._logo,"hasPropertyText",s,"function"),c(r._$logoLink,o._logo,"url","href"),c(r._$logoLink,o._logo,"title","title"),c(r._$logoImage,o._logo,"imageStrip",l,"function"),c(r._$logo,o._logo,"containerWidth",$B.IE_M6?"width":"min-width","style"),u(r,o._list),o.logo=new Observable(o._logo),o.list=new ObservableArray(o._list)}function s(e,t){t?e.hide():e.show()}function l(e,t){e.empty(),e.append(t)}function c(t,n,i,r,o){e(n).bind("propertyChanged",function(e,n,a){i==n&&("style"==o?t.css(r,a):"function"==o?r(t,a):t.attr(r,a))})}function u(t,n){e([n]).bind("arrayChange",function(n,i,r,o){t._needsToRender||e(t).trigger("beforeRender"),clearTimeout(t._renderTimeout),t._needsToRender=!0,t._renderTimeout=setTimeout(function(){t._needsToRender&&t.render&&t.render()},500),"insert"==i?t.add(o,r):"remove"==i&&t.remove(r,!0,o)})}function d(){N||(N=setTimeout(f,0))}function f(){N=0;for(var e=M.length,t=0;e>t;t++)M[t]();M.splice(0,e)}function h(e){M.push(e)}function p(t,i){var o=t._$ul.children("li");o.each(function(){var o=e(this);o.hasClass(x)?t._items.push(new r(o,!0)):o.hasClass(L)?o.hasClass(T)||t._items.push(new n(o,!0)):t._items.push(new k(o,!0)),i&&sutra(this,i,!0)})}function g(e){for(var t=e._items,n=0;n<t.length;n++)e._$ul.append(t[n].$obj)}function m(t,n,i){i||0==i||(i=t._items.length),h(function(){if(n.$obj){var r=t._$ul.children(),o=r[i];0!=r.length&&o?e(o).before(n.$obj):t._$ul.append(n.$obj);var a=n._$a;a.attr("role")||a.attr("role","button");var s=n._$ul;s&&(a.attr("aria-expanded","false"),a.attr("aria-haspopup","true"));var l=n.$obj.css("display");("list-item"==l||"block"==l&&$B.IE_M7)&&n.$obj.css("display",""),n.$obj.hasClass(L)&&!n.$obj.hasClass(x)&&g(n)}}),t._items.splice(i,0,n),t._dataModel&&(t._dataModel._isItemsHashDirty=!0),d()}function v(e,t,n){t&&!t._isDisposed&&(t.$obj&&(t.$obj.remove(),e._dataModel&&(e._dataModel.isItemsHashDirty=!0),e._$ul=e.$obj.children("ul")),n&&t.dispose())}function y(e,t,n){var i=e._items.splice(t,1)[0];return i._isDisposed||(h(function(){v(e,i,n)}),d()),i}function _(e){var t=e._items;if(t)for(var n=0;n<t.length;n++)t[n].dispose();return e._items=[],e._$ul&&e._$ul.html(""),e}window.ObservableArray=function(e){this.array=e};var w=ObservableArray.prototype;w.insert=function(t,n){var i=this;t>=0&&t<=i.array.length&&e([i.array]).triggerHandler("arrayChange",["insert",t,n])},w.push=function(e){var t=this;t.insert(t.array.length,e)},w.remove=function(t){var n=this;if(t>=0&&t<n.array.length){var i=n.array[t];e([n.array]).triggerHandler("arrayChange",["remove",t,i])}},w.clear=function(){for(var e=this;e.array.length;)e.remove(e.array.length-1)},w.length=function(){return this.array.length},window.Observable=function(e){this.obj=e};var b=Observable.prototype;b.setProperty=function(t,n){var i=this,r=i.obj[t];n!=r&&(i.obj[t]=n,e(i.obj).trigger("propertyChanged",[t,n,r]))};var C=window,S=C.wLive.Controls,k=S.NavLink,I="c_m",x="c_sm",T="c_cmore",L="c_mcp",P=0,D=6;S.MenuDataModel=t,S.Menu=n;var E=n.prototype;E.makeSubMenu=function(){var e=this,t=$menu.chevronTypes.SmallRightDark;return $B.rtl&&(t=$menu.chevronTypes.SmallLeftDark),e._$chev.html(" "+$menu.createChevron(t,!0)),e},E.setHtml=function(e){var t=this;return t._$mspan.html(e),t},E.setId=function(e){var t=this;return t._$ul.attr("id",e),t.id=e,t},E.getDataModel=function(){return this._dataModel},E.getMenu=function(){return this._menu},E.getLink=function(){return this._navLink},E.add=E.push=function(t,n,i){var r=this;return m(r,t,n),i||t._$a.hasClass("c_ml")||e(t._$a).bind("click",$menu.closeAll),r._menu&&r._menu.update(),r},E.remove=function(t,n,i){var r=this,o=y(r,t,n,i);return e(o._$a).unbind("onclick",$menu.closeAll),r._menu&&r._menu.update(),o},E.clear=function(){var e=this;return _(e),e._menu&&e._menu.update(),e},E.dispose=function(){var e=this;e._$a.unbind(".menu"),e.clear(),e._menu&&e._menu.dispose()},n.defaultOptions={html:"",id:"",subMenu:!1,container:'<li class="'+L+'"></li>',menuParams:null,linkId:""},n.create=function(t){var i=e.extend({},n.defaultOptions,t),r=new n(i.container);return r.setHtml(i.html),r.setId(i.id),r._$a.attr("id",i.linkId),i.subMenu&&r.makeSubMenu(),r},S.SplitMenuDataModel=i,S.SplitMenu=r;var $=r.prototype;$.getDataModel=function(){return this._dataModel},$.dispose=function(){var e=this;e._$menu&&e._$menu.dispose()},$.setProperty=function(e,t){var n=this;return n.$obj.attr(e,t),n},$.getMenu=function(){return this._$menu},$.getLink=function(){return this._$a},r.defaultOptions={id:"",linkId:"",container:"<li></li>",useChevronAsText:!0},r.create=function(t){var n=e.extend({},r.defaultOptions,t),i=new r(n.container,!1,n.useChevronAsText);return i.setProperty("id",n.id),i._$a.setId(n.linkId),i},S.CommandBarDataModel=o;o.prototype;S.CommandBar=a;var A=a.prototype;A.add=A.push=function(e,t){var n=this;return sutra(e.$obj,"$Sutra.Shared.CommandItem",!0),m(n,e,t),n},A.remove=function(e,t,n){return y(this,e,t,n)};var F;A.addLightHover=function(){this.$obj.addClass("c_clih");var e=this.$obj.parent();e.hasClass("c_hcnlto")&&(e.removeClass("c_hcnlto"),F=!0)},A.removeLightHover=function(){F?(this.$obj.parent().addClass("c_hcnlto"),F=!1):this.$obj.removeClass("c_clih")},a.defaultOptions={container:'<div class="c_c c_cbb c_ccptc"></div>'},a.create=function(t){var n=e.extend({},a.defaultOptions,t),i=new a(n.container);return i},A.render=function(){var t=this;clearTimeout(t._renderTimeout),e(t).trigger("afterRender"),t._needsToRender=!1},A.getDataModel=function(){var e=this;return e._dataModel},A.dispose=function(){for(var e=this,t=0,n=e._items.length;n>t;t++)v(e,e._items[t],!0);e._dataModel._dispose()},A.get=E.get=function(e){return this._items[e]},A.count=E.count=function(){return this._items.length},A.clear=function(){var e=this;return _(e),e};var N,M=[]}(window.originaljQuery||jQuery)}),define("sharedlapsetimer",["csiperf"],function(){!function(){window.$CSIPerf.lapse.push({s:"sjs",t:(new Date).getTime()})}()}),define("headerhelper",["jquery-1.7.2","registernamespace","pagestats","baseutil","domutils","wliveimagestrip","wlivecss","wlivemenu","csiperf","date","pwcinitializer","icmanager","safelinks","ssl","navigationcollections","sharedlapsetimer"],function(){!function(e){function t(e){return e=e||_ge("c_h_ttl"),'<div><ul class="c_h_ttl">'+e.innerHTML+'</ul><div class="c_clr"></div></div>'}function n(){var n=wLive.Controls.Notifications;if(n){var r=t(),o=n.createFlyout({title:"",content:r,anchor:_ge("c_clogoc"),options:{moreCss:"c_headerBar",bubble:6,maxWidth:h,animation:{entranceType:"slidefadein2",entranceArguments:[{left:0,top:-20,override:!0}],exitType:"slidefadeout2",exitArguments:[{left:0,top:-20}]}}});n.getQueue().start(),o.show(),e(o).bind("aftershow",function(){var t=e(".c_headerBar .UserContent div")[0];i(e(t).find("a"),o),c.$Sutra&&$Sutra.Shared&&$Sutra.Shared.HeaderTiles&&sutra(t,"$Sutra.Shared.HeaderTiles")})}}function i(t,n){e(document).on("mousedown",".c_headerBar",function(t){return e(t.srcElement).parents("a").addClass("pressed"),!1}).on("mouseup","html",function(){e(".c_headerBar a").removeClass("pressed")}),t.each(function(){var t=e(this);st(t,t.attr("id")),t.click(function(){n&&n.dismiss()})}),c.$Sutra&&$Sutra.Shared&&$Sutra.Shared.HeaderTile&&t.each(function(){sutra(this,"$Sutra.Shared.HeaderTile")})}function r(e){13==e.which&&(l="keydown"==e.type)}function o(){var e=window.location.host.split("."),t="."+e[e.length-2]+".com",n=new Date,i=$HIC,r=f.getCookie(Ct,1)||"",o=r.split("|");n.setDate(n.getDate()+i.e),o[0]!=i.c&&(o=[]),o[0]=i.c||o[0]||"",o[1]=i.m||0===i.m?i.m:o[1]||"",o[2]=i.l||0===i.l?i.l:o[2]||"",o[3]=i.cl||o[3]||"",o[4]=i.dg||0===i.dg?i.dg:o[4]||"",o[5]=i.scl||o[5]||"",o[0]?f.setCookie(Ct,o.join("|"),t,0,n,1):f.deleteCookie(Ct,t)}var a,s,l,c=window,u=c.$Config,d=c.$Do,f=c.$Cookie,h=(e(c),642),p=[],g="SelectClick.MetroHeader.Nav",m="c_h_mail",v="c_h_ppl",y="c_h_cal",_="c_h_sd",w="c_h_dfe",b="c_h_dfi",C="c_h_wd",S="c_h_xl",k="c_h_ppt",I="c_h_on",x="c_h_oo",T="c_h_sw",L="c_clogot",P="c_clogoc",D="c_hiconm",E="c_hiconu",$="c_hiconc",A="c_coh",F="c_cof",N="c_memenu",M="c_melink",B="c_himla",R="c_himld",H="c_memenuic",O="c_profile",U="c_hli",j="c_wimnetsub",W="c_signout",Q="c_wimneton_FB",V="c_wimnetoff_FB",q={};q[m]="Mail",q[v]="People",q[y]="Calendar",q[_]="SkyDrive",q[w]="DogExt",q[b]="DogInt",q[C]="Word",q[S]="Excel",q[k]="PowerPoint",q[I]="OneNote",q[x]="Office",q[T]="Sway",q[L]="Home",q[P]="Switcher",q[D]="webIM",q[E]="undo",q[$]="gear",q[A]="help",q[F]="feedb",q[M]="me",q[B]="presence",q[R]="presence",q[H]="c_memenuic",q[O]="profile",q[U]="account",q[j]="3pchatm",q[W]="signout",q[Q]="fbchat",q[V]="fbchat";var G=e("#c_signin"),z=function(){for(var t=0;t<p.length;t++)p[t].unbind("click");G.unbind(),e(".c_clogo").unbind(),e(c).unbind("unload",z)};e(".c_clogo a").attr("onclick",""),c.$header={};var K=0;e("#c_clogoc").bind("click",function(){return window.require?window.require(["flyout","doregister"],n):n(),c.top.$HeaderWebIM&&c.top.$HeaderWebIM.setUnreadCountEl(_ge("#c_murc")),!1}),e("#c_clogoc").bind({keydown:r,keyup:r}),c.$header.showLoading=function(){if(!a){var t=_ge("c_header"),n=t&&t.firstChild;n&&(a=e($f.createLoading(0,$f.loadingType.flying,"100%","4px",0,"#fff")),a.addClass("c_h_flyingDots"),n.appendChild(a.get(0)))}K++,$f.showLoading(a)},c.$header.hideLoading=function(){K--,K=0>K?0:K,a&&!K&&$f.hideLoading(a)},c.$header.getDummyHeader=function(){if(!s){s=document.createElement("ul"),s.className="c_mcp t_hdbg c_c";var e=document.createElement("li");e.style.listStyle="none",s.appendChild(e),document.body.appendChild(s)}return s};var J=function(e){if(c.$PF){var t=encodeURIComponent($PF.getCurrentUrl()),n=$f.replaceQs(G.attr("href"),"wreply",t);return $BSI.navigateTo(n,"_top"),$f.cancelEvent(e)}return!0};G.bind("click",J),e(c).bind("unload",z);var X,Y,Z,et,tt,nt=[],it=function(e,t,n){this.execute=function(i){i.href=i.href.indexOf("?rru=home")>-1?i.href.replace(t,n):i.href.replace(e,n)}},rt=function(e,t,n){this.execute=function(i){var r=i.href;if(r.indexOf(t)>-1&&r.indexOf("#")<0&&!r.match(/[\?|&|\/]cid/))if(n){var o="."+u.d,a=o+"/"+e;"profile"==t.toLowerCase()&&r.indexOf("/home")>0&&(o+="/home"),i.href=r.replace(o,a)}else{var s="cid="+e,l="?";r.indexOf(l)>-1&&(l="&"),i.href=r+l+s}}},ot=function(e,t){this.execute=function(n){e&&n.href.indexOf("?rru=inbox")>-1?n.href=e:t&&n.href.indexOf("?rru=contacts")>-1&&(n.href=t)}},at=function(e){c.$theme=e.$theme;var t=e._ge("themecss");if(t){var n=document.createElement("style");if(document.head.appendChild(n),n.styleSheet&&t.styleSheet)n.styleSheet.cssText=t.styleSheet.cssText;else{var i=document.createElement("div");i.innerHTML='&nbsp;<style type="text/css">'+t.innerHTML+"</style>",document.head.appendChild(i)}}};c.$header.copyThemeToOuterFrame=at;var st=function(e,t,n){e&&Boolean(q[t])&&(e.bind("click",function(){var e=q[t];Boolean(n)&&(e+=n),$BSI.reportEvent(g,{MetroHeaderNav:e})}),p.push(e))};c.$header.reportBSIMenu=st;var lt=function(t){var n=t.getAttribute("hid");Boolean(q[n])&&st(e(t),n,"A")};d.register("$Header.MenuBind",lt);var ct=function(){st(e("#c_h_theme_m_ul"),N)};d.register("$Header.ThemesMenuBind",ct),u.Header&&(X=u.Header.MailLink,Y=u.Header.ContactsLink,Z=u.Header.HotmailDomain,tt=u.Header.OldHomeDomain,et=u.Header.OldHotmailDomain);var ut=Z;X||Y?nt[nt.length]=new ot(X,Y):ut&&(nt[nt.length]=new it(et,tt,Z));var dt=c.$HIC&&$HIC.c;dt&&dt.length>0&&(nt[nt.length]=new rt("cid-"+dt,"profile",!0),nt[nt.length]=new rt(dt,"skydrive."));var ft=[],ht=[],pt=c._ge("c_header");if(pt){var gt=$css.getCN("c_hleft","div",pt)[0];gt&&(ht=gt.getElementsByTagName("a"))}for(var mt=ht.length-1;mt>=0;mt--){var vt=ht[mt];ft.push(vt),st(e(vt),vt.id),c.$Sutra&&$Sutra.Shared&&$Sutra.Shared.HeaderLink&&sutra(vt,"$Sutra.Shared.HeaderLink")}st(e("#c_clogot"),"c_clogot"),st(e("#c_clogoc"),"c_clogoc"),st(e("#c_hiconu"),"c_hiconu"),st(e("#c_hiconm"),"c_hiconm"),st(e("#c_hiconc"),"c_hiconc");for(var yt,_t,wt=(e("#c_hmc").find("a").each(function(){ft.insert(0,this)}),ft.length-1);wt>=0;wt--){yt=ft[wt],!yt.target&&(yt.href.indexOf("//g.live")>-1||yt.href.indexOf(u.sd)<0)&&(yt.target="_top");for(var bt=nt.length-1;bt>=0;bt--)_t=nt[bt],_t&&_t.execute(yt)}if(c.$HIC){var Ct="HIC";d.register("$Header.UpdateCookie",o)}}(window.originaljQuery||jQuery)}),define("header_themehover",["headerhelper"],function(){!function(e){function t(t){var n=u.Themes,i=[];i.push('<div id="c_h_theme_m" class="c_om noresize t_hovl"><ul class="c_oblock c_ot" id="c_h_theme_m_ul" serviceurl="'),i.push(n.ThemeService.encodeHtmlAttribute()),i.push('">');for(var r='<li class="c_omti">',a="</li>",l=!0,d=t?Math.min(m,t.length):m,f=v-1,p=0;d>p;p++){var g=p%v;0==g&&i.push(r);var y=t?t[p]:null;i.push('<a href="#" onclick="return false;" info="'),y&&i.push((y[0]+"|"+y[1]).encodeHtmlAttribute()),i.push('" class="c_thmb" title="'),y&&i.push(y[2].encodeHtmlAttribute()),i.push('">'),y||i.push('<div class="c_noimg"></div>'),i.push("</a>"),l=g==f,l&&i.push(a)}l||i.push(a),i.push('</ul><span class="c_ms"></span></div>'),s.innerHTML=i.join(""),o=c._ge("c_h_theme_m"),sutra(o,"$Sutra.Shared.ThemesPicker"),c.$Sutra&&$Sutra.Shared&&$Sutra.Shared.ThemesThumb&&e(".c_thmb",o).each(function(){sutra(this,"$Sutra.Shared.ThemesThumb")}),t&&c.$theme.bind(o,$menu.themeAreaId),o.style.display="block",h=1}function n(e){e&&(f=0,l=0,s=null),0==f?((!h||e)&&(a=c._ge("c_theme_menu"),(a||s)&&(s=s||a.parentNode,a=null,t())),h&&($BSI.isLoading()?$BSI.addLoadedCallback(i):i(),p&&p.menu&&p.menu.update())):1==f&&c.$theme&&c.$theme.beforeMenuShow()}function i(){if(1!=f){if(f=1,$menu.themeAreaId="c_h_theme_m_ul",$menu.disableThumbs=0,!l){l=1;var t=u.handlerBaseUrl,n=c.$PF&&$PF.getAppFrameWindow();if(n)try{t=n.location.protocol+"//"+$U.getHost(n.location.href)}catch(i){}d.fetchScript(t+"/Handlers/ThemePickerJS.mvc"+u.Themes.ThemeJSParms,e.noop),d.fetchScript(u.Header.themeJsUrl,function(){$Do.register("$theme.invertTheme")})}setTimeout(r,5)}}function r(){!function e(){"undefined"==typeof c.$theme?$menu.themeCallback=e:(c.$theme.renderThemePicker=function(e){if(g){var n=e.length;window.themejs=null;for(var i,r,o=1,a=n-1,s=o;s<e.length;s++){i=Math.floor(Math.random()*a)+o,r=Math.floor(Math.random()*a)+o;var l=e[i];e[i]=e[r],e[r]=l}}t(e),$Do.when("$Header.ThemesMenuBind")},$Do.register("$theme.renderThemePicker",c.$theme.renderThemePicker))}()}var o,a,s,l,c=window,u=c.$Config,d=c.$Network,f=-1,h=0,p=c._ge("c_hiconc"),g=!1,m=u.Themes&&u.Themes.numberOfThemes||0,v=6;u&&u.Header&&u.Header.themeJsUrl&&(f=0),$Do.register("$ThemeMenuInit",n)}(window.originaljQuery||jQuery)}),define("mecontrol",["header_themehover"],function(){!function(e){function t(){function t(){e(n).unbind(".me"),d&&e(d).unbind("click",r)}function r(e){$menu.closeCurrent();var t=n.$Logout;t&&t.doLogout&&t.doLogout(e)}var o,a,s,l,c,u,d,f=this,h=!1,p=!1,g="c_memenu",m="c_meic",v="c_melinkspan",y="c_melink";e(n).bind("unload.me",t),d=_ge("c_signout"),d&&e(d).bind("click",r),f.copyAndInitializeMenu=function(t){t=t||n.$PF&&n.$PF.getAppFrameWindow()||window;var i=_ge(g),r=t._ge(g);u=t._ge(v);var o=!(n==t||i&&i.initialized&&r.isCopied);if(o&&(h=!1),!h&&t.$f){var a=_ge(v);if(c=i||r,o){i&&(e(i).remove(),c=r);var s=_ge(y);s&&e(s).remove();var d=$header.getDummyHeader().firstChild,p=t.$f.getLocation(t._ge(v),1,1),m=document.createElement("ul"),_=document.createElement("a");m.innerHTML=c.innerHTML,m.className=c.className,m.id=c.id,m.initialized=1,r.isCopied=1,_.style.position="absolute",_.style.top=p.bottom+"px",_.style.left=($B.rtl?p.left:p.right)+"px",_.style.height=0,_.style.padding=0,_.id=y,c=m,l=_,d.appendChild(_),d.appendChild(m),n.$header.copyThemeToOuterFrame(t),e(n).bind("resize.me",function(){m.initialized=0})}else i&&a&&i.parentNode!=a.parentNode&&($css.add(i,"uxfa_m c_m t_hovl"),a.parentNode.insertBefore(i,a.nextSibling),l=_ge(y));f.init(),$Do.when("$HeaderWebIM.Initialize")}},f.openMenu=function(e){f.copyAndInitializeMenu(),h&&(c.binding?c.binding.toggleState():$menu.create(e,0,{sourceEl:l,menuEl:c,pressedStateEl:u}))},f.createMeICs=function(){if(!p){p=!0;var t=n.$icm,r=i.cid,o=_ge(m);if(o){var a=t.createICForPerson("MeControlMedium",r);if(a){var s=e(o);s.html(a.render()),a.activate();var l=s.find("img");l.attr("title",s.attr("title"))}}var c=_ge("c_memenuic");if(c){var u=t.createICForPerson("MeControlXXL",r);if(u){var d=e(c);d.html(u.render()),u.activate();var f=d.find("img");f.attr("title",d.attr("title"))}}}},f.init=function(){h||(o=e("#c_memenu"),a=e("#c_memenu_right"),s=e("#c_memenu_left"),$Do.when("$ic",0,f.createMeICs),n.$header&&(n.$header.reportBSIMenu(e("#c_himla"),"c_himla"),n.$header.reportBSIMenu(e("#c_himld"),"c_himld"),n.$header.reportBSIMenu(e("#c_memenuic"),"c_memenuic"),n.$header.reportBSIMenu(e("#c_profile"),"c_profile"),n.$header.reportBSIMenu(e("#c_hli"),"c_hli"),n.$header.reportBSIMenu(e("#c_wimnetsub"),"c_wimnetsub"),n.$header.reportBSIMenu(e("#c_signout"),"c_signout")),sutra(_ge(g),"$Sutra.Shared.MeControlMenu"),sutra(_ge("c_profile"),"$Sutra.Shared.Profile"),sutra(_ge("c_hli"),"$Sutra.Shared.Account"),sutra(_ge("c_signout"),"$Sutra.Shared.SignOut"),h=!0)},$Do.when("$icm",0,f.createMeICs)}var n=window,i=n.$Config,r=_ge("c_melink");r&&(_$meLink=e(r),_$meLink.mouseover(function(){window.top.$MeControl.copyAndInitializeMenu(n)}),_$meLink.focus(function(){window.top.$MeControl.copyAndInitializeMenu(n)}),n.$header.reportBSIMenu(_$meLink,"c_melink"),sutra(r,"$Sutra.Shared.MenuLink")),n.$MeControl=new t}(window.originaljQuery||jQuery)}),define("footer",["mecontrol"],function(){!function(e){function t(){var e=null;if(b.XMLHttpRequest)e=new XMLHttpRequest;else if(b.ActiveXObject)try{e=new b.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}return e}function n(){var n=t(),i=r("LanguagePicker.Client.Title"),o='<div class="loadingArea"><table class="loadingTable"><tr><td class="loadingSpinner" id="lpSpinner"></td><td class="lpLoading">'+r("LanguagePicker.Client.Loading")+"</td></tr></table></div>",l=wLive.Controls.Notifications,c=l.createFlyout({title:i,content:o,anchor:_ge("uxp_ftr_link_language"),buttons:{action:r("LanguagePicker.Client.Save")},options:{dismissOnButtonClick:!1,moreCss:"languagePickerFlyout"}});if(y=c,e(c).bind({"buttonclick.flyout":function(n,i,o){if("action"===o){{var s=e(c.content()).find("form"),l=s[0].elements,u=l.language.value,d=l.canary.value;e(c.content()).find(".UserContent").html('<div class="loadingArea"><table class="loadingTable"><tr><td class="loadingSpinner" id="lpSpinner"></td><td class="lpLoading">'+r("LanguagePicker.Client.Saving")+"</td></tr></table></div>")}if(e(".languagePickerFlyout button.default").hide(),b.$f){var f=e($f.createLoading(0,$f.loadingType.spinning,"25px","25px"));e("#lpSpinner").append(f),$f.showLoading(f)}var h=t();h&&(h.onreadystatechange=function(){if(4==h.readyState&&200==h.status)if(c.dismiss(),b.$PF)try{b.top.location=b.$PF.getCurrentUrl()}catch(e){}else{var t=h.responseText,n=b.top.location.href.toString(),i=$f.replaceQs(n,"mkt",t);try{b.top.location.href=i,-1!=n.indexOf("#")&&b.top.location.reload()}catch(e){}}else 4==h.readyState&&200!=h.status&&(c.dismiss(),a(M.saving))},h.open("POST","/handlers/languagesave.mvc?canary="+encodeURIComponent(d)+"&lang="+u,!0),h.send("canary="+encodeURIComponent(d)+"&lang="+u))}},"beforedismiss.flyout":function(){e(document.body).toggleClass(P,!1)}}),e(document.body).toggleClass(P,!0),c.show().then(function(){}),l.getQueue().start(),b.$f){var u=e($f.createLoading(0,$f.loadingType.spinning,"25px","25px"));e("#lpSpinner").append(u),$f.showLoading(u)}return n&&(n.onreadystatechange=function(){4==n.readyState&&200==n.status?s(n.responseText):4==n.readyState&&200!=n.status&&(c.dismiss(),a(M.loading))},n.open("GET","/handlers/languagepicker.mvc",!0),n.send()),!1}function i(){return window.require?window.require(["flyout","doregister"],n):n(),!1}function r(e){var t="";return b.GetString&&(t=b.GetString("live.shared.strings."+e)),t}function o(){var e="";e=B===M.loading?r("LanguagePicker.Client.Error.Loading"):r("LanguagePicker.Client.Error.Saving");var t=wLive.Controls.Notifications,n=t.createTopBar({content:e,dismissalMode:"Explicit",buttons:{action:r("LanguagePicker.Client.Close")}});n.show(),t.getQueue().start()}function a(e){return B=e,window.require?window.require(["notificationbar","doregister"],o):o(),!1}function s(t){e(y.content()).find(".UserContent").html('<div><form name="langPicker" action="/handlers/languagesave.mvc" method="POST">'+t+"</form></div>");e(".languagePickerFlyout button.default").show();var n=e(".Flyout.languagePickerFlyout");n.attr("aria-labelledby","uxp_ftr_link_language"),n.attr("aria-label",r("LanguagePicker.Client.Title"))}function l(e,t,n){return F.style.display=t,n?(e.returnValue=!1,!1):!0}function c(e){return l(e,"none",!0)}function u(e){return l(e,"",!0)}function d(t,n){return t&&(t.id===n||d(e(t).parent(),n))}function f(e){return""!==F.style.display||d(e.target,$.id)?!0:l(e,"none",!1)}function h(){clearTimeout(m),m=setTimeout(S.adjustFooter,50)}function p(){var t=E[e(this).attr("id")];t&&$BSI.reportEvent(D,{FooterNav:t})}function g(e){b.$Sutra&&$Sutra.Shared&&$Sutra.Shared.FooterLink&&sutra(e,"$Sutra.Shared.FooterLink")}var m,v,y,_,w,b=window,C=$Config,S=b.$footer={},k=_ge("uxp_ftr_control"),I=e("#m_wf"),x=e("#m_wh"),T="uxp_ftr_ff",L=x.height(),P="langPickerVisible";C.wla&&$Network.fetchScript($Config.wla,function(){},"window.live.shared.strings.languagepicker","Gfx_JS_WLiveStr_Download","Gfx"),I.length||(I=e(k).parent());var D="SelectClick.Footer.Nav",E={};E.uxp_ftr_link_legal="Terms",E.uxp_ftr_link_privacy="Privacy",E.uxp_ftr_link_developers="Dev",E.uxp_ftr_link_intl1="Intl",E.uxp_ftr_link_custom3="CoB1",E.uxp_ftr_link_custom4="CoB2",E.uxp_ftr_link_abuse="Abuse",E.uxp_ftr_link_language="Lang";var $=b._ge("uxp_ftr_control_mini"),A=b._ge("uxp_ftr_hidechevron"),F=b._ge("uxp_ftr_control_cc"),N=b._ge("uxp_ftr_link_language"),M={loading:0,saving:1},B=-1;S.dispose=function(){$&&(e(document).unbind("click",f),e($).unbind(),e(A).unbind()),e(N).unbind(),e("#uxp_ftr_control a").unbind(".ftr"),e(b).unbind("unload",S.dispose),e(b).unbind("resize",h),e(document).unbind(".footerResize")},S.pageContentDiv=_ge("c_content")||_ge("BelowHeader"),S.pageContentDiv||(S.pageContentDiv=I.prev(".MainLayoutIndented")[0]),S.adjustFooter=function(){var t=S.pageContentDiv;if(k&&t){var n=$f.clientHeight(),i=t.scrollHeight;if(!_||_!=n||w!=i){_=n,w=i,v=I.outerHeight(),e(S).trigger("beforeResize"),i=t.scrollHeight;var r=i+L;I.hasClass(T)&&(r+=v),r<$f.docHeight(!0)?I.addClass(T):I.removeClass(T),e(S).trigger("afterResize")}}},$&&(e(document).bind("click",f),e($).bind("click",u),e(A).bind("click",c)),e("#uxp_ftr_control a").each(function(){var t=this;e(t).bind("click.ftr",p),g(t)});var R=_ge("uxp_ftr_link_mobile");if(R&&e(R).bind("click",function(){try{$Cookie.setCookie($Config.bpcc,"false",$Config.sd),window.open($Config.fml,"_top")}catch(e){}}),g(_ge("uxp_ftr_link_trademark")),C.ff&&(I.css("padding-top",0),e(b).bind("resize",h),e(document).bind({"keydown.footerResize":h,"mousedown.footerResize":h,"mousewheel.footerResize":h,"DOMMouseScroll.footerResize":h}),S.adjustFooter()),(!$Config.LP||!$Config.LP.bypassLanguageFlyout)&&N){var H=e(N);H.attr("aria-haspopup","true"),H.attr("aria-label",r("LanguagePicker.Client.LanguageLinkAriaLabel")),H.attr("tabindex","0"),H.attr("role","button"),N.href="",H.bind("click",i)}e(b).bind("unload",S.dispose)}(window.originaljQuery||jQuery)}),define("leftnav",["footer"],function(){!function(e){function t(){if(m.length){if(l=e(f.$footer),c=e("#uxp_ftr_control"),s=_ge("c_base"),e(f).bind("unload.leftNav",n),e(".c_n .c_gl").bind("click",i),g)d=e("#"+g);else{var t=e(".c_n .active > a");d=t.length?t:e(".c_n .active > .link")}d&&(u=d.hasClass("c_gl")?d.siblings("ul"):e(d.parents("ul")[0]),p.AutoExpand&&u.show(),d.parent().addClass("active"),d.parents("ul").show()),p.FullHeight&&(l.bind("beforeResize.leftNav",r),l.bind("afterResize.leftNav",o),h.adjustHeight()),m.find("a").bind("dragstart.ln",$f.cancelEvent)}}function n(){e(f).unbind(".leftNav"),e(l).unbind(".leftNav"),e(".c_n .c_gl").unbind(),m.find("a").unbind(".ln")}function i(){var t=e(this);if(!t.attr("href")){var n=t.siblings("ul");u||(u=n),u[0]==n[0]?u.toggle():(u.hide(),n.show(),u=n)}}function r(){m.css("height","auto")}function o(){clearTimeout(a),a=setTimeout(h.adjustHeight,100)}var a,s,l,c,u,d,f=window,h=f.$leftNav={},p=$Config.LeftNav||{},g=p.ActiveLinkId,m=e("#c_ln"),v=parseInt(m.css("padding-top"));h.adjustHeight=function(){if(s&&m.length){var e=s.scrollHeight-c.height()-v;m.css("height",e+"px")}},t()}(window.originaljQuery||jQuery)}),define("collapsing",["leftnav"],function(){!function(e){var t=window,n=0,i=6;t.CollapsingMenu=function(t,r,o,a,s,l,c,u){function d(){var e;if(c)e=c();else{var t,n=S?l.previousSibling:l;n&&(t=$B.ltr?o.parentNode.offsetWidth+f(o.parentNode)<n.offsetWidth+f(n)+s+20:f(o.parentNode)>f(n)-(s+20),e=o.childNodes.length>v&&t||C.offsetTop<n.offsetTop-n.offsetHeight)}return e}function f(e){for(var t=e.offsetLeft;"body"!=e.nodeName.toLowerCase()&&"html"!=e.nodeName.toLowerCase()&&(e=e.offsetParent);)t+=e.offsetLeft;return t}function h(){var e=!1,t=o.lastChild.previousSibling;return t&&(p(t,!0),b.insertBefore(t,b.firstChild),e=!0),e}function p(t,r){var o=e(t),a=o.find("a.c_ml")[0],s=a&&a.menu;if(o.hasClass("c_sm"))r?(s&&s.deactivate(),o.children("a").hide(),o.children("ul").css("visibility",""),o.find("ul li:last-child").append('<span class="c_ms"> </span>')):(s&&s.activate(),o.children("a").css("display",""),o.find("ul li:last-child .c_ms").remove());
else if(o.children(".c_m").length>0){var l=o.find("span.c_chev");if(l.length){var c=r?w:_;l[0].innerHTML=" "+c}s&&(r?s.convertToSubMenu(i):s.convertFromSubMenu(n))}}var g=this,m=t,v=r,y=u?$menu.chevronTypes.SmallDownLight:$menu.chevronTypes.SmallDownDark,_=$menu.createChevron(y,!0),w=$B.rtl&&$B.IE_M6?$menu.createChevron($menu.chevronTypes.SmallLeftDark,!0):$menu.createChevron($menu.chevronTypes.SmallRightDark,!0),b=o.lastChild.childNodes[1],C=o.firstChild,S=!1;l||(l=b.parentNode,S=!0),g.updateMaxItems=function(e){m=e},g.updateMinItems=function(e){v=e},g.redraw=function(t,n){var i=$css.getCN("c_collRem","a",b)[0];if(i){var r=i.parentNode;r.parentNode.removeChild(r)}for(var s=o.childNodes.length-1;m>s&&0!=b.childNodes.length;)p(b.firstChild,!1),o.insertBefore(b.firstChild,o.lastChild),s++;for(;s>m;)h(),s--;for(b.parentNode.style.display=a;!n&&d()&&h(););var c=e(b);c.show();var u=c.children();if(0===u.filter(":visible").length)b.parentNode.style.display="none";else{var f=S;b.parentNode.style.display=a,l=b.parentNode,S=!1,d()&&h(),S=f}b.binding&&b.binding.update()}}}(window.originaljQuery||jQuery)}),define("commandbar",["collapsing"],function(){!function(e){function t(){clearTimeout($),$=setTimeout(n,100)}function n(){g=0,e(v).trigger(C)}function i(){var t=T-e("#c_cb0 .c_cme").outerWidth();e("#c_cb0 .c_cc").css("padding-"+P,t+"px"),e(v).trigger("resize")}function r(){e("#c_cb0 .c_cc").css("padding-"+P,0),e(v).trigger("resize")}function o(){$Do.when("$WLXIM.SidebarCreated",0,function(){$WLXIM.isSidebarOpened()&&i(),e($WLXIM.sidebar).bind("onSidebarOpenedEvent",i),e($WLXIM.sidebar).bind("onSidebarClosedEvent",r)});for(var n=$css.getCN("c_c","div",document),o=0;o<n.length;o++){var l=n[o],c=e(l),d=c.children(".c_cc")[0],g=E.getInstanceById(l.id);if(!c.hasClass("c_ncolapse")){var m=g&&!g.getDataModel().isLightTheme,w=$B.IE_M6?"block":$B.IE_M7?"inline":"inline-block";l.collapse=new CollapsingMenu(l.m,l.i,d,w,14,0,u(l.id),m),l.r&&l.collapse.redraw(),l.DisableCommand=function(e){var t=l.getElementsByTagName("a")[e];y.d(t)},l.EnableCommand=function(e){var t=l.getElementsByTagName("a")[e].parentNode;y.e(t)},l.dispose=function(){_.unbind("unload",l.dispose)},l.updateMaxItems=function(e){l.collapse.updateMaxItems(e)},l.updateMinItems=function(e){l.collapse.updateMinItems(e)};var S=window.$Config;if(S&&S.CommandBar&&S.CommandBar.resize){if(_.bind(C,l.collapse.redraw),g){f=e("#c_cb0 h1"),h=e("#c_clogoc"),p=h.siblings(".c_ms"),_$emptyLogoLink=e("#c_cb0.c_cle a.c_clogot"),a(c),_$emptyLogoLink.length&&(_$emptyLogoLink.unbind(),_$emptyLogoLink.bind("click",function(){return!1})),e(g).bind("beforeRender",function(e){d.style.overflow=I,l.collapse.redraw(e,!0)}),e(g).bind("afterRender",function(){l.collapse.redraw(),l.style.overflow=x,d.style.overflow=x}),g.updateMaxItems=l.updateMaxItems,g.updateMinItems=l.updateMinItems;{e("#c_cb0 h1 .c_clogot")}f.bind("keydown",s)}_.bind(b,t),l.dispose=function(){if(_.unbind(b,t),_.unbind(C,l.collapse.redraw),g&&(e("a",c).unbind(),e(g).unbind(),e("#c_clogoc").unbind(),g.dispose(),v.$WLXIM&&$WLXIM.sidebar))try{e($WLXIM.sidebar).unbind()}catch(n){}_.unbind("resize.cb"),_.unbind("unload",l.dispose)},g&&g.render()}_.bind("unload",l.dispose)}d.style.overflow=x}$Do.register("WLXCommandBar")}function a(e){e.delegate("a",{"mousedown.cb":l,"focus.cb":l,"blur.cb":c,"mouseup.cb":c,"mouseleave.cb":c,"dragstart.cb":$f.cancelEvent})}function s(e){d=e.shiftKey}function l(){$B.IE&&$B.V<=8&&(this.hideFocus=!0),e(this).addClass(k)}function c(){e(this).removeClass(k)}function u(t){return function(){var n,i="#"+t,r=e(i);if(r.length){var o=g;if(!o){var a=e(i+" .c_cme"),s=a.outerWidth(),l=e(i+" .c_clogo").outerWidth();l>L&&(o=e(i).outerWidth()-l-s)}o>0&&(g=o,n=e(i+" .c_cc").outerWidth()>o)}return n}}var d,f,h,p,g,m,v=window,y=v.$edh,_=e(v),w={},b="resize",C="wlResize",S="c_cb0",k="c_cf",I="hidden",x="visible",T=300,L=50,P=$B.rtl?"left":"right",D=_ge(S),E={};D?E=v.$CommandBar=w[S]=new wLive.Controls.CommandBar("#"+S,!0,D.dataModel):v.$CommandBar=E,E.showOptionsMenu=function(t,n){var i,r,o=_ge("c_copt"),a=n._ge("c_copt"),s=o||a,l=n._ge("c_hiconc");if(!(v==n||o&&a.isCopied&&m)){o&&(e(o).remove(),s=a);var c=$header.getDummyHeader().firstChild,u=n.$f.getLocation(l,1,1),d=document.createElement("ul"),f=document.createElement("a");d.innerHTML=s.innerHTML.replace(/window\./g,"_ge($PF.fid).contentWindow."),d.className=s.className,d.id=s.id,a.isCopied=1,m=1,f.style.position="absolute",f.style.top=u.bottom+"px",f.style.left=($B.rtl?u.left:u.right)+"px",f.style.height=0,f.style.padding=0,s=d,i=f,c.appendChild(f),c.appendChild(d),v.$Config.Themes=n.$Config.Themes,r=1,v.$header.copyThemeToOuterFrame(n),_.bind("resize.cb",function(){m=0}),v.$header.reportBSIMenu(e("#c_cof"),"c_cof"),v.$header.reportBSIMenu(e("#c_coh"),"c_coh")}if(s.binding)s.binding.toggleState();else{var h=l.parentNode;$menu.create(t,1,{sourceEl:i,menuEl:s,pressedStateEl:h,bindEnterKey:!0})}($Config.Themes.ThemeService||v.$themewritecallback)&&$Do.when("$ThemeMenuInit",0,r)},E.getInstanceById=function(e){if(!w[e]){var t=_ge("#"+e);t&&(w[e]=new wLive.Controls.CommandBar("#"+e,!0,t.dataModel))}return w[e]},E.invalidateOptionsMenu=function(e){var t=e._ge("c_copt");t.isCopied=!1};var $;E.init=o,$Do.when("$CommandBarDomReady",0,function(){$Do.when("$WLiveLoaded",0,function(){setTimeout(o,0)})})}(window.originaljQuery||jQuery)}),define("trie",["commandbar"],function(){!function(){function e(e){function t(e){for(var t=0,n=i.length-1,r=null,o=null;n>=t;)if(r=Math.floor((t+n)/2),o=i[r].key.substring(0,e.length),e>o)t=r+1;else{if(!(o>e))return r;n=r-1}return null}var n=this,i=[],r=e,o=!1;n.remove=function(e){i.remove(e)},n.insert=function(e,t){var n={key:e,datum:t};return i.push(n),o=!1,n},n.sort=function(){o||i.sort(function(e,t){var n=e.key,i=t.key;return n>i?1:i>n?-1:0}),o=!0},n.matchPrefix=function(e,o){var a=null,s=null,l=null,c=null,u=null,d=null;if(n.sort(),a=t(e),null==a)return[];for(s=a;s>0&&i[s-1].key.startsWith(e);s--);for(l=a+1;l<i.length&&i[l].key.startsWith(e);l++);c=new Array(l-s);for(var f=0;f<c.length;f++){var h,p=i[s+f];h=o?{key:p.key,datum:p.datum}:p.datum,c[f]=h}if(r){c.sort(r),u=[d=c[0]];for(var g=0;g<c.length;g++)r(d,c[g])&&u.push(d=c[g]);return u}return c}}var t=window;t.$Trie=e}()}),define("icusertilescript.inline",["trie"],function(){}),define("logout",["icusertilescript.inline"],function(){!function(){function e(){function e(e,t){i||(i=1,$BSI.navigateTo(e,t))}function t(t,n){var i=this,r=[];i.pause=function(e){r.push(e)},i.resume=function(i){r.remove(i),0==r.length&&e(t,n)}}var i,r=this,o=[];r.add=function(e){o.push(e)},r.remove=function(e){o.remove(e)},r.doLogout=function(r){var a,s=0,l=o.length;if(i=0,!r.shiftKey&&!r.ctrlKey&&!r.altKey)for(var c=r.target;c;){if("A"==c.tagName){var u=c.href;if(u){var d=c.target;$f.cancelEvent(r),a=new t(u,d),setTimeout(function(){e(u,d)},1e3)}break}c=c.parentNode}var f="$logout";for(a.pause(f);l>s;s++)try{o[s](a)}catch(h){n.submitFromException(h)}a.resume(f)}}{var t=window,n=t.$WebWatson;t.$Logout=new e}}()}),define("preload",["logout"],function(){!function(e){function t(){$Config.WebIM?$Do.when("wlxim",0,n):$BSI.isLoading()?($BSI.addLoadedCallback(o),m=1):o(),e(c).bind("beforeunload",u.dispose)}function n(){s=window.$WLXIM,e(s).bind("stateChange",r),r(),g=1}function i(){e(s).unbind("stateChange",r),g=0}function r(){s.hasContacts()&&o()}function o(){var e=h.DelayMs||0;setTimeout(a,e),g&&i()}function a(){if(!p){var e=h.View;p=1,e&&(l=document.createElement("iframe"),l.id=d,l.width=l.height=0,l.style.display="none",l.src="/handlers/resourcespreload.mvc?bicild=&view="+e,document.body.appendChild(l))}}var s,l,c=window,u=c.$Preload={},d="preload_frame",f=c.$Config,h=f.Preload||{},p=0,g=0,m=0;u.dispose=function(){if(u.pause(),g?i():m&&($BSI.removeLoadedCallback(o),m=0),e(c).unbind("beforeunload",u.dispose),l){try{var t=l.contentWindow;t.onunload&&(t.onunload(),t.onunload=null)}catch(n){}l.parentNode.removeChild(l),l=0}},u.resume=function(e){if(l)try{l.contentWindow.$Preload.resume(e)}catch(t){}},u.pause=function(){if(l)try{l.contentWindow.$Preload.pause()}catch(e){}},t()}(window.originaljQuery||jQuery)}),define("basemaster",["preload"],function(){!function(e){function t(){$Do.when("$PF.attach",0,u.dispose),s=f.height(),d.fs&&$BSI.addLoadedCallback(r),e(document).bind("mousedown",n),$f.getDocType().indexOf("Strict")>0&&e(document.body).addClass("strict")}function n(t){var n=t.target;for(l&&i(t,l);n;){if(m.contains(n.tagName)){l=n,$css.addHideBorder(t,n),"A"==n.tagName&&$css.addPressedState(t,n),e(n).bind("blur",i);break}n=n.parentNode}}function i(t,n){n=n||this,$css.removeHideBorder(t,n),$css.removePressedState(t,n),e(n).unbind("blur",i),l=null}function r(){$Network.fetchCSS(d.fs,o,void 0,"Gfx_Css_WlxFonts_Download","Gfx")}function o(){var e=new Date;e.setDate((new Date).getDate()+1),$Cookie.setCookie("wlfonts","1",d.sd,"/",e)}var a,s,l,c=window,u=c.$baseMaster={},d=$Config,f=e("#m_wh"),h=e("#c_header"),p=e("#c_base"),g=!0,m=["A","INPUT","LABEL","BUTTON","TEXTAREA"];u.getHeaderHeight=function(){return s||(s=f.height()),s},u.toggleFixedHeader=function(t){g=!!t,f.show();var n=u.getHeaderHeight();t?($B.IE&&$B.V<=8&&f.show(),f.css({top:"0"}),h.removeClass("c_h_hidden"),p.css({top:n+"px"}),c.$WLXIM&&$WLXIM.setSidebarToFullScreen(!1),e("a",f).attr("tabindex","")):($B.IE&&$B.V<=8&&f.hide(),p.css({top:"0"}),f.css({top:"-"+n+"px"}),h.addClass("c_h_hidden"),c.$WLXIM&&$WLXIM.setSidebarToFullScreen(!0),e("a",f).attr("tabindex","-1"))},u.dispose=function(){if(!a){var t=c.$Static,n=c.$Preload,i=c.$WLXIM,r=c.$WLXIMCL,o=c.$footer,s=c.$HeaderWebIM;t&&t.pause(1),n&&n.dispose(),i&&i.pause(),r&&r.dispose(),o&&o.dispose(),s&&s.dispose(),e(document.body).parent().removeClass("fh"),a=1}},t()}(window.originaljQuery||jQuery)}),define("persistenceframework",["basemaster"],function(){!function(e){function t(e){try{{_ge(p.fid).contentWindow.document.domain}}catch(t){return}var n="",i=e.pfState;n=i?0==i.indexOf("#")?[p.afu,i].join(""):i:p.afu;var r=p.getNormalizedUrl(n,null);setTimeout(function(){p.navigateTo(r)},1);var o;return r!=n&&(o=p.getRelativeUrl(r)),o}function n(t){p.i||(e(p).bind(h,t),g++)}function i(t){var n=this;p.i||e(p).bind(f,function(){t.call(n)})}function r(t){p.i||e(p).unbind(f,t)}function o(){s||(s=e("#"+p.lid),s.html('<div style="top:45%;width:100%;position:absolute;text-align:center">'+$f.createLoading(1,0,"60px")+"</div>"),l=s.find(".c_loadingDots")),s.show(),$f.showLoading(l),e("#"+p.did).hide()}function a(e){var t=e.document.getElementsByTagName("link");if(t)for(var n=0;n<t.length;n++)if(t[n].getAttribute("rel").indexOf("icon")>-1)return t[n];return void 0}var s,l,c,u,d=window,f="Merge",h="PreMerge",p=d.$PF,g=0,m=0,v=2e3;p&&p.f&&(p.i||($Do.when("$History.attachPF",0,t,!0),p.m&&e("form").submit(function(){var t=e(this);return t.attr("target")||(t.attr("target",p.fid),$Do.when("$PF.merge")),!0})),p.preMerge=function(t){return p.merged?(p.navigateTo(t),void 0):(g>0?(u=t,e(p).trigger(h)):p.mergeAndNavigate(t),void 0)},p.allowMerge=function(){m++,m>=g&&p.mergeAndNavigate(u)},p.merge=function(){p.merged||(p.merged=!0,e(p).trigger(f),e(p).unbind(f),e(p).unbind(h),e("body").css("cssText",p.hbs),e("html").css("cssText",p.hhs),e("#"+p.did).show().add("[persist]").parentsUntil("body").andSelf().attr("persist",1).siblings().filter(":not([persist])").hide())},p.showLoading=function(){p.lid&&(c=setTimeout(o,v))},p.hideLoading=function(){p.lid&&(clearTimeout(c),e("#"+p.did).show(),s&&(s.hide(),$f.hideLoading(l)))},p.updateFavicon=function(e,t){var n=a(e),i=a(d);if(n&&i){var r=i.cloneNode(!0);r.href=n.getAttribute("href"),t.document.head.appendChild(r),i.parentNode.removeChild(i)}},$Do.register("$PF"),$Do.register("$PF.merge",p.merge),$Do.register("$PF.attach",i),$Do.register("$PF.detach",r),$Do.register("$PF.attachPreMerge",n))}(window.originaljQuery||jQuery)}),define("flextag",["persistenceframework"],function(){!function(){var e=window;e.$Flextag=new function(){var t=this;t.load=function(){e.$Config&&$Config.flextag&&$Config.flextag.url&&setTimeout(function(){var e="flextagFrame",t=document.getElementById(e),n=$Config.flextag.url+"?v="+(new Date).getTime();if(t)t.src=n;else{var i=document.createElement("IFRAME");i.id=i.name=e,i.width=i.height=0,i.style.display="none",i.scrolling="no",i.frameBorder="0",i.allowTransparency=!0,i.src=n,document.body.appendChild(i)}},2e3)}}}()}),define("animationsstub",["flextag"],function(){!function(e){function t(t,n,i,r){return r||(e(t).removeClass("NoDisplay"),e(t).toggle(!0)),s}function n(t){return function(n){return t?(e(n).removeClass("NoDisplay"),e(n).toggle(t)):e(n).addClass("NoDisplay"),s}}function i(){return function(t,n){return e(t).addClass("NoDisplay"),e(n).removeClass("NoDisplay"),e(n).toggle(!0),s}}var r=window,o=r.wLive;o.Animations={};var a=o.Animations,s=null;e.Deferred&&(s=e.Deferred().resolve()),e.extend(a,{Direction:{Horizontal:0,Vertical:0},Enabled:!1,expand:n(!0),collapse:n(!1),fadeIn:n(!0),fadeOut:n(!1),addToList:n(!0),deleteFromList:n(!1),addToSearchList:n(!0),deleteFromSearchList:n(!1),deleteFromListFast:n(!1),addAndDeleteInListFast:i(),showEdgeUI:n(!0),showPanel:n(!0),hideEdgeUI:n(!1),hidePanel:n(!1),showPopup:n(!0),hidePopup:n(!1),enterContent:t,exitContent:n(!1),enterContent2:t,exitContent2:n(!1),flyAway:function(){return s},reveal:n(!0),hide:n(!1)})}(window.originaljQuery||jQuery)}),define("webim",["animationsstub"],function(){!function(e){function t(){function t(){return Un&&Un.get_status()==Qn.UserStatus.signedIn}function n(t,n){if(I.$Sutra){var i=t.content(),r="$Sutra.WebIM.Flyouts.{0}".format(n.sutra.flyoutName);sutra(i,r);var o=t.getButton({buttonName:"action"});o&&sutra(e(o),r+"ActionButton");var a=e(".UserTitle",i);a.length>0&&sutra(a,r+"Title");var s=e(".UserContent",i);s.length>0&&sutra(s,r+"Message"),n.sutra.applyCustomTags&&n.sutra.applyCustomTags(r,i)}}function r(e,t,n,i,r,o){function a(t){0==u&&(c&&l?I.$pwc.client.blockOrUnblockMessenger(e,n,function(){o||(ai.addScenarioQoSStats(n?st:lt,null,p,f,!1),w(f,!0)),v(i)},function(t){s(n,e),o||(ai.addScenarioQoSStats(n?st:lt,t,p,f,!1),w(f,!1,t)),v(r)}):(c||s(n,e),o||w(f,c,c?null:h(t)),v(c?i:r)))}var l,c=!0,u=0,d=e.getContacts(),f=o||P.startScenario(n?X:Y,G),p=(new Date).getTime();if(!ai.user)return o||w(f,!1,"userNotInitialized"),v(r),void 0;for(var m=ai.user.get_skypeAddress()?ai.user.get_skypeAddress().get_address():null,y=0;y<d.length;y++){var _=d[y];if(_.getSourceId()===Q)l=_;else if(ai.isSkypeBlockEnabled()&&m&&(_.getSourceId()===q||_.getSourceId()===V)&&n!=_.getIsBlocked()&&I.SkyJS&&I.SkyJS.Outlook.isUserLinkStatusActive()){u++;var b=n?I.SkyJS.Outlook.blockContact:I.SkyJS.Outlook.unblockContact;b({data:{userId:m,contactId:g(_),reporterIp:E.ip,reportAbuse:t?1:0},success:function(e){u--,ai.addScenarioQoSStats(n?ot:at,null,p,f,!1),a(e)},error:function(e){c=!1,u--,ai.addScenarioQoSStats(n?ot:at,h(e),p,f,!1),a(e)}})}}a(null)}function s(t,i){var r=I.MsgrUI,o=t?r._getLocString("flyoutsBlockErrorMessage"):r._getLocString("flyoutsUnblockErrorMessage");o=o.format(i.getDisplayName().encodeHtml());var a={action:r._getLocString("flyoutsBlockErrorMessageButton")},s=x.Controls.Notifications.createTopBar({content:o,dismissalMode:x.Controls.Notifications.BarDismissalMode.Explicit,buttons:a});e(s).bind("aftershow.topBar",function(){n(s,{sutra:{flyoutName:"BlockUnblockErrorNotification"}}),e(s).unbind("aftershow.topBar")}),s.show().then(function(){s=null})}function d(e,t,n,i,r,o){function a(e){(!n||n&&u)&&(w(s,c,c?null:h(e)),v(c?r:o))}var s=P.startScenario(J,G),l=(new Date).getTime();if(I.SkyJS&&I.SkyJS.Outlook.isUserLinkStatusActive()){var c=!0,u=!1,d=ai.user.get_skypeAddress().get_address();I.SkyJS.Outlook.declineRequest({data:{userId:d,contactId:e},success:function(r){if(ai.addScenarioQoSStats(rt,null,l,s,!1),n&&ai.blockPerson(t,i,function(){u=!0,a(r)},function(){u=!0,c=!1,a(r)},s),i){var o=I.$pwc.getPerson(t);ai.reportAbuse(o,e)}a(r)},error:function(e){ai.addScenarioQoSStats(rt,h(e),l,s,!1),c=!1,a(e)}})}else w(s,!1,"userLinkNotActive"),v(o)}function h(e){return e?"{0}-{1}".format(e.code||"NoCode",e.text||"NoDescription"):"NoErrorData"}function g(e){return e.getSourceId()==q?e.getSkypeId():e.getObjectId()}function v(e,t){e&&e.apply(null,t||[])}function _(){At=!0}function M(){Yt(),At=!1,null!=Tt&&(I.clearInterval(Tt),I.setTimeout(function(){F.title=It},200),Nt=0,Bt={},Tt=null)}function R(t,n,i){var r=e("<div class='imToastHeader' />").text(t),o=e("<div class='imToastBody' />").append(I.Microsoft.Live.Messenger.MessengerUtility.replaceEmoticons(n)),a=m(H),s=I.wLive.Controls.Notifications.createToast({title:r,content:o,sourceIcon:a,options:{moreCss:"t_cbr"}});O(i),Ht[i]=s,s.show().then(function(e){e.clicked&&$WLXIM.onToastClicked(i)})}function O(e){if(Ht[e])try{Ht[e].dismiss();var t=I.wLive.Controls.Notifications.getQueue();t&&t.removeNotification(Ht[e])}catch(n){A.logError("removeToastFromQueueError",n)}}function W(t,n){0!=e("#rec_conv").length&&(wt=t,jt=!0,Dt&&p(),Ct=Un.get_contacts().findByIdWithoutRoleCheck(t),C(t,n||"other","chat"))}function mt(e){Qt(e,Rt)&&(Mt-=1)}function vt(e){Xt(e,Rt)&&Mt++}function Et(e){Xt(e,Bt)&&Nt++}function Qt(e,t){return 1==t[e]?(Rt[e]=0,!0):!1}function Xt(e,t){return 1!=t[e]?(t[e]=1,!0):!1}function Yt(){Ft>0&&x.Animations.enterContent(e("#c_ofm"),{top:100,left:0}).then()}function Zt(){return Ut?"open":"close"}function en(t,n,i,r){if(n=n||t.get_currentAddress(),n&&n.get_network().get_isSkype()){if(I.SkyJS){r=r||e("#sidebar")[0];var o=n.get_linkedContact().get_skypePendingOutbound&&n.get_linkedContact().get_skypePendingOutbound();return I.SkyJS.Outlook.isUserLinkStatusActive()?20==n.get_type()?(n.get_linkedContact().get_isBlocked()||ai.showSkypeInviteFlyout(r,t.get_id(),i),!1):8==n.get_type()&&o?(ai.showResendSkypeInviteFlyout(r,t.get_id(),i),!1):!0:(ai.showConnectToSkypeFlyout(r,I.MsgrUI._getLocString("flyoutsConnectToSkypeSendMessageText")),!1)}return!1}return!0}function tn(t,n,i){return n=n||t.get_currentAddress(),n&&n.get_network().get_isSkype()?I.SkyJS?I.Microsoft.Live.Messenger.Services.SkyJSHelper.isCallInProgress?!1:(i=i||e("#sidebar")[0],I.SkyJS.Outlook.isUserLinkStatusActive()?!0:(ai.showConnectToSkypeFlyout(i,I.MsgrUI._getLocString("flyoutsConnectToSkypeCallText")),!1)):!1:!0}function nn(e,t,n){var i;i=t?t.get_network().get_id():e.get_currentAddress().get_network().get_id(),I.SkyJS.Outlook.startCall(e.get_skypeName(),e.get_cid(),n,Un.createSkypeInitializationInfo(e),i)}function rn(){var t=50;return e("#m_wh").length>0?t=e("#m_wh").height()||t:e("#HeaderContainer").length>0&&(t=e("#HeaderContainer").height()),t}function on(){Ut=!1;var t=N("c_hiconm");null!=t&&t.setAttribute("aria-pressed","false");var n=e("#sidebar");n.is(":hidden")||(hn("onSidebarClosedEvent",null),T.rtl?x.Animations.hideEdgeUI(n,{left:pt,top:0}).then(function(){n.hide(),fn(),dn(),hn("onSidebarCloseCompletedEvent",null),e(t).css("background-color","")}):x.Animations.hideEdgeUI(n,{left:pt,top:0}).then(function(){e(n).css("left",""),n.hide(),fn(),dn(),hn("onSidebarCloseCompletedEvent",null),e(t).css("background-color","")}),Vt&&$t&&$t.sendWebimPaneStateChanged(Zt())),pn(j)}function an(e){jt&&wt?ln(e):sn()}function sn(){var t=e("#chat_view");t.is(":hidden")?un():x.Animations.fadeOut(t).then(function(){t.hide(),un()})}function ln(t){var n=e("#rec_conv");n.is(":hidden")?cn(t):x.Animations.fadeOut(n).then(function(){n.hide(),cn(t)})}function cn(t){var n=e("#chat_view");n.is(":hidden")&&(n.show(),x.Animations.fadeIn(n).then(function(){var n=e(".ModernConversationHistoryControl").get(0);n&&(n.scrollTop=n.scrollHeight);var i=e(".ModernConversationInputControl_TextBox").get(0);null!=i&&1==t&&i.focus(),_t&&_t.set_isVisible(!0),hn("landingPageControlVisible",!1)})),jt=!0,wt&&(mt(wt),O(wt),pn(wt)),Kt=e("#chat_view").find("a").first()}function un(){var t=e("#rec_conv");t.is(":hidden")&&(t.show(),x.Animations.fadeIn(t).then(function(){yt&&(e(yt.get_element()).show(),hn("landingPageControlVisible",!0))})),pn(U),Kt=e("#rec_conv").find("[resourceid='ContactSearchInput']").first()}function dn(){e("#rec_conv").css("display","none")}function fn(){e("#chat_view").css("display","none")}function hn(t,n){e("#sidebar").trigger(t,n)}function pn(e){var t="cid="+E.cid+":state="+e;D.setCookie("Webim_Sidebar_Open",t,E.sd,0,null,1)}function gn(){Tn(0),Un&&Un.set_services(Qn.SessionServices.notifications)}function mn(){Un&&(Un.set_services(Qn.SessionServices.full),xn("Full"))}function vn(e){if(ai.hasPresence()){e&&(Zn=e,Zn.pause("wim"));try{Un.signOut()}catch(t){A.logError("Signout Error",t)}}}function yn(){qn=1,jn=E.WebIM,Ln(),A.logAction("WebIM_DownloadingResources"),On(),_n()}function _n(){Lt=new Date,St=P.startScenario(z,G),kt=(new Date).getTime(),L.fetchCSS(jn.c,Cn,void 0,"Gfx_Css_WlxWebIMUI_Download","Gfx"),L.fetchCSS(jn.cc,Cn,void 0,"Gfx_Css_WebIMCore_Download","Gfx"),L.fetchScript(jn.a,Cn,"window.live.shared.globalsettings.webim","Gfx_JS_WebIMStr_Download","Gfx"),L.fetchScript(jn.cs,Cn,"webimui","Gfx_JS_WebIMCombined_Download","Gfx"),1==window.$Config.WebIM.si?L.fetchScript(jn.slu+"?r="+Math.random(),wn,void 0,"Gfx_JS_Skype_LocJs","Gfx"):(A.logAction("WebIM_Skype_DisabledByConfig"),bn()),jn.pj&&L.fetchScript(jn.pj,null,void 0,"Gfx_JS_Popover_Download","Gfx"),null==I.wLive.Search&&L.fetchScript(jn.ss,null,void 0,"window.wLive.Search")}function wn(){I.SkyJS&&I.SkyJS.Live&&I.SkyJS.Live.Rollout?I.SkyJS.Live.Rollout.isEnabled(E.cid,E.mkt.toLowerCase())?(ai.addScenarioQoSStats(Z,null,kt,St,!1),fi=I.SkyJS.Live.Rollout.getPackageUrl(E.cid,E.mkt.toLowerCase()),jn.eso&&I.location.search.indexOf("skyjsurl=")>-1&&/^https:\/\/(az351254|az299139|az340659|az359216|az415007)\.vo\.msecnd\.net\/\d+-\d+-\d+\/assets\/javascript\/outlook-package\.min\.js$/.test(I.location.search.split("skyjsurl=")[1])&&(fi=I.location.search.split("skyjsurl=")[1]),L.fetchScript(fi,Cn,void 0,"Gfx_JS_Skype_Skyjs","Gfx")):(A.logAction("WebIM_Skype_Rollout_Disabled"),bn()):(ii=!0,ai.addScenarioQoSStats(Z,ct+"LocJs",kt,St,!1),bn())}function bn(){var e=F.createElement("script");fi=e.src="",Cn(e)}function Cn(t){di++,Sn(t),di==ui&&(ii?w(St,!1,ct):w(St,!0),$.register("wlximuiouter",0,!0),Kn?kn():k(!1,ct,null),0==e("#sidebar").length&&(o(),e("#c_cme #c_hiconm").removeClass("c_md"),e(".c-Header .meArea .c_hiconm").removeClass("c_md"),a(),$.when("$pwc",0,f)))}function Sn(e){var t="script"==e.nodeName.toLowerCase()?e.src:e.href;switch(t){case location.protocol+"//"+location.hostname+jn.a:void 0!=I.GetString&&""!=I.GetString("live.webim.strings.connectedto")?ai.addScenarioQoSStats(tt,null,kt,St,!1):(ii=!0,ai.addScenarioQoSStats(tt,ct+"Strings",kt,St,!1));break;case jn.cs:ai.ML=Wn=I.Microsoft.Live,ai.MLM=Qn=Wn.Messenger,Qn?(Kn=!0,ai.addScenarioQoSStats(et,null,kt,St,!1)):(ii=!0,ai.addScenarioQoSStats(et,ct+"Core",kt,St,!1));break;case fi:I.SkyJS&&I.SkyJS.Outlook?ai.addScenarioQoSStats(nt,null,kt,St,!1):(ii=!0,ai.addScenarioQoSStats(nt,ct+"SkyJS",kt,St,!1))}}function kn(){var t=new Qn.RpsAuthIdentity(E.email,E.cid,null,null);null!=E.BSI&&null!=E.BSI.xid&&t.set_experienceId(E.BSI.xid),e(t).bind("authenticationCompleted",In)}function In(t,n,i){var r=(I.Microsoft.Live.Messenger,i.get_resultCode());if(r==Qn.AuthenticationResultCode.failure)i.get_isUnsupportedBrowser()?(Xn=1,Hn(-1,"Authentication Failed: unsuported browser")):Hn(91,"Authentication Failed with status code: "+i.get_status());else if(A.logAction("WebIM_SigningIn"),ai.user=Un=new Qn.User(n,new Qn.Services.PeopleCache),Un.get_localEndpoint().set_name(jn.n),Un.get_services()!=Qn.SessionServices.normal?(Tn(Un.get_status()),Yn=1):i.get_multipleEndpointsNotSupported()?(Tn(0),gn()):(Tn(1),Un.set_services(Qn.SessionServices.full),xn("Full")),Pn(),Un.signIn(),!ri&&oi&&oi.messagingModule&&oi.messagingModule.containerClassName){var o=e("."+oi.messagingModule.containerClassName);if(o){ri=new I.MsgrUI.MessagingModuleControl(Un,{containerWidth:o.width(),tabIndex:oi.messagingModule.tabIndex}),o.empty().append(ri.render()),ri.activate();var a=e(ri.get_element());o.bind("resize",function(){a.triggerHandler("resize")})}}}function xn(e){if(!Yn){Yn=1;var t={IMMode:e};I.$BSI.reportEvent("ClickedSelected.Messaging.IMStart",t),A.logDetails("WebIM_StartIM",t)}}function Tn(e){D.setCookie(si,E.hcid+li+e,E.sd,0,0,1)}function Ln(){var e=D.getCookie(si,1);if(e){var t=e.indexOf(li);if(-1!=t&&e.substr(0,t)==E.hcid&&(e=parseInt(e.substr(t+1)),!isNaN(e)))return e}return 1}function Pn(){e(Un).bind("signInCompleted",Fn),e(Un).bind("signedOut",Bn),e(Un).bind("propertyChanged",Nn),e(Un.get_contact().get_presence()).bind("propertyChanged",Mn),e(Un.get_conversations()).bind("collectionChanged",En),e(window).bind("unload",An),e(window).bind("resize",Dn),e(window).bind("blur",_),e(window).bind("focus",M)}function Dn(){if(Pt&&Pt.length>0&&ai.isSidebarOpened()&&!ai.isSidebarOverlay()){var t=e(window).width()-pt+"px";try{Pt.width(t)}catch(n){}}}function En(t,n,i){var r=i.get_newItems();if(r&&r.length>0){var o=r[0];e(o).bind("messageReceived",$n)}}function $n(e,t,n){if(null!=Un.get_contacts()&&Un.get_contacts().get_count()>0&&(!t.get_userInitiated||!t.get_userInitiated())){var i=t.get_buddyContact();i&&ai.onConversationUpdated(i,n.get_message(),t instanceof I.Microsoft.Live.Messenger.GroupConversation)}}function An(){e(window).unbind("unload",An),e(window).bind("resize",Dn),e(Un).unbind("signInCompleted",Fn),e(Un).unbind("signedOut",Bn),e(Un).unbind("propertyChanged",Nn),e(Un.get_contact().get_presence()).unbind("propertyChanged",Mn);var t=Un.get_conversations();e(t).unbind("collectionChanged",En);for(var n=0;n<t.get_count();n++)e(t).unbind("messageReceived",$n);if(null!=$t){var i=e($t);i.unbind("StartGroupChat"),i.unbind("ToggleMessagingPane"),i.unbind("WebImTakeFocus"),i.unbind("RegisterThreadId")}}function Fn(e,t,n){n.get_resultCode()==Qn.SignInResultCode.success?(ei=1,ai.isFull()||mn(),u(),k(!0,null,null)):k(!1,null,n.get_error()),Vn||D.setSessionCookie("WebIM","1"),Rn(),On(),$.register("$WLXIM.UserSignedIn"),A.logAction("WebIM_SignedIn")}function Nn(e,t,n){var i=n.get_propertyName();("Services"==i||"Status"==i)&&(ni&&Un&&Un.get_status()==Qn.UserStatus.signedIn&&(ni=0,gn()),!ei&&Un&&Un.get_status()==Qn.UserStatus.signedIn&&(ei=1),ti&&Un&&Un.get_status()==Qn.UserStatus.signedIn&&(ti=0,mn()),Un&&Un.get_status()!=Qn.UserStatus.signedIn&&l(),On())}function Mn(e,t){var n=t.get_status();n!=Qn.PresenceStatus.offline&&Tn(n),Un&&Un.get_presence().get_status()==Qn.PresenceStatus.offline?Un.get_status()==Qn.UserStatus.signedIn&&c():u()}function Bn(e,t,n){n.get_reason()||Zn&&Zn.resume("wim"),l()}function Rn(){Vn||(Vn=1)}function Hn(e,t){Jn=1,On(),Rn(),A.log({eventType:"WebIM_InitializationFailure",resultCode:e,resultDetails:{message:t}})}function On(){for(var t=0,n=ci.clone(),i=n.length;i>t;t++)try{n[t]()}catch(r){A.logError("WebIM_InformStateChagne",r)}e(ai).trigger("stateChange")}var Un,jn,Wn,Qn,Vn,qn,Gn,zn,Kn,Jn,Xn,Yn,Zn,ei,ti,ni,ii,ri,oi,ai=this,si="pres",li="=",ci=[],ui=5,di=0,fi="";ai.isWac=void 0,ai.wacThreadId=void 0,ai.wacReady=function(){return!(!ai.isWac||!ai.wacThreadId)},ai.isOff=function(){return!(ti||qn&&0!=Ln())},ai.isUnsupported=function(){return Xn},ai.isError=function(){return!ai.isOff()&&(Jn||Un&&Un.get_status()==Qn.UserStatus.signedOut)},ai.isLoading=function(){return!(ai.isOff()||ai.isError()||Un&&Un.get_status()!=Qn.UserStatus.signingIn&&Un.get_status()!=Qn.UserStatus.signingOut)},ai.isWaitingToReconnect=function(){return!ai.isOff()&&Un&&Un.get_status()==Qn.UserStatus.autoReconnectWaiting},ai.hasContacts=function(){return ei},ai.hasNotify=function(){return t()},ai.hasPresence=function(){return t()&&Un.get_services()>Qn.SessionServices.notifications},ai.isFull=function(){return t()&&Un.get_services()==Qn.SessionServices.full},ai.addScenarioQoSStats=function(e,t,n,i,r){if(i){var o={api:e,dependent:G};"undefined"!=typeof t&&null!=t&&(o.error=t),r&&(o.errorType="c"),x.ScenarioQoSStats.add(o,n,i),A.log({eventType:e,resultCode:t})}},ai.addStateListener=function(e){ci.push(e)},ai.removeStateListener=function(e){ci.remove(e)},ai.showFlyout=function(t){var i=x.Controls.Notifications.createFlyout(t);e(i).bind("aftershow.flyout",function(){n(i,t),t.onAfterShow&&t.onAfterShow(i),e(i).unbind("aftershow.flyout")});var r;e(i).bind("beforedismiss.flyout",function(){r=i.content(),e(i).unbind("beforedismiss.flyout")}),t.onButtonClick&&e(i).bind("buttonclick.flyout",function(){t.onButtonClick(i)}),i.show().then(function(e){"action"===e.buttonClicked?t.performAction&&t.performAction(r):t.onDismiss&&t.onDismiss(r)}),r=null},ai.showFirstShortCircuitFlyout=function(e,t){var n=I.MsgrUI,i=I.$pwc.getPerson(e);if(i){var r={content:n._getLocString("firstShortCircuitFlyoutMessage").format(i.getOrderedName()),anchor:t,sutra:{flyoutName:"firstscmessageflyout"}};ai.showFlyout(r)}},ai.isSkypeInvitesEnabled=function(){return!!window.$Config.WebIM.sv&&Kn&&ai.MLM.Services.SkyJSHelper.skypeEnabled},ai.isSkypeBlockEnabled=function(){return!!window.$Config.WebIM.sb&&Kn&&ai.MLM.Services.SkyJSHelper.skypeEnabled},ai.showBlockFlyout=function(t,n,i,r,o){var a=I.MsgrUI,s=I.$pwc.getPerson(n);if(s){var l=o||a._getLocString("flyoutsBlockMessage").format(s.getOrderedName()),c={content:dt.format(l.encodeHtml(),a._getLocString("flyoutsReportAbuse").encodeHtml()),anchor:t,buttons:{action:a._getLocString("flyoutsBlockButton")},sutra:{flyoutName:"BlockFlyout",applyCustomTags:function(t,n){var i=e("input",n);sutra(i,t+"ReportAbuse")}},performAction:function(t){var o=e("input",t)[0].checked;ai.blockPerson(n,o,function(){o&&ai.reportAbuse(s,null),v(i,[!0])},r,null)},onAfterShow:function(t){var n=e(t.content()),i=e(".wim_block_repabuse",n),r=e(t.getButton({buttonName:"action"}));i.find("label").bind("click",function(){var e=i.find(":checkbox");e.prop("checked",!e.is(":checked"))}),e(".ButtonArea",n).css("min-width",i.width()+r.width()+30)},onDismiss:function(t){e(".wim_block_repabuse",t).find("label").unbind(),v(i,[!1])}};ai.showFlyout(c)}},ai.showDeclineInviteFlyout=function(t,n,i,r,o){var a=I.MsgrUI,s={title:a._getLocString("flyoutsDeclineInviteTitle").encodeHtml(),content:ut.format(a._getLocString("flyoutsBlockCheckbox").encodeHtml(),a._getLocString("flyoutsReportAbuse").encodeHtml()),anchor:t,buttons:{action:a._getLocString("flyoutsDeclineButton")},sutra:{flyoutName:"DeclineInviteFlyout",applyCustomTags:function(t,n){var i=e("input",n);sutra(i[0],t+"Block"),sutra(i[1],t+"ReportAbuse")}},performAction:function(t){var a=e("input",t),s=a[0].checked,l=a[1].checked;d(i,n,s,l,function(){v(r,[!0])},o)},onAfterShow:function(t){var n=e(t.content());n.find("label").bind("click",function(t){var n=e(t.target).parent().find(":checkbox");n.prop("checked",!n.is(":checked"))})},onDismiss:function(t){e(t).find("label").unbind(),v(r,[!1])}};ai.showFlyout(s)},ai.showConnectToSkypeFlyout=function(t,n){var i=I.MsgrUI;n=n||i._getLocString("flyoutsConnectToSkypeAddContactText");var r={content:n.encodeHtml(),anchor:t,buttons:{action:i._getLocString("flyoutsConnectToSkypeButton")},sutra:{flyoutName:"ConnectToSkypeFlyout"},onButtonClick:function(t){e(t).unbind("buttonclick.flyout");var n=E.WebIM.sau,i=I.open(n,"_blank","scrollbars=0,resizable=1,location=0, width=720,height=520"),r=I.setInterval(function(){i.closed&&(I.clearInterval(r),I.location.reload())},500)},performAction:function(){}};ai.showFlyout(r)},ai.showSkypeInviteFlyout=function(e,t,n,i,r){var o=I.MsgrUI,a={content:o._getLocString("flyoutsAddToSkypeText").encodeHtml(),anchor:e,buttons:{action:o._getLocString("flyoutsAddToSkypeButton")},sutra:{flyoutName:"AddToSkypeContactsFlyout"},performAction:function(){ai.sendSkypeInvite(t,n,function(){v(i,[!0])},r)},onDismiss:function(){v(i,[!1])}};ai.showFlyout(a)},ai.showResendSkypeInviteFlyout=function(e,t,n,i,r){var o=I.MsgrUI,a=I.$pwc.getPerson(t);if(a){var s={content:o._getLocString("flyoutsResendSkypeRequestText").format(a.getDisplayName()).encodeHtml(),anchor:e,buttons:{action:o._getLocString("flyoutsResendSkypeRequestButton")},sutra:{flyoutName:"ResendSkypeRequestFlyout"},performAction:function(){ai.sendSkypeInvite(t,n,i,r)
},onDismiss:function(){i&&i()}};ai.showFlyout(s)}},ai.reportAbuse=function(e,t){if(null!=e){var n=e.getContacts();if(n.length>0){var i=Un.get_contacts().findByIdWithoutRoleCheck(n[0].getId());if(null!=i)for(var r=0;r<i.get_addresses().get_count();r++){var o=i.get_addresses().get_item(r);o.get_supportsReportAbuse()&&Un.reportAbuse(o,null)}}}else Un.reportAbuse(null,t)},ai.sendSkypeInvite=function(e,t,n,i){function r(e){0==o&&(ai.addScenarioQoSStats(it,a?null:h(e),l,s,!1),w(s,a,a?null:h(e)),v(a?n:i))}var o=0,a=!0,s=P.startScenario(K,G),l=(new Date).getTime(),c={skypeinvitesource:t};if($BSI.reportEvent("WebIM.SkypeInviteSent",c),A.logDetails("WebIM_SkypeInviteSent",c),I.SkyJS){var u=I.$pwc.getPerson(e);if(u)for(var d=u.getContacts(),f=ai.user.get_skypeAddress().get_address(),p=0;p<d.length;p++){var m=d[p],y=m.getOrderedName();(m.getSourceId()===q||m.getSourceId()===V&&m.getSkypePendingOutbound())&&(o++,I.SkyJS.Outlook.sendRequest({data:{userId:f,contactId:g(m),greeting:y?I.MsgrUI._getLocString("flyoutsSendInviteGreeting").format(y):""},success:function(e){o--,r(e)},error:function(e){a=!1,o--,r(e)}}))}}r(null)},ai.blockPerson=function(e,t,n,i,o){var a=I.$pwc.getPerson(e);a&&r(a,t,!0,n,i,o)},ai.unblockPerson=function(e,t,n){var i=I.$pwc.getPerson(e);i&&r(i,!1,!1,t,n,null)},ai.signIn=function(){Un&&Un.get_status()==Qn.UserStatus.signedIn?(Tn(1),mn()):(ti=1,ni=0,On())},ai.signOut=function(){Un&&Un.get_status()==Qn.UserStatus.signedIn?gn():(ti=0,ni=1,On())},ai.reconnect=function(){ai.isWaitingToReconnect()&&Un.signIn()},ai.toggleSidebar=function(t){var n=!t||"mousedown"==t.type||13==t.which;if(n){var i=e("#sidebar");if(i.length>0)if(i.is(":hidden")){if($WLXIM.isWac&&$WLXIM.wacThreadId){var r=Un.findContactByThreadId($WLXIM.wacThreadId);if(!r)return;W(r.get_id(),"wac"),ai.showSidebar(!1)}else ai.showSidebar(!0);if(t&&13==t.which){var o=i.find("a");o.length>0&&o[0].focus()}}else S("header"),on(),hn("landingPageControlVisible",!1)}},ai.dismissSidebar=function(){S("closeButton"),on()},ai.getChatViewOpenedContactId=function(){return wt},ai.onChatViewBack=function(){sn(),jt=!1,wt=null},ai.onConversationSelected=function(e,t,n){W(n.buddyId,"recentConversations"),ln(!0)},ai.onConversationUpdated=function(e,t,n){var i=t.get_conversationId().split(":")[1].toLowerCase();if(!$WLXIM.isWac||$WLXIM.wacThreadId===i){var r=I.MsgrUI,o=I.Microsoft.Live.Messenger;if(1==At&&!t.get_reloaded()&&t.get_type()==o.MessageType.textMessage&&!t.get_sender().get_isUser()&&(Et(e.get_id()),!Vt)){var a=null!=e.get_firstName()?e.get_firstName():e.get_displayName();1==Nt&&n?hi(r._getLocString("newGroupMessageNotification")):1==Nt&&null!=a?hi(r._getLocString("newMessageNotification").format(a).trim()):hi(r._getLocString("newMultipleMessageNotification").format(Nt).trim())}if(!(t.get_reloaded()||t.get_type()!=o.MessageType.textMessage&&t.get_type()!=o.MessageType.threadActivityMessage||Ut&&jt&&wt&&wt==e.get_id()||null==e.get_id()||""==e.get_id())){if(t.get_sender().get_isUser())return mt(e.get_id()),void 0;if(vt(e.get_id()),!t.get_isOfflineMessage()){var s;if(t.get_type()==o.MessageType.textMessage)s=t.get_text();else{if(!r||!r.Utility)return;s=r.Utility.getActivityMessageString(t)}if(s){var l=e.get_displayName();R(l,s,e.get_id())}}}}},ai.removeAllToasts=function(){for(var e in Ht)O(e)};var hi=function(){var e=!1,t=function(){e?(F.title=xt,e=!1):F.title==xt?F.title=It:(It=F.title,F.title=xt)};return function(n){e=!0,xt=n,null==Tt&&(It=F.title,Tt=I.setInterval(t,1e3))}}();ai.updateMessagingCount=function(t){var n;if(t!==Ft){Ft=t,n=t>99?"99+":t>0?t:"";var i=e("#c_ofm"),r=i.parent();i.html(n),r.parent().width(i.width()+gt+"px"),Yt(),Vt&&$WLXIM.wacThreadId&&$t&&$t.sendWebimUnreadCountChanged(t,Zt())}},ai.isSidebarOpened=function(){return Ut},ai.isSidebarOverlay=function(){return Ot&&e(window).width()<ht},ai.setPaneToResize=function(e){Pt=e,$WLXIM.isSidebarOpened()&&i(null,ai.isSidebarOverlay())},ai.resetSidebarOverlaySettings=function(){Ot=!1,ht=ft},ai.setSidebarOverlay=function(e){Ot=e},ai.setSidebarOverlayWindowWidth=function(e){Ot=!0,ht=e},ai.setSidebarToFullScreen=function(t){Wt=1==t?"0px":rn()+"px",e("#sidebar").css("top",Wt)},ai.bindToCustomPostMessage=function(t,n){e($t).bind(t,function(e,t){qt||($t.sendWebImFirstIncomingMessage(),qt=!0),n(e,t)})},ai.sendCustomPostMessage=function(e,t){Gt||($t.sendWebImFirstOutgoingMessage(),Gt=!0),e.apply(ai,t)},ai.registerWacChat=function(t){function n(e,t){i(t.groupId)}function i(e){$WLXIM.wacThreadId=e.toLowerCase(),$.register("WACChatThreadIdChanged")}function r(e,t){var n=t.groupId.toLowerCase(),r=Un.findContactByThreadId(n);null!=r?ai.startConversationWithContactId(r.get_id(),"wac",!0):Un.addToStartGroupChatPendingList(n),i(n)}function o(e,t){var n=t.htmlEvent;ai.toggleSidebar(n)}function a(){if(ai.isSidebarOpened())if(e("#rec_conv").is(":visible")){var t=e("#rec_conv").find("[resourceid='ContactSearchInput']").first();t.blur(),t.focus()}else{var n=e("#chat_view").find("[resourceid='TextBox']").first();if(n.attr("disabled")){var i=e("#chat_view").find("a").first();i.blur(),i.focus()}else n.blur(),n.focus(),n.val(n.val())}}function s(t){9==t.which&&null!==Kt?(y(),t.shiftKey&&e(":focus")[0]===Kt[0]?(Jt.focus(),t.preventDefault()):t.shiftKey||e(":focus")[0]!==Jt[0]||(Kt.focus(),t.preventDefault())):117==t.which&&t.ctrlKey&&(t.preventDefault(),$t.sendWebimGiveFocus(t.shiftKey?"backward":"forward",Zt()))}Un&&Un.get_status()==Qn.UserStatus.signedIn&&MC.GroupChatFeatures.phase!=MC.GroupChatPhase.disabled&&($t=t,$t.sendWebimReady(Ft,Zt()),0==Vt&&(e($t).bind("StartGroupChat",r),e($t).bind("ToggleMessagingPane",o),e($t).bind("WebImTakeFocus",a),e($t).bind("RegisterThreadId",n),e(F).keydown(s)),e("#sidebar").addClass("is_wac_registered"),Vt=!0)},ai.startConversationWithContactId=function(e,t,n){var i=Un.get_contacts().findByIdWithoutRoleCheck(e),r=Un.get_aggregatedConversations().getAggregatedConversationByContact(i);bt=null!=r&&null!=r.get_currentConversation()?r.get_currentConversation().get_buddyAddress():i.get_currentAddress(),null!=bt&&(W(e,t),ai.showSidebar(n))},ai.startConversationWithContact=function(e,t,n,i,r){var o=$WLXIM.getConversationAddress(e,t,n);en(e,o,r,i)&&(bt=o,W(e.get_id(),r),ai.showSidebar(!0))},ai.startConversationWithIMAddress=function(e,t,n,i){en(e,t,n,i)&&(bt=t,n=n||"",W(e.get_id(),n),ai.showSidebar(!0))},ai.startAudioCall=function(e,t,n,i){return tn(e,n,i)?(nn(e,n,!1),C(e.get_id(),t,"voice"),!0):!1},ai.startVideoCall=function(e,t,n,i){return tn(e,n,i)?(nn(e,n,!0),C(e.get_id(),t,"video"),!0):!1},ai.onToastClicked=function(e){W(e,"toast"),ai.showSidebar(!0)},ai.switchPresence=function(e){Un&&(Un.get_presence().set_status(e),Un.get_settings().set_userPresencePreference(e))},ai.isVVWindow=function(){return jn.vv},ai.showSidebar=function(t){if(0!=e("#rec_conv").length){var n=N("c_hiconm");null!=n&&n.setAttribute("aria-pressed","true");var i=e("#sidebar");i.is(":hidden")?(i.show(),hn("onSidebarOpenedEvent",ai.isSidebarOverlay()),yt&&b(),T.rtl?i.css("left","0"):i.css("right","0"),x.Animations.showEdgeUI(i,{left:e(window).width(),top:0}).then(function(){if(an(t),hn("onSidebarOpenCompletedEvent",ai.isSidebarOverlay()),T.IE_M7&&Pt&&Pt.length>0){var i=Pt.get(0),r=i.style.display;i.style.display="none",i.style.display=r}e(n).css("background-color",B)})):an(t),Ut=!0,Vt&&$t&&$t.sendWebimPaneStateChanged(Zt())}},ai.getSidebarOpenCookieState=function(){var e=D.getCookie("Webim_Sidebar_Open");if(e){var t=e.split(":state=");if(t&&2==t.length&&t[0].endsWith(E.cid)&&t[1].length>0)return t[1]}return null},ai.init=function(e,t){oi=t,di>=ui?A.logAction("WebIM_AlreadyLoaded"):qn?A.logAction("WebIM_Alreadyoading"):Gn?(A.logAction("WebIM_DownloadPaused"),zn=1):yn(),I.$Logout.add(vn)},ai.pause=function(){qn||(Gn=1)},ai.resume=function(){Gn=0,zn&&yn()},ai.setTestFlags=function(e){jn.eso&&(zt=e)},ai.getTestFlags=function(){if(0==zt&&jn.eso&&I.location.search.indexOf("testflags=")>-1)for(var e=I.location.search.substring(1).split("&"),t=0,n=e.length;n>t;t++)if(e[t].startsWith("testflags=")){zt=parseInt(e[t].split("=")[1]),isNaN(zt)&&(zt=0);break}return zt},ai._pres=Ln,ai._inform=On}function n(){E.WebIM&&E.WebIM.cs&&(I.$WLXIM=new t,I.$WLXIM.isWac=e("body").attr("id").indexOf("Wac")>-1,$.when("$BSI",0,_))}function i(t,n){if(Pt&&Pt.length>0&&!n){if(T.rtl&&T.Firefox){var i=pt+Pt.width()-e(window).width();Pt.css("left",i+"px")}var r=e(window).width()-pt+"px";Pt.width(r)}}function r(){Pt&&Pt.length>0&&(Pt.width(""),T.rtl&&T.Firefox&&Pt.css("left","0"))}function o(){var t=v(M,F.body,"sidebar",null);t.setAttribute("persist","1"),$WLXIM.sidebar=t,$.register("$WLXIM.SidebarCreated"),e($WLXIM.sidebar).bind("onSidebarOpenedEvent",i),e($WLXIM.sidebar).bind("onSidebarCloseCompletedEvent",r),e($WLXIM.sidebar).addClass("t_sbgc"),$.register("wlxim_startconversation",$WLXIM.startConversationWithContact),$.when("NotificationControls",0,function(){x.Controls.Notifications.getQueue().start()}),e(t).css("top",Wt),I.$Sutra&&I.$Sutra.WebIM&&sutra(t,"$Sutra.WebIM.WebIMSidebar")}function a(){var t=I.MsgrUI,n=e("#sidebar").get(0),i="<span id='sidebar_close_img' tabindex='0' class='imCloseImg' style='background-image:url("+m(R)+");display:block;' role='button' aria-pressed='false'/>",r=13,o=32;e(n).append(i),e(n).find("#sidebar_close_img").on("click",function(){return $WLXIM.dismissSidebar(),!1}).on("keyup",function(e){return e.keyCode===o||e.keyCode===r?($WLXIM.dismissSidebar(),!1):void 0});var a=v(M,n,"sidebar_info",null),c=m(O),u="<div style='text-align:center'><img src='"+c+"' class='signin_loading_img' /> "+t._getLocString("signingInInfo")+"</div>";s(a,"signing",u,""),s(a,"reconnect","","<button class='default sidebar_button' type='button' onclick='$WLXIM.reconnect()'>"+t._getLocString("messagingPaneReconnectNow")+"</button>"),s(a,"signout",t._getLocString("messagingPaneSignOut"),"<button class='default sidebar_button' type='button' onclick='$WLXIM.signIn()'>"+t._getLocString("messagingPaneSignInButton")+"</button>"),s(a,"resignin",t._getLocString("messagingPaneSignOut"),"<button class='default sidebar_button' type='button' onclick='location.reload()'>"+t._getLocString("messagingPaneSignInButton")+"</button>");var d=v(M,n,"rec_conv",null),f=v(M,d,"rec_conv_body",null),h=v(M,n,"chat_view",null),p=v(M,h,"chat_view_body",null);l(),I.$Sutra&&I.$Sutra.WebIM&&(sutra(n,"$Sutra.WebIM.WebIMSidebar"),sutra(d,"$Sutra.WebIM.RecentConversationsView"),sutra(f,"$Sutra.WebIM.RecentConversationsList"),sutra(h,"$Sutra.WebIM.ChatView"),sutra(p,"$Sutra.WebIM.ChatViewBody"))}function s(t,n,i,r){var o="<table class='sidebar_info_table "+n+"'><tr style='vertical-align: bottom; height:50%'><td><div class='sidebar_info_top'>"+i+"</div></td></tr><tr style='vertical-align: top; height:50%'><td><div class='sidebar_info_bottom'>"+r+"</div></td></tr></table>";e(o).appendTo(t)}function l(){var t=I.Microsoft.Live.Messenger,n=I.MsgrUI,i=e(".sidebar_info");if(i.find("table").hide(),$WLXIM.isWaitingToReconnect()){var r=i.find("table.reconnect"),o=n._getLocString("messagingPaneReconnect").format($WLXIM.getReconnectingTime().min+":"+$WLXIM.getReconnectingTime().sec);r.find(".sidebar_info_top").text(o),r.show(),I.setTimeout(l,1e3)}else if($WLXIM.isLoading())i.find("table.signing").show();else if($WLXIM.user&&$WLXIM.user.get_status()==t.UserStatus.signedOut)i.find("table.resignin").show();else{if(!$WLXIM.user||$WLXIM.user.get_presence().get_status()!=t.PresenceStatus.offline||$WLXIM.user.get_status()!=t.UserStatus.signedIn)return u(),void 0;c()}d()}function c(){var t=e(".sidebar_info");d(),t.find("table").hide(),t.find("table.signout").show(),_t&&(_t.dispose(),_t=null,e("#chat_view_body").empty())}function u(){var t=e(".sidebar_info");return t.is(":hidden")?(t.hide(),void 0):(x.Animations.fadeOut(t).then(function(){t.hide()}),wt&&$WLXIM.startConversationWithContactId(wt,Qt,!0),void 0)}function d(){var t=e(".sidebar_info");t.is(":hidden")&&(t.show(),x.Animations.fadeIn(t).then(function(){}),$WLXIM.removeAllToasts())}function f(){$.when("$WLXIM.UserSignedIn",0,function(){uiQosApiStartTime=(new Date).getTime(),h(),Dt=!0,Et=!1,$WLXIM.isWac||e($WLXIM.user.get_conversations()).bind("getRecentConversationsCompleted",function(){var e=$WLXIM.getSidebarOpenCookieState();e&&e!=j&&(e!=U&&null!=$WLXIM.user.get_contacts().findByIdWithoutRoleCheck(e)?$WLXIM.startConversationWithContactId(e,Qt,!1):$WLXIM.showSidebar(!1))})})}function h(){var t=null,n=I.$pwc.settings.getImHistoryEnabled();n&&(t=g()),yt=new I.MsgrUI.LandingPageControl($WLXIM.user),e("#rec_conv_body").append(yt.render()),yt.activate(),Ut&&b(),p()}function p(){var t=I.MsgrUI,n=e("#chat_view_body");_t&&(n.empty(),_t.dispose()),bt?(_t=new t.ModernConversationControl(n[0],null,bt,$WLXIM.user),bt=null):wt&&(_t=new t.ModernConversationControl(n[0],wt,null,null))}function g(){var e=E.WebIM.mh;return"javascript:window.location='"+e+"'"}function m(e){return E.WebIM.imgBase+e}function v(e,t,n,i){var r=F.createElement(e);return i&&(r.innerHTML=i),n&&(r.id=n,r.className=n),t&&t.appendChild(r),r}function y(){var t='a[href][tabindex!="-1"]:visible, textarea[tabindex!="-1"]:visible:not([disabled])',n=e(".WebIMUpsell:visible, .RecentConversationsControl_ConnectedTo, .ModernConversationControlBottom","#sidebar > div:visible");Jt=e(t,n).last()}function _(){var t=$WLXIM;if(E.WebIM.f||t.init(),$.register("wlxim",0,!0),e(".App #BelowHeader").length>0)$WLXIM.setPaneToResize(e(".App #BelowHeader"));else{var n=e("#c_base");n.length>0&&$WLXIM.setPaneToResize(n)}0==e("#c_header").length?$WLXIM.setSidebarToFullScreen(!0):$WLXIM.setSidebarToFullScreen(!1)}function w(e,t,n){e&&(P.stopScenario(e,t,n),e.id&&A.log({eventType:e.id,resultCode:t?null:n},!t))}function b(){var e={ConversationCount:yt.get_visibleItemCount()};I.$BSI.reportEvent("WebIM.RecentConversationCount",e),A.logDetails("WebIM_RecentConversationCount",e)}function C(e,t,n){if(t!==Qt&&Xt.indexOf(e)<0){Xt.push(e);var i={WebIMLaunchPoint:t,ConversationType:n,isOverlayMode:$WLXIM.isSidebarOverlay()};I.$BSI.reportEvent("WebIM.ConversationStarted",i),A.logDetails("WebIM_ConversationStarted",i)}}function S(e){var t={WebIMCloseLocation:e};I.$BSI.reportEvent("WebIM.SidebarHidden",{WebIMCloseLocation:e}),A.logDetails("WebIM_SidebarHidden",t)}function k(t,n,i){var r=I.Microsoft.Live.Messenger,o={};o.TimeToLogin=Math.floor((new Date-Lt)/1e3),o.SignInSuccess=t,o.Culture=E.mkt,o.MessengerError=i||"-",o.WebImError=n||"-",o.EndpointId=t?$WLXIM.user.get_localEndpoint().get_id().toString():"-",o.WLContacts=0,o.SkypeContacts=0,o.ConnectContacts=0;try{if(o.IsSkypeLogin=r.Services.SkyJSHelper.skypeEnabled,o.IsSkypeLogin){var a=r.Services.SkyJSHelper.initErrorCode;o.SkyjsErrorCode=""==a?"-":a,o.SkypeAccountType=I.SkyJS.Outlook.isUserLinkStatusActive(),o.SkypeLoginTime=$WLXIM.user.get_identity().skypeLoginTime}for(var s=0;s<$WLXIM.user.get_contacts().get_count();s++)for(var l=$WLXIM.user.get_contacts().get_item(s).get_addresses(),c=0;c<l.get_count();c++){var u=l.get_item(c).get_type();switch(u){case r.IMAddressType.windowsLive:o.WLContacts++;break;case r.IMAddressType.skype:o.SkypeContacts++;break;case r.IMAddressType.connect:o.ConnectContacts++}}}catch(d){A.logError("WebIM_SkypeReportingError",d)}var f={TimeToLogin:0,SkypeLoginTime:0,IsSkypeLogin:!1,SignInSuccess:!1,SkyjsErrorCode:"-",SkypeAccountType:!1,Culture:"-",MessengerError:"-",WebImError:"-",EndpointId:"-",WLContacts:0,SkypeContacts:0,ConnectContacts:0},h=e.extend({},f,o);$BSI.reportEvent("WebIM.LoginTime",h),A.logDetails("WebIM_LoginTime",h)}var I=window,x=I.wLive,T=I.$B,L=I.$Network,P=I.$ScenarioQoS,D=I.$Cookie,E=I.$Config,$=I.$Do,A=x.People.Reporter,F=I.document,N=I._ge,M="DIV",B="rgba(0, 0, 0, 0.24)",R="webim/imagestripmessaging.png",H="webim/messaging_icon_1.png",O="common/spinner_grey_40_transparent.gif",U=0,j=-1,W="FB",Q="WL",V="SKYPE",q="SCD",G="WebIM",z="WebIM_CoreScriptLoad",K="WebIM_SkypeSendRequest",J="WebIM_SkypeDeclineRequest",X="WebIM_BlockRequest",Y="WebIM_UnblockRequest",Z="WebIM_CoreScriptLoad_Loader",et="WebIM_CoreScriptLoad_MessengerCore",tt="WebIM_CoreScriptLoad_MessengerStrings",nt="WebIM_CoreScriptLoad_SkyJS",it="WebIM_SkypeSendRequest_Call",rt="WebIM_SkypeDeclineRequest_Call",ot="WebIM_SkypeBlockRequest_Call",at="WebIM_SkypeUnblockRequest_Call",st="WebIM_MessengerBlockRequest_Call",lt="WebIM_MessengerUnblockRequest_Call",ct="ScriptLoadFailure",ut='<div><div class="wim_decline_block"><input tabindex="-1" title="{0}" aria-label="{0}" type="checkbox" value="Block"><label title="{0}">{0}</label></div><div><input tabindex="-1" title="{1}" aria-label="{1}" type="checkbox" value="ReportAbuse"><label title="{1}">{1}</label></div></div>',dt='<div class="wim_block_message">{0}</div><div class="wim_block_repabuse"><input tabindex="-1" title="{1}" aria-label="{1}" type="checkbox" value="ReportAbuse"><label title="{1}">{1}</label></div>',ft=1e5,ht=ft,pt=300,gt=20,mt=new Array(1);mt[W]="sn/PsaMedium/FBActive.png";var vt=new Array(1);vt[W]="Facebook";var yt,_t,wt,bt,Ct,St,kt,It,xt,Tt,Lt,Pt,Dt,Et,$t,At=!1,Ft=0,Nt=0,Mt=0,Bt={},Rt={},Ht={},Ot=!1,Ut=!1,jt=!1,Wt=50,Qt="resumedConversation",Vt=!1,qt=!1,Gt=!1,zt=0,Kt=null,Jt=null,Xt=[];n()}(window.originaljQuery||jQuery)}),define("wliveloaded",["webim"],function(){!function(){$Do.register("$WLiveLoaded")}()}),define("popover",["jquery-1.7.2","registernamespace"],function(){!function(e){registerNamespace("$UI"),window.$UI.Dialog=function(t,n,i,r,o,a){function s(){if(h){var e=h.style,t=$B.IE&&7==$B.V?p.offsetLeft/100:1;0==t&&(t=1),$Debug.trace("zoomAmount: ",t),$Debug.trace("scrollLeft: ",C.scrollLeft),$B.IE&&6==$B.V&&(e.width=C.scrollWidth-3+"px",e.pixelTop=Math.max(0,C.scrollTop/t)),e.pixelHeight=b.clientHeight/t,e.pixelWidth=b.clientWidth/t}}function l(e){var t;t=e.target==g?$UI.Dialog.findFocusableElement(T,m,!1):$UI.Dialog.findFocusableElement(T,g,!0),t&&setTimeout(function(){try{t.focus()}catch(e){}},0)}function c(){e(window).bind({"resize.ext":u,"scroll.ext":u})}function u(){e(window).unbind(".ext",u),k.recalc(!1),c()}function d(){if($B.IE&&$B.V<7){v=_.getElementsByTagName("select");for(var e=T.getElementsByTagName("select"),t=0;t<v.length;t++){for(var n=!1,i=0;i<e.length;i++)if(v[t]==e[i]){n=!0;break}n||(v[t].wlppHide=v[t].style.visibility,v[t].style.visibility="hidden")}}}var f=window;o&&(f=o);var h,p,g,m,v,y,_=f.document||f.ownerDocument,w=_.body,b=_.documentElement,C=$B.RE_WebKit?w:_.documentElement,S=w.className.indexOf("rtl")>-1,k=this,I=e(),x=e(),T=null,L=null,P=null,D=null;this.dock=new $UI.Dialog.Rect(0,0,0,0),n&&5>n&&(n=5),r=r?" "+r:"",this.dispose=function(){y=!0,P&&(e(window).unbind("resize",P),P=null),D&&(e(window).unbind("focus",D),D=null),I.remove(),I=e(),x.remove(),x=e(),v=null,h=null,p=null,g=null,m=null,e(window).unbind(".ext",u)},this.setContents=function(n){I.remove(),I=e(),T=n;var i=T.parentNode;(null==i||null==i.tagName)&&(w.appendChild(T),I=I.add(e(T)));var o={"aria-hidden":"true"},s=null;$B.RE_WebKit?s="input":(s="a",o.href="#"),g=_.createElement(s),m=_.createElement(s);var u=e(g).attr(o).css("position","absolute"),d=e(m).attr(o).css("position","absolute");if((void 0===a||a)&&(u.bind("focus",l),d.bind("focus",l)),I=I.add(u),I=I.add(d),e(T).prepend(u).append(d),$B.RE_WebKit){var f="-10000px";S?m.style.right=g.style.right=f:m.style.left=g.style.left=f}return T.style.position="absolute",T.className+=r,!t&&$B.IE&&$B.V<7&&(L=new $UI.FramePopup),c(),T},this.recalc=function(t){if(T){s();var r=e(T);if(!i){var o=$UI.Dialog.getLocation(T);if(!o||o.isEmpty()){var a={visibility:r.css("visibility")||"visible",display:r.css("display")||"auto"};r.css({visibility:"hidden",display:"block"}),o=$UI.Dialog.getLocation(T),r.css(a)}$Debug.trace("recalc",Object.toJSON(o)),k.dock||(k.dock=new $UI.Dialog.Rect(0,0,0,0));var l=b.clientWidth/2-o.width/2;if(S?(k.dock.x=Math.min(l,0-(o.width-b.clientWidth)-25),$B.RE_WebKit&&(k.dock.x+=C.scrollWidth-b.clientWidth)):k.dock.x=Math.max(l,25),t){var c=b.clientHeight-o.height-3;k.dock.y=C.scrollTop+Math.min(Math.max(c>200?c:(b.clientHeight-o.height)/2,0),100)}$Debug.trace("dockbefore",Object.toJSON(k.dock)),k.dock.height=o.height,k.dock.width=o.width}var u=null;null!==k.dock.y&&(u={top:k.dock.y}),null!==k.dock.x&&(u=u||{},u.left=k.dock.x),u&&r.css(u),L&&L.positionAt(k.dock,n?1e3:n-2)}},this.show=function(i,o,c){function u(){try{(i?i:$UI.Dialog.findFocusableElement(T)).focus()}catch(e){}}k.recalc(!0);var f=e(T);if(f.show(),n&&f.css("z-index",n),t){$Debug.trace("Creating Modal Dialog"),h=_.createElement("div"),d(),p=_.createElement("div");var g=e(p).addClass("UI_Dialog_ZoomTest"+r);D=function(e){return e.stopImmediatePropagation(),!1};var m=e(h).attr("id","UI_Dialog_BG").addClass("UI_Dialog_BG"+r).bind({click:D,mousedown:D,keydown:D,keypress:D,dblclick:D});(void 0===a||a)&&m.bind("focus",l),n&&m.css("z-index",n-1),w.appendChild(h),w.appendChild(p),P=function(){setTimeout(s,0)},e(window).bind({resize:P,focus:D}),x=x.add(m),x=x.add(g),s()}o||(c=c||e.when(),c.then(function(){setTimeout(u,10)}))},this.hide=function(){if(x.remove(),x=e(),$B.IE&&$B.V<7&&v){for(var t=0;t<v.length;t++)"undefined"!=typeof v[t].wlppHide&&(v[t].style.visibility=v[t].wlppHide);v=null}},this.minimize=function(){if(L&&L.minimize(),T.style.visibility="hidden",t){if(h.style.display="none",v)for(var e=0;e<v.length;e++)v[e].style.visibility=v[e].wlppHide;s()}s()},this.restore=function(){T.style.visibility="visible",L&&L.restore(),k.recalc(!0),t&&(h.style.display="block",d(),s())}},window.$UI.Dialog.Rect=function(e,t,n,i){return new function(){var r=this;this.x=e,this.y=t,this.width=n,this.height=i,this.isEmpty=function(){return r.width<=0||r.height<=0}}},window.$UI.Dialog.findFocusableElement=function(t,n,i){function r(t){var n=e(t),i=n.attr("tabindex");if("-1"===i)return!1;if(n.is(".CloseX")&&n.is(":visible")&&0===n.parents(":hidden").length)return!0;var r="|BUTTON|TEXTAREA|FIELDSET|IFRAME|SELECT|";return t.tagName&&!t.disabled&&(r.indexOf("|"+t.tagName+"|")>-1||"A"==t.tagName&&t.href&&-1==t.className.indexOf("CloseX")||"INPUT"==t.tagName&&"hidden"!=t.type.toLowerCase()&&(!$B.Firefox||"file"!=t.type.toLowerCase()))&&e(t).is(":visible")}function o(e){if(!e)return null;for(var t=i?e.nextSibling:e.previousSibling;t&&1!=t.nodeType;)t=i?t.nextSibling:t.previousSibling;return t?t:o(e.parentNode)}function a(t,n){var a=n;if(a&&(a==t||e.contains(t,a)))for(;null!=a;){if(r(a))return a;a=i&&a.firstChild?a.firstChild:!i&&a.lastChild?a.lastChild:o(a)}return null}n=n?o(n):t;var s=a(t,n);return!s&&n&&n!=t?a(t,t):s},window.$UI.Dialog.getLocation=function(e){if(!e)return new $UI.Dialog.Rect(0,0,0,0);for(var t=0,n=0,i=e;i;)t+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;return new $UI.Dialog.Rect(t,n,e.offsetWidth,e.offsetHeight)},window.$UI.Popover=function(){function t(){try{k.focus()}catch(e){}}function n(){var t=_.modal?$B.IE?e("body"):e(window):e(v);$B.IE?t.bind("keypress.showhide",o):t.bind("keydown.showhide",o),b=b.add(t)}function i(){var t=_.modal?$B.IE?e("body"):e(window):e(v);t.unbind(".showhide",o)}function r(t,n,i,r){e("<span />").text(" ").appendTo(e(p));var o=_ce("div");e(o).html('<button id="popover_btn_{0}" type="{1}" />'.format(t,i?"submit":"button"));var s=e(o.firstChild).toggleClass("Default",i).html("<nobr>"+n+"</nobr>").bind("click",function(e){a(t),e.stopPropagation()});w=w.add(e(s)),!i&&r&&(g=t),m[t]=s,e(s).appendTo(e(p))}function o(e){switch(e.which){case 27:a(g?g:"$cancel"),e.stopPropagation()}}function a(e){var t=!0;S&&(t=S(_,e)),t&&_.hide()}function s(){function t(t,n){if(t){var i=e(n);"string"==typeof t?i.html(t):i.html("").append(t)}}if(e(c).toggle(_.showHeader),e(d).toggle(_.showFooter),e(f).toggle(_.showCloseX).bind("click",function(){return a(g?g:"$cancel"),!1}),_.showCloseX){var n=GetString("live.shared.skydrive.pc.Sharing.Close");e(f).append(wLive.Core.ImageStrip.getImage("close",n,n))}_.bodyPadding||e(u).css("padding","0px"),t(_.header,h),t(_.body,u)}this.header=null,this.body=null,this.footerText=null,this.width=300,this.bodyPadding=!0,this.showHeader=!0,this.showFooter=!0,this.modal=!1,this.showCloseX=!1,this.zIndex=null,this.dispose=function(){l&&(l.dispose(),l=null)},this.addButton=function(e,t,n,i){C.push({name:e,value:t,isDefault:n,isCancel:i})},this.show=function(t,i,o,a){if(!y){if(S=t,k=i,!l){l=new $UI.Dialog(_.modal,_.zIndex),v=_ce("div");var w=e(v).hide().html('<a href="#"></a><div><h3></h3></div><div></div><div><nobr></nobr></div>');l.setContents(v),n(),w.addClass("UI_Popover");var b=v.childNodes;if(f=b[1],c=b[2],u=b[3],d=b[4],h=c.firstChild,p=d.firstChild,e(f).addClass("CloseX"),e(c).addClass("Header"),e(u).addClass("Body"),e(d).addClass("Footer"),null!=_.width){var I=_.width;w.css("width",parseInt(I,10)==I?I+"px":I)}g=null,m=new Array;for(var x=0;x<C.length;x++)r(C[x].name,C[x].value,C[x].isDefault,C[x].isCancel);0==C.length&&(_.showFooter=!1),s()}l.show(o?m[o]:null,a),y=!0}},this.hide=function(){if(y){k&&setTimeout(t,10);try{e(f).unbind("click"),b.unbind(".showhide",o),b=e(),w.remove(),w=e(),l.hide(),this.dispose()}catch(n){}y=!1,v=f=c=d=u=h=p=m=null}},this.enableButton=function(t){e(m[t]).attr("disabled",!1)},this.disableButton=function(t){e(m[t]).attr("disabled",!0)},this.recalc=function(){y&&l&&l.recalc(!1)},this.minimize=function(){l&&y&&(l.minimize(),i())},this.restore=function(){l&&y&&(l.restore(),n())};var l,c,u,d,f,h,p,g,m,v,y=!1,_=this,w=e(),b=e(),C=new Array,S=null,k=null}}(window.originaljQuery||jQuery)}),define("popover.msgbox",["popover"],function(){$UI.MsgBoxEx=function(e,t,n,i,r,o,a,s,l){var c="ok",u="cancel",d=new $UI.Popover,f=_ce("div"),h=function(e,t){var n=!0;return t==c?0==r({Popover:e})&&(n=!1):t==u&&o&&o(),n&&(d=null),n};if(a)for(var p=temp=a,g=0;10>g&&temp;g++){var m=temp.tagName&&temp.tagName.toLowerCase();if("a"==m||"button"==m||"input"==m){p=temp;break}if(temp=temp.parentElement,!temp){p=null;break}}return t&&(f.innerHTML='<div style="margin-bottom:10px">'+t+"</div>"),d.width=s?s:"416px",d.header=e,d.body=f,d.modal=!0,0!=n&&d.addButton(c,n,!0,!1),0!=i&&d.addButton(u,i,!1,!0),d.show(h,p,l?u:c),d},$UI.MsgBox=function(e,t,n,i,r,o){$UI.MsgBoxEx(e,t,n,i,o,null,r,null,!1)}}),define("jquery.simplecallbacks",["jquery-1.7.2"],function(){!function(e,t){"use strict";var n=t;t.simpleCallbacks=function(){var e=[];return{fire:function(){for(var t=e,n=0;n<t.length;n++)t[n].apply(this,arguments)},add:function(t){e=e.slice(0),e.push(t)},remove:function(t){e=n.grep(e,function(e){return e!==t})},empty:function(){e=[]}}}}(this,window.originaljQuery||window.jQuery)}),define("jquery.observable",["jquery.simplecallbacks"],function(){/*! jsObservable: http://github.com/BorisMoore/jsviews */
!function(e,t,n){"use strict";function i(e,i,r,s){e=D(e)?e[0]:e;var l=r?{eventType:i,namespace:r}:a(i),c=l.eventType,u=l.namespace,d=x[c],f=e[S.expando];if(f){var h=f.events;if(h){var p=h[c];if(p&&p.length){for(var g=p.length-1;g>=0;--g){var m=p[g];u!==n&&!o(u,m.namespaceParts)||s!==n&&s!==m.handler||(d.remove.call(e,m),p.splice(g,1))}p.length||(delete h[c],t.isEmptyObject(h)&&delete f.events)}}}}function r(e,t,r){i(e,t,n,r)}function o(e,t){if(!t)return!1;for(var n=e.split("."),i=!0,r=0;i&&r<n.length;r++)n[r]&&(i=i&&t[n[r]]);return i}function a(e){var t=e,n="",i=e.indexOf(".");return i>-1&&(t=e.substr(0,i),n=e.substr(i+1)),{eventType:t,namespace:n}}function s(e,t,i){l(e,t,n,n,i)}function l(e,t,n,i,r){e=D(e)?e[0]:e;for(var o=e[S.expando]=e[S.expando]||{},s=o.events=o.events||{},l=a(t),c=l.eventType,u=l.namespace,d=s[c]=s[c]||[],f={},h=u.split("."),p=0;p<h.length;p++)f[h[p]]=!0;d.push({namespace:u,namespaceParts:f,data:i,handler:r,type:c,origType:c,selector:n})}function c(e,t,n){e=D(e)?e[0]:e;var i=e[S.expando];if(i){var r=i.events;if(r){var o=r[t];if(o)for(var a=0;a<o.length;a++){var s=o[a];s.handler.call(e,{data:s.data,type:t,handleObj:s,target:e},n)}}}}function u(e){return D(e)?new f(e):new d(e)}function d(e){return this._data=e,this}function f(e){return this._data=e,this}function h(e){return D(e)?[e]:e}function p(e){if("number"!=typeof e)throw"Invalid index."}function g(e,t){e=D(e)?e:[e];var n,i,r=t,o=r,a=e.length,s=[];for(n=0;a>n;n++)i=e[n],B(i)?L.apply(s,[s.length,1].concat(g(i.call(t,t),t))):""+i===i?(o!==r&&s.push(r=o),s.push(i)):(t=o=i,o!==r&&s.push(r=o));return s}function m(e,t){var n,i;for(n in e){i=!0;break}i||delete N[t]}function v(e,t){if(!e.data||!e.data.off){var n=t.oldValue,i=e.data;e.type===F?i.cb.array(e,t):("*"===i.prop||i.prop===t.path)&&(typeof n===$&&C(h(n),i.path,i.cb),typeof(n=t.value)===$&&b(h(n),i.path,i.cb),i.cb(e,t))}}function y(e,t,n,i,r,o,a){return e._ob=a(e,n),function(){var s=e._ob,l=t.length;typeof s===$&&(_(s,i,r,o,!0),l&&C(h(s),t,i,a,n)),s=e._ob=a(e,n),typeof s===$&&(_(s,i,r,o),l&&b(h(s),t,i,a,n))}}function _(e,t,i,r,o){t&&t.array&&D(e)&&w(F+".observe.obs"+t._bnd,n,e,t,i,r,!0,o)}function w(e,n,r,o,a,s,c,u){var d,f,p,g=O(r),m=h(r);if(u)g&&i(m,e);else{if(d=g&&t._data(r))for(d=d&&d.events,d=d&&d[c?F:A],f=d&&d.length;f--;)if((p=d[f].data)&&p.cb===o){if(c)return;"*"===n&&p.prop!==n&&i(r,e+"."+p.prop)}l(m,e,null,c?{cb:o}:{path:n,prop:a,cb:o},v),s&&(s[t.data(r,"obId")||t.data(r,"obId",R++)]=r)}}function b(){var e,r,o,a,s,l,c,u,d,f,p,v,C,S,k,I,x,T=1,D=M,E=P.apply([],arguments),$=E.pop(),A=E[0],F=""+A!==A?E.shift():n,R=E.length;for(A=F,B($)?u=$:($===!0?c=$:$&&(A=$,T=0),$=E[R-1],(R&&$===n||B($))&&(u=E.pop(),R--)),B(E[R-1])&&(C=u,u=E.pop(),R--),D+=c?u?".obs"+u._bnd:"":".obs"+(d=u._bnd=u._bnd||H++),c&&0===R&&F&&i(F,M),c||(k=N[d]=N[d]||{}),I=0,e=0;R>e;e++){if(a=E[e],_(l,u,o,c),l=F,""+a===a){if(r=a.split("^"),r[1]&&(I=r[0].split(".").length,a=r.join("."),I=a.split(".").length-I),C&&(S=C(a,F))){R+=S.length-1,L.apply(E,[e--,1].concat(S));continue}r=a.split(".")}else T&&!B(a)&&(a._jsvOb&&(c||(a._cb=x=y(a,E.slice(e+1),A,u,o,k,C),a._rt=A,x._bnd=u._bnd),b(a._rt,E.slice(0,e),a._cb,C,c),a=a._ob),l=a),F=a,r=[F];for(;l&&"object"==typeof l&&(o=r.shift())!==n;){if(""+o===o){if(""===o)continue;if(r.length<I+1&&!l.nodeType){if(!c&&(v=O(l)&&t._data(l))){for(v=v.events,v=v&&v.propertyChange,f=v&&v.length;f--&&(p=v[f].data,!p||p.cb!==u||(p.prop!==o||p.path!==r.join("."))&&"*"!==p.prop););if(f>-1){l=l[o];continue}}if("*"===o){B(l)?(s=l.depends)&&b(s,u,c||A):w(D,o,l,u,o,k,n,c);break}!o||B(s=l[o])&&s.depends||w(D+"."+o,r.join("."),l,u,o,k,n,c)}o=o?l[o]:l}if(B(o)){(s=o.depends)&&b(l,g(s,l),u,C,c||h(A));break}l=o}}return _(l,u,o,c),d&&m(k,d),{cbId:d,bnd:k,leaf:l}}function C(){return[].push.call(arguments,!0),b.apply(this,arguments)}var S=t;if(!t)throw"requires jQuery or JsRender";if(!t.observable){var k,I,x=t.event.special,T=t.views?t.views.sub:{},L=[].splice,P=[].concat,D=function(e){return e instanceof Array},E=t.expando,$="object",A=T.propChng=T.propChng||"propertyChange",F=T.arrChng=T.arrChng||"arrayChange",N=T._cbBnds=T._cbBnds||{},M=A+".observe",B=function(e){return"function"==typeof e},R=1,H=1,O=t.hasData;t.observable=u,u.Object=d,u.Array=f,u.observe=b,u.unobserve=C,u.on=l,u.simpleOn=s,u.simpleOff=r,u.off=i,u.trigger=c,u.onObservableTrigger=t.simpleCallbacks(),d.prototype={_data:null,data:function(){return this._data},observe:function(e,t){return b(this._data,e,t)},unobserve:function(e,t){return C(this._data,e,t)},setProperty:function(e,t,i){var r,o,a,s=this,l=s._data;if(e=e||"",l)if(D(e))for(r=e.length;r--;)o=e[r],s.setProperty(o.name,o.value,i===n||i);else if(""+e!==e)for(r in e)s.setProperty(r,e[r],t);else if(e.indexOf(E)<0){for(a=e.split(".");l&&a.length>1;)l=l[a.shift()];s._setProperty(l,a.join("."),t,i)}return s},_setProperty:function(e,t,n,i){var r,o,a=t?e[t]:e;B(a)&&a.set&&(o=a,r=a.set===!0?a:a.set,a=a.call(e)),(a!==n||i&&a!=n)&&(!(a instanceof Date)||a>n||n>a)&&(r?(r.call(e,n),n=o.call(e)):e[t]=n,this._trigger(e,{path:t,value:n,oldValue:a}))},_trigger:function(e,n){t.observable.onObservableTrigger.fire(),c(e,A,n)}},f.prototype={_data:null,data:function(){return this._data},insert:function(e,t){return p(e),arguments.length>1&&(t=D(t)?t:[t],t.length&&this._insert(e,t)),this},_insert:function(e,t){I=this._data,k=I.length,L.apply(I,[e,0].concat(t)),this._trigger({change:"insert",index:e,items:t})},remove:function(e,t){if(p(e),t=t===n||null===t?1:t,t&&e>-1){var i=this._data.slice(e,e+t);t=i.length,t&&this._remove(e,t,i)}return this},_remove:function(e,t,n){I=this._data,k=I.length,I.splice(e,t),this._trigger({change:"remove",index:e,items:n})},move:function(e,t,i){if(p(e),p(t),i=i===n||null===i?1:i){var r=this._data.slice(e,e+i);this._move(e,t,i,r)}return this},_move:function(e,t,n,i){I=this._data,k=I.length,I.splice(e,n),I.splice.apply(I,[t,0].concat(i)),this._trigger({change:"move",oldIndex:e,index:t,items:i})},refresh:function(e){var t=this._data.slice(0);return this._refresh(t,e),this},_refresh:function(e,t){I=this._data,k=I.length,L.apply(I,[0,I.length].concat(t)),this._trigger({change:"refresh",oldItems:e})},_trigger:function(e){var n=I.length;t.observable.onObservableTrigger.fire(),c([I],F,e),n!==k&&c([I],A,{path:"length",value:n,oldValue:k})}},x[A]=x[F]={remove:function(e){if((e=e.data)&&(e.off=1,e=e.cb)){var n=e._bnd,i=N[n];i&&(delete i[t.data(this,"obId")],m(i,n))}}}}}(this,window.originaljQuery||window.jQuery||this.jsviews)}),define("jsrender",["jquery.observable"],function(){/*! JsRender v1.0pre: http://github.com/BorisMoore/jsrender */
!function(e,t,n){"use strict";function i(e,t){t&&t.onError&&t.onError(e)===!1||(this.name="JsRender Error",this.message=e||"JsRender error")}function r(e,t){var n;e=e||{};for(n in t)e[n]=t[n];return e}function o(e,t,n){return(!it.rTag||arguments.length)&&($=e?e.charAt(0):$,A=e?e.charAt(1):A,F=t?t.charAt(0):F,N=t?t.charAt(1):N,M=n||M,e="\\"+$+"(\\"+M+")?\\"+A,t="\\"+F+"\\"+N,P="(?:(?:(\\w+(?=[\\/\\s\\"+F+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+F+"]|\\"+F+"(?!\\"+N+"))*?)",it.rTag=P+")",P=new RegExp(e+P+"(\\/)?|(?:\\/(\\w+)))"+t,"g"),D=new RegExp("<.*>|([^\\\\]|^)[{}]|"+e+".*"+t)),[$,A,F,N,M]}function a(e,t){t||(t=e,e=n);var i,r,o,a,s=this,l=!t||"root"===t;if(e){if(a=s.type===t?s:n,!a)if(i=s.views,s._.useKey){for(r in i)if(a=i[r].get(e,t))break}else for(r=0,o=i.length;!a&&o>r;r++)a=i[r].get(e,t)}else if(l)for(;s.parent.parent;)a=s=s.parent;else for(;s&&!a;)a=s.type===t?s:n,s=s.parent;return a}function s(){var e=this.get("item");return e?e.index:n}function l(e){var t,i=this,r=(i.ctx||{})[e];return r=r===n?i.getRsc("helpers",e):r,r&&"function"==typeof r&&(t=function(){return r.apply(i,arguments)}),t||r}function c(e,t,i){var r,o,a,s=+i===i&&i,l=t.linkCtx;return s&&(i=(s=t.tmpl.bnds[s-1])(t.data,t,Z)),a=i.args[0],(e||s)&&(o=l&&l.tag||{_:{inline:!l},tagName:e+":",flow:!0,_is:"tag"},o._.bnd=s,l&&(l.tag=o,o.linkCtx=l,i.ctx=I(i.ctx,l.view.ctx)),o.tagCtx=i,i.view=t,o.ctx=i.ctx||{},delete i.ctx,t._.tag=o,e="true"!==e&&e,e&&((r=t.getRsc("converters",e))||_("Unknown converter: {{"+e+":"))&&(o.depends=r.depends,a=r.apply(o,i.args)),a=s&&t._.onRender?t._.onRender(a,t,s):a,t._.tag=n),a}function u(e,t){var i,r=this,o=Z[e];for(i=o&&o[t];i===n&&r;)o=r.tmpl[e],i=o&&o[t],r=r.parent;return i}function d(e,t,i,r){var o,a,s,l,c,u,d,f,h,p,g,m,v,w,b="",C=+r===r&&r,S=t.linkCtx||0,k=t.ctx,x=i||t.tmpl,T=t._;for("tag"===e._is&&(a=e,e=a.tagName),C&&(r=(m=x.bnds[C-1])(t.data,t,Z)),d=r.length,a=a||S.tag,u=0;d>u;u++)h=r[u],g=h.tmpl,g=h.content=g&&x.tmpls[g-1],i=h.props.tmpl,u||i&&a||(v=t.getRsc("tags",e)||_("Unknown tag: {{"+e+"}}")),i=i||(a?a._def:v).template||g,i=""+i===i?t.getRsc("templates",i)||et(i):i,h.tmpl=i,h.render=y,h.index=u,h.view=t,h.ctx=I(h.ctx,k),a||(v._ctr?(a=new v._ctr,w=!!a.init,a.attr=a.attr||v.attr||n):a={render:v.render},a._={inline:!S},S&&(S.attr=a.attr=S.attr||a.attr,S.tag=a,a.linkCtx=S),(a._.bnd=m||S)&&(a._.arrVws={}),a.tagName=e,a.parent=c=k&&k.tag,a._is="tag",a._def=v),T.tag=a,h.tag=a,a.tagCtxs=r,a.flow||(p=h.ctx=h.ctx||{},s=a.parents=p.parentTags=k&&I(p.parentTags,k.parentTags)||{},c&&(s[c.tagName]=c),p.tag=a),a.rendering={};for(u=0;d>u;u++)h=a.tagCtx=r[u],a.ctx=h.ctx,!u&&w&&(a.init(h,S,a.ctx),w=n),(o=a.render)&&(f=o.apply(a,h.args)),b+=f!==n?f:h.tmpl?h.render():"";return delete a.rendering,a.tagCtx=a.tagCtxs[0],a.ctx=a.tagCtx.ctx,a._.inline&&(l=a.attr)&&"html"!==l&&(b="text"===l?tt.html(b):""),b=C&&t._.onRender?t._.onRender(b,t,C):b}function f(e,t,i,r,o,c,d,f){var h,p,g,m="array"===t,v={key:0,useKey:m?0:1,id:""+z++,onRender:f,bnds:{}},y={data:r,tmpl:o,content:d,views:m?[]:{},parent:i,ctx:e,type:t,get:a,getIndex:s,getRsc:u,hlp:l,_:v,_is:"view"};return i&&(h=i.views,p=i._,p.useKey?(h[v.key="_"+p.useKey++]=y,g=p.tag,v.bnd=m&&(!g||!!g._.bnd&&g)):h.splice(v.key=y.index=c!==n?c:h.length,0,y),y.ctx=e||i.ctx),y}function h(e){var t,n,i,r,o;for(t in Y)if(r=Y[t],(o=r.compile)&&(n=e[t+"s"]))for(i in n)n[i]=o(i,n[i],e,t,r)}function p(e,t,n){var i,r;return"function"==typeof t?t={depends:t.depends,render:t}:((r=t.template)&&(t.template=""+r===r?et[r]||et(r):r),t.init!==!1&&(i=t._ctr=function(){},(i.prototype=t).constructor=i)),n&&(t._parentTmpl=n),t}function g(i,r,o,a,s,l){function c(n){if(""+n===n||n.nodeType>0){try{d=n.nodeType>0?n:!D.test(n)&&t&&t(e.document).find(n)[0]}catch(r){}return d&&(n=d.getAttribute(J),i=i||n,n=et[n],n||(i=i||"_"+G++,d.setAttribute(J,i),n=et[i]=g(i,d.innerHTML,o,a,s,l))),n}}var u,d;return r=r||"",u=c(r),l=l||(r.markup?r:{}),l.tmplName=i,o&&(l._parentTmpl=o),!u&&r.markup&&(u=c(r.markup))&&(!u.fn||u.debug===r.debug&&u.allowCode===r.allowCode||(u=u.markup)),u!==n?(i&&!o&&(X[i]=function(){return r.render.apply(r,arguments)}),u.fn||r.fn?u.fn&&(r=i&&i!==u.tmplName?I(l,u):u):(r=m(u,l),b(u,r)),h(l),r):void 0}function m(e,t){var n,i=rt.wrapMap||{},o=r({markup:e,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:y},t);return t.htmlTag||(n=Q.exec(e),o.htmlTag=n?n[1].toLowerCase():""),n=i[o.htmlTag],n&&n!==i.div&&(o.markup=T.trim(o.markup),o._elCnt=!0),o}function v(e,t){function i(o,a,s){var l,c,u,d;if(o&&""+o!==o&&!o.nodeType&&!o.markup){for(u in o)i(u,o[u],a);return Z}return a===n&&(a=o,o=n),o&&""+o!==o&&(s=a,a=o,o=n),d=s?s[r]=s[r]||{}:i,c=t.compile,(l=it.onBeforeStoreItem)&&(c=l(d,o,a,c)||c),o?null===a?delete d[o]:d[o]=c?a=c(o,a,s,e,t):a:a=c(n,a),a&&(a._is=e),(l=it.onStoreItem)&&l(d,o,a,c),a}var r=e+"s";Z[r]=i,Y[e]=t}function y(e,t,i,r,o,a){var s,l,c,u,d,h,p,g,m,v,y,w,b,C=this,S=!C.attr||"html"===C.attr,k="";if(r===!0&&(p=!0,r=0),C.tag?(g=C,C=C.tag,v=C._,w=C.tagName,b=g.tmpl,t=I(t,C.ctx),m=g.content,g.props.link===!1&&(t=t||{},t.link=!1),i=i||g.view,e=e===n?i:e):b=C.jquery&&(C[0]||_('Unknown template: "'+C.selector+'"'))||C,b&&(!i&&e&&"view"===e._is&&(i=e),i&&(m=m||i.content,a=a||i._.onRender,e===i&&(e=i.data,o=!0),t=I(t,i.ctx)),i&&i.data!==n||((t=t||{}).root=e),b.fn||(b=et[b]||et(b)),b)){if(a=(t&&t.link)!==!1&&S&&a,y=a,a===!0&&(y=n,a=i._.onRender),T.isArray(e)&&!o)for(u=p?i:r!==n&&i||f(t,"array",i,e,b,r,m,a),s=0,l=e.length;l>s;s++)c=e[s],d=f(t,"item",u,c,b,(r||0)+s,m,a),h=b.fn(c,d,Z),k+=u._.onRender?u._.onRender(h,d):h;else u=p?i:f(t,w||"data",i,e,b,r,m,a),v&&!C.flow&&(u.tag=C),k+=b.fn(e,u,Z);return y?y(k,u):k}return""}function _(e){throw new Z.sub.Error(e)}function w(e){_("Syntax error\n"+e)}function b(e,t,n,i){function r(t){t-=u,t&&f.push(e.substr(u,t).replace(H,"\\n"))}function o(t){t&&w('Unmatched or missing tag: "{{/'+t+'}}" in template:\n'+e)}function a(a,c,p,g,m,v,y,_,b,C,k,I){v&&(m=":",g="html"),C=C||n;var x,T,L=c&&[],P="",D="",E="",$=!C&&!m&&!y;p=p||m,r(I),u=I+a.length,_?l&&f.push(["*","\n"+b.replace(O,"$1")+"\n"]):p?("else"===p&&(W.test(b)&&w('for "{{else if expr}}" use "{{else expr}}"'),L=h[6],h[7]=e.substring(h[7],I),h=d.pop(),f=h[3],$=!0),b&&(b=b.replace(H," "),P=S(b,L,t).replace(j,function(e,t,n){return t?E+=n+",":D+=n+",",""})),D=D.slice(0,-1),P=P.slice(0,-1),x=D&&D.indexOf("noerror:true")+1&&D||"",s=[p,g||!!i||"",P,$&&[],'params:"'+b+'",props:{'+D+"}"+(E?",ctx:{"+E.slice(0,-1)+"}":""),x,L||0],f.push(s),$&&(d.push(h),h=s,h[7]=u)):k&&(T=h[0],o(k!==T&&"else"!==T&&k),h[7]=e.substring(h[7],I),h=d.pop()),o(!h&&k),f=h[3]}var s,l=t&&t.allowCode,c=[],u=0,d=[],f=c,h=[,,,c];return e=e.replace(U,"\\$1"),o(d[0]&&d[0][3].pop()[0]),e.replace(P,a),r(e.length),(u=c[c.length-1])&&o(""+u!==u&&+u[7]===u[7]&&u[0]),C(c,n?e:t,n)}function C(e,n,i){var r,o,a,s,l,c,u,d,f,h,p,g,v,y,_,b,S,k,I,x,T,L,P,D,E,$,A,F=0,N="",M="",B={},R=e.length;for(""+n===n?(b=i?'data-link="'+n.replace(H," ").slice(1,-1)+'"':n,n=0):(b=n.tmplName||"unnamed",(I=n.allowCode)&&(B.allowCode=!0),n.debug&&(B.debug=!0),g=n.bnds,_=n.tmpls),r=0;R>r;r++)if(o=e[r],""+o===o)N+='\nret+="'+o+'";';else if(a=o[0],"*"===a)N+=""+o[1];else{if(s=o[1],l=o[2],x=o[3],c=o[4],M=o[5],T=o[7],(D="else"===a)||(F=0,g&&(v=o[6])&&(F=g.push(v))),(E=":"===a)?(s&&(a="html"===s?">":s+a),M&&($="prm"+r,M="try{var "+$+"=["+l+"][0];}catch(e){"+$+'="";}\n',l=$)):(x&&(S=m(T,B),S.tmplName=b+"/"+a,C(x,S),_.push(S)),D||(k=a,P=N,N="",y=r),L=e[r+1],L=L&&"else"===L[0]),c+=",args:["+l+"]}",E&&v||s&&">"!==a){if(A=new Function("data,view,j,u"," // "+b+" "+F+" "+a+"\n"+M+"return {"+c+";"),A.paths=v,A._ctxs=a,i)return A;p=1}if(N+=E?"\n"+(v?"":M)+(i?"return ":"ret+=")+(p?(p=0,h=!0,'c("'+s+'",view,'+(v?(g[F-1]=A,F):"{"+c)+");"):">"===a?(d=!0,"h("+l+");"):(f=!0,"(v="+l+")!="+(i?"=":"")+'u?v:"";')):(u=!0,"{tmpl:"+(x?_.length:"0")+","+c+","),k&&!L){if(N="["+N.slice(0,-1)+"]",(i||v)&&(N=new Function("data,view,j,u"," // "+b+" "+F+" "+k+"\nreturn "+N+";"),v&&((g[F-1]=N).paths=v),N._ctxs=a,i))return N;N=P+'\nret+=t("'+k+'",view,this,'+(F||N)+");",v=0,k=0}}N="// "+b+"\nvar j=j||"+(t?"jQuery.":"js")+"views"+(f?",v":"")+(u?",t=j._tag":"")+(h?",c=j._cnvt":"")+(d?",h=j.converters.html":"")+(i?";\n":',ret="";\n')+(rt.tryCatch?"try{\n":"")+(B.debug?"debugger;":"")+N+(i?"\n":"\nreturn ret;\n")+(rt.tryCatch?"\n}catch(e){return j._err(e);}":"");try{N=new Function("data,view,j,u",N)}catch(O){w("Compiled template code:\n\n"+N,O)}return n&&(n.fn=N),N}function S(e,t,n){function i(i,f,h,p,g,m,v,y,_,C,k,I,x,T,L,P,D,E,M){function R(e,n,i,r,a,s,l){if(n&&(t&&!o&&t.push(p),"."!==n)){var c=(i?'view.hlp("'+i+'")':r?"view":"data")+(l?(a?"."+a:i?"":r?"":"."+n)+(s||""):(l=i?"":r?a||"":n,""));return c+=l?"."+l:"","view.data"===c.slice(0,9)?c.slice(5):c}return e}var H;return g=g||"",h=h||f||k,p=p||y,_=_||P||"",m?(w(e),void 0):(t&&L&&(H=l[c],M.length-2>E-H&&(H=M.slice(H,E+1),L=A+":"+H+F,L=a[L]=a[L]||b($+L+N,n,!0),L.paths||S(H,L.paths=[],n),t.push({_jsvOb:L}))),d?(d=!I,d?i:'"'):u?(u=!x,u?i:'"'):(h?(c++,l[c]=E++,h):"")+(D?c?"":r?(r=o=!1,"\b"):",":v?(c&&w(e),r=p,o="~"===p.charAt(0),"\b"+p+":"):p?p.split("^").join(".").replace(B,R)+(_?(s[++c]=!0,"."!==p.charAt(0)&&(l[c]=E),_):g):g?g:T?(s[c--]=!1,T+(_?(s[++c]=!0,_):"")):C?(s[c]||w(e),","):f?"":(d=I,u=x,'"')))}var r,o,a=n.links,s={},l={0:-1},c=0,u=!1,d=!1;return(e+" ").replace(R,i)}function k(){}function I(e,t){var n;return t&&(k.prototype=t),n=e&&e!==t?t?r(new k,e):e:t&&new k}function x(e){return K[e]||(K[e]="&#"+e.charCodeAt(0)+";")}if(!(t&&t.views||e.jsviews)){var T,L,P,D,E="v1.0pre",$="{",A="{",F="}",N="}",M="^",B=/^(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,R=/(\()(?=\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^)|[)\]])([([]?))|(\s+)/g,H=/\s*\n/g,O=/\\(['"])/g,U=/\\?(['"\\])/g,j=/\x08(~)?([^\x08]+)\x08/g,W=/^if\s/,Q=/<(\w+)[>\s]/,V=/[\x00`><"'&]/g,q=V,G=0,z=0,K={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},J="data-jsv-tmpl",X=([].slice,{}),Y={template:{compile:g},tag:{compile:p},helper:{},converter:{}},Z={jsviews:E,render:X,settings:{delimiters:o,debugMode:!0,tryCatch:!0},sub:{View:f,Error:i,tmplFn:b,parse:S,extend:r,error:_,syntaxError:w},_cnvt:c,_tag:d,_err:function(e){return rt.debugMode?"Error: "+(e.message||e)+". ":""}};(i.prototype=new Error).constructor=i,s.depends=function(){return[this.get("item"),"index"]};for(L in Y)v(L,Y[L]);var et=Z.templates,tt=Z.converters,nt=(Z.helpers,Z.tags),it=Z.sub,rt=Z.settings;t?(T=t,T.fn.render=y):(T=e.jsviews={},T.isArray=Array&&Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}),T.render=X,T.views=Z,T.templates=et=Z.templates,nt({"else":function(){},"if":{render:function(e){var t=this,n=t.rendering.done||!e&&(arguments.length||!t.tagCtx.index)?"":(t.rendering.done=!0,t.selected=t.tagCtx.index,t.tagCtx.render());return n},onUpdate:function(e,t,n){var i,r,o;for(i=0;(r=this.tagCtxs[i])&&r.args.length;i++)if(r=r.args[0],o=!r!=!n[i].args[0],r||o)return o;return!1},flow:!0},"for":{render:function(e){var t=this,i=t.tagCtx,r=!arguments.length,o="",a=r||0;return t.rendering.done||(r?o=n:e!==n&&(o+=i.render(e),a+=T.isArray(e)?e.length:1),(t.rendering.done=a)&&(t.selected=i.index)),o},onUpdate:function(){},onArrayChange:function(e,t){var n,i=this,r=t.change;if(this.tagCtxs[1]&&("insert"===r&&e.target.length===t.items.length||"remove"===r&&!e.target.length||"refresh"===r&&!t.oldItems.length!=!e.target.length))this.refresh();else for(n in i._.arrVws)n=i._.arrVws[n],n.data===e.target&&n._.onArrayChange.apply(n,arguments);e.done=!0},flow:!0},include:{flow:!0},"*":{render:function(e){return e},flow:!0}}),tt({html:function(e){return e!=n?String(e).replace(q,x):""},attr:function(e){return e!=n?String(e).replace(V,x):null===e?null:""},url:function(e){return e!=n?encodeURI(String(e)):null===e?null:""}}),o()}}(this,window.originaljQuery||window.jQuery)}),define("jquery.views",["jsrender"],function(){/*! JsViews v1.0pre: http://github.com/BorisMoore/jsviews */
!function(e,t,n){"use strict";function i(e){var i,r,o,a,s,c,u,d,f,h,p,g,m,v,y,_=e.target,w=_._jsvBnd;if(w)for(g=w.slice(1).split("&"),m=g.length;m--;)(p=Dt[g[m]])&&(a=p.linkCtx,h=a.view,(w=p.to)&&(f=t(_),v=h.hlp(lt),y=h.hlp(ct),o=l(_),i=gt[o],s=Z(o)?o(_):i?f[i]():f.attr(o),v&&(r=v.call(h,e)===!1)||s===n||(u=w[1],w=w[0],d=w[0],d=d._jsvOb?d._ob:d,w=w[2]||w[1],Z(u)?c=u:(c=h.tmpl.converters,c=c&&c[u]||z.converters[u]),c&&(s=c.call(a.tag,s)),s!==n&&d&&(tt(d).setProperty(w,s),y&&y.call(a,e))),r&&e.stopImmediatePropagation()))}function r(e,i,r){var o,s,c,u,f,h,p,g,m,v,y=this,_=y.data,w=y.elem,b=y.cvt,C="attr",S=w.parentNode,k=S,I=t(w),x=y.view,L=x.hlp(lt);if(!(!S||L&&i&&L.call(y,e,i)===!1||i&&"*"!==e.data.prop&&e.data.prop!==i.path)){if(m=x.linkCtx,x.linkCtx=y,i&&(y.eventArgs=i),!e||i||y._initVal){if(delete y._initVal,u=r.call(x.tmpl,_,x,z),o=y.attr||l(w,!0,b!==n),h=y.tag){if(i&&h.onUpdate&&h.onUpdate(e,i,u)===!1||"none"===o)return d(y,_,w,r),x.linkCtx=m,void 0;u=":"===h.tagName.slice(-1)?z._cnvt(h.tagName.slice(0,-1),x,u):z._tag(h.tagName,x,x.tmpl,u)}else r._ctxs&&(b=""===b?"true":b,u=b?z._cnvt(b,x,u):z._tag(r._ctxs,x,x.tmpl,u),h=x._.tag,o=y.attr||o);if(h&&(h.parentElem=y.expr||h._elCnt?w:w.parentNode,p=h._prv,g=h._nxt,h.refresh=T),Z(u)&&_t(y.expr+": missing parens"),"visible"===o&&(o="css-display",u=u?a(w):"none"),f=0===o.lastIndexOf("css-",0)&&o.substr(4))(c=t.style(w,f)!==u)&&t.style(w,f,u);else if("link"!==o){if("value"===o)"checkbox"===w.type&&(u=u&&"false"!==u,C="prop",o="checked");else if("radio"===o){if(w.value!==""+u)return d(y,_,w,r),x.linkCtx=m,void 0;u=!0,C="prop",o="checked"}else("selected"===o||"disabled"===o||"multiple"===o||"readlonly"===o)&&(u=u&&"false"!==u?o:null);if(s=gt[o]){if(c=h||I[s]()!==u)if("html"===o)if(h){if(v=h._.inline,h.refresh(u),!v&&h._.inline)return x.linkCtx=m,void 0}else I.empty(),k=w,x.link(_,k,p,g,u,h&&{tag:h._tgId});else"text"!==o||w.children[0]?I[s](u):w.textContent!==n?w.textContent=u:w.innerText=null===u?"":u}else(c=I[C](o)!=u)&&(null==u?I["attr"===C?"removeAttr":"removeProp"](o):I[C](o,u))}i&&c&&(L=x.hlp(ct))&&L.call(y,e,i)}d(y,_,w,r),x.linkCtx=m}}function o(e,t){var n=this,i=n.hlp(lt),r=n.hlp(ct);if(!i||i.call(e,t)!==!1){if(t){var o=t.change,a=t.index,s=t.items;switch(o){case"insert":n.addViews(a,s);break;case"remove":n.removeViews(a,s.length);break;case"move":n.refresh();break;case"refresh":n.refresh()}}r&&r.call(this,e,t)}}function a(t){var n,i,r=e.getComputedStyle,o=(t.currentStyle||r.call(e,t,"")).display;return"none"!==o||(o=Lt[i=t.nodeName])||(n=G.createElement(i),G.body.appendChild(n),o=(r?r.call(e,n,""):n.currentStyle).display,Lt[i]=o,G.body.removeChild(n)),o}function s(e){var i,r,a=e.data,s=e._.bnd;!e._.useKey&&s&&((r=e._.bndArr)&&(t.observable.off([r[1]],at,n,r[0]),e._.bndArr=n),s===!!s||s.linkCtx?a&&(i=function(t){t.data&&t.data.off||o.apply(e,arguments)},t.observable.on([a],at,null,null,i),e._.bndArr=[i,a]):a?s._.arrVws[e._.id]=e:delete s._.arrVws[e._.id])}function l(e,t,n){var i=e.nodeName.toLowerCase(),r=J.merge[i];return r?t?"input"===i&&"radio"===e.type?"radio":r.to.toAttr:r.from.fromAttr:t?n?"text":"html":""}function c(e,i,r,o,a,s,l){var c,u,d,f,h,p=e.parentElem,g=e._prv,m=e._nxt,v=e._elCnt;if(g&&g.parentNode!==p&&_t("Missing parentNode"),l){f=e.nodes(),v&&g&&g!==m&&N(g,m,p,e._.id,"_",!0),e.removeViews(n,n,!0),u=m,v&&(g=g?g.previousSibling:m?m.previousSibling:p.lastChild),t(f).remove();for(h in e._.bnds)D(h)}else{if(i){if(d=o[i-1],!d)return!1;g=d._nxt}v?(u=g,g=u?u.previousSibling:p.lastChild):u=g.nextSibling}c=r.render(a,s,e,l||i,e._.useKey&&l,!0),e.link(a,p,g,u,c,d)}function u(e,t,i){var r,o,a;return i?(a="^`",o=t._.tag||{_:{inline:!0,bnd:i},tagCtx:{view:t},flow:!0},r=o._tgId,o.refresh=T,r||(Dt[r=$t++]=o,o._tgId=""+r)):(a="_`",Pt[r=t._.id]=t),"#"+r+a+(e===n?"":e)+"/"+r+a}function d(e,i,r){var o,a,s,l,c,u,d=[],f=e._bndId||""+$t++,h=e._hdlr;if(delete e._bndId,(o=e.tag)&&(d=o.depends||d,d=Z(d)?o.depends(o):d,s=o.onChange),s=s||e._cvtBk,(!e._depends||""+e._depends!=""+d)&&(e._depends&&nt(i,e._depends,h,!0),a=nt(t.isArray(i)?[i]:i,l=e.fn.paths||e.fn,d,h,e._ctxCb),a.elem=r,a.linkCtx=e,a._tgId=f,r._jsvBnd=r._jsvBnd||"",r._jsvBnd+="&"+f,e._depends=d,e.view._.bnds[f]=f,Dt[f]=a,s!==n)){for(u=l.length;""+(c=l[--u])!==c;);c=l[u]=c.split("^").join("."),a.to="."===c.charAt(0)?[[l[u-1],c.slice(1)],s]:[e._ctxCb(l[0])||[i,l[0]],s]}}function f(e,t,n,i,r,o){return h(this,e,t,n,i,r,o)}function h(e,r,o,a,s,l,c,d){if(e&&r){r=r.jquery?r:t(r),R||(R=G.body,t(R).on(st,i));for(var f,h,p,m,v,y,_,b=u,C=a&&"replace"===a.target,S=r.length;S--;)if(_=r[S],"string"==typeof e)g(e,_,H(_),o,a);else{if(s=s||H(_),e.markup!==n)s.link===!1&&(a=a||{},a.link=b=!1),C&&(y=_.parentNode),p=e.render(o,a,s,n,n,b),y?(l=_.previousSibling,c=_.nextSibling,t.cleanData([_],!0),y.removeChild(_),_=y):(l=c=n,t(_).empty());else if(e!==!0)break;if(_._dfr&&!c){for(m=w(_._dfr,!0,Nt),f=0,h=m.length;h>f;f++)v=m[f],(v=Pt[v.id])&&v.data!==n&&v.parent.removeViews(v._.key,n,!0);_._dfr=""}s.link(o,_,l,c,p,d)}}return r}function p(e,i,r,a,l,c){function d(e,t,n,i,r,o,a,s,c,u,d,f){var h="";return y=s||c||"",i=i||n||u||f,i&&(q&&(n||f)&&!Tt[tt]&&wt("'<"+tt+"... />' in:\n"+l),lt=st,tt=Bt.shift(),st=kt[tt],lt&&(Nt+=ht,ht="",st?Nt+="-":(h=(u||"")+ft+"@"+Nt+dt+(d||""),Nt=Ht.shift()))),st?(o?ht+=o:t=u||f||"",y&&(t+=y,ht&&(t+=" "+it+'="'+ht+'"',ht=""))):t=o?t+h+r+ft+o+dt+a+y:h||e,y&&(Bt.unshift(tt),tt=y.slice(1),Bt[0]===It[tt]&&_t('"'+tt+'" has incorrect parent tag'),(st=kt[tt])&&!lt&&(Ht.unshift(Nt),Nt=""),lt=st,Nt&&st&&(Nt+="+")),t}function f(e,t){var r,a,l,c,d,f,h,p=[];if(e){for(L=e.length,"@"===e.tokens.charAt(0)&&(t=D.previousSibling,D.parentNode.removeChild(D),D=null),L=e.length;L--;){if($=e[L],l=$.ch,r=$.path)for(T=r.length-1;a=r.charAt(T--);)"+"===a?"-"===r.charAt(T)?(T--,t=t.previousSibling):t=t.parentNode:t=t.lastChild;"^"===l?(y=Dt[d=$.id])&&(h=t&&(!D||D.parentNode!==t),(!D||h)&&(y.parentElem=t),$.elCnt&&h&&($.open?t&&(t._dfr="#"+d+l+(t._dfr||"")):t._dfr="/"+d+l+(t._dfr||"")),p.push([h?null:D,$])):(E=Pt[d=$.id])&&(E.link||(E.parentElem=t||D&&D.parentNode||i,X(E,B),E._.onRender=u,E._.onArrayChange=o,s(E)),c=E.parentElem,$.open?(E._elCnt=$.elCnt,t?t._dfr="#"+d+l+(t._dfr||""):(E._prv||(c._dfr=v(c._dfr,"#"+d+l)),E._prv=D)):(!t||D&&D.parentNode===t?D&&(E._nxt||(c._dfr=v(c._dfr,"/"+d+l)),E._nxt=D):(t._dfr="/"+d+l+(t._dfr||""),E._nxt=n),m=E.linkCtx,(f=Ot||E.ctx&&E.ctx.onAfterCreate)&&f.call(m,E)))}for(L=p.length;L--;)Mt.push(p[L])}return!e||e.elCnt}function h(e){var t,n;if(L=e&&e.length)for(T=0;L>T;T++)if($=e[T],V.id)V.id=V.id!==$.id&&V.id;else if(n=y=Dt[$.id].linkCtx.tag,!y.flow){if(!j){for(t=1;n=n.parent;)t++;Q=Q||t}!j&&t!==Q||W&&y.tagName!==W||U.push(y)}}function p(){if(vt){if("resolved"===vt.state())return;{Et.shift()}}for(P=St?i.querySelectorAll(pt):t(pt,i).get(),S=P.length,r&&(F=St?r.querySelectorAll(pt):t(pt,r).get(),r=F.length?F[F.length-1]:r),Q=0,_=0;S>_;_++)if(D=P[_],r&&!mt)mt=D===r;else{if(a&&D===a)break;D.parentNode&&Ut(w(D,n,U&&Rt))&&D.getAttribute(rt)&&Mt.push([D])}if(b(r,st),b(a,st),V)return vt&&vt.resolve(),void 0;for(st&&Nt+ht&&(D=a,Nt&&(a?f(w(Nt+"+",!0),a):f(w(Nt,!0),i)),f(w(ht,!0),i),a&&(at=a.getAttribute(it),(S=at.indexOf(gt)+1)&&(at=at.slice(S+gt.length-1)),a.setAttribute(it,ht+at))),S=Mt.length,_=0;S>_;_++)D=Mt[_],A=D[1],D=D[0],A?(y=Dt[A.id],y=y.linkCtx?y.linkCtx.tag:y,A.open?(D&&(y.parentElem=D.parentNode,y._prv=D),y._elCnt=A.elCnt,!y||y.onBeforeLink&&y.onBeforeLink()===!1||y._.bound||(y._.bound=!0,E=y.tagCtx.view,g(n,y._prv,E,E.data||e,A.id)),y._.linking=!0):(y._nxt=D,y._.linking&&(E=y.tagCtx.view,y.contents=k,y.nodes=I,y.childTags=x,delete y._.linking,y&&y.onAfterLink&&y.onAfterLink(),y._.bound||(y._.bound=!0,g(n,y._prv,E,E.data||e,A.id))))):(E=H(D),g(D.getAttribute(rt),D,E,E.data||e));vt&&(vt.resolve(),K.onAfterLazyLink.fire(Et.length))}var m,y,_,S,T,L,P,D,E,$,A,F,N,M,R,O,U,j,W,Q,V,z,Y,Z,et,tt,nt,ot,at,st,lt,ct,ht,gt,mt,vt,yt,Lt=J.noDomLevel0,$t=this,At=$t._.id+"_",Nt="",Mt=[],Bt=[],Ht=[],Ot=$t.hlp(ut),Ut=f;if(c&&(vt=c.lazyLink&&t.Deferred(),c.tmpl?M="/"+c._.id+"_":(V=c.get,c.tag&&(At=c.tag+"^",c=!0)),c=c===!0),V&&(Ut=h,U=V.tags,j=V.deep,W=V.name),i=i?"string"==typeof i?t(i)[0]:i.jquery?i[0]:i:$t.parentElem||G.body,tt=i.tagName.toLowerCase(),st=!!kt[tt],r=r&&C(r,st),a=a&&C(a,st)||null,l!==n){if(ot=G.createElement("div"),nt=ot,gt=ht="",ct="http://www.w3.org/2000/svg"===i.namespaceURI?"svg":(et=bt.exec(l))&&et[1]||"",Lt&&et&&et[2]&&_t("Unsupported: "+et[2]),st){for(O=a;O&&!(R=w(O));)O=O.nextSibling;(at=R?R.tokens:i._dfr)&&(N=M||"",(c||!M)&&(N+="#"+At),T=at.indexOf(N),T+1&&(T+=N.length,gt=ht=at.slice(0,T),at=at.slice(T),R?O.setAttribute(it,at):i._dfr=at))}for(l=(""+l).replace(Ft,d),Ct.appendChild(ot),ct=xt[ct]||xt.div,z=ct[0],nt.innerHTML=ct[1]+l+ct[2];z--;)nt=nt.lastChild;for(Ct.removeChild(ot),Y=G.createDocumentFragment();Z=nt.firstChild;)Y.appendChild(Z);K.onBeforeInsert.fire(Y),i.insertBefore(Y,a)}return vt?(yt=setTimeout(p,0),Et.push({id:yt,fn:p}),K.onBeforeLazyLink.fire()):p(),vt&&vt.promise()}function g(e,t,i,r,o){var a,s,l,c,u,d,f,h,p,g,v;if(o)g=Dt[o],g=g.linkCtx?g.linkCtx.tag:g,p=g.linkCtx||{data:r,elem:g._elCnt?g.parentElem:t,view:i,attr:"html",fn:g._.bnd,tag:g,_bndId:o},m(p,p.fn);else if(e&&t)for(a=i.tmpl,e=S(e,t),O.lastIndex=0;s=O.exec(e);)v=O.lastIndex,l=o?"html":s[1],f=s[3],u=s[10],c=n,p={data:r,elem:g&&g._elCnt?g.parentElem:t,view:i,attr:l,_initVal:!s[2]},s[6]&&(!l&&(c=/:([\w$]*)$/.exec(u))&&(c=c[1],c!==n&&(d=-c.length-1,f=f.slice(0,d-1)+W,u=u.slice(0,d))),null===c&&(c=n),p.cvt=s[5]||""),p.expr=l+f,h=a.links[f],h||(a.links[f]=h=K.tmplFn(U+f+Q,a,!0,c),K.parse(u,h.paths=[],a)),p.fn=h,l||c===n||(p._cvtBk=c),m(p,h),O.lastIndex=v}function m(e,t){function n(n,i){r.call(e,n,i,t)}e._ctxCb=A(e.view),e._hdlr=n,e.tag&&e.tag.onArrayChange&&(n.array=function(t,n){e.tag.onArrayChange(t,n)}),n(!0)}function v(e,t){var n;return e?(n=e.indexOf(t),n+1?e.slice(0,n)+e.slice(n+t.length):e):""}function y(e){return e&&("string"==typeof e?e:"SCRIPT"===e.tagName?e.type.slice(3):1===e.nodeType&&e.getAttribute(it)||"")}function _(e,t,n,i,r,o){Ut.push({elCnt:Ot,id:i,ch:r,open:t,close:n,path:o,token:e})}function w(e,t,i){var r;return Ot=n,Ut=[],(r=t?e:y(e))?(Ut.elCnt=!e.type,Ot="@"===r.charAt(0)||Ut.elCnt,Ut.tokens=r,r.replace(i||Ht,_),Ut):void 0}function b(e,t){e&&("jsv"===e.type?e.parentNode.removeChild(e):t&&""===e.getAttribute(rt)&&e.removeAttribute(rt))}function C(e,t){for(var n=e;t&&n&&1!==n.nodeType;)n=n.previousSibling;return n&&(1!==n.nodeType?(n=G.createElement("SCRIPT"),n.type="jsv",e.parentNode.insertBefore(n,e)):y(n)||n.getAttribute(rt)||n.setAttribute(rt,"")),n}function S(e,n){return e=t.trim(e),e.slice(-1)!==W?e=j+":"+e+(l(n)?":":"")+W:e}function k(e,n){var i,r=t(this.nodes());return r[0]&&(i=e?r.filter(e):r,r=n&&e?i.add(r.find(e)):i),r}function I(e,t,n){var i,r=this,o=r._elCnt,a=!t&&o,s=[];for(t=t||r._prv,n=n||r._nxt,i=a?t===r._nxt?r.parentElem.lastSibling:t:r._.inline===!1?t||r.linkCtx.elem.firstChild:t&&t.nextSibling;i&&(!n||i!==n);)(e||o||!y(i))&&s.push(i),i=i.nextSibling;return s}function x(e,t){e!==!!e&&(t=e,e=n);var i=this,r=i.link?i:i.tagCtx.view,o=i._prv,a=i._elCnt,s=[];return o&&r.link(n,i.parentElem,a?o.previousSibling:o,i._nxt,n,{get:{tags:s,deep:e,name:t,id:a&&i._tgId}}),s}function T(e){var i,r,o,a=this,s=a.parentElem,l=a.tagCtx.view,c=a._prv,d=a._nxt,f=a._elCnt,h=a._.inline,p=a.tagCtx.props;return a.disposed&&_t("Removed tag"),e===n&&(e=a._.bnd.call(l.tmpl,l.data,l,z),h&&(e=z._tag(a,l,l.tmpl,e))),(a.flow||a.render||a.template)&&(h?(r=a.nodes(!0),f&&(c&&c!==d&&N(c,d,s,a._tgId,"^",!0),c=c?c.previousSibling:d?d.previousSibling:s.lastChild),t(r).remove()):(!a.flow&&p.inline&&(l._.tag=a,e=u(e,l,!0),l._.tag=n,i=a._.inline=!0),t(s).empty())),!i&&a.onBeforeLink&&a.onBeforeLink(),o=l.link(l.data,s,c,d,e,a&&{tag:a._tgId,lazyLink:p.lazyLink}),!i&&a.onAfterLink&&(o?o.then(function(){a.onAfterLink()}):a.onAfterLink()),o||a}function L(){for(var e;e=Et[0];)clearTimeout(e.id),e.fn()}function P(e){var t,i,r,o,a,s,l,c=[],u=e.length,d=u;for(L();d--;)c.push(e[d]);for(d=u;d--;)if(o=c[d],o.parentNode){if(l=o._jsvBnd)for(l=l.slice(1).split("&"),o._jsvBnd="",i=l.length;i--;)D(l[i],!0);var f=o&&("string"==typeof o?o:"SCRIPT"===o.tagName?o.type.slice(3):1===o.nodeType&&o.getAttribute(it)||"");if(a=w(f+(o._dfr||""),!0,Mt))for(t=0,r=a.length;r>t;t++)s=a[t],"_"===s.ch?(s=Pt[s.id])&&s.data!==n&&s.parent.removeViews(s._.key,n,!0):D(s.id,!0)}}function D(e,n){var i,r,o,a,s,l=Dt[e];if(l){for(i in l.bnd)a=l.bnd[i],s=".obs"+l.cbId,t.isArray(a)?(t.observable.off([a],at,s),t.observable.off([a],ot,s)):t.observable.off(a,ot,s),delete l.bnd[i];r=l.linkCtx,(o=r.tag)&&(o.onDispose&&o.onDispose(),n||o._elCnt||(o._prv.parentNode.removeChild(o._prv),o._nxt.parentNode.removeChild(o._nxt)),o.disposed=!0),delete r.view._.bnds[e],delete Dt[e],delete K._cbBnds[l.cbId]}}function E(e,r){return arguments.length?r&&(r=r.jquery?r:t(r),e===!0?t.each(r,function(){for(var e;(e=H(this,!0))&&e.parent;)e.parent.removeViews(e._.key,n,!0);P(this.getElementsByTagName("*"))}):e===n&&P(r)):(R&&(t(R).off(st,i),R=n),e=!0,Y.removeViews(),P(G.body.getElementsByTagName("*"))),r}function $(e,t){return E(this,e,t)}function A(e){return e=e||t.view(),function(t,n){var i,r,o=[n];if(e&&t){if(t._jsvOb)return t._jsvOb.call(e.tmpl,n,e,z);if("~"===t.charAt(0))return"~tag"===t.slice(0,4)&&(r=e.ctx,"."===t.charAt(4)&&(i=t.slice(5).split("."),r=r.tag),i)?r?[r,i.join("."),n]:[]:(t=t.slice(1).split("."),(n=e.hlp(t.shift()))&&(t.length&&o.unshift(t.join(".")),o.unshift(n)),n?o:[]);if("#"===t.charAt(0))return"#data"===t?[]:[e,t.replace(At,""),n]}}}function F(e){return"checkbox"===e.type?e.checked:e.value}function N(e,t,n,i,r,o){var a,s,l,c,u,d,f,h=0,p=e===t;if(e){for(l=w(e)||[],a=0,s=l.length;s>a;a++){if(c=l[a],d=c.id,d===i&&c.ch===r){if(!o)break;s=0}if(!p){var g="_"===c.ch?Pt[d]:Dt[d];g&&(u="_"===c.ch?g:g.linkCtx.tag,c.open?u._prv=t:c.close&&(u._nxt=t))}h+=d.length+2}h&&e.setAttribute(it,e.getAttribute(it).slice(h)),f=t?t.getAttribute(it):n._dfr,(s=f.indexOf("/"+i+r)+1)&&(f=l.tokens.slice(0,h)+f.slice(s+(o?-1:i.length+1))),f&&(t?t.setAttribute(it,f):n._dfr=f)}else n._dfr=v(n._dfr,"#"+i+r),o||t||(n._dfr=v(n._dfr,"/"+i+r))}var M=t;if(!t)throw"requires jQuery";if(!t.views)throw"requires JsRender";if(!t.observable)throw"requires jquery.observable";if(!t.link){var B,R,H,O,U,j,W,Q,V,q,G=e.document,z=t.views,K=z.sub,J=z.settings,X=K.extend,Y=K.View(n,"top"),Z=function(e){return"function"==typeof e},et=z.templates,tt=t.observable,nt=tt.observe,it="data-jsv",rt=J.linkAttr||"data-link",ot=(t.event.special,J.propChng=J.propChng||"propertyChange"),at=K.arrChng=K.arrChng||"arrayChange",st=(K._cbBnds=K._cbBnds||{},"change.jsv"),lt="onBeforeChange",ct="onAfterChange",ut="onAfterCreate",dt='"></script>',ft='<script type="jsv',ht="script,["+it+"]",pt=ht+",["+rt+"]",gt={value:"val",input:"val",html:"html",text:"text"},mt={from:{fromAttr:"value"},to:{toAttr:"value"}},vt=t.cleanData,yt=J.delimiters,_t=K.error,wt=K.syntaxError,bt=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,Ct=G.createDocumentFragment(),St=G.querySelector,kt={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1},It={tr:"table"},xt=J.wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],svg:[1,"<svg>","</svg>"],div:[1,"x<div>","</div>"]},Tt={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},Lt={},Pt={0:Y},Dt={},Et=[],$t=1,At=/^#(view\.?)?/,Ft=/(^|(\/>)|(<\/\w+>)|>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|(<\/\w+>)(\s*)|(\/>)\s*)/g,Nt=/(#)()(\d+)(_)/g,Mt=/(#)()(\d+)([_^])/g,Bt=/(?:(#)|(\/))(\d+)(_)/g,Rt=/(#)()(\d+)(\^)/g,Ht=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g;xt.optgroup=xt.option,xt.tbody=xt.tfoot=xt.colgroup=xt.caption=xt.thead,xt.th=xt.td,K.onBeforeInsert=M.simpleCallbacks(),K.onBeforeLazyLink=M.simpleCallbacks(),K.onAfterLazyLink=M.simpleCallbacks();var Ot,Ut;t.observable.onObservableTrigger.add(L),K.onStoreItem=function(e,n,i){i&&e===et&&(i.link=f,i.unlink=$,n&&(t.link[n]=function(){return f.apply(i,arguments)},t.unlink[n]=function(){return $.apply(i,arguments)}))},(J.delimiters=function(){var e=yt.apply(z,arguments);return U=e[0],j=e[1],W=e[2],Q=e[3],V=e[4],O=new RegExp("(?:^|\\s*)([\\w-]*)(\\"+V+")?(\\"+j+K.rTag+"\\"+W+")","g"),this})(),K.viewInfos=w,B={addViews:function(e,t,n){var i,r,o=this,a=t.length,s=o.views;if(!o._.useKey&&a&&(n=o.tmpl)&&(r=s.length+a,c(o,e,n,s,t,o.ctx)!==!1))for(i=e+a;r>i;i++)tt(s[i]).setProperty("index",i);return o},removeViews:function(e,i,r){function o(e){var i,o,a,l,c,u,d=f[e];if(d&&d.link){i=d._.id,r||(u=d.nodes()),d.removeViews(n,n,!0),d.data=n,l=d._prv,c=d._nxt,a=d.parentElem,r||(d._elCnt&&N(l,c,a,i,"_"),t(u).remove(),d._elCnt||(l.parentNode&&a.removeChild(l),c.parentNode&&a.removeChild(c))),s(d);for(o in d._.bnds)D(o,r);delete Pt[i]}}var a,l,c,u=this,d=!u._.useKey,f=u.views;if(d&&(c=f.length),e===n)if(d){for(a=c;a--;)o(a);u.views=[]}else{for(l in f)o(l);u.views={}}else if(i===n&&(d?i=1:(o(e),delete f[e])),d&&i){for(a=e+i;a-->e;)o(a);if(f.splice(e,i),c=f.length)for(;c>e;)tt(f[e]).setProperty("index",e++)}return this},refresh:function(e){var t=this,n=t.parent;return n&&(c(t,t.index,t.tmpl,n.views,t.data,e,!0),s(t)),t},nodes:I,contents:k,childTags:x,link:p},J.merge={input:{from:{fromAttr:F},to:{toAttr:"value"}},textarea:mt,select:mt,optgroup:{from:{fromAttr:"label"},to:{toAttr:"label"}}},J.debugMode&&(q=!J.noValidate,e._jsv={views:Pt,bindings:Dt}),X(t,{view:z.view=H=function(e,i,r){i!==!!i&&(r=i,i=n);var o,a,s,l,c,u,d,f,h=0,p=G.body;if(e&&e!==p&&Y._.useKey>1&&(e="string"==typeof e?t(e)[0]:e.jquery?e[0]:e))if(i){for(f=St?e.querySelectorAll(ht):t(ht,e).get(),u=f.length,s=0;u>s;s++)for(d=f[s],a=w(d,n,Nt),l=0,c=a.length;c>l;l++)if(o=a[l],(o=Pt[o.id])&&(o=o&&r?o.get(!0,r):o))return o}else for(;e;){if(a=w(e,n,Bt))for(u=a.length;u--;)if(o=a[u],o.open){if(1>h)return o=Pt[o.id],o&&r?o.get(r):o||Y;h--}else h++;e=e.previousSibling||e.parentNode}return i?n:Y},link:z.link=h,unlink:z.unlink=E,cleanData:function(e){e.length&&(P(e),vt.call(t,e))}}),X(t.fn,{link:function(e,t,n,i,r,o,a){return h(e,this,t,n,i,r,o,a)},unlink:function(e){return E(e,this)},view:function(e){return H(this[0],e)}}),X(Y,{tmpl:{links:{},tags:{}}}),X(Y,B),Y._.onRender=u}}(this,window.originaljQuery||window.jQuery)}),define("queuing",["wliveloaded","popover.msgbox","jquery.views"],function(){!function(e){"use strict";var t=wLive.Controls.Notifications=wLive.Controls.Notifications||{},n=new function(){var t=this,n={},i=[];t.showDelay=600,t.start=function(){if(i){var e=i,t=e.length;i=null;for(var n=0;t>n;n++)e[n]()}},t.addNotification=function(e,r,o){if(i)i.push(function(){t.addNotification(e,r,o),t.showNextNotification(o.queueGroup)});else{var a=o.queueGroup||"default",s=o.queueMode||"fifo",l=o.queueTrumpLowPriOnScreen||{},c=!!o.queueIsPriorityHigh,u=n[a]=n[a]||{current:null,items:[]},d=u.items.length;if(0!==d&&c)for(d=0;d<u.items.length&&u.items[d].queueIsPriorityHigh;d++);u.items.splice(d,0,{mode:s,notification:e,queueTrumpLowPriOnScreen:l,queueIsPriorityHigh:c,callback:r})}},t.showNextNotification=function(e){var t,i,r=n[e],o=function(e){var t,n,i,r=e.length,o={mode:null,item:null};for(t=0;r>t&&(n=e[t],i=o.mode=n.mode,o.item=n,"fifo"!==i);t++);return o.item};r&&r.items.length>0&&(t=r.current,i=r.items,t&&"filo"===t.mode&&i.length>1&&t.queueTrumpLowPriOnScreen&&(t.notification.hide(),t=null),t||(t=r.current=o(i),t.callback()))},t.removeNotification=function(i){e.each(n,function(e,n){for(var r=n.items,o=!1,a=r.length-1;a>=0;a--)if(r[a].notification===i){r[a]===n.current&&(n.current=null),r.splice(a,1),o=!0;break}o&&setTimeout(function(){t.showNextNotification(e)},t.showDelay)})},t.reset=function(){e.each(n,function(e,t){for(var n,i=t.items,r=i.length-1;r>=0;r--)n=i[r],n===t.current?n.notification.dismiss():i.splice(r,1)})},t.registerSearchApi=function(i,r){t[i]=function(t){var i,o,a,s,l,c,u,d=[];for(t=t||function(){return!0},i=r&&0!==r.length?e.map(r,function(e){return n[e]}):n,o=i.length,c=0;o>c;c++)for(s=i[c].items,l=s.length,u=0;l>u;u++)a=s[u].notification,t(a)&&d.push(a);return d}}};t.getQueue=function(){return n},t.dispose=function(){n&&(n.reset(),n=null)}}(window.originaljQuery||jQuery)}),define("automation",["queuing"],function(){!function(){"use strict";{var e=wLive.Controls.Notifications;e.AutomationOptions=new function(){var e,t,n=this;n.setModeAndLabels=function(n,i){e=n,t=i},n.getLabelAttribute=function(){return e},n.getLabelValue=function(n){var i;return e&&""!==e&&t&&(i=t[n]),i},n.getLabel=function(n,i){var r,o="",a=function(e){return(i?i[e]:null)||t[e]};return e&&""!==e&&t&&(r=a(n))&&""!==r&&(o=" "+e+'="'+r+'" '),o}}}}(window.originaljQuery||jQuery)}),define("notificationbase",["automation"],function(){!function(e){"use strict";var t=27,n=13,i=9,r=wLive.Animations,o=wLive.Controls.Notifications,a=e(o),s=o.InternalTools=o.InternalTools||{},l=o.AutomationOptions,c=e(window),u=e("BODY"),d=u[0],f={fadein:"fadeIn",fadeout:"fadeOut",slidein:"showEdgeUI",slideout:"hideEdgeUI",slidefadein:"enterContent",slidefadeout:"exitContent",slidefadein2:"enterContent2",slidefadeout2:"exitContent2"},h=s.Toolkit={isEmptyString:function(e){return"undefined"==typeof e||null==e||""==e},checkEmptyArgument:function(e,t){if(h.isEmptyString(e))throw new Error(t)},getExtraDimensions:function(e){var t={},n=function(e){return parseInt(e)||0};return t.left=n(e.css("marginLeft"))+n(e.css("borderLeftWidth"))+n(e.css("paddingLeft")),t.right=n(e.css("marginRight"))+n(e.css("borderRightWidth"))+n(e.css("paddingRight")),t.width=t.left+t.right,t.top=n(e.css("marginTop"))+n(e.css("borderTopWidth"))+n(e.css("paddingTop")),t.bottom=n(e.css("marginBottom"))+n(e.css("borderBottomWidth"))+n(e.css("paddingBottom")),t.height=t.top+t.bottom,t},sanitizeOptions:function(t,n){var i=null;if(t){var r={};e.each(t,function(t,i){e.inArray(t,n)>=0&&(r[t]=i)}),i=r}return i},registerChangeUserOptionsApi:function(t,n,i){var r=function(t){e.extend(n,h.sanitizeOptions(t,i))};o["set"+t+"DefaultOptions"]=r},isLtr:function(){return"ltr"===e("BODY").css("direction")}},p=s.ButtonHelper=function(t,n){var i=this,r=[],o=e.extend({action:!1,close:!1,alternate:!1},n&&n.excludes?n.excludes:{}),a=n&&n.renderOrder?n.renderOrder.split(","):p.buttonNames;!function(){var e,n,i,s;if(t)for(s=a.length,i=0;s>i;i++)e=a[i],n=t[e],!o[e]&&n&&"string"==typeof n&&""!==n&&r.push({name:e,title:n})}(),i.getNamesAndTitles=function(){return r}};p.buttonNames=["action","close","alternate"],p.automationKeys={},e.each(p.buttonNames,function(e,t){p.automationKeys[t]=t.charAt(0).toUpperCase()+t.substr(1)+"Button"}),s.DeferredManager=function(t,n){function i(){o=n?n():{}}var r=this,o=null,a=null;i(),r.getDeferred=function(){return a=a||e.Deferred()},r.updateState=function(t){t&&"object"==typeof t&&(o=e.extend({},o,t))},r.resolve=function(){a&&(a.resolveWith(t,[o]),a=null),i()}};var g=s.TemplateHelper={basicContainer:'<div><div tabindex="-1" class="OuterContainer" {{if backgroundColor}}style="background-color: {{attr:backgroundColor}};"{{/if}}><div class="InnerContainer"><div class="Content {{attr:contentCssClassnames}}">{0}</div></div></div></div>',defaultPartialTemplate:'{{for #data tmpl="Notifications.UserAreaSubTemplate"/}}{{for #data tmpl="Notifications.ButtonSubTemplate"/}}',registerTemplate:function(t){var n=t.html||g.defaultPartialTemplate;n=g.basicContainer.format(n),e.templates(t.id,{markup:n})},render:function(t,n,i,r,o){var a=t.options.automationOptions,c=e.extend({contentCssClassnames:"",renderTitle:!0,showNotificationArea:!1,shouldRenderButtonArea:function(){return this.showNotificationArea&&r||this.buttons.length>0},prepareForAutomation:function(e){return l.getLabel(e,a)},buttons:e.map(o.getNamesAndTitles(),function(t){return e.extend({getButtonLabel:function(){return l.getLabel(s.ButtonHelper.automationKeys[this.name],a)}},t)})},t.options);h.isEmptyString(n)&&c.renderTitle&&(c.renderTitle=!1);var u=e.views,d=u.activeViews;u.activeViews=!1;var f=e.templates[t.id].render(c);u.activeViews=d;var p=e(f);return p.find(".UserTitle").append(n),p.find(".UserContent").append(i),c.showNotificationArea&&!h.isEmptyString(r)&&p.find(".NotificationArea").append(r),p}};e.templates("Notifications.ButtonSubTemplate",{markup:'{{if shouldRenderButtonArea()}}<div class="ButtonArea">{{if showNotificationArea}}<div class="NotificationArea" {{:prepareForAutomation("NotificationArea")}}></div>{{/if}}{{for buttons}}<button name="{{attr:name}}" type="button" {{if name=="action"}}class="default c_nobdr"{{/if}} {{:getButtonLabel()}}>{{>title}}</button>{{/for}}</div>{{/if}}'}),e.templates("Notifications.UserAreaSubTemplate",{markup:'<div class="UserArea"><div class="Clipper">{{if renderTitle}}<div class="UserTitle{{if titleCssClassnames}} {{attr:titleCssClassnames}}{{/if}}" {{:prepareForAutomation("Title")}}></div>{{/if}}<div class="UserContent" {{:prepareForAutomation("Contents")}}></div></div></div>'});var m=s.TimerHelper=function(e,t,n){var i,r,o,a=this,s=function(){i=null,t()},l=function(){o||(o=new Date,clearTimeout(i),i=null)},c=function(){if(o&&r){var t=e-(o-r);o=null,r=new Date,i=setTimeout(s,t)}},u={mouseenter:l,mouseleave:c};a.start=function(){e&&(e=parseInt(e))>0&&n&&n.length>0&&(n.bind(u),r=new Date,i=setTimeout(s,e))},a.stop=function(){i&&(n.unbind(u),clearTimeout(i),i=null)}},v=s.NotificationBase=function(p){function y(){var t=e.extend({},ht.ariaOptions);null===ht.tabIndex||isNaN(ht.tabIndex)||(t.tabindex=ht.tabIndex),st.attr(t)}function _(e){var t=e?"show":"hide";st&&(st[t](),st.attr("aria-hidden",!e),null!=lt&&lt[t]())}function w(e,t,n){return n=n||[ut],a.triggerHandler(e+p.name+t,n)}function b(e,t){return t=t||[ut],dt.triggerHandler(e,t)}function C(e,t,n){var i=e?e[t]:null;i&&"function"==typeof i&&i.apply({},n||[])}function S(){var t=l.getLabelValue(ht.automationKey);t&&e(at).attr(l.getLabelAttribute(),t)}function k(){if(st){var e=l.getLabelAttribute();if(e){var t="automationtemp",n=st.attr(t);if(n&&""!==n)st.attr(e,n),st.attr(t,"");else{var i=st.attr(e);i&&""!==i&&(st.attr(t,i),st.attr(e,""))}}}}function I(){gt.timeoutInMsecs&&(mt=new m(gt.timeoutInMsecs,gt.callback,gt.getElements()),mt.start())}function x(){mt&&(mt.stop(),mt=null)}function T(){if(ot&&at&&!rt&&p.positioner){p.positioner(ot.dock,at,ht.anchorElement,ht,ft);var e=ot.dock,t=null;null!==e.y&&(t={top:e.y}),null!==e.x&&(t=t||{},t.left=e.x),t&&st.css(t)}}function L(t){var n,i,o,a,s=ht.animation||{},l=s.type||"none",c=s.entranceType||l+"in",u=s.exitType||l+"out",d=[at];if(lt&&lt.length>0&&d.push(lt[0]),t?(n=c,s.entranceArguments&&(i=e.isArray(s.entranceArguments)?e.extend(!0,[],s.entranceArguments):e.extend(!0,{},s.entranceArguments))):(n=u,s.exitArguments&&(i=e.isArray(s.exitArguments)?e.extend(!0,[],s.exitArguments):e.extend(!0,{},s.exitArguments))),o=f[n]){var h=[d];"undefined"!=typeof i&&h.push(i),h.push(!1),a=r[o].apply({},h)}else a=e.Deferred().resolve();return a}function P(){var e=$UI.Dialog.findFocusableElement(at,at,!0);e&&setTimeout(function(){try{e.focus()}catch(t){}},0)}function D(e){bt||!e||Q(e,at)||P(),bt=!1}function E(e){var r=e.which;if(null!=st&&!rt)if(ht.dismissOnEsc&&r===t||!Ct&&ht.dismissOnEnter&&r===n){var o=r===t?"close":"action";nt.changeAnimation(!1,"none"),e.stopImmediatePropagation(),st.find(".ButtonArea button[name="+o+"]").length>0&&(vt.updateState({buttonClicked:o}),b("buttonclick",[ut,o])),setTimeout(function(){ut.dismiss()},0)}else r===i?(D(e.srcElement),wt||(st.find("BUTTON.default.c_nobdr").removeClass("c_nobdr"),wt=!0)):bt=!0;Ct=!0}function $(e){D(e.srcElement)}function A(){st&&((ht.dismissOnEsc||ht.dismissOnEnter)&&st.keydown(E),ht.isModal&&(u.keydown(E),u.focusin($)))}function F(){st&&((ht.dismissOnEsc||ht.dismissOnEnter)&&st.unbind("keydown",E),ht.isModal&&(u.unbind("keydown",E),u.unbind("focusin",$)))}function N(t){var n,i=t&&t.srcElement&&t.srcElement.name||e(this).attr("name");nt.changeAnimation(!1,"none"),t.stopPropagation(),vt.updateState({buttonClicked:i}),n=e(ut).triggerHandler("buttonclick",[ut,i]),n!==!1&&ft.dismissOnButtonClick&&ut.dismiss()}function M(){st&&st.find(".ButtonArea button").bind("click.notification",N)}function B(){st&&st.find(".ButtonArea button").unbind("click.notification",N)}function R(){c.bind({"resize.nbwindowchanged":O,"scroll.nbwindowchanged":O})}function H(){c.unbind(".nbwindowchanged",O)}function O(){rt||(H(),T(),R())}function U(){return _ge("UI_Dialog_BG")||d}function j(){if(ht.dismissOnOutsideClick){var t=U(),n=(e(t),function(){t.addEventListener?t.addEventListener("click",V,!0):(t.attachEvent("onclick",V),!_ge("UI_Dialog_BG")&&d.setCapture&&(d._capturingClicks=!0,d.attachEvent("onlosecapture",q),G())),_t=null});ht.delayOutsideClickDetectionByMsecs<=0?n():_t=setTimeout(n,ht.delayOutsideClickDetectionByMsecs)}}function W(){{var t=U();e(t)}ht.dismissOnOutsideClick&&(null!=_t&&(clearTimeout(_t),_t=null),t.removeEventListener?t.removeEventListener("click",V,!0):(t.detachEvent("onclick",V),!_ge("UI_Dialog_BG")&&t.releaseCapture&&(t._capturingClicks=!1,t.detachEvent("onlosecapture",q),t.releaseCapture())))}function Q(e,t){for(var n=!1;e;)e===t?(e=null,n=!0):e=e.parentElement;return n}function V(e){rt||e._alreadyCaptured||(Q(e.srcElement||e.target,at)||ut.dismiss(),!d.addEventListener&&d.setCapture&&(e._alreadyCaptured=!0,e.srcElement.click(),d._capturingClicks&&G()),e._alreadyCaptured&&(e._alreadyCaptured=!1))}function q(){if(u){var e=u[0];e.attachEvent("onmousemove",z),ct=!1}}function G(){u&&(u[0].setCapture(!0),ct=!0)}function z(){u&&(G(),u[0].detachEvent("onmousemove",z))}function K(){P()}function J(){ht.insideClickFocus&&st&&st.click(K)}function X(){ht.insideClickFocus&&st&&st.unbind("click",K)}function Y(e){e.stopImmediatePropagation(),e.preventDefault(),ht.dismissOnOutsideClick&&Z(e)}function Z(e){e&&e.srcElement&&!Q(e.srcElement,at)&&ut.dismiss()}function et(){lt&&ht.isModal&&lt.bind("contextmenu",Y),u&&ht.dismissOnOutsideClick&&u.bind("contextmenu",Z)}function tt(){lt&&ht.isModal&&lt.unbind("contextmenu",Y),u&&ht.dismissOnOutsideClick&&u.unbind("contextmenu",Z)}var nt=this,it=(e(nt),!1),rt=!1,ot=null,at=null,st=null,lt=null,ct=!1,ut=p.instance,dt=e(ut),ft=e.extend({},v.defaultUserOptions,p.userOptions),ht=e.extend({},v.defaultControlOptions,p.controlOptions),pt=p.render=p.render||{},gt=p.timer=p.timer||{},mt=null,vt=new s.DeferredManager(ut),yt=new s.ButtonHelper(pt.buttons,pt.buttonOptions),_t=null,wt=!1,bt=!1;pt.template=pt.template||{},pt.template.options=pt.template.options||{},pt.template.options.automationOptions=h.sanitizeOptions(ft.automation,["ActionButton","CloseButton","AlternateButton","Title","Contents"]),nt.changeAnimation=function(e,t,n){if(ht.changeAnimationOnUserInteraction){var i=e?"entrance":"exit";ht.animation[i+"Type"]=t,"undefined"!=typeof n&&(ht.animation[i+"Arguments"]=n)}},nt.popoverElement=function(){return at},nt.isCurrentlyShown=function(){return it&&!rt},nt.isHidden=function(){return rt},nt.getButton=function(e){var t,n=null;if(!e||""==(t=e.buttonName+""))throw new Error("buttonName was not supplied.");return st&&(n=st.find(".ButtonArea BUTTON[name="+t+"]")),n},nt.getDeferredManager=function(){return vt},nt.reposition=function(){ot&&(T(),ot.recalc())},nt.hide=function(){ot&&!rt&&(w("before","hide"),b("beforehide"),rt=!0,ot.minimize(),k(),w("after","hide"),b("afterhide"))},nt.dismiss=function(e){var t,n=function(){o.getQueue().removeNotification(ut),ht.anchorElement=ht.focusElement=null};if(ot){if(t=w("before","dismiss"),t===!1)return;if(t=b("beforedismiss"),t===!1)return;C(e,"beforeDismiss"),F(),B(),X(),W(),H(),tt(),x(),L(!1).then(function(){if(ot){if(ot.hide(),t=w("after","dismissanimation"),t===!1)return;if(t=b("afterdismissanimation"),t===!1)return;if(st.remove(),at=null,st=null,ot.dispose(),ot=null,lt=null,t=w("after","dismiss"),t===!1)return;if(t=b("afterdismiss"),t===!1)return;
vt.resolve(),n(),it=!1;var e;ft.returnFocusTo&&(e=ft.returnFocusTo.focus)&&"function"==typeof e&&ft.returnFocusTo.focus()}})}else n()},nt.show=function(t){var n,i=o.getQueue(),r=vt.getDeferred(),a=!1;return ot?rt&&ot.restore():(i.addNotification(ut,function(){if(ot&&rt)k(),ot.restore(),rt=!1;else if(!ot&&(n=w("before","render"),n!==!1&&(n=b("beforerender"),n!==!1))){var i=g.render(pt.template,pt.title,pt.content,pt.notificationArea,yt);if(ht.focusElement=ft.focusFirstButton&&yt.getNamesAndTitles().length>0?i.find(".ButtonArea BUTTON").first()[0]:ft.focusElement?ft.focusElement:i.find(".OuterContainer").get(0),C(t,"afterRendering",[i]),ht.anchorElement=ht.anchorElement||window,ft.moreCss=ft.moreCss||"",ot=new $UI.Dialog(!!ht.isModal,ht.dialogZindex,!!p.positioner,"NotificationBase "+ht.controlCss+" "+ft.moreCss,ht.anchorElement,ht.trapTab),i.appendTo(ft.notificationContainer||"#notificationContainer"),at=ot.setContents(i[0]),st=e(at),isNaN(ht.tabIndex)||st.attr("tabindex",ht.tabIndex),y(),T(),C(t,"beforeShow"),n=w("before","show"),n!==!1&&(n=b("beforeshow"),n!==!1)){A(),M(),I(),S();var r=e.Deferred();ot.show(ht.focusElement,!ht.setFocus,r),ht.isModal&&(lt=e("#UI_Dialog_BG")),_(!1),L(!0).then(function(){a||(a=!0,r.resolve(),_(!0),C(t,"afterShow"),setTimeout(function(){ot&&(j(),R(),J(),et())},0),b("aftershow"),n=w("after","show"),it=!0)})}}},ht),i.showNextNotification(ht.queueGroup)),r.promise()},ut.content=nt.popoverElement,ut.isCurrentlyShown=nt.isCurrentlyShown,ut.isHidden=nt.isHidden,ut.getButton=nt.getButton,ut.show=function(){return nt.show()},ut.dismiss=function(){nt.dismiss()},ut.hide=nt.hide,ut.reposition=nt.reposition;var Ct=!1};v.defaultControlOptions={anchorElement:null,ariaOptions:{role:"alert","aria-hidden":"false"},automationKey:null,changeAnimationOnUserInteraction:!0,controlCss:null,dismissOnEnter:!1,dismissOnEsc:!0,dismissOnOutsideClick:!1,delayOutsideClickDetectionByMsecs:0,focusElement:null,insideClickFocus:!1,isModal:!1,returnFocusTo:null,setFocus:!1,trapTab:!0,tabIndex:null,queueGroup:null,queueMode:"fifo",queueTrumpLowPriOnScreen:!1},v.defaultUserOptions={dismissOnButtonClick:!0,focusFirstButton:!1,moreCss:null}}(window.originaljQuery||jQuery)}),define("notificationbar",["notificationbase"],function(){!function(e){"use strict";var t=window.wLive,n=t.Controls.Notifications,i=(e(n),n.AutomationOptions,n.InternalTools),r=i.Toolkit,o="Notifications.Bar";i.TemplateHelper.registerTemplate({id:o,html:'{{for #data tmpl="Notifications.UserAreaSubTemplate"/}}{{for #data tmpl="Notifications.ButtonSubTemplate"/}}<div class="Expand" {{:prepareForAutomation("ToggleExpansion")}}></div>'});var a="#c_header",s=860,l=120,c=function(t,n,i,o,a,c){var u=e("HTML"),d=e("BODY"),f=e(n),h=f.find(".InnerContainer"),p=h.find(".Content"),g=r.isLtr(),m=Math.max(h.outerWidth(),s),v=p.find(".UserArea"),y=r.getExtraDimensions(v),_=y.width,w=v.find(".Clipper"),b=v.find(".UserContent"),C=p.find(".ButtonArea"),S=C.outerWidth()||0,k=p.find(".Expand");p.width("").addClass("ForMeasure").removeClass("MinWidth NormalWidth WideWidth"),v.width("").addClass("ForMeasure"),k.removeClass("ShowImage").hide(),w.removeClass("ShowEllipsis"),b.addClass("ForMeasure").width("");var I=(p.outerWidth()||0,b.outerWidth()||0),x=m-_-S,T=I+_+S;if(s>T)x=s-_-S,v.width(x),p.addClass("MinWidth");else{var L=m-T>l,P=!L&&I>=x;if(L?(p.width(T),p.addClass("WideWidth")):(x-=l,P=I>=x,p.addClass("NormalWidth")),P){var D="margin"+(g?"Right":"Left");k.css(D,S).addClass("ShowImage").show(),w.addClass("ShowEllipsis"),x-=k.outerWidth(),b.width(x)}v.width(x)}if(0===S&&p.addClass("NoButton"),h.css("left",-(u.scrollLeft()+d.scrollLeft())),c){var E=e(a.topBarOffsetJquerySelector);if(E.length>0){var $=$UI.Dialog.getLocation(E[0]);t.y=$.height}}else f.css("bottom","0"),t.y="";b.removeClass("ForMeasure"),v.removeClass("ForMeasure"),p.removeClass("ForMeasure")},u={Top:{controlOptions:{animation:{entranceType:"slidein",entranceArguments:[{left:0,top:-50}],exitType:"slideout",exitArguments:[{left:0,top:-50}]},automationKey:"TopBar",controlCss:"NotificationBar TopBar",insideClickFocus:!0,queueGroup:"TopBar"},positioner:function(e,t,n,i,r){c(e,t,n,i,r,!0)}},Bottom:{controlOptions:{animation:{entranceType:"slidein",entranceArguments:[{left:0,top:50}],exitType:"slideout",exitArguments:[{left:0,top:50}]},automationKey:"BottomBar",controlCss:"NotificationBar BottomBar",insideClickFocus:!0,queueGroup:"BottomBar"},positioner:c}},d=n.BarDismissalMode={Explicit:"Explicit",Implicit:"Implicit",Timeout:"Timeout"},f={};f[d.Explicit]={controlOptions:{queueMode:"filo"}},f[d.Implicit]={controlOptions:{dismissOnOutsideClick:!0,delayOutsideClickDetectionByMsecs:1e3}},f[d.Timeout]={controlOptions:{dismissOnOutsideClick:!0,delayOutsideClickDetectionByMsecs:1e3}};var h=function(t,n,s,l,c){function p(){e(I.popoverElement()).find(".Expand").click(m)}function g(){e(I.popoverElement()).find(".Expand").unbind("click",m)}function m(){var t=e(I.popoverElement()).find(".Content"),n=t.hasClass("Collapsed"),i=t.find(".Clipper"),r=t.find(".UserContent");return i.toggleClass("ShowEllipsis"),n?(i.css("height",r.css("height")),t.removeClass("Collapsed")):(i.css("height",""),t.addClass("Collapsed")),I.reposition(),!1}function v(){var t=e(I.popoverElement()),n=t.find(".UserArea"),i=n.find(".Clipper"),r=n.find(".UserContent"),o=t.find(".Expand"),a=i.innerHeight(),s=r.innerHeight();s>a?(o.addClass("ShowImage"),i.addClass("ShowEllipsis")):o.attr("sutra","")}r.checkEmptyArgument(n,"Dismissal mode was not supplied.");var y=this,_=e(y),w=f[n];r.checkEmptyArgument(w,"Dismissal mode was supplied but is invalid."),r.checkEmptyArgument(t,"Mode was not supplied.");var b=u[t];if(r.checkEmptyArgument(b,"Mode was supplied but is invalid."),b===u.Top&&n===d.Implicit)throw new Error("Top bars cannot be dismissed implictly.");if(n===d.Explicit&&r.isEmptyString(l.action)&&r.isEmptyString(l.close)&&r.isEmptyString(l.alternate))throw new Error("An explict dismissable bar should contain at least one button.");var C=e.extend({trapTab:!1},w.controlOptions,b.controlOptions,h.defaultControlOptions),S=e.extend({},h.defaultUserOptions,c);r.isEmptyString(S.topBarOffsetJquerySelector)&&(S.topBarOffsetJquerySelector=a);var k={name:"bar",instance:y,controlOptions:C,userOptions:S,positioner:b.positioner,render:{content:s,buttons:l,buttonOptions:{renderOrder:"action,alternate,close"},template:{id:o,options:{contentCssClassnames:S.autoHeight?"":"Collapsed",backgroundColor:S.backgroundColor,renderTitle:!1}}}};n===d.Timeout&&(k.timer={timeoutInMsecs:7e3,callback:function(){I.getDeferredManager().updateState({timedOut:!0}),_.triggerHandler("timedout",[y]),I.changeAnimation(!1,"fadeout"),y.dismiss()},getElements:function(){var t=e(I.popoverElement());return e().add(t).add(t.children()).add(t.find(".UserContent").children()).add(t.find(".ButtonArea BUTTON")).add(t.find(".Expand"))}});var I=new i.NotificationBase(k);y.barType=function(){return t},y.dismissalMode=function(){return n},y.show=function(){return I.show({beforeShow:function(){var i=e(I.popoverElement());"Bottom"===t&&n!==d.Timeout&&i.find(".InnerContainer").addClass("WithMinWidth"),i.find(".Clipper").addClass("transitionOnHeightChange"),v(),p()}})},y.dismiss=function(){I.dismiss({beforeDismiss:function(){g()}})}};h.defaultUserOptions={autoHeight:!1,focusFirstButton:!1,topBarOffsetJquerySelector:null},h.defaultControlOptions={queueTrumpLowPriOnScreen:!0,tabIndex:0};var p=function(e,t){if(!t)throw new Error("No parameters were supplied.");return new h(e,t.dismissalMode,t.content,t.buttons,t.options)};n.createTopBar=function(e){return p("Top",e)},n.createBottomBar=function(e){return p("Bottom",e)},r.registerChangeUserOptionsApi("Bar",h.defaultUserOptions,["autoHeight","topBarOffsetJquerySelector","moreCss","notificationContainer"]),n.getQueue().registerSearchApi("getNotificationBars",[u.Top.controlOptions.queueGroup,u.Bottom.controlOptions.queueGroup])}(window.originaljQuery||jQuery)}),define("flyout",["notificationbar"],function(){!function(e){"use strict";var t=window.wLive,n=t.Controls.Notifications,i=(n.AutomationOptions,n.InternalTools),r=i.Toolkit,o="Notifications.Flyout";i.TemplateHelper.registerTemplate({id:o});var a=50,s=1,l=2,c=4,u=25,d=function(t,n,f,h,p){function g(t,n,i,r,o){for(var a,s=S(i),l=e(n),c=l.find(".OuterContainer"),u=k(l),d=e(i),f=3;f-->0&&(I(t,u,r),a=o.offset||k(d),v(t,u,a,s),x(t,l,u,a,!!o.offset,d,c)););var h=m(t,r,o,a,d);T(t,h,s)}function m(e,t,n,i,o){var s=n.offset?i.width:o.outerWidth(!0),l=n.offset?i.height:o.outerHeight(!0),c=parseInt(s/2+i.left),u=parseInt(l/2+i.top),d=parseInt(e.width/2+e.x),f=parseInt(e.height/2+e.y),h=0,p=0;p=P(f,u,a),h=P(d,c,r.isLtr()?a:-a);var g=t.animation.entranceArguments[0];return g.override||(g.left=h,g.top=p),g}function v(e,t,n,i){var r=e.width,o=e.height,a=o/2,s=n.top,l=n.left,c=n.height,u=n.width,d=c/2;e.x=l+u/2-r/2,e.y=s-o,e.y<0&&(e.y=s+c),e.x<0?(e.x=l+u,e.y=s+d-a):e.x+r>i.width&&(e.x=l-r,e.y=s+d-a)}function y(t,n,i,o,a){var l,c=r.isLtr()?o.position:o.position^s,u=S(i),d=e(n),f=d.find(".OuterContainer");null!==a.bubble&&(f.addClass("Bubble{0}".format(c)),l=e("<div/>",{"class":"BubbleBeak"}).appendTo(d));for(var h,p=k(d),g=e(i),m=3;m-->0&&(I(t,p,o),h=a.offset||k(g),c=_(t,p,u,h,c,f,d,o,null!==a.bubble),x(t,d,p,h,!!a.offset,g,f)););null!==a.bubble&&l.addClass("Beak{0}".format(c));var v=C(c,o);T(t,v,u)}function _(t,n,i,r,o,a,s,l,c){var u=o,d=2;do o!==u&&(c&&a.removeClass("Bubble{0}".format(o)).addClass("Bubble{0}".format(u)),e.extend(n,k(s)),I(t,n,l)),o=u,w(t,o,r),u=b(t,o,i);while(u!=o&&d-->0);return o}function w(e,t,n){var i=e.width,r=e.height,o=n.top,a=n.left,d=n.width,f=n.height,h=f/2,p=d/2,g=t&s,m=t&l;t&c?(e.x=g?a-i+p+u:a+p-u,e.y=m?o-r:o+f):(e.x=g?a-i:a+d,e.y=m?o-r+h+u:o+h-u)}function b(e,t,n){var i=t&s,r=t&l,o=t&c;return e.y<0?t=r?t^l:o?t:t^c:e.y+e.height>n.height&&(t=r?o?t:t^c:t^l),e.x<0?t=i?t^s:o?t^c:t:e.x+e.width>n.width&&(t=i?o?t^c:t:t^s),t}function C(e,t){var n=e&c?e&l?-1:1:0,i=e&c?0:e&s?-1:1,r=t.animation.entranceArguments[0];return r.override||(r.left=a*i,r.top=a*n),r}function S(e){var t=null,n=null,i=0,r=0;return e&&(t=e.document||e.ownerDocument)&&(n=t.documentElement,i=n.clientWidth,r=n.clientHeight),{width:i,height:r}}function k(e){var t=e.offset();return t.width=e.outerWidth(),t.height=e.outerHeight(),t}function I(e,t,n){e.width=Math.max(Math.min(t.width,n.maxWidth),n.minWidth),e.height=Math.max(Math.min(t.height,n.maxHeight),n.minHeight)}function x(t,n,i,r,o,a,s){var l=!0,c=t.width,u=t.height,d=r.top,f=r.left,h=s.outerWidth(),p=s.outerHeight(),g={top:t.y,left:t.x};c!=i.width&&(g.width=c),u!=i.height&&(g.height=u),n.css(g);var m=s.outerWidth(),v=s.outerHeight();if(o||e.extend(r,a.offset()),h!==m||p!==v){var y=v-p,_=m-h;i.width+=_,i.height+=y}else d===r.top&&f===r.left&&(l=!1);return l}function T(e,t,n){var i=e.y+e.height-n.height;i>0&&(0!==t.top&&(i+=a,t.top-=i),e.y-=i),e.y=Math.max(0,e.y)}function L(e,t,n){var i=0,r=e-t,o=Math.abs(r)>n;return o&&(i=r>0?1:-1),i}function P(e,t,n){var i=0,r=L(e,t,5);return r>0?i=-n:0>r&&(i=n),i}if(r.checkEmptyArgument(n,"No content was supplied"),null==f)throw new Error("No anchor was supplied.");var D=this,E=e.extend({},d.defaultUserOptions,p),$=e.extend({anchorElement:f},d.defaultControlOptions,p),A=E.positionMode,F=null!==E.bubble;F&&($.controlCss+=" Bubble",A=E.bubble),$.position=A;var N=new i.NotificationBase({name:"flyout",instance:D,controlOptions:$,userOptions:E,positioner:-1!==A?y:g,render:{title:t,content:n,buttons:h,buttonOptions:{excludes:{dismiss:!0}},template:{id:o}}});D.show=function(){return N.show({beforeShow:function(){$.width&&e(N.popoverElement()).find(".UserContent").css({width:$.width})}})}};d.defaultUserOptions={bubble:null,positionMode:-1},d.defaultControlOptions={animation:{entranceType:"slidefadein",entranceArguments:[{left:0,top:0}],exitType:"fadeout"},ariaOptions:{role:"alertdialog"},automationKey:"Flyout",changeAnimationOnUserInteraction:!1,controlCss:"Flyout",dismissOnEnter:!0,dismissOnOutsideClick:!0,isModal:!0,maxHeight:758,maxWidth:510,minHeight:54,minWidth:70,position:-1,queueGroup:"Flyout",setFocus:!0,trapTab:!1,width:null},n.createFlyout=function(e){if(!e)throw new Error("No parameters were supplied.");return new d(e.title,e.content,e.anchor,e.buttons,e.options)},r.registerChangeUserOptionsApi("Flyout",d.defaultUserOptions,["moreCss","notificationContainer"]),n.getQueue().registerSearchApi("getFlyouts",[d.defaultControlOptions.queueGroup])}(window.originaljQuery||jQuery)}),define("modaldialog",["flyout"],function(){!function(e){"use strict";var t=window.wLive,n=t.Controls.Notifications,i=(n.AutomationOptions,n.InternalTools),r=i.Toolkit,o="Notifications.ModalDialog";i.TemplateHelper.registerTemplate({id:o});var a=function(t,n,s,l,c){r.checkEmptyArgument(n,"No content was supplied");var u=this,d=null,f=e.extend({},a.defaultUserOptions,c),h=a.defaultControlOptions;h.dismissOnEsc=f.dismissOnEsc;var p=new i.NotificationBase({name:"dialog",instance:u,controlOptions:h,userOptions:f,positioner:function(t,n){var i=e("HTML"),o=e("BODY"),a=e(n),s=a.find(".InnerContainer"),l=e(window).innerHeight(),c=a.height(),u=(l-c)/2;t.y=u;var d=a.find(".NotificationArea");if(0!==d.contents().length){var f=a.find(".ButtonArea"),h=0;f.find("BUTTON").each(function(){var t=e(this);h+=r.getExtraDimensions(t).width+t.outerWidth(!0)});var p=r.getExtraDimensions(d);a.find(".NotificationArea").width(f.width()-p.width-h),d.show()}else d.hide();s.css("left",-(i.scrollLeft()+o.scrollLeft()))},render:{title:t,content:n,notificationArea:s,buttons:l,template:{id:o,options:{showNotificationArea:!0}}}});u.show=function(){return p.show({beforeShow:function(){d=e(p.popoverElement()).find(".NotificationArea")}})},u.dismiss=function(){p.dismiss({beforeDismiss:function(){d=null}})},u.notificationArea=function(){return d}};a.defaultUserOptions={dismissOnEsc:!0,focusFirstButton:!0},a.defaultControlOptions={animation:{type:"fade"},ariaOptions:{role:"alertdialog"},automationKey:"ModalDialog",changeAnimationOnUserInteraction:!1,controlCss:"ModalDialog",isModal:!0,setFocus:!0,queueGroup:"ModalDialog"},n.createModalDialog=function(e){return new a(e.title,e.content,e.notificationArea,e.buttons,e.options)},r.registerChangeUserOptionsApi("ModalDialog",a.defaultUserOptions,["dismissOnEsc","moreCss","notificationContainer"]),n.getQueue().registerSearchApi("getModalDialogs",[a.defaultControlOptions.queueGroup])}(window.originaljQuery||jQuery)}),define("toast",["modaldialog"],function(){!function(e){"use strict";var t=window.wLive,n=t.Controls.Notifications,i=(n.AutomationOptions,n.InternalTools),r=i.Toolkit,o="Notifications.Toast";i.TemplateHelper.registerTemplate({id:o,html:'{{if contentImage}}<div class="ContentImage" {{:prepareForAutomation("ContentImage")}}><img src="{{attr:contentImage}}"></div>{{/if}}{{for #data tmpl="Notifications.UserAreaSubTemplate"/}}{{if sourceIcon}}<div class="SourceIcon" {{:prepareForAutomation("SourceIcon")}}><img src="{{attr:sourceIcon}}"></div>{{/if}}<div class="CloseIcon" {{:prepareForAutomation("CloseIcon")}}><div class="HoverArea"><span class="CloseText">&times;</span></div></div>{{if soundSourceFiles}}<audio autoplay loop>{{for soundSourceFiles}}<source src="{{attr:uri}}" type="{{attr:type}}"/>{{/for}}</audio>{{/if}}'});var a=n.ToastPriority={Normal:"Normal",High:"High"},s=n.ToastTimeout={Normal:"Normal",Long:"Long"},l=function(t,c,u,d,f){function h(){var t=e(x.popoverElement());_&&t.click(g),t.find(".CloseIcon").click(m)}function p(){var t=e(x.popoverElement());_&&t.unbind("click",g),t.find(".CloseIcon").unbind("click",m)}function g(){x.getDeferredManager().updateState({clicked:!0}),b.triggerHandler("click",[w]),x.changeAnimation(!1,"none"),w.dismiss()}function m(){x.changeAnimation(!1,"none"),w.dismiss()}r.checkEmptyArgument(c,"No content was supplied"),r.checkEmptyArgument(d,"No source icon was supplied");var v=e.extend({timeoutInMsecs:f.timeout===s.Long?6e4:7e3,queueIsPriorityHigh:f.priority===a.High},l.defaultControlOptions),y=e.extend({},l.defaultUserOptions,f),_=y.dismissOnInsideClick,w=this,b=e(w),C=null,S=y.soundSourceFiles;e.isArray(S)?C=S:(C=[],S.aac&&C.push({uri:S.aac,type:"audio/mp4"}),S.ogg&&C.push({uri:S.ogg,type:"audio/ogg"}));var k={id:o,options:{backgroundColor:y.backgroundColor,soundSourceFiles:C,contentImage:u,sourceIcon:d,renderTitle:!!t,titleCssClassnames:"TextSemiBold LineHeightStandard"}},I=function(e,t){e&&(k.options.contentCssClassnames=(k.options.contentCssClassnames||"")+" "+t)};I(!r.isEmptyString(u),"WithContentImage"),I(!r.isEmptyString(t),"WithTitle");var x=new i.NotificationBase({name:"toast",instance:w,controlOptions:v,userOptions:y,positioner:function(e){e.x=null,e.y=null},render:{title:t,content:c,template:k},timer:{timeoutInMsecs:v.timeoutInMsecs,callback:function(){x.getDeferredManager().updateState({timedOut:!0}),b.triggerHandler("timedout",[w]),w.dismiss()},getElements:function(){var t=e(x.popoverElement);return e().add(t.find(".OuterContainer").find("*"))}}});w.show=function(){return x.show({beforeShow:function(){n.enableAriaSupport(),h()}})},w.dismiss=function(){x.dismiss({beforeDismiss:function(){p()}})}};l.defaultUserOptions={timeout:s.Normal,priority:a.Normal,dismissOnInsideClick:!0,soundSourceFiles:{}},l.defaultControlOptions={animation:{entranceType:"slidein",exitType:"fadeout"},automationKey:"Toast",controlCss:"Toast",queueGroup:"Toast",queueMode:"fifo"},$B.SF_Mac||(l.defaultControlOptions.animation.entranceArguments=[{top:0,left:400}]),n.createToast=function(e){var t=window.top,n=null,i=null;try{t!==window&&t.wLive&&t.wLive.Controls&&t.wLive.Controls.Notifications&&(n=t.wLive.Controls.Notifications,n.getQueue().start(),i=n.createToast(e))}catch(r){}return i||(i=new l(e.title,e.content,e.contentImage,e.sourceIcon,e.options)),i},r.registerChangeUserOptionsApi("Toast",l.defaultUserOptions,["backgroundColor","moreCss","notificationContainer"]),n.getQueue().registerSearchApi("getToasts",[l.defaultControlOptions.queueGroup])}(window.originaljQuery||jQuery)}),define("ariasupport",["toast"],function(){!function(e){var t=wLive.Controls.Notifications;t.enableAriaSupport=function(){if(0===e("#notificationContainer").length){var t={position:"absolute",padding:"0",margin:"0",height:"100%",width:"100%",top:"0"};t[wLive.Controls.Notifications.InternalTools.Toolkit.isLtr()?"left":"right"]="0",e('<div id="notificationContainer" class="NotificationContainer" persist="1" role="alert" aria-live="assertive" aria-atomic="false" aria-haspopup="true"></div>').css(t).prependTo("BODY")}}}(window.originaljQuery||jQuery)}),define("doregister",["ariasupport"],function(){!function(){$Do.register("NotificationControls")}()}),define("getstring",[],function(){window.GetString=function(e){for(var t=this,n=e.toLowerCase().split("."),i=n.length,r=0;i>r;r++){var o=n[r];if(t=t[o],null==t)return""}return"object"==typeof t?t.___str:t.toString()}}),define("alehelpers",["registernamespace","dependancies","getstring"],function(){!function(){function e(e){return window.GetString?GetString(e):""}var t="live.shared.skydrive.",n="live.shared.strings.",i="live.shared.marketinfo.";wLive.Core.AleHelpers={getString:function(n){return e(t+"shared."+n)},getPCString:function(n){return e(t+"pc."+n)},getSkyString:function(n){return e(t+n)},getMobileString:function(n){return e(t+"mobile."+n)},getMarketInfoValue:function(t){return e(i+t)},getSharedString:function(t){return e(n+t)}}}()}),define("viewparams",["dependancies","defineutilities"],function(){!function(){defineClass("wLive.Core.ViewParams",function(){},{})}()}),define("viewcontext",["viewparams"],function(){!function(){var e,t=wLive.Core;defineClass("wLive.Core.ViewContext",function(){this.viewParams=new t.ViewParams},{},{getInstance:function(){return e||(e=new wLive.Core.ViewContext),e}})}()}),define("bicihelpers",["jquery-1.7.2","dependancies","lightstring","bsi","domutilities","viewcontext"],function(){!function(){function e(e){for(var t=e.context;t;){if(t.control)return t.control;t=t.parentElement}return void 0}var t=wLive.Core,n="TypeOfPage",i="Search",r="SearchesBeforeAction",o="SearchItemPos",a="frestatus",s="ABTest",l=5,c="ODREFID",u="SR",d="SB";t.BiciHelpers={reportClickAction:function(f,h,p,g,m){var v,y={SkyCmnd:f,ClickLoc:h};if(!p){v=wLive.Core.ViewContext.getInstance(),p=v&&v.biciPageId;var _=v&&v.biciSetViewContentType;_&&(p+=_)}if(p&&(y[n]=p),f==u&&h==d){var w={searchCount:-1,searchId:-1,currentQuery:"",pageSearchedFrom:p};t.Search&&(w.searchCount=t.Search.getSearchesBeforeAction(),w.searchId=t.Search.getSearchStartTime(),w.currentQuery=t.Search.getCurrentQuery()),Qos.logData("SkyDriveWeb_Internal_Search_Query","SkyDrive",w.searchId,null,null,w,Date.now())}if(p&&p.startsWith(i)){var b={searchesBeforeAction:-1,searchItemPosition:-1,resultCount:-1,searchSucceeded:!1,searchId:-1,searchQuery:"",skyCmnd:f,clickLoc:h};if(t.Search&&(y[r]=t.Search.getSearchesBeforeAction(),b.searchesBeforeAction=y[r],b.searchId=t.Search.getSearchStartTime(),t.Search.clearSearchesBeforeAction(f)),v&&(b.searchItemPosition=v.selectionManager.getSelection().firstSelectedIndex,b.resultCount=v.currentItem.estimatedResultCount,b.searchQuery=v.viewParams.q),g){var C=e(g);if(C){for(;C&&C.dataContext&&void 0==C.dataContext.itemIndex;)C=C.parent;C&&C.dataContext&&(b.searchItemPosition=C.dataContext.itemIndex)}}b.searchItemPosition>=0&&(y[o]=b.searchItemPosition,b.searchSucceeded=!0),Qos.logData("SkyDriveWeb_Internal_Search_Result","SkyDrive",b.searchId,null,null,b,Date.now())}for(var S in m)y[S]=m[S];for(var k=1;l>k;k++){var I=s+k,x=$Cookie.getCookie(I);null!=x&&(y[I]=x)}var T=$Cookie.getCookie(c);null!=T&&(y[c]=T);var L=$Cookie.getCookie(a);if(null!=L){var P="0";"shown"==L&&(P="1"),$BSI.reportEvent("SkyDrive.FREEligible.ActionAfter",{FREShown:P}),$Cookie.deleteCookie(a)}$BSI.reportEvent("ClickedSelected.Command.SkyDrive",y)},prependBiciReportClickAction:function(e,n,i){return function(r){if(r&&r.target)var o=jQuery(r.target);return t.BiciHelpers.reportClickAction(n,i,null,o),e&&e.apply(this,arguments)}}}}()}),define("actionmanager",["jquery-1.7.2","dependancies","lightstring","bsi","bicihelpers"],function(){!function(){function e(){this._actions={}}var t=wLive.Core;t.ActionManager=e;var n=e.prototype;n.registerAction=function(e,t){this._actions[e]=t},n.isActionRegistered=function(e){return this._actions[e]?!0:!1},n.getAction=function(e){var t=this._actions[e];return t?t.getAction.apply(t,arguments):null},n.doAction=function(e){var t=!0;return e&&(e.click&&(t=e.click()),e.url&&($BSI.navigateTo(e.url,e.target),t=!1)),t},e.getATagAction=n.getATagAction=function(e,n,i){var r=e.click||function(){return $BSI.navigateTo(e.url),!1},o=e.skyCmd;return n&&o&&(r=e.click=t.BiciHelpers.prependBiciReportClickAction(r,o,n)),i&&(e.click=function(e){return i(e,r)}),e},e.setATagAction=n.setATagAction=function(t,n,i,r){return n=n||jQuery(document.createElement("a")),t=e.getATagAction(t,i,r),t.click&&n.bind("click.action",t.click),n.attr("href",t.url||"#"),t.target&&n.attr("target",t.target),n}}()}),define("priorityqueue",["dependancies"],function(){!function(){function e(e,t,h){function p(e,t){var n=e[t];n&&(n.state==d?(C(n),n.abort&&n.abort()):m(n),S(n))}function g(e,t,n,i,r){var o={id:i,queueId:r,exec:e,abort:t,pri:n,timeoutId:0,next:null,prev:null,state:c};return o}function m(e){if(e&&e.state==u){e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev);var t=e.pri;N[t]==e&&(N[t]=e.next),M[t]==e&&(M[t]=e.prev),e.state=c,e.prev=e.next=null,L--}return e}function v(e){if(e&&e.state==c){var t=e.pri,n=M[t];n?(n.next=e,e.prev=n):N[t]=e,M[t]=e,e.state=u,L++}}function y(){!H&&!$&&L&&I>P&&($=window.setTimeout(w,a))}function _(e,t){var n=!0;if(t>0){var i=Math.max(r,o-o*(t/T));n=(new Date).getTime()-e<i}return n}function w(){var e=(new Date).getTime(),t=0;for($=0,H=!0;L>0&&T>=t&&I>P;){var n=N[t];if(n=n&&D[n.pri]<(x[n.pri]||I)?b(m(n)):null){if(!_(e,t))break}else t++}H=!1,y()}function b(e){if(e){P++,B[e.id]=e,e.startTime=(new Date).getTime(),D[e.pri]++,e.state=d;var t=e.exec(function(t){C(e,t)});t||C(e)}return e}function C(e){e.state===d&&(P--,delete B[e.id],D[e.pri]--,S(e))}function S(e){var t=F[e.queueId];e.state=f,delete t[e.id],y()}for(var k=this,I=e||i,x=t||{},T=h||n,L=0,P=0,D=[],E=0;T>=E;E++)D.push(0);var $=0,A=0,F={},N=[],M=[],B={},R=!1,H=!1;k.enqueue=function(e,t,n,i,r){var o=!1;if(!R){r=r||s,i=i||String(A++),n=void 0!==n?n:l;var a=F[r]=F[r]||{},c=a[i];(!c||c.state==u&&(c.next||c.pri!=n))&&(c?(m(c),c.pri=n):(o=!0,c=a[i]=g(e,t,n,i,r)),v(c),y())}return o},k.abortAll=function(){R=!0;for(queueId in F)k.abort(queueId);R=!1},k.abortTask=function(e,t){e=e||s;var n=F[e];n&&p(n,t)},k.abort=function(e){e=e||s;var t=F[e];if(t){for(taskId in t)p(t,taskId);F[e]={}}},k.getActiveTaskCount=function(){return P},k.getActiveTasks=function(){return B}}var t=wLive.Core,n=3,i=5,r=20,o=100,a=0,s="root",l=2,c=0,u=1,d=2,f=4;t.PriorityQueue=e}()}),define("priorityqueueconfiguration",["priorityqueue"],function(){!function(){var e=wLive.Core,t=5,n=e.RequestPriorityEnum={FetchData:0,FetchImages:1,DefaultGet:2,DefaultPost:3,MoveOperation:4,CopyOperation:5,DeleteOperation:6,RestoreOperation:7,UploadOperation:8,RemoteUploadOperation:9,UpdateStatusOperation:10,ResetAbuseScoreOperation:11,OwnerRequestReviewOperation:12,RotateImageOperation:13,PublishToFacebookOperation:14,CopyAsyncOperation:15,PublishVideoOperation:16,AddFavoritesOperation:17,RemoveFavoritesOperation:18},i=18,r={};r[n.CopyOperation]=1,r[n.DeleteOperation]=1,r[n.MoveOperation]=1,r[n.RestoreOperation]=1,r[n.UploadOperation]=3,r[n.RemoteUploadOperation]=1,window.requests=new e.PriorityQueue(t,r,i),window.domUpdates=new e.PriorityQueue}()}),define("jsonconstants",["jquery-1.7.2","pagestats","validateconfig","jbase","workmonitor","basecontrol","alehelpers","dependancies","retriablepromise","priorityqueueconfiguration"],function(){wLive.Core.JSONConstants={ErrorCodes:{BlockedUserErrorCode:3009,HipCheck:3006,PartialPermissionsSetError:2019,UnverifiedAccount:3020},InvalidNameRegEx:'([:|*|?|\\\\|/|"|<|>||||])',InvalidItemNameCharacters:'* ? \\ / " : < > |',ViewType:{FolderPicker:"1",FilePicker:"2",Self:"3",Photos:"photos"},SortField:{Default:"0",Name:"1",ModifiedDate:"2",CreatedDate:"3",Size:"4",Type:"5",DateTaken:"6",Owner:"7",UserArranged:"8",LastOpened:"9",Relevancy:"10",DateDeleted:"11",OriginalLocation:"12",DateShared:"13",Sharer:"14",DateLastActioned:"15"},SortDirection:{Default:"0",Ascending:"1",Descending:"2"},GroupBy:{Default:"-1",None:"-2",Folders:"0",FoldersDocumentsPhotos:"0,1,2"},FilterType:{Albums:"1",Folder:"2",Favorites:"4",AllFolders:"7",PhotosAndVideos:"8",Documents:"16"},SharingLevel:{Public:0,PublicUnlisted:2,Shared:3,Private:4},RecentActionType:{Edit:0,Add:1,Share:2,Open:3},UserFactInfoType:{NewBrandBonus:1,CameraRollBonus:2,NewFriendAcceptedInvitation:3,CameraRollNewlyEnabled:4,InvitedFriendBonus:5,InvitedByFriendBonus:6,Upsells:7,Grandfather:8,OdbAccounts:9,QuotaFactExpiration:10,CameraRollBonus2:14},UserFactInfoAction:{Set:1,Delete:2,InsertUpdate:3}}}),define("datarequest",["jsonconstants"],function(){!function(e){function t(t,i,S,k,I,x,T,L,P,D,E){function $(e){var t=!1;return 0!=e.indexOf("/")&&(t=A(e)!=A(window.location.host)),t}function A(e){var t=e.indexOf("://");return-1!==t&&(e=e.substr(t+3)),t=e.indexOf("?"),-1!==t&&(e=e.substr(0,t)),t=e.indexOf("/"),-1!==t&&(e=e.substr(0,t)),e.toLowerCase()}function F(){M._workId&&(a.completeWork(M._workId),M._workId=null)}function N(e){var r,o=e?e.error:null;if(F(),e=e||{},wLive.PageStats.add(e.pageStats,U),e.error){var a=e.error.stackTrace;r=e.error.debugMessage?e.error.debugMessage+"\n":"",r+=a&&a.encodeJson?a.encodeJson():"";{'{"code": "'+e.error.code+'", "message": "'+e.error.message+'", "debug": "'+e.error.debugMessage+'", "stacktrace": "'+r+'", "retriesLeft": "'+O+'", "requestUrl": "'+i+'"}'}}if(e.error&&e.error.isRetriable&&O>0)Trace.logTo(j,"Retrying request: "+i,y,{dataBundle:e,shouldSynchronizeSerialization:!0}),R&&R(),O--,M.start();else{if(e.error)Trace.logTo(j,"Failed response: "+i,y,{dataBundle:e,shouldSynchronizeSerialization:!0}),R&&R(M.failureReentranceDelay),e.error.code!=p&&n(t,!1,e);else{var l=!1;Trace.logTo(j,"Response: "+i,y,{dataBundle:e,shouldSynchronizeSerialization:l}),R&&R(M.successReentranceDelay),W&&M.originId&&(e.originId=M.originId),n(t,!0,e)}if(M.apiId&&M.propertyId){var c=void 0,u=s.success;o&&(c=o.code+(o.status?"-"+o.status:""),u=o.isExpected?s.expected:s.unexpected),M.errorCodeSuffix&&(c=(c||"success")+"-"+M.errorCodeSuffix),window.Qos&&Qos.log(M.apiId,M.propertyId,U,c,u,r)}}}var M=this;M.successCallback=k,M.failureCallback=I,t=t||"key"+w++,b[t]=b[t]||[],b[t].push(this);var B,R,H=!1,O=void 0!==L?L:g;x=x||d;var U,j=null,W=$(i);M.priority=T||(S||E?m:v),M.queueId=S||E?u:c,M.originId=null,M.jsonpParameterName=void 0,M.successReentranceDelay=0,M.failureReentranceDelay=0,M._queuedWorkStarted=!1,S&&(S=S.replace(/\?/g,"\\u003F")),M.apiId="",M.propertyId="",M.errorCodeSuffix="",M._workId=null,M.start=function(){var n=a.startWork([a.StandardTags.Network,a.StandardTags.Network_Data]);return M._enqueued=window.requests.enqueue(function(s){if(M._queuedWorkStarted=!0,H)a.completeWork(n);else{M._workId=n,R=s,U=(new Date).getTime(),j=Trace.log("Request: "+i,y,{dataBundle:S,shouldSynchronizeSerialization:!0});var l,c=null,u=i,d=!1;if(W){if(!P){u+=-1===i.indexOf("?")?"?":"&",u+="canary="+FilesConfig.canary.encodeUrl(),l="dataRequestCallback_"+_++;var f=!1,p=setTimeout(function(){f||(f=!0,N(M.parseError(B,"timeout",h)))},x);o.DataRequest[l]=function(e){f||(clearTimeout(p),f=!0,N(e)),delete o.DataRequest[l]}}}else c={canary:FilesConfig.canary,Accept:"application/json",AppId:FilesConfig.appId},u.indexOf("/GetItems?")>-1&&(c["Cache-Control"]="private",c["X-ForceCache"]="1"),M.originId&&(c["X-SkyApiOriginId"]=M.originId),FilesConfig.oauthToken&&(c["X-Auth"]=FilesConfig.oauthToken),FilesConfig.authKey&&(c.InvitationToken=FilesConfig.authKey),FilesConfig.skyApiDomain&&u.toLowerCase().startsWith("/api/")&&(d=!0);var g=function(e){d?setTimeout(function(){N(e)},0):N(e)},m=function(e,t,n){d?setTimeout(function(){N(M.parseError(e,t,n))},0):N(M.parseError(e,t,n))},v={url:u,dataType:D?D:W&&!P?"jsonp":"json",jsonp:M.jsonpParameterName,jsonpCallback:l?"wLive.Core.DataRequest."+l:void 0,data:S,processData:!1,type:S||E?"POST":"GET",headers:c,timeout:x,success:W&&!P?void 0:g,error:W&&!P?void 0:m,xhrFields:P?null:{withCredentials:1}},w=window.$InlineRequests&&$InlineRequests[t];w?(Trace.logTo(j,"Inline request: "+i,y),w.then(g,m)):d?$Do.when("skyApiProxy",0,function(){H||(C&&C.contentWindow&&C.contentWindow.jQuery?B=C.contentWindow.jQuery.ajax(v):(f=!0,N(M.parseError(null,"proxyfailure",h)),r()))}):B=e.ajax(v)}return!H},function(){W||M.abort()},M.priority,t,M.queueId),M._enqueued||a.completeWork(n),M._enqueued},M.abort=function(){H=!0,B&&!W&&(Trace.logTo(j,"Abort: "+i,y,{dataBundle:S,shouldSynchronizeSerialization:!0}),B.abort(),B=null),R?(R(),R=null):M._enqueued&&!M._queuedWorkStarted&&(requests.abortTask(M.queueId,t),M._enqueued=!1),F()},M.getStartTime=function(){return U},M.parseError=function(e,t){var n={};if(e&&500==e.status)try{n=Object.fromJSON(e.responseText)||{}}catch(r){}if(!n.error&&!n.items){var o=!0,a=!1,s=f+(e&&e.status?": status "+e.status:""),c=l("LoadGenericError");switch(n.pageStats={url:i,error:t,tasks:[],executionTimeMs:0,schedulerTimeMs:0},t){case"proxyfailure":case"timeout":s=h,c=l("LoadTimeoutError");break;case"abort":s=p,o=!1,a=!0,n.pageStats.info=t,n.pageStats.error=null}n.error={isRetriable:o,isExpected:a,code:s,message:c,status:t,debugMessage:e?"(xhr status "+e.status+") xhr.responseText: "+e.responseText:"",stackTrace:""}}return n}}function n(e,t,n){var i=b[e];delete b[e];for(var r=0;i&&r<i.length;r++){var o=i[r];t&&o.successCallback&&o.successCallback(n),!t&&o.failureCallback&&o.failureCallback(n)}}function i(){C||(C=ce("IFRAME"),C.id="skyApiProxyFrame",C.src=FilesConfig.skyApiDomain+"/api/proxy?v=3",document.head.appendChild(C))}function r(){C&&(document.head.removeChild(C),C=null),$Do.unregister("skyApiProxy"),i()}var o=wLive.Core,a=Shared.WorkMonitor,s=Qos.responseType,l=o.AleHelpers.getString,c="fetch",u="write",d=3e4,f="unexpected",h="timeout",p="aborted",g=1,m=o.RequestPriorityEnum.DefaultPost,v=o.RequestPriorityEnum.DefaultGet,y="DataRequest",_=0,w=0,b={},C=null;
FilesConfig.skyApiDomain&&(document.domain=$Config.d,C=byId("skyApiProxyFrame"),i()),o.DataRequest=t,o.DataRequest.hasPendingRequest=function(e){return!!b[e]}}(window.originaljQuery||jQuery)}),define("imagestrip",["validateconfig","dependancies","wliveimagestrip"],function(){!function(){function e(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].hasOwnProperty(e)){n=i;break}return n}var t=[window.FilesIS32||{},window.FilesIS8||{}],n=[FilesConfig.imageStripUrl_32,FilesConfig.imageStripUrl_8];window.require&&!$B.Mobile&&require(["skydrive_pc_strip_8_ltr","skydrive_pc_strip_32_ltr"],function(){t=[window.FilesIS32||{},window.FilesIS8||{}]});var i=wLive.Core.ImageStrip={};i.getImage=function(i,r,o){r=r||"",o=o||"";var a,s=e(i);if(s>-1){var l=t[s],c=n[s],u=l[i];a=$IS.Create(u.x,u.y,u.w,u.h,FilesConfig.imgBaseUrl,c,r,o)}return a}}()}),define("ticketredeemer",["alehelpers"],function(){!function(){function e(e){function u(e,t,n,i,r){if(et.html((n?L:T).format($Config.email||"")),tt.html(b(e,t,n)),n){var a=y(e,i,r),s=jQuery(o.format(A,a,F));X.append(s)}else require(["ic"],function(){$Do.when("$icm",0,function(){var e=$icm.createICForPerson("TokenRedemptionTemplate",$Config.cid,{namespace:c,showICCard:!0});e?(Z.html(e.render()),e.activate(jQuery(".c_ic",Z))):Z.html($Config.email)})})}function d(e,t,n,i,r,o){t==s?h(r,n,o):t==a?f(r.id,o,i):I.dispose()}function f(e,t,n){p(e,t,n),X.detach(),Y.html(P),nt.detach()}function h(e,t,n){var i=y(e,t,n);$BSI.navigateTo(i)}function p(e,n,i){var r=Object.toJSON({id:e,authKey:n}),o=new t.DataRequest(l,l,r,function(){g(i)},m);o.apiId="SkyDrive_Json_RedeemPermissionToken",o.propertyId="SkyDrive",o.start()}function g(t){e.tokenHasBeenRedeemed=!0,I.dispose(),t&&t()}function m(){Y.html(X),nt.insertBefore(X.find(".header"))}function v(e,t,n){var i=_(e,t,n),r=FilesConfig.signInUrl+"&ru="+i.encodeUrl()+"&wreply="+i.encodeUrl();return r}function y(e,t,n){var i=_(e,t,n),r=FilesConfig.autoRedeemSignOut+("&lru="+i.encodeUrl());return r}function _(e,t,n){var i,r=t&&t.url;return i=r?r:"/?id="+e.id.encodeUrl()+"&cid="+e.ownerCid.encodeUrl()+(t?"&action="+t.name.encodeUrl():""),FilesConfig.autoRedeemUrl+"?resid="+e.id.encodeUrl()+"&authkey="+n.encodeUrl()+"&ru="+i.encodeUrl()}function w(e){var t;return t=e.folder?G:e.video?z:e.photo?K:J}function b(e,t,n){var i,r=0==t;return i=e.folder?n?V:r?B:U:e.video?n?q:r?R:j:e.photo?n?Q:r?M:O:n?W:r?N:H}var C,S,k,I=this,x="Office.TicketRedeem.",T=i(x+"You"),L=i(x+"Mobile.You"),P=i(x+"PleaseWait"),D=i(x+"Error"),E=i(x+"ContinueStr"),$=i(x+"SwitchAccounts"),A=i(x+"Mobile.SameAccount"),F=i(x+"Mobile.SwitchAccounts"),N=i(x+"GoldenTicketBodyDocument"),M=i(x+"GoldenTicketBodyPhoto"),B=i(x+"GoldenTicketBodyFolder"),R=i(x+"GoldenTicketBodyVideo"),H=i(x+"InfiniteTicketBodyDocument"),O=i(x+"InfiniteTicketBodyPhoto"),U=i(x+"InfiniteTicketBodyFolder"),j=i(x+"InfiniteTicketBodyVideo"),W=i(x+"Mobile.BodyDocument"),Q=i(x+"Mobile.BodyPhoto"),V=i(x+"Mobile.BodyFolder"),q=i(x+"Mobile.BodyVideo"),G=i(x+"HeaderFolder"),z=i(x+"HeaderVideo"),K=i(x+"HeaderPhoto"),J=i(x+"HeaderDocument"),X=jQuery(r),Y=jQuery(_ce("div")).html(X),Z=X.find(".icPlaceholder").css("padding-bottom","8px"),et=X.find(".header").css("padding-bottom","8px"),tt=X.find(".body"),nt=jQuery(_ce("div")).html(D).addClass("error");I.show=function(t){k=t;var i=t.callback,r=t.item,o=t.action,l=t.authkey,c=!t.container;c||(Y=t.container.html(X));var p=(r.id,r.tokenType);if(e.callerCid&&""!==e.callerCid)if(e.callerCid.toLowerCase()===r.ownerCid.toLowerCase())I.dispose(),i&&i();else{u(r,p,!c,o,l);var g=0===p?"GoldenTicketRedeem":"InfiniteTicketRedeem";if(C=w(r),c){var m={buttons:{action:E,alternate:$},title:C,content:Y};S=n.Notifications.createModalDialog(m);var y=jQuery(S);y.bind({"aftershow._dlg":function(){var e=X.closest(".ModalDialog");sutra(e,"$Sutra.SkyDrive."+g);var n=S.getButton({buttonName:a});sutra(n,"$Sutra.SkyDrive.RedeemContinue");var i=S.getButton({buttonName:s});sutra(i,"$Sutra.SkyDrive.RedeemSwitchAccounts"),t.onShow&&t.onShow()},"afterdismiss._dlg":function(){y&&y.unbind("._dlg"),y=null,S=null},"buttonclick._dlg":function(e,t,n){d(t,n,o,i,r,l)}}),S.show()}else{var _=X.find(".same"),b=X.find(".switch");_.click(function(){return f(r.id,l,i),!1}),b.click(function(){return h(r,o,l),!1}),sutra(Y,"$Sutra.SkyDrive."+g),sutra(_,"$Sutra.SkyDrive.RedeemContinue"),sutra(b,"$Sutra.SkyDrive.RedeemSwitchAccounts")}}else $BSI.navigateTo(v(r,o,l),"_top")},I.dispose=function(){X.remove(),nt.remove(),window.$icm&&window.$icm.removeAllICsByNamespace(c),S&&S.dismiss(),k.onHide&&k.onHide()}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString,r='<div class="ticketRedeemer"><div class="header"></div><div class="icPlaceholder"></div><div class="body"></div></div>',o='<ul class="commands"><li><a href="#" class="same">{0}</a></li><li><a href="{1}" class="switch">{2}</a></li></ul>',a="action",s="alternate",l="/API/2/RedeemPermissionToken",c="Folders_TicketRedeemer";n.TicketRedeemer=e}()}),define("browserstorage",["lightobject"],function(){!function(){var e={},t=window.$Config&&$Config.hcid?"."+$Config.hcid:"";window.BrowserStorage={setSessionValue:function(t,n){try{window.sessionStorage?sessionStorage[t]=Object.toJSON(n):e[t]=Object.toJSON(n)}catch(i){}},getSessionValue:function(t){try{var n;return n=window.sessionStorage?sessionStorage[t]:e[t],n?Object.fromJSON(n):void 0}catch(i){}return void 0},setLocalValue:function(e,n,i){try{window.localStorage&&(i||(e+=t),localStorage[e]=Object.toJSON(n))}catch(r){}},getLocalValue:function(e,n,i){try{if(window.localStorage){i||(e+=t);var r=localStorage[e],o=r?Object.fromJSON(r):void 0;return null!==o&&void 0!==o||void 0===n?o:n}}catch(a){}return n}}}()}),define("imageloader",["defineutilities","trace","retriablepromise","domutilities","workmonitor","elementeventing"],function(){!function(){var e=Shared.WorkMonitor,t=10,n="ImageLoader",r=3,o=[5e3,15e3,3e4];Trace.register(n,{isEnabled:!1});var a="retryid";defineNamespace("Shared.ImageLoader",{_loadedUrls:{},_imageStates:{},_urlQueue:[],_loadAttempts:0,_loadRetryAttempts:0,_loadSuccess:0,_loadError:0,_loadAbort:0,_loadPending:0,loadImagePromise:function(t,i){var a,s=t,l=this,c=0,u=new Shared.RetriablePromise(function(e,r){1===++c?a=Trace.log("Loading image: "+t,n):Trace.logTo(a,"Retrying image (attempt: "+c+", pending: "+l._loadPending+")",n),l.loadImage(s,i,e,r,c>1)},function(){var e=l._imageStates[t];e&&(e.references--,e.references||delete l._imageStates[t])},r,o,null);return u.then(function(){Trace.logTo(a,"Complete",n)},function(){Trace.logTo(a,"Error",n)}),e.monitorPromise([e.StandardTags.Network,e.StandardTags.Network_Image],u),u},loadImage:function(e,t,n,i,r){var o=this;if(t=t||ce("img"),o._loadedUrls[e])t.src=e,n(e,t);else{var a=o._imageStates[e];a?(a.elements.push(t),a.references++,n&&a.callbacks.push(n),i&&a.errorCallbacks.push(i),a.forceDownload=a.forceDownload||r):(r&&o._loadRetryAttempts++,a=o._imageStates[e]={url:e,elements:[t],callbacks:[],errorCallbacks:[],references:1,forceDownload:r},n&&a.callbacks.push(n),i&&a.errorCallbacks.push(i),o._urlQueue.push(e),o.processQueue())}},isIdle:function(){return 0===this._loadPending},isLoaded:function(e){return!!this._loadedUrls[e]},isDomainAccessible:function(){return!0},onError:function(){},processQueue:function(){for(var e=0,n=this;e<n._urlQueue.length&&n._loadPending<t;)if(Shared.ImageLoader.isDomainAccessible(n._urlQueue[e])){var i=n._urlQueue.shift(),r=n._imageStates[i];if(r){var o=r.elements[0],s=i;n._addImageEventHandlers(o),r.forceDownload&&(s+=(-1==i.indexOf("?")?"?":"&")+a+"="+Math.random()),n._loadAttempts++,n._loadPending++,o.s=i,o.src=s}}else e++},_addImageEventHandlers:function(e){return this.addElementListener(e,"load",this._onImageLoad),this.addElementListener(e,"error",this._onImageError),this.addElementListener(e,"abort",this._onImageAbort),e},_removeImageEventHandlers:function(e){this.removeElementListener(e,"load",this._onImageLoad),this.removeElementListener(e,"error",this._onImageError),this.removeElementListener(e,"abort",this._onImageAbort)},_onImageLoad:function(e,t){var n=this,r=e.currentTarget,o=r.s,a=n._imageStates[o];if(n._removeImageEventHandlers(r),n._loadPending--,a){if(t){if(1===t){for(i=0;i<a.errorCallbacks.length;i++)a.errorCallbacks[i](o);Shared.ImageLoader.onError(o)}}else for(n._loadSuccess++,n._loadedUrls[o]=!0,i=0;i<a.callbacks.length;i++)try{i>0&&(a.elements[i].src=o),a.callbacks[i](o,a.elements[i])}catch(s){}delete n._imageStates[o]}this.processQueue()},_onImageError:function(e){this._loadError++,this._onImageLoad(e,1)},_onImageAbort:function(e){this._loadAbort++,this._onImageLoad(e,2)}}),mix(Shared.ImageLoader,Shared.ElementEventing)}()}),define("contentcontrol",["jbase","basecontrol"],function(){!function(){defineSubClass("JBase.UI.ContentControl",JBase.UI.BaseControl,function(){mix(this,{_contentControlType:null,_controlTable:{}})},{controlType:JBase.UI.BaseControl,controlOptions:null,currentControl:null,disposeOnSwap:!1,getControlType:function(){return this.controlType},getControlOptions:function(){return this.controlOptions},getChildDataContext:function(e){return e},onRenderHtml:function(){return this.currentControl?this.currentControl.renderHtml():this.defaultRenderHtml("")},onCurrentControlChanged:function(){},onDataContextChanged:function(e){var t=this.getControlType(e);t&&t.isPromise?t.then(bind(this,this._evaluateControlType)):this._evaluateControlType(t)},_evaluateControlType:function(e){var t=this.dataContext,n=this.currentControl;if(this._contentControlType!==e){var i=ce("div");if(n&&(this.removeChild(n),this.currentControl=null,this.disposeOnSwap?(delete this._controlTable[this._contentControlType.prototype.__fullName],n.dispose()):n.deactivate()),this._contentControlType=e,e){var r=e.prototype.__fullName;n=this.currentControl=this._controlTable[r],n?this.addChild(n):(n=this.currentControl=this._controlTable[r]=this.createChild(e,this.getControlOptions(t)),n.id=this.id,this.onCurrentControlChanged()),n.setDataContext(this.getChildDataContext(t),!0),this.element&&(n.element||(setHtml(i,n.renderHtml()),n.element=i.firstChild),this.element.parentNode&&this.element.parentNode.replaceChild(n.element,this.element),this.element=n.element,this.isActive&&n.activate())}else if(this.element){setHtml(i,this.defaultRenderHtml(""));var o=i.firstChild;this.element.parentNode&&this.element.parentNode.replaceChild(o,this.element),this.element=o}}else n&&n.setDataContext(this.getChildDataContext(t))},onDispose:function(){for(var e in this._controlTable)this._controlTable.hasOwnProperty(e)&&this._controlTable[e].dispose();this._controlTable={}}})}()}),define("repeater",["jbase","basecontrol","imageloader","contentcontrol"],function(){!function(){defineSubClass("JBase.UI.Repeater",JBase.UI.BaseControl,function(){},{childControl:JBase.UI.ContentControl,onRenderHtml:function(){return this.defaultRenderHtml(this._buildHtml())},onDataContextChanged:function(){var e=this;e.element&&(e.element.childNodes.length?e._update():(setHtml(e.element,e._buildHtml()),e.activate(),e._updateKeyToElementMap()))},getChildContext:function(e){var t=e;return e.__isDataContext||(t={item:e}),t},getKeyFromChildContext:function(e){return e.key||(e.item?e.item.key:null)},_updateKeyToElementMap:function(){var e=this,t=e.element.childNodes;e._keyToElement={};for(var n=0;n<t.length;n++){var i=t[n],r=i.control,o=r&&r.dataContext&&r.dataContext.key?r.dataContext.key:null;o&&(e._keyToElement[r.dataContext.key]=i)}},_buildHtml:function(){var e=this,t="";if(e.dataContext){var n=e.dataContext.items;if(e.clearChildren(),n&&e.childControl)for(var i,r=0;r<n.length;r++)i=e.createChild(e.childControl),i.setDataContext(e.getChildContext(n[r],r)),t+=i.renderHtml()}return t},_update:function(){var e=this;if(e.element){var t=e.dataContext.items,n=e._keyToElement||{},i=e.element.childNodes,r={};if(t&&t.length){for(var o=0;o<t.length;o++){var a=t[o],s=this.getChildContext(a,o),l=this.getKeyFromChildContext(s),c=i[o];if(c){var u=c.control&&c.control.dataContext?this.getKeyFromChildContext(c.control.dataContext):null;if(u!=l)if(void 0===n[l])r[l]=e._insertCell(o,s);else{for(var d=-1,f=0;f<t.length;f++){var h=t[f];if(h&&h.key===u){d=f;break}}-1===d?(e._removeCell(c),o--):r[l]=e._insertCell(o,s)}else r[l]=c,c.control&&c.control.setDataContext(s)}else r[l]=e._insertCell(o,s)}for(;i.length>t.length;)this._removeCell(i[i.length-1]);this._keyToElement=r}else e.clearChildren(),setHtml(e.element,"")}},_insertCell:function(e,t){{var n=this,i=n.element,r=n.createChild(n.childControl),o=ce("div");n.dataContext.items}r.setDataContext(t),setHtml(o,r.renderHtml());var a=r.element=o.firstChild;return e>=i.childNodes.length?i.appendChild(a):i.insertBefore(a,i.childNodes[e]),r.activate(),a},_removeCell:function(e){var t=e.control;t&&(t.dispose(),this.removeChild(t)),this.element&&this.element.removeChild(e)}})}()}),define("repeaterv2",["repeater"],function(){!function(){defineSubClass("JBase.UI.RepeaterV2",JBase.UI.BaseControl,function(){},{childControlType:JBase.UI.ContentControl,childControlOptions:{},getChildControlType:function(){return this.childControlType},getChildControlOptions:function(){return this.childControlOptions},onRenderHtml:function(){return this.defaultRenderHtml(this._buildHtml())},onDataContextChanged:function(){var e=this;e.element&&(e.element.childNodes.length?e._update():(setHtml(e.element,e._buildHtml()),e.activate(),e._updateKeyToElementMap()))},getChildContext:function(e){var t=e;return e.__isDataContext||(t={item:e}),t},getKeyFromChildContext:function(e){return e.key||(e.item?e.item.key:null)},_updateKeyToElementMap:function(){var e=this,t=e.element.childNodes;e._keyToElement={};for(var n=0;n<t.length;n++){var i=t[n],r=i.control,o=r&&r.dataContext&&r.dataContext.key?r.dataContext.key:null;o&&(e._keyToElement[r.dataContext.key]=i)}},_buildHtml:function(){var e=this,t="";if(e.dataContext){var n=e.dataContext.itemSet;if(e.clearChildren(),n)for(var i,r=n.getCount(),o=0;r>o;o++){var a=n.get(o);if(!a)break;i=e.createChild(e.getChildControlType(a),e.getChildControlOptions(a)),i.setDataContext(e.getChildContext(a,o)),t+=i.renderHtml()}}return t},_update:function(){var e=this;if(e.element){var t=e.dataContext.itemSet,n=e._keyToElement||{},i=e.element.childNodes,r={},o=0;if(t&&t.getCount()){for(var a=t.getCount();a>o;o++){var s=t.get(o);if(!s)break;var l=this.getChildContext(s,o),c=this.getKeyFromChildContext(l),u=i[o];if(u){var d=u.control&&u.control.dataContext?this.getKeyFromChildContext(u.control.dataContext):null;if(d!=c)if(void 0===n[c])r[c]=e._insertCell(o,l,s);else{var f=t.getByKey(d),h=f?t.indexOf(f):-1;-1===h?(e._removeCell(u),o--):r[c]=e._insertCell(o,l,s)}else r[c]=u,u.control&&u.control.setDataContext(l)}else r[c]=e._insertCell(o,l,s)}for(;i.length>o;)this._removeCell(i[i.length-1]);this._keyToElement=r}else e.clearChildren(),setHtml(e.element,"")}},_insertCell:function(e,t,n){var i=this,r=i.element,o=i.createChild(i.getChildControlType(n),i.getChildControlOptions(n)),a=ce(i.baseTag);o.setDataContext(t),setHtml(a,o.renderHtml());var s=o.element=a.firstChild;return e>=r.childNodes.length?r.appendChild(s):r.insertBefore(s,r.childNodes[e]),o.activate(),s},_removeCell:function(e){var t=e.control;t&&(t.dispose(),this.removeChild(t)),this.element&&this.element.removeChild(e)}})}()}),define("imagestriphelper",["repeaterv2"],function(){!function(){var e=[],t=[],n={};defineNamespace("JBase.UI.ImageStripHelper",{registerStrip:function(n,i){e.push(n),t.push(i)},getImageInfo:function(i,r,o){var a;if(i&&(a=n[i],!a)){for(var s=0,l=-1;s<t.length&&-1==l;)l=t[s].hasOwnProperty(i)?s:-1,s++;if(l>=0){var c=t[l][i];a=n[i]={url:e[l],containerSize:{width:c.w,height:c.h},imagePosition:{left:-c.x,top:-c.y}}}}return a?{url:a.url,containerSize:a.containerSize,imagePosition:a.imagePosition,alt:r,title:o}:null}})}()}),define("imagesizehelper",["imagestriphelper"],function(){!function(){var e=.5;defineNamespace("JBase.UI.ImageSizeHelper",{scaleToContainer:function(e,t,n,i,r){var o={};if(e.width=e.width||n&&n.width||0,e.height=e.height||n&&n.height||0,e.width&&e.height){var a=e.width/e.height,s=t.width/t.height;if(!i&&a>s||i&&s>a){var l=n&&!r?Math.min(n.width,t.width):t.width;o={width:l,height:Math.ceil(l*(1/a))}}else{var c=n&&!r?Math.min(n.height,t.height):t.height;o={width:Math.ceil(c*a),height:c}}}return o},centerPosition:function(t,n,i,r){var o=t.width>n.width,a=t.height>n.height;i=o&&void 0!==i?i:e,r=a&&void 0!==r?r:e;var s=Math.round(.5*n.height-t.height*r),l=Math.round(.5*n.width-t.width*i),c={left:o?Math.min(0,l):l,top:a?Math.min(0,s):s,width:t.width,height:t.height};return c},swapWidthAndHeight:function(e){return{left:e.left,top:e.top,width:e.height,height:e.width}}})}()}),define("imagetile.css",["registerstyle","imagesizehelper"],function(){registerStyle("/* Root image tile style. */\r\n.c-ImageTile\r\n{\r\n    display: inline-block;\r\n    position: relative;\r\n    overflow: hidden;\r\n}\r\n\r\n/* Image within the tile container. */\r\n.c-ImageTile img \r\n{     \r\n    position: absolute;\r\n    opacity: 0;\r\n    left: 0; /* This works in RTL as well, it's just a default position required for Safari RTL. */\r\n    top: 0;\r\n}\r\n\r\n/* Visible state. */\r\n.c-ImageTile img.visible\r\n{\r\n    opacity: 1;\r\n}\r\n\r\n/* Visible animated state. */\r\n.c-ImageTile img.animated\r\n{\r\n    opacity: 1;\r\n    animation-name: imageTileFadeIn;\r\n    -ms-animation-name: imageTileFadeIn;\r\n    -webkit-animation-name: imageTileFadeIn;\r\n    -moz-animation-name: imageTileFadeIn;\r\n}\r\n\r\n/* Disabling image animations in Chrome when the language picker is visible. */\r\n.Chrome.langPickerVisible .c-ImageTile img.animated\r\n{\r\n   animation-name: none;\r\n    -ms-animation-name: none;\r\n    -webkit-animation-name: none;\r\n    -moz-animation-name: none;\r\n}")}),define("imagetile",["imagetile.css"],function(){!function(e){function t(e){return e?generateStyleAttribute("width.px",e.width,"height.px",e.height,"left.px",e.left,"right.px",e.right,"top.px",e.top):""}var n=JBase.UI.ImageSizeHelper,i="visible",r="animated",o={url:""},a=.5,s=Shared.ImageLoader,l="keyframes imageTileFadeIn {0% { opacity: 0; }100% { opacity: 1; }}";registerStyle(".c-ImageTile > img { filter: alpha(opacity=0); }.c-ImageTile > img.visible { filter: alpha(opacity=100); }@"+l+"@-ms-"+l+"@-moz-"+l+"@-webkit-"+l);var c=!($B.IE&&$B.V<10||$B.SF_iPhone&&$B.rtl);defineSubClass("JBase.UI.ImageTile",JBase.UI.BaseControl,function(){mix(this,{scaleToFit:!1,_currentUrl:null,_lastLoadedImage:null,_loadingImagePromise:null,thumbnailStyle:null,_lastLoadedUrl:null,_purgeTimeout:null,_renderedImageHtml:!1,_rotationClass:null})},{baseTag:"span",imageAnimationDuration:null,horizontalCenterRatio:a,verticalCenterRatio:a,allowStretching:!1,onRenderHtml:function(){var e="",t=this.dataContext||o;return t.url&&s.isLoaded(t.url)&&!this._lastLoadedImage&&(this._renderedImageHtml=!0,e="<img "+(t.alt?' alt="'+htmlAttributeEncode(t.alt)+'"':"")+(t.title?' title="'+htmlAttributeEncode(t.title)+'"':"")+' src="'+htmlAttributeEncode(t.url)+'" class="'+i+'" style="'+this.thumbnailStyle+'" />'),this.defaultRenderHtml(e)},onActivate:function(){var e=this;e._lastLoadedImage&&e._onImageAvailable(e._lastLoadedUrl,e._lastLoadedImage),e._renderedImageHtml&&e.element&&(e._currentImage=e.element.children[0],e._renderedImageHtml=!1)},onDispose:function(){this._loadingImagePromise&&this._loadingImagePromise.cancel(),this._loadingImagePromise=null},onDataContextChanged:function(e){e=e||o,e.url!=this._currentUrl&&(this._currentUrl=e.url,this._currentImage=null,this.imageAnimationDuration&&e.url||this.element&&setHtml(this.element,""),(this.isActive||!s.isLoaded(e.url))&&this._loadImage(e.url)),this._updateContentSize()},onImageLoaded:function(){},_loadImage:function(e){var t=this;t._loadingImagePromise&&t._loadingImagePromise.cancel(),e&&(t._loadingImagePromise=s.loadImagePromise(e,null),t._loadingImagePromise.then(bind(this,this._onImageAvailable)))},_onImageAvailable:function(e,t){var n=this,r=this.dataContext;e===n._currentUrl&&(n._loadingImagePromise=null,n.isActive?(n.element&&(n._currentImage=t,t.alt=r.alt||"",t.title=r.title||"",!n.imageAnimationDuration&&(t.className=i),n._updateContentSize(),n.element.appendChild(t),n.onImageLoaded&&n.onImageLoaded(),n.imageAnimationDuration&&n._fadeInImage()),n._lastLoadedImage=n._lastLoadedUrl=null):(n._lastLoadedImage=t,n._lastLoadedUrl=e))},_fadeInImage:function(){var t=this;t.imageAnimationDuration&&(c?setTimeout(function(){if(t._currentImage){var e=t._currentImage.style;e.animationDuration=e.msAnimationDuration=e.webkitAnimationDuration=e.MozAnimationDuration=t.imageAnimationDuration/1e3+"s",t._currentImage.className=r}},20):e(t._currentImage).css("opacity",0).animate({opacity:1},t.imageAnimationDuration,function(){t._currentImage&&(t._currentImage.className=i)}),clearTimeout(t._purgeTimeout),t._purgeTimeout=setTimeout(function(){t._currentImage&&(t._currentImage.className=i),t._purgeHiddenImages()},t.imageAnimationDuration+20))},_updateContentSize:function(){var e=this.dataContext||{},i=e.containerSize,r=e.imagePosition,o=e.originalSize,a=e.rotation||0;r&&void 0===r.left&&void 0===r.top&&(a%2!=0&&(r=n.swapWidthAndHeight(r),o=o&&n.swapWidthAndHeight(o)),r=n.scaleToContainer(r,i,o,!this.scaleToFit,this.allowStretching),r=n.centerPosition(r,i,this.horizontalCenterRatio,this.verticalCenterRatio),a%2!=0&&(r=n.swapWidthAndHeight(r))),this.baseStyle=t(i),this.thumbnailStyle=t(r),this.element&&(this.element.style.cssText=this.baseStyle),this._currentImage&&(this._currentImage.style.cssText=this.thumbnailStyle)&&this._updateRotationClass(a)},_purgeHiddenImages:function(){if(this.element)for(;this.element.childNodes.length>1;)this.element.removeChild(this.element.children[0])},_updateRotationClass:function(e){if(this._currentImage&&(e||this._rotationClass)){var t=e?"rotate"+Math.round(90*e):"";this._currentImage.className=this._rotationClass?this._currentImage.className.replace(this._rotationClass,t):this._currentImage.className+" "+t,this._rotationClass=t}}})}(window.originaljQuery||jQuery)}),define("customlayoutprovider",["jbase","basecontrol","imagetile","datarequest"],function(){!function(){var e=wLive.Core,t=500,n="divider";defineNamespace("SkyDrive.Core.CustomLayoutType",{item:0,divider:1}),defineClass("SkyDrive.Core.CustomLayoutProvider",function(e){mix(this,{ownerCid:e,enabled:!1,_pendingRequests:{}})},{propertyId:"SkyDrive",getLayout:function(t){function n(n,i){function a(e){delete r._pendingRequests[t],n&&n(e)}r._pendingRequests[t]||(o=new e.DataRequest(t,t,null,a,i,null,3,1,!0),o.apiId="Skydrive_GetCustomLayout",o.propertyId=r.propertyId,o.start(),r._pendingRequests[t]=o)}function i(){delete r._pendingRequests[t],o&&o.abort()}var r=this,o=null;return new Shared.Promise(n,i)},updateLayout:function(e,t){for(var i=this,r=e.getCount(),o=e.getParent(),a=[],s=0,l=0;r>l;l++){var c=e.get(l);s||(s=c.id.indexOf("!")+1),a.push({id:c.id.substring(s),w:c.customWidth,h:c.customHeight})}for(var u=e.getGroupings()[0],d=u&&u.itemGroups,f=1;d&&f<d.length;f++){var h=d[f];h.groupingId==n&&a.insert(h.startIndex+f-1,{type:SkyDrive.Core.CustomLayoutType.divider,val:h.name})}var p={items:a,syncToken:t};o.folder.layoutUrl||(o.folder.layoutUrl="dummy");var g=o.rootResourceId||o.id;return p.syncToken?i._callUpdateLayout(p,g):i.getCurrentSyncToken(g).then(function(e){return mix(p,{syncToken:e}),i._callUpdateLayout(p,g)},function(){return i._callUpdateLayout(p,g)})},clearLayout:function(e){return this._callUpdateLayout("",e)},getChanges:function(n,i){function r(r,o){function l(e){r&&r(e)}var c=FilesConfig.baseApiUrl+"GetChanges?id={0}&token={1}&ps={2}".format(encodeURIComponent(n),encodeURIComponent(i||""),t);a=new e.DataRequest(c,c,null,l,o),a.apiId="SkyDrive_Json_GetCustomLayoutChanges",a.propertyId=s.propertyId,a.start()}function o(){a&&a.abort()}var a=null,s=this;return new Shared.Promise(r,o)},getCurrentSyncToken:function(t){function n(n,i){function a(e){n&&n(e&&e.token)}var s=FilesConfig.baseApiUrl+"GetCurrentToken?id={0}".format(encodeURIComponent(t));r=new e.DataRequest(s,s,null,a,i),r.apiId="SkyDrive_Json_GetCurrentToken",r.propertyId=o.propertyId,r.start()}function i(){r&&r.abort()}var r=null,o=this;return new Shared.Promise(n,i)},_callUpdateLayout:function(t,n){function i(i,r){var s=FilesConfig.baseApiUrl+"UpdateCustomLayout?ownerCid={0}&id={1}".format(encodeURIComponent(o.ownerCid),encodeURIComponent(n));a=new e.DataRequest(s,s,Object.toJSON(t),i,r,null,null,null,null,null,!0),a.apiId="SkyDrive_Json_UpdateCustomLayout",a.propertyId=o.propertyId,a.start()}function r(){a&&a.abort()}var o=this,a=null;return new Shared.Promise(i,r)}})}()}),define("stringhelpers",["jquery-1.7.2","browserstorage","pagestats","jbase","basecontrol","validateconfig","lightobject","alehelpers","datarequest","bicihelpers","viewcontext","customlayoutprovider","imagestrip"],function(){!function(){wLive.Core.StringHelpers={caseInsensitiveStringEquals:function(e,t){return e==t?!0:null==e||null==t?!1:e.toLowerCase()==t.toLowerCase()}}}()}),define("throttle",["stringhelpers"],function(){!function(){var e={},t={};wLive.throttle=function(n,i,r,o){function a(){e[n]=setTimeout(function(){r(),delete e[n],o&&t[n]&&(r=t[n],delete t[n],a())},i)}return o&&e[n]?(t[n]=r,void 0):(e[n]&&clearTimeout(e[n]),a(),void 0)}}()}),define("skydriveitemset",["throttle"],function(){!function(){function e(e,t){var n=t._headerItemsSet&&e&&-1!==t._headerItemsSet.indexOf(e);return n&&i.push({set:t,headerSet:t._headerItemsSet,item:e}),!n}function t(e,t,n,i){for(var r=e+1;r<t.length;r++){var o=t[r];if(!(o.startIndex<=n.endIndex+1))break;if(o.mergeUp){if(i.endIndex<o.endIndex){var a=o.endIndex-i.endIndex;i.mergeDown=o.mergeDown,i.count+=a,i.endIndex+=a}o.count=-1,o.startIndex=-1,o.endIndex=-1}else{if(!o._filler)break;if(i.endIndex<o.endIndex){var s=o.endIndex-i.endIndex;o.count-=s,o.startIndex+=s}else o.count=-1,o.startIndex=-1,o.endIndex=-1}}}var n=wLive.Core,i=[];s_infiniteScrollBuffer=20;var r="SkyDriveItemSet",o="headerFilter",a=Shared.ItemSet.prototype;defineSubClass("SkyDrive.Core.SkyDriveItemSet",Shared.ItemSet,function(t,i,r){var a=this;a._dataModel=t,a._parentItemKey=i,a._setKey=r,a.setKeyParts=n.SkyDriveItem.getSetKeyParts(r),a._headerItemsSet=null,a.setFilter(o,e)},{modifiedDate:"-1",defaultGroupName:"FolderDocumentsPhotos",groupings:null,_rawCount:void 0,firstGroupingId:"folder",hasPendingRequests:function(){var e=this;return e._dataModel.hasPendingRequests(e._parentItemKey,e._setKey)},setHeaderItemsSet:function(e){var t=this;t._headerItemsSet&&t.removeChangeListener(t._headerItemsSet),t._headerItemsSet=e,e&&this.addChangeListener(e,t._onChildChanged)},isOutOfDate:function(){var e=this,t=!1,n=e.getParent(!0);if(n&&n.folder&&!n.neverExpires){var i=n&&n.modifiedDate!=e.modifiedDate,r=n&&0===n.folder.totalCount&&0===e._childCount,o=e.setKeyParts.tagFilter;t=n&&(n.hasExpired()||i&&(!r||o))}return t},peek:function(e,t){return this._get(e,t,!0)},get:function(e,t){return this._get(e,t,!1)},_get:function(e,t,n){var i=this,o=null,s=!1,l=!1,c=i._dataModel,u=i._parentItemKey,d=i._setKey,f=i._headerItemsSet,h=i.getCount(t),p=i._filteredIndexToActualIndex,g=i.isOutOfDate();if(f&&f.getCount()>0&&(f.getCount()>e?(o=f.get(e,t),s=!0):e-=f.getCount()),s||(o=a.get.call(i,e,t),l=!o&&e>=0&&h>e),o&&o.hasExpired()&&i.parentShouldBeExpiredOnGet()){g=!0;var m=o.getParent(!0);m&&m.expire(!1,!0)}if(!n&&(l||g)){var v=e;t||void 0===p[e]||(v=p[e]),c.fetchItem(u,d,null,v)&&Trace.log("get miss - index: "+e+", exists: "+!!o+", setExpired: "+g+", setKey: "+d,r)}return o&&(o.parentKey=u),o},parentShouldBeExpiredOnGet:function(){return!0},getCount:function(e){var t=this,n=t._headerItemsSet,i=a.getCount.call(t,e);return n&&(i+=n.getCount()),t.isOutOfDate()&&!i&&!t._materializedCount&&(i=1),i},getRawCount:function(){return this._rawCount||this.getCount()},setCount:function(e){var t=this,n=t.getParent(!0);if(!n||n.hasMoreResults!==!0&&n.hasMoreResults!==!1)a.setCount.call(t,e);else{var i=t._rawCount,r=n.folder.totalCount,o=n.folder.totalCount,s=t._childCount;if(n.hasMoreResults&&(i>r&&(r=i),s>=o?o=s:o+=s_infiniteScrollBuffer),t._rawCount=r,t._childCount=t._filteredCount=o,t._requiresFilter=!0,s>o)for(var l=s-1;l>=o;l--)t._indexToItem[l]&&t._materializedCount--,delete t._indexToItem[l]}},getGroupings:function(e){var t,n,i=this,r=i._headerItemsSet,o=a.getGroupings.call(i,e);if(r&&(n=r.getCount(e))){for(var s=[],l=0;l<o.length;l++){var c=o[l],u={name:c.name,itemGroups:[],partial:c.partial};s.push(u);var d=c.itemGroups;if(0==d.length||d[0].groupingId!=i.firstGroupingId){u.itemGroups.push({groupingId:i.firstGroupingId,startIndex:0,endIndex:n-1,count:n});for(var f=0;f<d.length;f++)t=d[f],u.itemGroups.push({groupingId:t.groupingId,startIndex:t.startIndex+n,endIndex:t.endIndex+n,count:t.count})}else for(var h=0;h<d.length;h++)t=d[h],u.itemGroups.push({groupingId:t.groupingId,name:t.name,startIndex:t.startIndex?t.startIndex+n:0,endIndex:t.endIndex+n,count:t.groupingId==i.firstGroupingId?t.count+n:t.count})}o=s}return n=this.getCount(e),n&&!o.length&&o.push({groupingId:"other",startIndex:0,endIndex:n-1,count:n}),o},getParent:function(e){var t=this,n=t._dataModel;return n?n.getItem(t._parentItemKey,e):null},indexOf:function(e,t,n){var i=this,o=i._headerItemsSet,s=i._dataModel,l=i._parentItemKey,c=i._setKey,u=i.isOutOfDate(),d=-1;return o&&(d=o.indexOf(e,t)),-1==d&&(d=a.indexOf.call(i,e,t),n||-1!==d&&!u||s.fetchItem(l,c,e.id,0)&&Trace.log("indexOf miss - id: "+e.id+", setExpired: "+u+", setKey: "+c,r),o&&-1!==d&&(d+=o.getCount(t))),d},remove:function(e){var t=this,n=t.indexOf(e,!0,!0);-1!=n&&t.removeAt(n,!0)},removeAt:function(e,t){var n=this._headerItemsSet;if(n){var i=n.getCount();i>e?n.removeAt(e,t):a.removeAt.apply(this,[e-i,t])}else a.removeAt.apply(this,arguments)},insertWithGroupHint:function(e,t,n,i){var r=this._headerItemsSet;if(r){var o=r.getCount();o>e?r.insertWithGroupHint(e,t,n,i):a.insertWithGroupHint.apply(this,[e-o,t,n,i])}else a.insertWithGroupHint.apply(this,arguments)},clone:function(){var e=this,t=new SkyDrive.Core.SkyDriveItemSet(e._dataModel,e._parentItemKey,e._setKey),n=a.get;t.groupings=this.groupings;for(var i=0;i<e.getCount();i++){var r=n.call(e,i);r&&t.set(i,r)}t.modifiedDate=e.modifiedDate;var o=e._headerItemsSet,s=new Shared.ItemSet;if(o)for(i=0;i<o.getCount();i++){var l=o.peek(i);l&&s.set(i,l)}return t.setHeaderItemsSet(s),t},isComplete:function(){var e=this;return e._materializedCount===e._childCount},sort:function(){for(var e=this,t=n.SkyDriveItem.getSetKeyParts(e._setKey),i=[],r=0;r<e.getCount();r++){var o=e.peek(r);i.push(o)}var a=i.sort(function(e,i){function r(e,t){var i=n.JSONConstants.SortField;switch(t){case i.ModifiedDate:return e.dateModifiedOnClient||0;case i.CreatedDate:return e.creationDate||0;case i.Size:return e.size||0}}var o=t.sr;t.sd&&(o=t.sd==n.JSONConstants.SortDirection.Default);var a=o?r(e,t.sb):r(i,t.sb),s=o?r(i,t.sb):r(e,t.sb),l=a-s;return e.folder&&!i.folder?-1:!e.folder&&i.folder?1:!e.video&&!e.photo||i.photo||i.video?!i.video&&!i.photo||e.photo||e.video?l:-1:1});for(r=0;r<a.length;r++)e.set(r,a[r])},_mergeGroupingsFromServer:function(e,n){var i=this,r=this.getCount(!0);(n||!i.groupings)&&(i.groupings=e);for(var o=0;o<e.length;o++){for(var a,s=e[o],l=i.groupings,c=0;c<l.length;c++)l[c].name===s.name&&(a=l[c]);if(a||(a=e[o],i.groupings.push(e[o])),s.partial){var u=[],d=s.itemGroups;if(n){if(d.length>0){var f=d[0];0!==f.startIndex&&u.push({groupingId:"other",startIndex:0,endIndex:f.startIndex-1,count:f.startIndex,__filler:!0});for(var h=0;h<d.length;h++){var p=d[h];p.endIndex=p.startIndex+p.count-1,u.push(p)}var g=d[d.length-1],m=g.startIndex+g.count-1;m!==r-1&&u.push({groupingId:"other",startIndex:m+1,endIndex:r-1,count:r-m-1,__filler:!0})}}else for(var v=a.itemGroups,y=d.length>0?d[0]:null,_=0;_<v.length;_++){var w=v[_];if(y&&y.startIndex<=w.endIndex&&w.__filler){for(var b=0;b<d.length;b++){var C=d[b];if(C.endIndex=C.startIndex+C.count-1,C.startIndex<=w.endIndex&&C.endIndex>=w.startIndex)if(C.startIndex<=w.startIndex){var S=C;
if((C.mergeUp||C.startIndex<w.startIndex)&&_>0&&v[_-1].mergeDown){var k=C.count-(w.startIndex-C.startIndex);S=v[_-1],S.count+=k,S.endIndex+=k,S.mergeDown=C.mergeDown,w.count-=k,w.startIndex+=k}else u.push(C),w.count-=C.count,w.startIndex+=C.count;if(w.count<=0){t(_,v,C,S);break}}else if(u.push({groupingId:"other",startIndex:w.startIndex,endIndex:C.startIndex-1,count:C.startIndex-w.startIndex,__filler:!0}),u.push(C),w.startIndex=C.endIndex+1,w.count=w.endIndex-w.startIndex+1,w.count<=0){t(_,v,C,C);break}}w.count>0&&u.push(w)}else w.count>0&&u.push(w)}a.itemGroups=u}}}},{removeMarkedHeaderItems:function(){for(;i.length>0;){var e=i.pop(),t=e.set,n=e.headerSet,r=e.item;n.remove(r),t._requiresFilter=!0}},setInfiniteScrollBuffer:function(e){s_infiniteScrollBuffer=e}})}()}),define("customlayoutitemset",["skydriveitemset"],function(){!function(){var e=wLive.Core,t=Shared.ItemSet.prototype,n="CustomLayoutItemSet",i="placeholder",r="Dividers";defineClass("SkyDrive.Core.CustomLayoutItem",function(){},{w:0,h:1,val:0,type:1}),defineSubClass("SkyDrive.Core.CustomLayoutItemSet",SkyDrive.Core.SkyDriveItemSet,function(t,n,i,r){var o=this;if(o._dataModel=t,o._parentItemKey=n,o._setKey=i,o._customLayoutProvider=new SkyDrive.Core.CustomLayoutProvider($Config.cid),o.setKeyParts=e.SkyDriveItem.getSetKeyParts(i),o._headerItemsSet=null,r){for(var a=r.getCount(),s=0;a>s;s++){var l=r.get(s);l&&o.set(s,l)}o.modifiedDate=r.modifiedDate;var c=r._headerItemsSet;if(c){var u=new Shared.ItemSet,d=c.getCount();for(s=0;d>s;s++){var f=c.peek(s);f&&u.set(s,f)}o.setHeaderItemsSet(u)}}},{hasCustomLayout:!0,_customLayoutFetched:!1,_syncToken:"",_pageSize:100,firstGroupingId:"placeholder",_get:function(e,t,i){var r=this,o=r.getParent(!0);if(r._customLayoutFetched=r._customLayoutFetched||!o.folder.layoutUrl,r._customLayoutFetched||!o||i){if(r._customLayoutFetched)return r._syncToken&&o&&r._customLayoutProvider.getChanges(o.id,r._syncToken).then(function(e){r._mergeChanges(e)}),r._startGet(e,t,i)}else Trace.log("Custom layout not yet fetched, starting retrieval",n),r._customLayoutProvider.getLayout(o.folder.layoutUrl).then(function(o){Trace.log("Custom layout fetched successfully, applying layout to existing item set",n),r._customLayoutFetched=!0,r._syncToken=o&&o.syncToken,r.applyLayout(o&&o.items),r._startGet(e,t,i)},function(){Trace.log("Custom layout could not be retrieved!",n),r._startGet(e,t,i)});return null},_startGet:function(e,i,r){var o=this,a=null,s=!1,l=!1,c=o._dataModel,u=o._parentItemKey,d=o._setKey,f=o._headerItemsSet,h=o.getCount(i),p=o._filteredIndexToActualIndex,g=o.isOutOfDate(),m=[];if(f&&f.getCount()>0&&(f.getCount()>e?(a=f.get(e,i),s=!0):e-=f.getCount()),s||(a=t.get.call(o,e,i),l=!a&&e>=0&&h>e),a){var v=o.getParent(!0);if(a.isLayoutItem){g=!0;for(var y=Math.floor(e/o._pageSize)*o._pageSize,_=y;h>_&&m.length<o._pageSize;_++)a=t.get.call(o,_,i),a&&a.isLayoutItem&&m.push(a.id.replace(v.ownerCid+"!",""))}else a.hasExpired()&&o.parentShouldBeExpiredOnGet()&&(g=!0,v&&v.expire(!1,!0))}if(!r&&(l||g)){var w=e,b=null;m.length>0?(b="&"+$Utility.serialize({filterIds:m}),w=0):i||void 0===p[e]||(w=p[e]),c.fetchItem(u,d,null,w,null,null,null,null,1,b)&&Trace.log("get miss - index: "+e+", exists: "+!!a+", setExpired: "+g+", setKey: "+d,n)}return a&&(a.parentKey=u),a&&!a.isLayoutItem?a:null},set:function(e,n){var i=this,r=e,o=i.getByKey(n&&n.key);return o&&(r=i._keyToFilteredIndex[n.key],mix(n,{customWidth:o.customWidth||o.w,customHeight:o.customHeight||o.h})),t.set.apply(this,[r,n])},setCount:function(n){var i=this,r=i.getParent(!0);r&&r.folder&&(n=this.setKeyParts.ft==e.JSONConstants.FilterType.PhotosAndVideos?r.folder.photoCount:r.folder.totalCount),t.setCount.call(i,n)},_mergeGroupingsFromServer:function(){},applyLayout:function(t){for(var n=this,o=!1,a=[{startIndex:0,groupingId:i}],s=0,l=0;t&&s<t.length;s++){var c=t[s];if(c.type>SkyDrive.Core.CustomLayoutType.item){var u=a[a.length-1];u&&l-u.startIndex>0&&(u.endIndex=l-1,u.count=l-u.startIndex,a.push({startIndex:l,name:c.val,groupingId:"divider"}))}else{var d=n.getParent(!0);c.key=e.SkyDriveItem.getItemKey(d.ownerCid+"!"+c.id,d.ownerCid);var f=n.getByKey(c.key);f?(mix(f,{customWidth:c.w,customHeight:c.h}),n.remove(f),n.insert(l,f),o=!0):(c.isLayoutItem=!0,n.insert(l,c)),l++}}var h=a[a.length-1];h&&(h.endIndex=n.getCount()-1,h.count=h.endIndex-h.startIndex+1),n.groupings=n._filteredGroups=[{itemGroups:a,name:r}],o&&n.invalidate()},createDivider:function(t){if(!this.groupings){var n=this.getCount();this.groupings=[{itemGroups:[{startIndex:0,endIndex:n-1,count:n,groupingId:i}],name:r}]}for(var o=this.groupings[0],a=o.itemGroups,s=a&&a[0],l=null,c=0,u=0,d=0;a&&d<a.length;d++){var f=a[d];if(f.count>1&&(c=d,l=f),u=f.endIndex-t,0==u){s=l,t=l?l.endIndex-1:-1,u=1;break}if(u>0){s=f,c=d;break}}s&&(a.splice(c+1,0,{name:e.AleHelpers.getPCString("CustomLayout.DividerDefaultText"),groupingId:"divider",count:u,startIndex:t+1,endIndex:s.endIndex,data:{autoFocus:!0}}),s.count-=u,s.endIndex=t,this._requiresFilter=!0,this.invalidate())},updateDivider:function(e,t){var n=this.groupings[0],i=n&&n.itemGroups,r=i&&i[e];r&&r.name!=t&&(r.name=t,this._requiresFilter=!0,this.updateLayout())},updateLayout:function(){this._customLayoutProvider.updateLayout(this,this._syncToken)},_mergeChanges:function(t){var i=!1,r=this.getCount(),o=this.getParent(!0),a=t.changedItems;Trace.log("Merging changes: number of changed items "+(a?a.length:0),n);for(var s=0;a&&s<a.length;s++){var l=a[s],c=e.SkyDriveItem.getItemKey(l.id),u=this.getByKey(c,!0);if(!u&&o.id==l.parentId){var d=new wLive.Core.SkyDriveItem(this._dataModel,c,o.key);d.processItem(l),this.insert(r++,d),i=!0}}var f=t.deletedItems;Trace.log("Merging deletions: number of deleted items "+(f?f.length:0),n);for(var h=0;f&&h<f.length;h++){var p=this.getByKey(e.SkyDriveItem.getItemKey(f[h].id),!0);p&&(this.remove(p),i=!0)}this._syncToken=t.token,i&&(this.invalidate(),this.updateLayout())}})}()}),define("skydriveitem",["customlayoutitemset"],function(){!function(){function e(e,n){var i=e.parentKey,r=e.key,o=e.snippet,a=e.highlights,s=e.directlyShared,l={};t(l,e.keyParts,1),t(e,n,1),delete e.partialData,e.parentKey=i,e.key=r,e.keyParts=l,e.snippet=o,e.highlights=a,e.directlyShared=s}function t(e,n,i){for(var r in n){var o=n[r];if(o&&"object"==typeof o&&!Object.isArray(o)&&i>0){var a=e[r]=e[r]||{};t(a,o,i-1)}else e[r]=o}}function n(e){if(U&&e)for(var t=0;t<U.length;t++)if(e.id===U[t].id)return!1;return!0}function i(e,t){if("shared"==t.qt){if(!U&&(U=l.getLocalValue(m))){for(var i=new Date,r=0;r<U.length;r++){var o=U[r];new Date(o.expire)<i&&(U.splice(r,1),r--)}l.setLocalValue(m,U)}e.setFilter("abdicatedItems",n)}}function r(e){var t=e.folder;t&&(t.covers=t.covers||null,t.hasSubfolders=t.hasSubfolders?!0:!1),e.isProcessingVideo=e.isProcessingVideo||!1}function o(e,t){var n=a.JSONConstants.FilterType,i=e.totalCount,r=a.SkyDriveItem.getSetKeyParts(t),o=r?r.ft:"";return o==n.AllFolders?i=void 0!==e.folderCount?e.folderCount:e.hasSubfolders?1:0:o==n.PhotosAndVideos&&void 0!==e.photoCount&&(i=e.photoCount),void 0!==i?i:1}var a=wLive.Core,s=(a.AleHelpers.getPCString,a.AleHelpers.getString),l=window.BrowserStorage,c="SkyDriveItem",u="root",d="default",f="NonEmptyDocumentFolder",h=wLive.Core.AleHelpers.getPCString("SkyDriveProductName"),p=0,g="SkyDriveItem",m="SkyDrive.AbdicatedItems",v="shared",y="sharedby",_="allmyphotos",w="search",b="mru",C="recent",S="recyclebin",k=s("DocsSharedWithMe"),I=s("RecentDocuments"),x=s("RecycleBin"),T=s("SharedWithGroup"),L=s("SearchResults"),P=s("SharedLandingPage"),D=s("AllMyPhotosLandingPage"),E=s("RecentActivity"),$=s("AllFilesRootTitle"),A=s("AllFilesVisitorRootTitle"),F=0,N="rd,1",M=12e4,B=36e7,R={},H={},O=null,U=null,j="f",W="p",Q="r",V="a",q="h",G="s",z="d",K="b",J="y",X="cl",Y=FilesConfig.customLayoutEnabled;defineClass("wLive.Core.SkyDriveItem",function(e,t,n,i){t==n&&(n=null);var r=this;r.instance=p++,r._dataModel=e,r.key=t,r.specialFolderKey=i,r.keyParts=a.SkyDriveItem.getItemKeyParts(t),r.parentKey=n,r.id=r.keyParts.id,r.did=r.keyParts.did,r.documentFormat=wLive.Core.SkyDriveItem.DocumentFormat.Default,r.name=r._getNameForItem(r.keyParts)},{__isObservable:!0,commands:null,parentId:null,ghostId:null,modifiedDate:-1,name:null,extension:null,orderedFriendlyName:null,ownerName:null,ownerCid:null,resourcePartitionCid:null,iconType:null,isUnknownFileType:!1,folder:null,sharingLevel:null,group:null,groupFolderType:0,hasPendingGroupJoinRequest:null,userInvitedToGroupOnDifferentEmail:null,userRole:null,partialData:null,hasMoreResults:null,neverExpires:null,estimatedResultCount:null,directlyShared:null,snippet:null,sharingRootResourceId:null,highlights:null,textEditorMimeType:null,tokenNeedsRedeeming:!1,photo:null,video:null,dateLastActioned:null,recentAction:null,ocr:null,tags:null,downloadUrl:null,downloadUrlTimestamp:0,quotaRemaining:0,recycledSharedItemInfo:null,thumbnailSet:null,isAlbum:!1,_isLoadingItem:!1,_missingName:!0,_expirationDate:0,_isNewFolder:!1,_childSets:null,_headerItemsSet:null,_dataContext:null,_version:0,processItem:function(e){var n=this,i=!1;if(this._isNewFolder=!1,void 0===e.modifiedDate||e.modifiedDate>=n.modifiedDate||this.parentId!=e.parentId){if(r(e),this.parentKey&&this.parentId!=e.parentId){var o=a.SkyDriveItem.getItemKeyParts(this.parentKey),s=a.SkyDriveItem.getItemKey(this.parentId,o.cid,o.group,null,null,o.q,o.sft);s==this.parentKey&&(this.parentKey=a.SkyDriveItem.getItemKey(e.parentId,o.cid,o.group,o.qt,o.did,o.q,o.sft))}var l=a.GroupFolderType.None;e.groupFolderType&&(l="OriginalSyncRoot"==e.groupFolderType?a.GroupFolderType.OriginalSyncRoot:"MountPoint"==e.groupFolderType?a.GroupFolderType.MountPoint:a.GroupFolderType.None);var c=this.folder?this.folder.totalCount:-1,u=l==a.GroupFolderType.MountPoint&&!!e.folder&&!e.folder.totalCount,h=e.folder&&!u?e.folder.totalCount:-1;(e.modifiedDate!=n.modifiedDate||h!=c||e.sharingLevel!=n.sharingLevel||e.ocr&&(!n.ocr||e.ocr.engineVersion!=n.ocr.engineVersion)||e.quotaRemaining&&e.quotaRemaining!=n.quotaRemaining)&&(n._version++,i=!0);var p=null;e.folder&&(p=e.folder.children,delete e.folder.children),t(n,e,1),n.groupFolderType=l,p&&(e.folder.children=p),e.folder&&(!n._childSets&&(n._childSets={}),!n._headerItemsSet&&(n._headerItemsSet=new Shared.ItemSet)),n.itemStatus=e.itemStatus||0,n.folder&&(n.folder.totalCount=h),n._missingName=!e.name,n.name=n._getNameForItem(n.keyParts),n.parentId=e.parentId,n.resourcePartitionCid=e.resourcePartitionCid?e.resourcePartitionCid:"",e.sharingRootResourceId&&(n.sharingRootResourceId=e.sharingRootResourceId);var g=n.isViewerOwner();if(!n.ownerName&&(n.ownerName=g?FilesConfig.userDisplayName:""),!n.ownerCid&&(n.ownerCid=n.keyParts.cid),!n.iconType&&(n.iconType=e.folder?f:d),n.isUnknownFileType=a.StringHelpers.caseInsensitiveStringEquals(n.iconType,d),e.docFormat&&1==e.docFormat&&(n.documentFormat=a.SkyDriveItem.DocumentFormat.ODF),n.thumbnailSet&&n.thumbnailSet.thumbnails){var m=!!FilesConfig.thumbnailCropEnabled;if(n.photo&&!m)n.thumbnailSet.size={width:n.photo.width,height:n.photo.height};else for(var v=0;v<n.thumbnailSet.thumbnails.length;v++){var y=n.thumbnailSet.thumbnails[v];if("scaledLargest"==y.name){n.thumbnailSet.size={width:y.width,height:y.height};break}}}}n._commands=null,n.did&&(n.commands=N+(n.commands?","+n.commands:"")),n.isAlbum&&(n.commands="de,1"+(n.commands?","+n.commands:""));var _=n.neverExpires?B:M;return n._expirationDate=(new Date).getTime()+_,i},updateItemProperties:function(e,t,n,i){var r=this;r._dataModel.updateItemProperties(r,e,t,n,i)},updateItemProperty:function(e,t,n,i,r,o){var a=this;this._isNewFolder&&"name"==e?(a.name=(t||"").trim(),a.invalidate(),a._dataModel.createSubfolder(a.getParent(),a.name,null,n,i,a)):a._dataModel.updateItemProperty(a,e,t,n,i,r,o)},updateTags:function(e,t,n,i,r){var o=this;o._dataModel.updateTags(o,e,t,n,i,r)},createSubFolder:function(e,t,n,i){var r=this;r._dataModel.createSubfolder(r,e,t,n,i)},getExtendedInfo:function(e,t,n){var i;switch(n){case a.SkyDriveItem.ExtendedProperty.MoSkyDocProperties:i="&with=davUrl,mimetype";break;case a.SkyDriveItem.ExtendedProperty.QuotaInfo:i=""}this._dataModel.fetchItem(this.key,a.SkyDriveItem.getSetKey(),null,0,!0,this.modifiedDate,e,t,0,i)},hasExpired:function(){return this._expirationDate<(new Date).getTime()},getVersion:function(){return this._version},getDisplayName:function(e,t){var n=this,i=n.name;if(e&&!n.parentKey)if(n.did){var r=e.deviceItemSet.getByKey(n.did.toLowerCase());i=r?r.name:""}else i=n.isQt("search")?s("SearchResults").format(n.getSearchQuery()):n.isQt("recyclebin")?s("RecycleBinLowerCase"):n.isQt("sharedby")?s("SharedLandingPage"):n.ownerName&&(n.isViewerOwner()||n.isViewerCoOwner())?n.orderedFriendlyName&&n.isViewerOwner()?s("UsersSkyDrive").format(n.orderedFriendlyName):s("UsersSkyDrive").format(n.ownerName):h;else{var o=n.extension;(n.isUnknownFileType||n.textEditorMimeType||t)&&o&&(i+=o)}return i},getJsonApiCommandActionIndex:function(e){return wLive.Core.SkyDriveItem.getJsonApiCommandActionIndex(this,e)},isViewerOwner:function(){var e=this;return!e.ownerCid||e.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase()},isViewerCoOwner:function(){return 4===this.userRole||FilesConfig.upgradeEditorsToCoOwners&&1===this.userRole},doesViewerHaveEditAccess:function(){var e=this;return 1===e.userRole||e.isViewerCoOwner()||e.isViewerOwner()},getUploadUrlCid:function(){var e=this;return e.resourcePartitionCid?e.resourcePartitionCid:e.ownerCid},hasPendingRequests:function(){return this._dataModel.hasPendingRequests(this.key)},isLoading:function(){return this._isLoadingItem},isWebPlayableVideo:function(){return this.video?!0:!1},isQt:function(e){return a.StringHelpers.caseInsensitiveStringEquals(this.keyParts.qt,e)},isParQt:function(e){return a.StringHelpers.caseInsensitiveStringEquals(this.keyParts.parQt,e)},getSearchQuery:function(){return this.keyParts.q||""},extendPartialData:function(t){var n=this,i=a.SkyDriveItem.getItemKeyParts(n.key),r=a.SkyDriveItem.getItemKey(i.id,i.cid,parseInt(i.group),void 0,i.did,void 0,void 0),o=n._dataModel.getItem(r,!0),s=n._dataModel.getItem(n.key,!0);o&&!o.hasExpired()&&s&&!s.hasExpired()?(e(n,o),t(n)):n._dataModel.fetchItem(r,a.SkyDriveItem.getSetKey("0"),null,0,!1,n.modifiedDate,function(i){e(n,i),t(n)})},getParent:function(e){var t=this;return t.parentKey?t._dataModel.getItem(t.parentKey,e):null},getChildren:function(e){var t=this,n=this._childSets,r=null;if(n){if(e=e||O,t.isQt("shared")||t.isQt("sharedby")||t.isParQt("sharedby")||t.isQt("allmyphotos")||t.isParQt("allmyphotos")){var s=a.SkyDriveItem.getSetKeyParts(e);e=a.SkyDriveItem.getSetKey(s.sb,null,s.ft,"0",s.sd,s.tagFilter,s.rif)}if(r=n[e],!r){var l=a.SkyDriveItem.getSetKeyParts(e),c="-2"==l.gb;for(var u in n){var d=a.SkyDriveItem.getSetKeyParts(u),f=n[u];if(l.ft===d.ft&&l.tagFilter===d.tagFilter&&d.sb===l.sb&&d.sd===l.sd&&f.isComplete()){if(c){r=n[e]=new SkyDrive.Core.CustomLayoutItemSet(t._dataModel,t.key,e,f);break}if(1==f.getCount()){r=n[e]=f.clone(),r._setKey=e,r.setKeyParts=$Utility.deserialize(e,"&",!1,!1);break}}}r||(r=n[e]="-2"==l.gb?new SkyDrive.Core.CustomLayoutItemSet(t._dataModel,t.key,e):new SkyDrive.Core.SkyDriveItemSet(t._dataModel,t.key,e),l&&l.ft&&l.ft===a.JSONConstants.FilterType.PhotosAndVideos||r.setHeaderItemsSet(t._headerItemsSet),i(r,this.keyParts))}"-1"==r.modifiedDate&&r.setCount(o(t.folder,e))}return r},remove:function(){raiseEvent(this,"removeItem",this)},setVisibility:function(e){var t=this;t.isVisible=e,change(this)},getVisibility:function(){var e=this;return void 0===e.isVisible||e.isVisible},clearRotationState:function(){this.rotationState=null,this.invalidate(!0)},getRotationState:function(e){var t=this;return e?t.rotationState:t.rotationState||0},rotateClockwise:function(e){this.rotationState=((this.rotationState||0)+e)%4,this.invalidate(!0)},invalidate:function(e){var t=this;Trace.log("Item invalidating (name: "+this.name+", suppressVersionIncrement: "+e+")",c),e||t._version++;var n=t;for(change(this);n;)t._dataModel._fireDataChanged(n),n=n.getParent(!0)},expire:function(e,t){var n=this;if(-1!=n._expirationDate&&(Trace.log("Item expiring (name: "+this.name+", expireAncestors: "+e+", suppressAbort: "+t+")",c),n._expirationDate=-1,n._dataModel.setItemVersion(n.key)),e){var i=n.getParent(!0);i&&i.expire(!0,t)}t||n._dataModel.abortPendingRequests(n.key)},getHasSubfolders:function(){var e=this.folder&&this.folder.hasSubfolders;return e||this._headerItemsSet&&this._headerItemsSet.getCount()>0},createPinnedSubfolder:function(){var e=this,t=null;if(e._headerItemsSet){var n="NewFolder"+F++;t=new a.SkyDriveItem(this._dataModel,a.SkyDriveItem.getItemKey(n),this.key),t.processItem({folder:{totalCount:0,childCount:0},name:FilesConfig.defaultFolderString,commands:"rn,1",group:e.group,cid:e.ownerCid,ownerName:e.ownerName,sharingLevel:e.sharingLevel,_isNewFolder:!0}),Trace.log("Creating a pinned subfolder under: "+this.key,g),e._headerItemsSet.insert(0,t),e._headerItemsSet.invalidate()}return t},removePinnedSubfolder:function(e){var t=this,n=t._headerItemsSet;n&&(n.remove(e),n.invalidate())},updatePinnedSubfolderKey:function(e){var t=this,n=!1;if(t._headerItemsSet){var i=t._headerItemsSet.indexOf(e);i>=0&&(t._headerItemsSet.remove(e),e.key=a.SkyDriveItem.getItemKey(e.id,e.ownerCid,e.group,null,null),e.keyParts=a.SkyDriveItem.getItemKeyParts(e.key),e.clearItemSets(),t._headerItemsSet.insert(i,e),t._headerItemsSet.invalidate(),n=!0)}n||(e.key=a.SkyDriveItem.getItemKey(e.id,e.ownerCid,e.group,null,null),e.keyParts=a.SkyDriveItem.getItemKeyParts(e.key),e.clearItemSets())},clearItemSets:function(){var e=this;if(null!==e._childSets){for(var t in e._childSets)e._childSets[t].clear();e._childSets={}}},getDevice:function(){var e=this,t=null;if(e.keyParts.did){var n=a.ViewContext.getInstance().deviceItemSet;t=n.getByKey(e.keyParts.did.toLowerCase())}return t},getDeviceBaseUrl:function(){var e=this,t=null,n=e.getDevice();return n&&(t=n.baseUrl),t||FilesConfig.devicesBaseUrl},getViewCategory:function(){return wLive.Core.SkyDriveItem.getViewCategory(this)},_getNameForItem:function(e){var t=this,n=t.name||"",i="1"==e.group;if(t.id==u&&t._missingName){var r=e.qt;if(e.did){var o=t.getDevice();n=o?o.name:""}else if(r===v)n=i?T:k;else if(r===y)n=P;else if(r===_)n=D;else if(r===w)n=L.format(t.getSearchQuery());else if(i)n=t.ownerName||"";else if(r===b)n=I;else if(r===C&&FilesConfig.recentEnabled)n=E;else if(r===S&&FilesConfig.recycleBinEnabled)n=x;else{var s=t.checkForName&&t.checkForName(t,a.ViewContext.getInstance());if(s)n=s;else if(!this.parentKey&&!this._isLoadingItem){var l=this.ownerCid&&this.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase();n=l?$:this.ownerName?A.format(this.ownerName):""}}}return n}},{getJsonApiCommandActionIndex:function(e,t){var n=null;if(e&&e.commands){if(!e._commands){var i=e.commands.split(",");e._commands={};for(var r=0;r<i.length;r+=2)e._commands[i[r]]=i[r+1]}n=e._commands[t]}return n},getItemKey:function(e,t,n,i,r,o,a,s){return this.getItemKeyFromObject({id:e,ownerCid:t,isGroup:n,queryType:i,deviceId:r,searchQuery:o,searchFilterType:a,internalPath:s})},getItemKeyFromObject:function(e){var t={id:e.id||u,cid:(e.ownerCid||""+FilesConfig.hcid).toLowerCase(),group:Number(e.isGroup)?"1":"0",qt:(e.queryType||"").toLowerCase(),did:e.deviceId||"",q:e.searchQuery||"",sft:e.searchFilterType||"",beginDate:e.beginDate||"",endDate:e.endDate||"",highlights:e.highlights||"",internalPath:e.internalPath||""};t.did||(t.id=t.id.toLowerCase());var n="id="+t.id.encodeUrl()+"&cid="+t.cid.encodeUrl()+"&group="+t.group.encodeUrl()+"&qt="+t.qt.encodeUrl();return t.did&&(n+="&did="+t.did.encodeUrl()),t.q&&(n+="&q="+t.q.encodeUrl()),t.sft&&(n+="&sft="+t.sft.encodeUrl()),t.beginDate&&(n+="&beginDate="+t.beginDate.encodeUrl()),t.endDate&&(n+="&endDate="+t.endDate.encodeUrl()),t.highlights&&(n+="&highlights="+t.highlights.encodeUrl()),t.internalPath&&(n+="&internalPath="+t.internalPath.encodeUrl()),R[n]=t,n},getItemKeyParts:function(e){var t=R[e];if(!t){var n=$Utility.deserialize(e,"&",!1,!1);a.SkyDriveItem.getItemKey(n.id,n.cid,parseInt(n.group),n.qt,n.did,n.q,n.sft,n.internalPath),t=R[e]}return t},getSetKey:function(e,t,n,i,r,o,a){var s=H[O]||{},l=e||s.sb||"0",c=null!==t&&void 0!==t,u=c?t:s.sr,d=Number(u)?"1":"0",f=n||"",h=a||"0";i=i||(Y?"-1":"0,1,2"),r=r||"0";var p="ft="+f.encodeUrl()+"&sb="+l.encodeUrl()+(c?"&sr="+d:"")+(c?"":"&sd="+r)+"&gb="+i.encodeUrl()+"&rif="+h.encodeUrl();return o&&(p+="&tagFilter="+o.encodeUrl()),H[p]={ft:f,sb:l,gb:i,rif:h},c?H[p].sr=u:H[p].sd=r,o&&(H[p].tagFilter=o),p},getSetKeyParts:function(e){return e=e||O,H[e]},setDefaultSetKey:function(e){O=e},getDefaultSetKey:function(){return O},areItemsSame:function(e,t,n){if(e&&t){var i=!n||e.commands===t.commands&&e.name===t.name&&!t.error;return e.key===t.key&&e.modifiedDate===t.modifiedDate&&e._isLoadingItem===t._isLoadingItem&&i}return e||t?!1:!0},isFolderWithCovers:function(e){return e&&e.folder&&e.folder.covers},DocumentFormat:{Default:0,ODF:1},ExtendedProperty:{Default:0,MoSkyDocProperties:1,QuotaInfo:2},getViewCategory:function(e){var t=j;return e&&e.folder&&(e.folder.layoutUrl&&!e.folder.layoutDisabled?t=X:1===e.folder.category?t=W:"mru"===e.keyParts.qt?t=Q:"recent"==e.keyParts.qt?t=V:"shared"===e.keyParts.qt?t=q:"search"===e.keyParts.qt?t=G:"recyclebin"===e.keyParts.qt?t=K:"sharedby"===e.keyParts.qt?t=J:e.did&&(t=z)),t},ViewCategories:{DefaultFolder:j,PhotoFolder:W,RecentDocs:Q,RecentActivity:V,Shared:q,Search:G,Devices:z,RecycleBin:K,SharedBy:J,CustomLayout:X}}),a.ClientSortableFields={2:!0,3:!0,4:!0},a.QuotaStatus={Normal:0,Nearing:1,Exceeded:2},a.ItemStatus={Active:0,Restricted:1,RestrictedICN:2},a.ReviewState={NotReviewed:0,AutoReviewed:1,AgentReviewed:2,Challenged:3,ChallengeReviewed:4},a.GroupFolderType={None:0,OriginalSyncRoot:1,MountPoint:2},O=a.SkyDriveItem.getSetKey()}()}),define("deviceitem",["skydriveitem"],function(){!function(){defineClass("wLive.Core.DeviceItem",function(e){this.processItem(e)},{__isObservable:!0,processItem:function(e){var t=this;t.isVisible=!0,jQuery.extend(t,e),t.id="root",t.folder={},t.commands="defc,1",t.baseUrl=null},setVisibility:function(e){this.isVisible=e,change(this)},isQt:function(){return!1},getJsonApiCommandActionIndex:wLive.Core.SkyDriveItem.prototype.getJsonApiCommandActionIndex},{hasNewBaseUrlError:function(e,t){var n=!1;if((!e||e.isRetriable)&&t){var i=wLive.Core.ViewContext.getInstance().deviceItemSet,r=i.getByKey(t.toLowerCase());r&&(r.baseUrl=null,n=!0)}return n}})}()}),define("deviceitemset",["deviceitem"],function(){!function(){function e(){c||(c=!0,l.callerCid&&t())}function t(){var e=new i.DataRequest(s,s,null,function(e){Trace.log("DeviceItemSet.js getDevices() successCallback - devices count: "+(e.devices?e.devices.length:"no devices returned"),o),e.devices&&n(e)},function(){n(null)});e.apiId="SkyDrive_Json_GetDevices",e.propertyId="SkyDrive",e.start()}function n(e){if(Trace.log("DeviceItemSet.js parseResponse()",o),!e||e.error)d>0&&(d--,t());else{for(var n=e.devices||[],i=0;i<n.length;i++){var r=n[i];r.key=r.did.toLowerCase(),f.push(new wLive.Core.DeviceItem(r))}change(wLive.Core.DeviceItemSet)}}var i=wLive.Core,r=i.AleHelpers.getPCString,o="DeviceItemSet",a="DeleteRemove.Device",s=FilesConfig.baseApiUrl+"GetDevices",l=i.ViewContext.getInstance(),c=!1,u=3,d=u,f=[],h=Shared.ItemSet.prototype;defineSubClass("wLive.Core.DeviceItemSet",Shared.ItemSet,function(){var t=this;e(),f&&(t.isLoaded=!0,t.load(f)),t.addChangeListener(wLive.Core.DeviceItemSet,function(){t.isLoaded=!0,t.load(f),t.invalidate()})},{isLoaded:!1,remove:function(e){var t=this,n=FilesConfig.baseApiUrl+"RemoveDevice";$BSI.reportEvent(a,{});var o=i.ViewContext.getInstance();e.setVisibility(!1),$BSI.navigateTo("#cid="+FilesConfig.hcid.encodeUrl());var s={did:e.did},l=new i.DataRequest(n,n,Object.toJSON(s),function(){h.remove.call(t,e);var n=jQuery("<span>"+r("RemoveDevice.SuccessNotification").format(e.name).encodeHtml()+"</span>");sutra(n,"$Sutra.SkyDrive.RemoveDeviceSuccess"),o.errorManager.add({$element:n,priority:1,type:2})},function(){e.setVisibility(!0);var t=jQuery("<span>"+r("RemoveDevice.ErrorNotification").format(e.name).encodeHtml()+"</span>");sutra(t,"$Sutra.SkyDrive.RemoveDeviceError"),o.errorManager.add({$element:t,priority:0,type:0,code:"deviceRemove"})});l.apiId="SkyDrive_Json_RemoveDevice",l.propertyId="SkyDrive",l.start()}})}()}),define("groupinfo",["deviceitemset"],function(){!function(){function e(e,t){var v=this,y=$Utility.deserialize(t,"&",!1,!1),_=(e.displayName,e.email),w=e.membershipState,b=e.permissions,C=e.membership,S=y.cid;v.emailHtml=function(){var e;if(_&&_!==o){var t=s.format(_.encodeUrl());e=i.format(t.encodeHtmlAttribute(),_.encodeHtmlAttribute());var n=jQuery(e);n.click(m(null,"EG",a)),e=n}else if(w&&w>5){var r=p.format(S);e=f+'<br /><a href="'+r.encodeHtmlAttribute()+'">'+h+"</a>"}return e},v.emailTitle=function(){return _},v.emailHistoryHtml=function(){var e;if(_&&_!==o){var t=u.format(_.encodeUrl());e=i.format(t.encodeHtmlAttribute(),d);var n=jQuery(e);n.click(m(null,"VGE",a)),e=n}return e},v.membershipHtml=function(){var e;return w&&w>3&&(e=n(r+".Membership"+w)),e},v.permissionsHtml=function(){var e;return null!=b&&(e=n(r+".Permissions"+b)),e},v.groupOptionsLink=function(){var e;if(w&&w>4){var t=l.format(S);e=i.format(t.encodeHtmlAttribute(),c);var n=jQuery(e);n.click(m(null,"VGO",a)),e=n}return e},v.canInvite=function(){return w&&w>5},v.groupMembership=function(){return C},v.membershipPageLink=function(e){var t=g.format(S);return i.format(t.encodeHtmlAttribute(),e)}}var t=wLive.Core,n=t.AleHelpers.getPCString,i='<a href="{0}">{1}</a>',r="GroupInfo",o="",a="IP",s=FilesConfig.groupMailUrl,l="/cid-{0}/GroupOptions",c=n(r+".ViewGroupOptions"),u=FilesConfig.groupMailSearchUrl,d=n(r+".ViewEmail"),f=n(r+".EmailTurnedOff"),h=n(r+".TurnOnEmailLinkText"),p=l+"/email",g="/cid-{0}/Groupmembership/",m=t.BiciHelpers.prependBiciReportClickAction;t.GroupInfo=e}()}),define("skydriveitemhelper",["groupinfo"],function(){!function(){function e(e){var n=t(e,"qt");return n&&""!==n}function t(e,t){return e?(e.keyParts||(e.keyParts=$Utility.deserialize(e.key,"&",!1,!1)),e.keyParts[t]):void 0}function n(e,t,n){var i=mix({},e),r=Math.round(Math.min(e.width,t)),o=Math.round(Math.min(e.height,n));return mix(i,{url:e.url+"&width="+r+"&height="+o+"&cropmode=center",width:r,height:o}),i}var i=wLive.Core,r=i.JSONConstants,o=r.SharingLevel,a=i.AleHelpers.getPCString,s=i.AleHelpers.getSkyString,l=i.AleHelpers.getString,c="SkyDriveItemHelper";Trace.register(c,{isEnabled:!1});var u="",d=":",f=1e3,h=6e4,p=36e5,g="lastModifierName",m=.85,v=new RegExp(r.InvalidNameRegEx),y="root",_="photomail_",w=a("SkyDriveProductName"),b=l("UsersSkyDrive"),C="Doc",S="One",k="Ppt",I="Xls",x="Vsd",T="Lib",L="Drive",P="CDDrive",D="USBDrive",E="ExtDrive",$="NetDrive",A="ipi_",F='<span class="'+A+'arrow">{0}</span>',N=null,M=1,B=2,R={WinDocuments:T,WinLibrary:T,WinMusic:T,WinPictures:T,WinPodcastLibrary:T,WinVideos:T,WinDrive:L,CDDrive:P,GenericDrive:L,UsbDrive:D,ExternalDrive:E,NetworkStorage:$,Accdb:"Mdb",Doc:C,Docm:C,Docx:C,Dot:C,Dotm:C,Dotx:C,Exe:"Exe",Html:"Html",Mdb:"Mdb",Mpp:"Mpp",Mpt:"Mpp",Odp:k,Ods:I,Odt:C,One:S,Onepkg:S,Onetoc2:S,Notebook:"OneNotebook",Pot:k,Potm:k,Potx:k,Ppa:k,Ppam:k,Pps:k,Ppsm:k,Ppsx:k,Ppt:k,Pptm:k,Pptx:k,Pub:"Pub",Rtf:"Rtf",Txt:"Txt",Vdw:x,Vsd:x,Vsdm:x,Vsdx:x,Vsl:x,Vss:x,Vssm:x,Vssx:x,Vst:x,Vstm:x,Vstx:x,Xaml:"Xaml",Xla:I,Xlam:I,Xll:I,Xls:I,Xlsb:I,Xlsm:I,Xlsx:I,Xlt:I,Xltm:I,Xltx:I,Xml:"Xml",Xps:"Xps",Xsn:"Xsn",Zip:"Zip"},H={},O="PC.Sharing.EditableAttribute",U="PC.Sharing.OwnedAttribute",j="PC.Sharing.ViewOnlyAttribute",W="PC.Sharing.PublicViewLinkTitle",Q="";i.SkyDriveItemHelper={duration:function(e){var t=u,n=!1;if(e>=p){var i=Math.floor(e/p);e%=p,t+=i+d,n=!0}var r=Math.floor(e/h);e%=h,10>r&&n&&(t+="0"),t+=r+d;var o=Math.floor(e/f);return 10>o&&(t+="0"),t+=o},getThumbnail:function(e,t){var n=e.thumbnails;if(n)for(var i=n.length,r=0;i>r;r++){var o=n[r];if(o.name==t)return o}return void 0},getPixelRatio:function(){if(!N){var e=1,t=window.devicePixelRatio,n=screen.deviceXDPI;t?e=t:$B.IE&&$B.Mobile?e=window.screen.availWidth/document.documentElement.clientWidth:n&&(e=n/96),N=Math.min(Math.max(e,M),B)}return N},pickThumbnail:function(e,t,r,o){var a=null,s=null,l=o||m,c=i.SkyDriveItemHelper.getPixelRatio(),u=t*c,d=r*c,f=u*d*l;if(e&&e.thumbnails&&e.thumbnails.length>0)for(var h=0;h<e.thumbnails.length;h++){var p=e.thumbnails[h];"unRes"==p.name&&(p=n(p,u,d)),p.totalPixels=p.width*p.height;var g=p.coverage=Math.min(p.width,u)*Math.min(p.height,d)*Math.max(l,1);g>=f?(!a||p.totalPixels<a.totalPixels)&&(a=p):(!s||p.totalPixels>s.totalPixels)&&(s=p)}return a||s},isHtml5DropEnabled:function(e){return e&&e.folder&&!e.did&&"mru"!=e.keyParts.qt&&"shared"!=e.keyParts.qt&&!("search"==e.keyParts.qt&&"root"==e.id)&&"sharedby"!=e.keyParts.qt&&"recyclebin"!=e.keyParts.qt&&"allmyphotos"!=e.keyParts.qt&&i.SkyDriveItem.getJsonApiCommandActionIndex(e,"up")},isRootItem:function(e){return e.id===y},isSkyDriveRoot:function(t){return i.SkyDriveItemHelper.isRootItem(t)&&!t.group&&!t.did&&!e(t)},isDeviceRoot:function(e){return e&&i.SkyDriveItemHelper.isRootItem(e)&&e.did},isGroupRoot:function(e){return i.SkyDriveItemHelper.isRootItem(e)&&"1"===t(e,"group")&&null!=e.ownerCid},isGroupItem:function(e){return"1"===t(e,"group")},isCoOwner:function(e){return e&&e.isViewerCoOwner()},isOwnerOrCoOwner:function(e){return e&&(e.isViewerOwner()||e.isViewerCoOwner())},canViewSharingInfo:function(e){return e&&e.doesViewerHaveEditAccess()&&!i.SkyDriveItemHelper.isAlbumRoot(e)},isSharedLandingPageRoot:function(e){return e&&i.SkyDriveItemHelper.isRootItem(e)&&i.SkyDriveItemHelper.isSharedByQuery(e)},isAlbumRoot:function(e){return e&&e.isAlbumRoot},treatAsAlbum:function(e,t){return e&&(e.isAlbum||e.folder&&!e.isAlbumRoot&&!e._isLoadingItem&&t.viewParams&&"photos"==t.viewParams.v&&"allmyphotos"!=t.viewParams.qt)},isSharerFolder:function(e){return e&&e.isSharerFolder},isLegacyPhotomail:function(e){return e.id&&e.id.startsWith(_)},isTopLevelItem:function(e){if(i.SkyDriveItemHelper.isRootItem(e))return!1;var t=e.getParent(!0);return t&&i.SkyDriveItemHelper.isRootItem(t)},getTopLevelItem:function(e){for(;e&&!i.SkyDriveItemHelper.isTopLevelItem(e);)e=e.getParent(!0);return e},isViewerOwner:function(e){return!e.ownerCid||e.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase()},isMruQuery:function(e){var n=t(e,"qt");return n&&"mru"===n.toLowerCase()},isRecentQuery:function(e){var n=t(e,"qt");return n&&"recent"===n.toLowerCase()},isHighlightsQuery:function(e){return!!t(e,"highlights")},isRecycleBinQuery:function(e){var n=t(e,"qt");return n&&"recyclebin"===n.toLowerCase()},isAllMyPhotosQuery:function(e){var n=t(e,"qt");return!!n&&"allmyphotos"===n.toLowerCase()},isAllMyPhotosDescendant:function(e){var t=e&&e.getParent&&e.getParent(!0);return i.SkyDriveItemHelper.isAllMyPhotosQuery(t)},isSharedQuery:function(e){var n=t(e,"qt");return n&&"shared"===n.toLowerCase()},isSharedByQuery:function(e){var n=t(e,"qt");return n&&"sharedby"===n.toLowerCase()},isSearchQuery:function(e){var n=t(e,"qt");return n&&"search"===n.toLowerCase()&&i.SkyDriveItemHelper.isRootItem(e)},getSearchQuery:function(e){return t(e,"q")||""},getErrorMessageForNewItemName:function(e,t){var n;if(e)if(!t&&e.endsWith("."))n=a("CantStartOrEndWithDotError");else{var i=e.match(v);i&&i.length>1&&(n=a("InvalidTextFormatError").format(r.InvalidItemNameCharacters))}else n=a("NameRequiredError");return n},isPartOfBundle:function(e){var t=e&&e.getParent&&e.getParent(!0);return t&&t.isBundle},hasExtractedTextUrl:function(e){return e&&e.photo&&e.urls&&e.urls.textContent},hasOneNoteWebUrl:function(e){return e&&e.urls&&e.urls.oneNoteWeb},hasOneNoteClientUrl:function(e){return e&&e.urls&&e.urls.oneNoteClient},isGifOrPng:function(e){return e&&e.mimeType&&("image/gif"===e.mimeType||"image/png"===e.mimeType)},isRestricted:function(e){return e.itemStatus&&e.itemStatus>0&&4!=e.sharingLevelValue},isSearchResult:function(e){var t=e&&e.getParent&&e.getParent(!0);
return i.SkyDriveItemHelper.isSearchQuery(t)},isSearchOrDescendent:function(e){for(;e;){if(i.SkyDriveItemHelper.isSearchQuery(e))return!0;e=e.getParent&&e.getParent(!0)}return!1},highlightAndEncodeField:function(e,t){if(e&&e[t]){var n=e[t],r=e.highlights;if("name"==t&&e.internalPath){var o;o=1==e.internalPath.length?[n,e.internalPath[0]]:e.internalPath.slice(0);for(var a=0,s=0;s<o.length;s++){var l=o[s];o[s]=i.SkyDriveItemHelper.highlightAndEncodeFieldWithValue(r,t,l,a),a+=l.length}var c=i.ImageStrip.getImage("chevronRightBlack",null,null).outerHTML;return o.join(F.format(c))}return i.SkyDriveItemHelper.highlightAndEncodeFieldWithValue(r,t,n,0)}return""},highlightAndEncodeFieldWithValue:function(e,t,n,i){var r=n,o=[];if(e)for(var a=e.length-1;a>=0;a--){var s=e[a].startIndex-i,l=e[a].endIndex-i;if(e[a].fieldName==t&&s<r.length){o.unshift(r.substring(l).encodeHtml());var c=jQuery(_ce("span")).addClass("highlight").html(r.substring(s,l).encodeHtml());sutra(c,"$Sutra.SkyDrive.SearchHighlight");var u=jQuery(_ce("span")).append(c);o.unshift(u.html()),r=r.substring(0,s)}}return o.unshift(r.encodeHtml()),o.join("")},hasFieldHighlight:function(e,t){if(e&&e[t]&&e.highlights)for(var n=e.highlights,i=0;i<n.length;i++)if(n[i].fieldName==t)return!0;return!1},clearFieldHighlights:function(e,t){if(e&&e.highlights)for(var n=e.highlights,i=0;i<n.length;)n[i].fieldName==t?n.splice(i,1):i++},evaluateThrottleNotification:function(e,t,n){for(var r=!1,o=e;o&&!o.throttleRestrictions;)o=t.itemProvider.peekParent(o);if(o&&!o.hasExpired()&&(!H[o.ownerCid]||n)){var s=o.throttleRestrictions;if(s)for(var l=s.split(","),c=0;c<l.length;c++){var u=l[c];if("4"===u||"Download_Visitor"===u){r=!0,H[o.ownerCid]=!0;var d=i.SkyDriveItemHelper.isViewerOwner(e);t.errorManager.add({$element:a("BandwidthThrottledNotification."+(d?"Owner":"NonOwner")),priority:2,ui:1,type:1});break}}}return r},getNormalizedExtension:function(e){return e&&R[e.iconType]},getFriendlyFileType:function(e){var t=e.getVersion(),n="friendlyFileTypeVersion";if(e[n]!==t){var r=e.extension,o=r&&r.substring(1).toUpperCase(),s=i.SkyDriveItemHelper.getNormalizedExtension(e),l=a("FileType.NoExtension");!s&&e.folder?l=a("FileType.Folder"):e.isPanorama?l=a("FileType.Panorama"):e.photo&&!e.video?l=a("FileType.Image").format(o||"").trim():s?l=a("FileType."+s):o&&(l=a("FileType.Unknown").format(o)),e.friendlyFileType=l,e[n]=t}return e.friendlyFileType},getModifiedDateHtml:function(e,t,n){var r="",o=i.DateFactory,a=t.callerCid;if(!e._isNewFolder){var s=e.displayModifiedDate||o.getDateString(e.dateModifiedOnClient||e.modifiedDate,null,!1)||"";if(r='<span class="modifiedDateText">'+htmlEncode(s)+"</span>",a!==e.ownerCid||a!==e.lastModifierCid){var l=e.lastModifierName;l&&(l=n?i.SkyDriveItemHelper.highlightAndEncodeField(e,g):htmlEncode(l),r+='&nbsp;<span class="modifiedDateNameText">'+l+"</span>")}}return r},getCreatedDateText:function(e,t){var n="",r=i.DateFactory,o=t.callerCid;if(!e._isNewFolder&&(n=e.displayCreationDate||r.getDateString(e.creationDate,null,!1),o!==e.creatorCid)){var a=e.creatorName;a&&(n+=" "+a)}return n},getLocationText:function(e){var t;if(i.SkyDriveItemHelper.isSearchResult(e))t=e.locatedIn||w;else if(i.SkyDriveItemHelper.isViewerOwner(e)){var n=e.getParent();t=!n||i.SkyDriveItemHelper.isRootItem(n)?w:n.name}else t=e.ownerName?b.format(e.ownerName):w;return t},getOriginalLocationText:function(e){var t=e.deletedFromLocation;return t||(t=b.format(e.ownerName)),t},getSharedWithText:function(e){var t;if(FilesConfig.visualUpdatesForSharedContent){var n=void 0===e.sharingLevelValue||e.sharingLevelValue===o.Private,r=e.sharingLevelValue===o.Public;return t=r?s(W):n?Q:!FilesConfig.upgradeEditorsToCoOwners||e.groupFolderType!=i.GroupFolderType.MountPoint&&e.groupFolderType!=i.GroupFolderType.OriginalSyncRoot?this.fetchDetailedSharingText(e):s(O)}if(t=void 0!==e.sharingLevelValue&&e.sharingLevelValue!==o.Private?e.sharingLevel:"",t&&(e.groupFolderType==i.GroupFolderType.MountPoint||e.groupFolderType==i.GroupFolderType.OriginalSyncRoot)){var a=FilesConfig.upgradeEditorsToCoOwners?s("GF.Sharing.EditorAttribute"):s("GF.Sharing.CoOwnedAttribute");t=t+" "+a}return t},fetchDetailedSharingText:function(e){var t;return e.sharingLevelValue!==o.Public&&e.sharingLevelValue!==o.Private&&(t=e.groupFolderType==i.GroupFolderType.MountPoint?O:e.isViewerCoOwner()?O:e.isViewerOwner()?U:e.doesViewerHaveEditAccess()?O:j),s(t)},getDateSharedText:function(e){var t="",n=i.DateFactory;return t=e.dateShared?e.displayDateShared||n.getDateString(e.dateShared,null,!1):""},getRestoreItem:function(e){var t={};return e.recycledSharedItemInfo?t.restoreSharedItemInfo={relativePath:e.recycledSharedItemInfo.relativePath,sharedFolderResId:e.recycledSharedItemInfo.sharedFolderResId,ghostRootResId:e.recycledSharedItemInfo.ghostRootResId}:t.deletedFromLocation=e.deletedFromLocation,t.name=e.extension?e.name+e.extension:e.name,t.id=e.id,t},getActivityText:function(e){var t="";e.recentActionNames&&e.recentActionNames.length&&(t=e.recentActionNames[0]);var n;switch(e.recentAction){case i.JSONConstants.RecentActionType.Add:var r=e.recentActionItemName;n=t?a("RecentActivity.AddedFileBy").format(r,t):a("RecentActivity.AddedFile").format(r);break;case i.JSONConstants.RecentActionType.Share:n=a("RecentActivity.SharedBy").format(t);break;case i.JSONConstants.RecentActionType.Open:n=a("RecentActivity.Opened");break;default:n=t?a("RecentActivity.EditedBy").format(t):a("RecentActivity.Edited")}return n}}}()}),define("datamodel",["skydriveitemhelper"],function(){!function(){function e(e){var t=d.ViewContext.getInstance().deviceItemSet;return t.getByKey(e.toLowerCase())}function t(e){return e&&"recyclebin"===o(e,"qt")&&o(e,"id")===v}function n(e){return e&&"search"===o(e,"qt")&&o(e,"id")===v}function i(e){for(var t=e?e.getParent(!0):null;t&&t.parentKey&&!t.isSharerFolder;)e=t,t=t.getParent(!0);return t?e:null}function r(e,t){var n=f.getItemKeyParts(e);return d.StringHelpers.caseInsensitiveStringEquals(n.id,t)||!t&&!n.id}function o(e,t){var n=f.getItemKeyParts(e);return n[t]}function a(e){var t=!1;if(e)switch(e.code){case 101:case 102:case 103:case 152:case 200:case 201:case 202:case 3e3:case 10001:case 10002:case 10004:case 10006:case 10009:case 10011:case 10012:case 10013:case 10027:t=!0}return t}function s(e){return!e||e.hasExpired()}function l(e){if(void 0!==e.childCount){for(var t=e.childCount,n=[],i=[],r=null,o=0;t>o;o++){var a=e.children[o];a.isHeader?(r&&r.count&&i.push(r),r={groupingId:"other",name:a.name,startIndex:n.length,endIndex:n.length,count:0}):(r.endIndex=n.length,n.push(a),r.count++)}r&&r.count&&i.push(r),e.itemGroupings=[{name:"FolderDocumentsPhotos",itemGroups:i}],e.children=n,e.totalCount=n.length,e.childCount=n.length}}function c(e){var t="SkyDrive_Json_GetItems",n=f.getItemKeyParts(e);return t+="mru"===n.qt?"Mru":"shared"===n.qt?"Shared":"recyclebin"===n.qt?"RecycleBin":"search"===n.qt?"Search":"recent"===n.qt?"RecentActivity":"sharedby"===n.qt?"SharedBy":"allmyphotos"===n.qt?"AllMyPhotos":"Folders"}var u,d=wLive.Core,f=d.SkyDriveItem,h=d.SkyDriveItemHelper,p=d.JSONConstants.SortField,g=d.JSONConstants.SortDirection,m=d.JSONConstants.GroupBy,v="root",y="id",_="cid",w="lct=1",b="rset",C=FilesConfig.useNewThumbs,S=(C?"odweb":"skyweb")+($B.Mobile?"_mobile":""),k="skyweb_picker",I="DataModel",x=1e3,T=45e3,L=15e4,P=2e3,D=3,E=4,$=5,A=6e4,F="SkyDrive.GetItemsVersionLookup",N="albums",M={};defineClass("wLive.Core.DataModel",function(e,t,n,i,r){mix(this,{extraGetItemsParams:"",baseUrl:e,_baseUrl:e||null,_callerCid:(n||"").toLowerCase(),_market:i||"",_pageSize:r||100,_appId:t||"",_items:[],_maxRetries:1,_groupInfo:{},_pendingRequests:{},_restoreAllWorkItemCount:0,_versionLookup:BrowserStorage.getLocalValue(F)||{},_suspendedChangeEvents:null})},{__isObservable:!0,dispose:function(){var e=this;for(var t in e._pendingRequests)e._pendingRequests[t].abort()},hasPendingRequests:function(e,t){var n=this._pendingRequests[e],i=n&&t?n[t]:null;return!!(t?i:n)},abortPendingRequests:function(e){var t=this._pendingRequests[e];if(t){for(var n in t)if("count"!==n)for(var i in t[n])if("count"!==i){var r=t[n][i];r.abort()}delete this._pendingRequests[e]}},setItemVersion:function(e,t){Trace.log("Setting item version (key: "+e+", version: "+t+")",I),t?this._versionLookup[e]=t:delete this._versionLookup[e],BrowserStorage.setLocalValue(F,this._versionLookup)},getRestoreAllWorkItemCount:function(){return this._restoreAllWorkItemCount},getItem:function(e,t,n,i,r){var o=this,a=null;if(e&&(a=o._items[e]||null,!t)){var l=s(a),c=o._hasAncestors(a,e);if(l||!c&&a.id!==v){var u=i||f.getDefaultSetKey();o.fetchItem(e,u,null,0,!1,a?null:n,null,null,void 0,null,r)&&Trace.log("getItem miss - exists: "+!!a+", expired: "+l+", hasAncestors: "+c+", key: "+e+", setKey: "+u,I)}}return a},processResponse:function(t,n,i){var r=this,a=!1;i=i||f.getDefaultSetKey();var s=i;if(t&&t.items&&!t.error){var l=o(n,"did"),c=f.getSetKeyParts(i);if(c.sb==p.Default||c.sd==g.Default||c.gb==m.Default)if(l){var u=c.sb==p.Default?p.Name:c.sb,d=c.sd,v=c.gb;d==g.Default&&(d=u!=p.Name?g.Descending:g.Ascending),v==m.Default&&(v=m.Folders),i=f.getSetKey(u+"",null,c.ft,v+"",d+"",t.tagFilter,t.rif)}else i=f.getSetKey(t.sortOrder+"",null,c.ft,t.groupBy||c.gb,t.sortDirection+"",t.tagFilter,t.rif);t.restoreAllWorkItemCount&&t.restoreAllWorkItemCount>0&&(r._restoreAllWorkItemCount=t.restoreAllWorkItemCount);var y=t.items;r._preprocessGetItemsResponse(t);var _=t.baseUrl;if(l&&_){var w=e(l);w&&(w.baseUrl=_)}for(var b=0;b<y.length;b++)a=r._processItem(y[b],n,i,null,a,s)||a;var C=r.getItem(n,!0);if(void 0!==t.lastVersion||C&&h.isSkyDriveRoot(C)&&h.isViewerOwner(C)){var S=FilesConfig.lastVersion||t.lastVersion,k=S?S.split(","):[];FilesConfig.lastVersion=k[0]||"0",void 0===FilesConfig.freRenderIndex&&(FilesConfig.freRenderIndex=Number(k[1]||"0"))}}return a},suspendChangeEvents:function(){this._suspendedChangeEvents||(this._suspendedChangeEvents=[])},resumeChangeEvents:function(){var e=this;if(e._suspendedChangeEvents){var t=e._suspendedChangeEvents;for(e._suspendedChangeEvents=null;t.length;)e._fireDataChanged(t.pop())}},createSubfolder:function(e,t,n,i,r,o){var a=this,s=this._baseUrl+"AddFolder?"+w,l=null,c={parentId:e.id,cid:e.ownerCid,group:e.group,name:t,permissionsInfo:null};n&&(c.permissionsInfo={ownerCid:n.ownerCid,message:n.message,requireSignIn:n.requireSignIn,entities:n.entities},c.doNotRollbackOnPartialPermissionsError=n.doNotRollbackOnPartialPermissionsError,c.sendShareNotification=n.sendSharingNotification,l=A),h.isRootItem(e)&&"photos"==d.ViewContext.getInstance().viewParams.sc&&(c.category=1);var u=null,f=new d.DataRequest(s,s,Object.toJSON(c),function(t){var n=t?t.item:null,r=o?o:e.createPinnedSubfolder();r.processItem(n),e.updatePinnedSubfolderKey(r),a._items[r.key]=r,e.expire(),e.invalidate(),i&&i(t,r)},function(e){e&&e.error&&e.error.code===x&&(e.error.isExpected=!0),r&&r(e,u)},l);f.apiId="SkyDrive_Json_AddFolder",f.propertyId="SkyDrive",f.start()},updateItem:function(e,t,n,i,r,o){var a=this,s=a._baseUrl+t+"?"+w,l=new d.DataRequest(s+Math.random(),s,n,function(t){var n=t&&t.item;if(n){var r=f.getItemKey(n.id,n.ownerCid,n.group);a._processItem(n,r)&&a.getItem(r).invalidate()}i&&i(t,e)},function(t){if(r){var n=a.getItem(e.key,!0);r(t,n)}});l.apiId="SkyDrive_Json_"+(o?t+"_"+o:t),l.propertyId="SkyDrive",l.start()},updateItemProperties:function(e,t,n,i,r){var o=this,a=e.parentId;t.id=e.id,a&&a!==v&&(t.lid=e.parentId),t[b]=S,o.updateItem(e,"UpdateItem",Object.toJSON(t),n,i,r)},updateItemProperty:function(e,t,n,i,r,o,a){var s="";o&&(s=', "overrideLock":"true"');var l=e[t],c=e[t]=n,u=e.extension;"name"===t&&u&&(c+=u),e.invalidate();var d=e.parentId;this.updateItem(e,"UpdateItem",'{"id":"'+e.id+'","'+t+'":"'+c.encodeJson()+(d&&d!==v?'","lid":"'+d.encodeJson():"")+'","'+b+'":"'+S+'"'+s+"}",i,function(e,i){r(e,i),i[t]===n&&(i[t]=l,i.invalidate())},a)},updateTags:function(e,t,n,i,r){var o=this,a="UpdateTags",s={id:e.id,tagsToAdd:t,tagsToDelete:n},l=o._baseUrl+a,c=new d.DataRequest(l+Math.random(),l,Object.toJSON(s),function(t){i&&i(t,e)},function(t){if(e.expire(),e.invalidate(),r){var n=o.getItem(e.key,!0);r(t,n)}});c.apiId="SkyDrive_Json_"+a,c.propertyId="SkyDrive",c.start()},getPlaceholderItem:function(e,t,n,i){var r=new f(this,e,null),a=o(e,_).toUpperCase(),s={name:t,isPlaceholder:!0,id:o(e,y),ownerName:a==FilesConfig.hcid?FilesConfig.userDisplayName:"",ownerCid:a};return n&&(s.folder={totalCount:1,childCount:1}),r.processItem(s),mix(r,i),r},getLoadingItem:function(e,t,n){var i=void 0!==t?t:!0;return n=n||{},mix(n,{_isLoadingItem:!0}),this.getPlaceholderItem(e,"",i,n)},getGroupInformation:function(e,t,n){var i="cid="+e.toLowerCase().encodeUrl(),r=n.viewParams;r.authkey&&(i+="&authkey="+(r.authkey||"").encodeUrl()),r.ticket&&(i+="&ticket="+(r.ticket||"").encodeUrl());var o=this._groupInfo[i];return o||this._fetchGroupInformation(i,t,this._maxRetries),o},_ensureCompletelyDownloaded:function(e,t,n){function i(n,i){function f(){var f=[],m=l.getItem(c,!0);if(!h)if("-1"!=d&&d!=m.modifiedDate&&(Trace.log("EnsureCompletelyDownloaded refresh loop detected: modifiedDateChanges - "+u+" itemModifiedDate - "+d+" item.modifiedDate - "+e.modifiedDate,I),u++,d=m.modifiedDate),u>D)Trace.log("EnsureCompletelyDownloaded refresh loop hit: modifiedDateChanges - "+u+" itemModifiedDate - "+d+" item.modifiedDate - "+e.modifiedDate,I),l.resumeChangeEvents(),i(null);else{var v=m?m.getChildren(t):e.getChildren(t);if(r?f=l._getMissingGroupRanges(m||e,t,a,s):v.isComplete()||(f=l._getMissingRanges(m||e,t,o)),f.length){p=[],l.suspendChangeEvents();for(var y=0;y<f.length;y++){var _=f[y];g(y,_.start,_.count)}}else l.resumeChangeEvents(),n(m||e)}}function g(e,n,i){p[e]=l.fetchItem(c,t,null,n,!1,null,function(){m(e)},v,1,null,{pageSize:i})}function m(e){var t;for(p[e]=!1,t=0;t<p.length&&!p[t];t++);t==p.length&&f()}function v(e){Trace.log("EnsureCompletelyDownloaded fetch error: itemKey - "+c+" setKey - "+t,I),l.resumeChangeEvents(),i(e)}f()}var r=n.downloadGroupMode,o=n.indexes,a=n.groupIndex,s=n.subGroupIndex;t=t||f.getDefaultSetKey();var l=this,c=e.key,u=0,d=e.modifiedDate,h=!1,p=[];return new Shared.Promise(i,function(){l.resumeChangeEvents(),l.abortPendingRequests(c),h=!0})},ensureCompletelyDownloaded:function(e,t,n){return this._ensureCompletelyDownloaded(e,t,{indexes:n,downloadGroupMode:!1})},ensureGroupCompletelyDownloaded:function(e,t,n,i){return this._ensureCompletelyDownloaded(e,t,{groupIndex:n,subGroupIndex:i,downloadGroupMode:!0})},fetchItem:function(e,t,i,r,a,s,l,c,u,p,g){var m=this;g=g||{};var v=g.pageSize||m._pageSize;i||(r-=r%m._pageSize,r>0&&!g.pageSize&&(r-=m._pageSize,v=2*m._pageSize));var y=m.replaceGetItemsUrl&&m.replaceGetItemsUrl(e,m._baseUrl),_=g.itemKey||e,w=g.startId||i,b=y||m._createGetItemsUrl(_,t,w,r,v,u,p),C=window.$InlineRequests||{},S=C[b],k=S?S.originId:Math.random(),I=m.getItem(e,!0);I&&I.hasExpired()&&(a=!0);var x;if(I&&h.isAllMyPhotosQuery(I)&&!a){var D=I.getChildren(t);D&&D.getGroupings(!1).length<2&&(a=!0)}x=d.Search&&n(e)&&!a?d.Search.getSearchOrigin(o(e,"q")):a?k:S?S.version:m._versionLookup[e]||k;var E=FilesConfig.authKey?"&authkey="+FilesConfig.authKey.encodeUrl():FilesConfig.ticket?"&ticket="+FilesConfig.ticket.encodeUrl():"",$=b+E+"&v="+x,A=!!f.getItemKeyParts(e).did,F=(new Date).getTime(),N=!d.DataRequest.hasPendingRequest(b),B=null,R=(new Date).getTime();lastErrorForRequest=M[e+"_"+t],lastErrorForRequest&&R-lastErrorForRequest.time<P?(raiseEvent(this,wLive.Core.DataModel.errorEvent,lastErrorForRequest.error),c&&c(lastErrorForRequest.error)):(B=new d.DataRequest(b,$,null,function(n){N&&m._handleServerResponse(n,e,t,i,r,k,F,x,b),l&&l(m.getItem(e,!0))},function(n){N&&m._handleServerResponse(n,e,t,i,r,k,F,x,b),c&&c(n?n.error:null)},A?L:T),B.originId=k);var H=B&&B.start();if(H){var O=m._pendingRequests[_]=m._pendingRequests[_]||{},U=O[t]=O[t]||{};U[b]=B,U.count=(U.count||0)+1,O.count=(O.count||0)+1}return H},getApplicationDetails:function(e,t,n){var i=this,r=i._baseUrl+"GetApplicationDetails?appId="+e,o=new d.DataRequest(i._baseUrl,r,null,function(e){t&&t(e)},function(e){n&&n(e?e.error:null)},T);return o.originId=Math.random(),o.failureReentranceDelay=P,o.start()},_getMissingGroupRanges:function(e,t,n,i){var r=e.getChildren(t),o=r.getGroupings(),a=[],s=o[n];if(s){var l=s.itemGroups[i];if(l){if(l.mergeUp){var c=Math.max(l.startIndex-this._pageSize,0);a.push({start:c,count:l.startIndex-c})}l.mergeDown&&a.push({start:l.endIndex+1,count:this._pageSize})}}return a},_getMissingRanges:function(e,t,n){var i,r=this._pageSize,o=[],a=e.getChildren(t),s={};if(n)for(i=0;i<n.length;i++){var l=n[i];a.peek(l)||(s[l-l%r]=!0)}else for(i=0;i<a.getCount();i+=r)a.peek(i)||(s[i]=!0);for(i in s)o.push({start:Number(i),count:r});if(o.length>E){var c=0;for(i=0;i<o.length-1;i++){var u=o[i];++c<$&&u.start+u.count==o[i+1].start?(u.count+=o[i+1].count,o.splice(i+1,1),i--):c=0}}return o},_fireDataChanged:function(e){var t=this;t._suspendedChangeEvents?t._suspendedChangeEvents.push(e):raiseEvent(this,wLive.Core.DataModel.dataChangedEvent,e)},_handleServerResponse:function(t,n,i,r,s,l,u,f,h){var p,g,m,v=this,y=(new Date).getTime(),_=v._pendingRequests[n],w=c(n);if(window.$InlineRequests&&delete window.$InlineRequests[h],_){var b=_[i];b&&(delete b[h],b.count--,b.count||delete _[i]),_.count--,_.count||delete v._pendingRequests[n]}if(t&&t.items&&!t.error){var C=l&&l!=t.originId,S=C,k=v.processResponse(t,n,i);p=(C?"cacheHit-":"cacheMiss-")+(S?"revalidating-":"valid-")+(k?"changed":"nochange"),g="s",Trace.log("Received response: ("+p+")",I);var x=v.getItem(n,!0);x&&(C||(this.setItemVersion(n,f),raiseEvent(v,d.DataModel.responseAvailableEvent,{itemKey:n,setKey:i,originId:l,response:t}),(x.isSpecialFolder||x.isAlbumRoot)&&(x.specialFolderKey!=n?(v.setItemVersion(x.specialFolderKey,f),raiseEvent(v,d.DataModel.responseAvailableEvent,{itemKey:x.specialFolderKey,setKey:i,originId:l,response:t})):(v.setItemVersion(x.key,f),raiseEvent(v,d.DataModel.responseAvailableEvent,{itemKey:x.key,setKey:i,originId:l,response:t})))),k&&x.invalidate(!0)),S&&v.fetchItem(n,i,r,s,!0)}else{var T=t?t.error:null;T=T||{code:2147745797,debugMessage:"Server returned no success or failure"};var L=o(n,"did");if(L){var P=e(L);P&&P.baseUrl&&d.DeviceItem.hasNewBaseUrlError(T,L)&&v.fetchItem(n,i,r,s,!0)}p=T.code,g=a(T)?"c":"f",m=T.debugMessage+"\n"+T.stackTrace,T.key=n,T.rootCauseApiId=w,T.rootCauseErrorType=g,T.rootCauseStartTime=u,M[n+"_"+i]={error:T,time:(new Date).getTime()},raiseEvent(this,wLive.Core.DataModel.errorEvent,T)}Qos.log(w,"SkyDrive",u,p,g,m,y)},_processItem:function(e,t,n,i,a,s){var c,u=this,p=f.getItemKeyParts(t),g=void 0;if(t&&r(t,e.id))c=t;else{var m=p.qt,y=d.ViewContext.getInstance(),_=y&&y.viewParams.parId;e.id==_&&(m=y.viewParams.parQt),"search"===m&&e.internalPath&&(g=e.internalPath.join(",")),c=f.getItemKey(e.id,e.ownerCid,e.group,m,p.did,p.q,p.sft,g)}var w=u.getItem(c,!0),b=e.folder;if(!i&&e.parentId&&(i="search"===p.qt?f.getItemKey(v,void 0,0,p.qt,0,p.q,p.sft):f.getItemKey(e.parentId,e.ownerCid,e.group,p.qt,p.did)),!w){a=!0;var C,S=e.isAlbumRoot;(S||e.isSpecialFolder)&&(C=f.getItemKey((S?N:e.specialFolderCanonicalName).toLowerCase(),e.ownerCid,e.group,null,p.did)),w=u._items[c]=new f(u,c,i,C),C&&(u._items[C]=w)}if(a=w.processItem(e)||a,b){var k=w.getChildren(n);s&&n!=s&&(a=a||w._childSets[s]!==k,w._childSets[s]=k),h.isDeviceRoot(w)&&l(b);var I=!1,x=k.getCount(!0);k.modifiedDate==w.modifiedDate&&x==b.childCount||void 0==b.childCount||(I=!0,k.modifiedDate=w.modifiedDate,k.setCount(b.childCount),x=k.getCount(!0),k._requiresFilter=!0,a=!0),b.itemGroupings&&w.hasMoreResults!==!0&&w.hasMoreResults!==!1&&k._mergeGroupingsFromServer(b.itemGroupings,I),void 0!==b.photoCount&&(w.folder.photoCount=b.photoCount);var T=o(t,"qt");("allmyphotos"===T||"sharedby"===T)&&(T=null);var L=o(t,"q"),P=o(t,"sft");if(b.children){var D=b.startIndex||0;if(D+b.children.length>b.totalCount){var E=b.totalCount-D;b.children.length=E>0?E:0}for(var $=0,A=D;$<b.children.length;$++,A++){var F=b.children[$];g=void 0,"search"===T&&F.internalPath&&(g=F.internalPath.join(","));var M=f.getItemKey(F.id,F.ownerCid,F.group,T,w.did,L,P,g);a=u._processItem(F,M,n,c,a)||a,a=k.set(A,u.getItem(M,!0))||a}a&&change(k)}}return a},_mergeGroupsAfterCurrent:function(e,t,n,i){for(var r=e+1;r<t.length;r++){var o=t[r];if(!(o.startIndex<=n.endIndex+1))break;if(o.mergeUp){if(i.endIndex<o.endIndex){var a=o.endIndex-i.endIndex;i.mergeDown=o.mergeDown,i.count+=a,i.endIndex+=a}o.count=-1,o.startIndex=-1,o.endIndex=-1}else{if(!o._filler)break;if(i.endIndex<o.endIndex){var s=o.endIndex-i.endIndex;o.count-=s,o.startIndex+=s}else o.count=-1,o.startIndex=-1,o.endIndex=-1}}},_preprocessGetItemsResponse:function(e){for(var t=e.items,n=e.tokenNeedsRedeeming,i=e.tokenType,r=d.ViewContext.getInstance(),o=0;o<t.length;o++){var a=t[o];if(a.id!=v&&(n&&null!=i||!a.tokenNeedsRedeeming)){a.tokenNeedsRedeeming=n,a.tokenType=i;var s=a.folder;if(s&&s.children){var l=0;for(s.startIndex||0;l<s.children.length;l++){var c=s.children[l];c.tokenNeedsRedeeming=n,c.tokenType=i}}}a.settings&&r&&mix(r.userSettings,a.settings)}},_createGetItemsUrl:function(t,n,r,a,s,l,c){var u,h=this,m=h.getItem(t,!0),v=(i(m),c?c:h.extraGetItemsParams),y=d.ViewContext.getInstance(),_=y&&y.viewParams,C=S;_&&_.v==FilesConfig.filePickerViewParam&&(u=_.auth==FilesConfig.skyDrivePickerOAuth?2:1,C=k);var I=(void 0===l?"&d=1":"&d="+l)+"&iabch=1&caller="+h._callerCid+"&path="+(0===l?"0":"1")+(r?"&sid="+r:"&si="+a)+"&ps="+s+"&pi=5&m="+h._market+"&"+b+"="+C+"&"+w+(u?"&urlType="+u:"")+(FilesConfig.eventRange?"&eventRange="+FilesConfig.eventRange:"")+v;$B.Mobile&&(I+="&isMobile=1");var x=this._baseUrl;if(-1!==t.indexOf("&did=")){var T=e(o(t,"did"));x=T&&T.baseUrl?T.baseUrl:FilesConfig.devicesBaseUrl;var L=f.getSetKeyParts(n);if(void 0!==L.sd){var P="0";P=L.sb==p.Default||L.sb==p.Name?L.sd==g.Descending?"1":"0":L.sd==g.Ascending?"0":"1",n=n.replace("sd="+L.sd,"sr="+P)}}return x+"GetItems?"+t+"&"+n+I},_fetchGroupInformation:function(e){var t=this._baseUrl+"GetGroupInfo?"+e+"&retrieveMembership=true",n=this,i=new d.DataRequest(t,t,null,function(t){var i=new d.GroupInfo(t.groupInfo,e);n._groupInfo[e]=i,raiseEvent(n,wLive.Core.DataModel.groupInfoChangedEvent,null)});i.apiId="SkyDrive_Json_GetGroupInfo",i.propertyId="SkyDrive",i.start()},_hasAncestors:function(e,r){var o=i(e);return n(r)||t(r)?!1:!!(e&&e.parentKey||o&&this.getItem(o.parentKey,!0))}},{getInstance:function(){if(!u){var e=window.FilesConfig;u=new wLive.Core.DataModel(e.baseApiUrl,e.appId,e.hcid,$Config.mkt,e.dataPageSize)}return u},dataChangedEvent:"dataChanged",responseAvailableEvent:"responseAvailable",groupInfoChangedEvent:"groupInfoChanged",errorEvent:"error"},Shared.ObjectEventing,Shared.Async)}()}),define("errormanager",["datamodel"],function(){!function(){function e(){function e(e,t){return e.priority!=t.priority?e.priority-t.priority:e.type-t.type}var t=this;t._errors=[],t.errorReceivedEventName="errorreceived",t.errorClearedEventName="errorcleared",t.add=function(i){if(i.priority|=0,i.type|=0,0==i.type&&$Config.hc&&i.$element){var r="Help",o=i.$element.children("a").length>0;if(o)r="Other";else if(i.code){var a=null;if($Config.hc.slcList&&$Config.hc.slcList[i.code]){r="SLC";var s="&nbsp;"+n("ErrorStatusMessage"),l='<a href="'+$Config.hc.slcUrl+'" target="_blank">'+n("ErrorStatusLinkLabel")+"</a>";a=jQuery("<span/>",{"class":"errorHelpLink",html:s.format(l)}),a.click(function(){$BSI.reportEvent("ClickSelected.SLC.SkyDriveInProductLink",{CMXErrorCodeSD:i.code})}),$BSI.reportEvent("Action.SLC.SkyDriveOutageError",{CMXErrorCodeSD:i.code})}else a=jQuery('<span class="errorHelpLink">&nbsp;<a target="_blank">'+$Config.hc.label+"</a></span>"),$HelpContext.attachContextTo(a.children("a"),i.code,i.$element.text());i.$element.append(a)}else i.code="noCode",r="None";$BSI.reportEvent("Log.WL.ErrorDisplayed",{WLErrorProduct:$Config.prop,WLErrorCode:i.code,WLErrorLinkType:r})}t._errors.push(i),t._errors.sort(e),jQuery(t).trigger(t.errorReceivedEventName)},t.removeAt=function(e){var n=t._errors&&t._errors.length;n>0&&e>=0&&n>e&&(t._errors.splice(e,1),0===t._errors.length&&jQuery(t).trigger(t.errorClearedEventName))},t.clear=function(){t._errors.length>0&&(t._errors=[],jQuery(t).trigger(t.errorClearedEventName))},t.dismiss=function(){var e=t._errors;e.length>0&&e[0].dismissCallback&&e[0].dismissCallback(),t.clear()},t.getErrors=function(){return t._errors}}var t=wLive.Core,n=t.AleHelpers.getString;t.ErrorManager=e}()}),define("itemactionhelper",["jquery-1.7.2","errormanager"],function(){!function(){function e(e){return e?e.encodeURIComponent():r}function t(e,t,n,i){var r=e?e.ownerCid:null;return i?i:r||t.callerCid}function n(e,t){var n=e&&(e.photo||e.video||e.isProcessingVideo||"SelfView"===t.currentViewType);return{shouldKeepQueryType:t.viewParams.qt&&("allmyphotos"===t.viewParams.qt&&!e.isAlbum||"sharedby"===t.viewParams.qt&&(n||e.isSharerFolder)),hasParentParam:t.viewParams.parQt||t.viewParams.parId,shouldUseSelfView:n,hasChildren:e&&e.folder&&e.folder.childCount}}var i=wLive.Core,r="",o="&v=",a=i.ViewContext.getInstance(),s=i.SkyDriveItemHelper,l=i.JSONConstants;wLive.Core.ItemActionHelper={itemStringFormat:function(i,c,u,d){return i.itemFormat({item:c,$Config:window.$Config,FilesConfig:FilesConfig,ViewContext:a},{encodeUrl:function(e){return e?e.encodeUrl():r},encodeURIComponent:e,cid:t,cidQueryString:function(n,i,o,a,l){var c=l||n&&n.group,u=n&&s.isSearchQuery(n)&&"root"==n.id,d=n&&s.isRecycleBinQuery(n);return u?"qt=search&q="+s.getSearchQuery(n):"cid="+e(t(n,i,o,a))+(c?"&group=1":r)+(d?"&qt=recyclebin":r)},profileDomain:function(e,t,n,i,r){var o=r===!0||r===!1?r:e&&e.group;return o?n.groupsDomain:n.profileDomain},groupsDomain:function(){return FilesConfig.groupsDomain},groupEmail:function(e){return e&&s.isGroupRoot(e)&&e.groupEmail?e.groupEmail:""},deviceIdQueryString:function(e){return e&&e.did?"&did="+e.did.encodeURIComponent():r},resIdQueryString:function(e){return e&&"root"!=e.id?"&resid="+e.id.encodeURIComponent():r},idAsParentIdQueryString:function(e){return e?"&parid="+e.id.encodeURIComponent():r},appQueryString:function(e){var t=wLive.Core.SkyDriveItemHelper.getNormalizedExtension(e)||e.iconType,n=null;switch(t){case"Doc":n="Word";break;case"Pdf":n="WordPdf";break;case"Xls":n="Excel";break;case"Ppt":n="PowerPoint";break;case"One":case"OneNotebook":n="OneNote"}return n?"&app="+n:r},authKeyQueryString:function(e,t){var n=t.viewParams;return n.ticket?"&ticket="+n.ticket.encodeURIComponent():n.authkey?"&authkey="+n.authkey.encodeURIComponent():r},idQueryString:function(e,t){var i=r,o=n(e,t);return o.shouldKeepQueryType||!o.hasParentParam||o.shouldUseSelfView&&!o.hasChildren||e&&e.parentId===t.viewParams.id?e&&(i=e.id):i=t.viewParams.parId,"root"==i?r:"&id="+i.encodeURIComponent()},parentIdQueryString:function(e){return e.parentId&&!e.directlyShared?"root"==e.parentId?r:"&id="+e.parentId.encodeURIComponent():r},parentId:function(e){return(e.parentId||r).encodeURIComponent()},isFolder:function(e){return e.folder?1:0},scenario:function(e,t){return t.viewParams.sc?"&sc="+t.viewParams.sc:r},queryType:function(e,t){return t.viewParams.qt?"&qt="+t.viewParams.qt:r},selfViewQueryType:function(e,t){function i(e){return c&&(e+="&beginDate="+c),u&&(e+="&endDate="+u),d&&(e+="&highlights="+d),e}var o=r,a=t.viewParams.qt,s=t.viewParams.parQt,l=t.viewParams.parId,c=t.viewParams.beginDate,u=t.viewParams.endDate,d=t.viewParams.highlights,f=e&&e.getParent&&e.getParent(!0),h=n(e,t);if(h.shouldKeepQueryType)if(h.shouldUseSelfView){var p="sharedby"!==a||t.viewParams.id&&"root"!==t.viewParams.id?t.viewParams.id:e.ownerDCid;o="&parQt="+a+"&parId="+(p||"root"),o=i(o)}else o="&qt="+t.viewParams.qt;else h.hasParentParam?h.shouldUseSelfView&&!h.hasChildren&&"SelfView"===t.currentViewType?(s&&(o="&parQt="+s),l&&(o+="&parId="+l),o=i(o)):s&&(o="&qt="+s):f&&f.isBundle?o="&parId="+f.id:e&&e.isSharerFolder?o="&qt=sharedby":e&&e.keyParts&&e.keyParts.qt&&"sharedby"===e.keyParts.qt&&(o="&qt="+e.keyParts.qt);return o},filterTypeParams:function(e,t){var n=t.viewParams.ft;return n?"&ft="+n.encodeUrl():r},tagFilterParams:function(e,t){var n=t.viewParams.tagFilter;return n?"&tagFilter="+n.encodeUrl():r},searchParams:function(e,t){var n=e&&s.isSearchResult(e),i=e&&(e.photo||e.video||e.isProcessingVideo||"SelfView"===t.currentViewType);return n&&i?"&qt=search&q="+s.getSearchQuery(e):r},viewQueryString:function(e,t){var n=t.viewParams.v,i=FilesConfig.tailoredPhotos&&e&&(FilesConfig.enableAlbumsView&&(e.isAlbum||e.isAlbumRoot)||s.isAllMyPhotosQuery(e)),a=e&&(e.photo||e.video||e.isProcessingVideo),c=r;return a?c=o+l.ViewType.Self:n&&n!=l.ViewType.Self?c=o+n:i&&(c=o+l.ViewType.Photos),c}},[c,a,FilesConfig,u,d])}}}()}),define("permissionsprovider",["jquery-1.7.2","wliveloaded","alehelpers","errormanager"],function(){!function(){function e(o){function d(e){return function(t,n,i){var r=i&&i[0];r&&(n.code=r.code),e&&e(t,n)}}function f(e,t,o,a,d,f,h,p,g,m,v,_){m=m||{};var w={entities:o};if(e)w.id=e.id;else{for(var b=[],C=0;C<t.length;C++)b.push(t[C].id);w.ids=b,w.bundleName=m.bundleName}null!==d&&(w.requireSignIn=d),f&&(w.group=1,w.groupUserRole=h,w.ownerCid=e.ownerCid),a&&(w.message=a),null!==p&&(w.suppressNotification=p),null!=g&&(w.userAction=g);var S=Object.toJSON(w),k=FilesConfig.baseApiUrl+"SetPermissions",I=new n.DataRequest(null,k,S,function(r){var o=r.permissions,a=o&&o.permissionScopes,s=a&&a[0]&&a[0].entities;if(e&&e.expire)e.expire(!1),e.invalidate();else if(t)for(var l=0;l<t.length;l++){var c=t[l];c.expire(!1),c.invalidate()}var u=a&&a[0],d=e;!e&&t&&u&&(d=n.DataModel.getInstance().getPlaceholderItem(n.SkyDriveItem.getItemKey(u.id,T,f),u.name,!0,{isBundle:!0,ownerCid:T,commands:"sh,1"})),d?(u&&(d.selectionId=u.id),y(d,o),v&&v(d,s)):_&&_(e,{message:i("Sharing.ShareErrorAllFailed")},null)},function(t){1==o.length&&o[0].role==r&&t.error&&t.error.code==c?x.fetchPermissions(e,function(){e.expire(!1),e.invalidate(),v&&v(e,void 0)},null,!0):(!t.errorResult&&t.error.code!=s||t.primaryError&&t.primaryError.code==l||!e||x.fetchPermissions(e,function(){e.expire&&(e.expire(!1),e.invalidate())},null,!0),_&&_(e,t.primaryError?t.primaryError:t.error,t.errorResult))},u,null,0);I.apiId="SkyDrive_Json_SetPermissions",I.propertyId="SkyDrive",I.start()}function h(e){return{id:e.id,refId:"",canChange:!1,name:e.name,allowedActions:[],entities:[]}}function p(e,t,n,i){for(var r=t.permissionScopes,o=0;o<r.length;o++)if(r[o].id==e.id)return i?r.splice(o,1)[0]:r[o];if(n){var a=h(e);return r.push(a),a}return null}function g(e,t){var n;if(e&&!e.getParent)return n=p(e,t,!1,!0),n&&t.permissionScopes.unshift(n),void 0;for(var i=[];e;)n=p(e,t,!1,!0),n&&i.push(n),e=e.getParent(!0);t.permissionScopes=i.concat(t.permissionScopes)}function m(t){for(var n=null,i=null,r=null,o=0;o<t.length;o++){var a=t[o];a.type==e.EntityType.Link?a.linkType==e.LinkType.View?n=a:a.linkType==e.LinkType.Edit&&(i=a):a.type==e.EntityType.Public&&(r=a)}r&&(t.remove(r),t.unshift(r)),i&&(t.remove(i),t.unshift(i)),n&&(t.remove(n),t.unshift(n))}function v(t,i){i.permissionScopes=i.permissionScopes||[],g(t,i);for(var r=i.permissionScopes,o=0;o<r.length;o++)r[o].entities.remove||(r[o].entities=Array.prototype.slice.call(r[o].entities)),m(r[o].entities);var a=r[0];if(0!=r.length&&n.StringHelpers.caseInsensitiveStringEquals(a.id,t.id)||(a=h(t),r.splice(0,0,a)),i.group||!L.isViewerOwner(t)||L.isCoOwner(t)||t.groupFolderType==n.GroupFolderType.MountPoint){var s,l;if(i.group){var c=$(t);s=p(c,i,!0),l={role:i.groupUserRole,type:e.EntityType.GroupOwned}}else s=r[0],l={did:i.ownerDCid?i.ownerDCid:t.ownerDCid,id:i.ownerCid,name:i.ownerName,role:e.Role.Owner,type:e.EntityType.User};return s.entities.unshift(l),void 0}}function y(e,n,i){if(v(e,n),S(e))return C(e,n),void 0;void 0===i&&(i=!1);var r=n.permissionScopes,o={};for(var a in n)"permissionScopes"!==a&&(o[a]=n[a]);var s=e,l=e.getParent(!0);s._cachingParentId=l&&l.id;for(var c,u=r.slice(0);s&&!P(s);){var d=[];for(c=0;c<u.length;c++){var f=u[c];
f.id!==s.id&&(f.refId!=s.id||l&&f.id==l.id)||(d.push(u[c]),u.splice(c,1),c--)}if(0==d.length&&d.push(h(s)),s._permissionScope=new t(d),i)break;s=s.getParent(!0)}u.length>0&&!i?e._cappedPermissions=u:k(e)&&(e._cappedPermissions=[]);var p=new t(o);if(e._permissionExtra=p,!o.group&&!i)for(s=e.getParent(!0);s&&!P(s);)s._permissionExtra=p,s=s.getParent(!0)}function _(e,t){if(S(e))return b(e,t);var n=e.getParent(!0),i=e._permissionExtra;if(!i||!t&&i.isExpired()||!n||e._cachingParentId!=n.id)return null;var r={};for(var o in i.value)r[o]=i.value[o];r.permissionScopes=[];for(var a=[],s=e;s&&!P(s);){var l=s._permissionScope;if(!l||!t&&l.isExpired())return null;for(var c=l.value,u=0;u<c.length;u++){var d=c[u];(d.entities.length>0||s==e)&&(d.refId?a.push(d):(d.name=s.name,r.permissionScopes.push(d)))}s=s.getParent(!0)}return a.length>0&&(r.permissionScopes=r.permissionScopes.concat(a)),k(e)&&e._cappedPermissions&&e._cappedPermissions.length>0&&(r.permissionScopes=r.permissionScopes.concat(e._cappedPermissions)),r}function w(e){if(S(e))return b(e)?void 0:!1;var t=e.getParent(!0);if(k(e)&&(!e._cappedPermissions||t&&e._cachingParentId&&e._cachingParentId!=t.id))return!1;for(var n=-1,i=0,r=e;r&&!P(r);){var o=r._permissionScope;if(!o||o.isExpired())n=i;else{var a=r._permissionExtra;r!==e||a&&!a.isExpired()||(n=i)}if(n>0)break;r=r.getParent(!0),i++}return-1===n?void 0:D(e)?!1:!n}function b(e,t){var n=e._simplePermissions;return!n||!t&&n.isExpired()?null:n.value}function C(e,n){e._simplePermissions=new t(n)}function S(e){return E(e)||FilesConfig.isWacSharing||!e.getParent||!e.group&&!I(e)}function k(e){return I(e)}function I(e){return n.StringHelpers.caseInsensitiveStringEquals(T,e.ownerCid)||L.isOwnerOrCoOwner(e)}var x=this,T=o,L=n.SkyDriveItemHelper,P=n.SkyDriveItemHelper.isRootItem,D=n.SkyDriveItemHelper.isGroupItem,E=n.SkyDriveItemHelper.isSearchResult,$=n.SkyDriveItemHelper.getTopLevelItem,A={};x.hasCachedData=function(e){return void 0===w(e)},x.deletePermission=function(t,n,i,o){n.role=r,this.updatePermissions(t,null,n,{suppressNotification:!0},e.UserAction.Manage,i,d(o))},x.embedLink=function(t,n,i){var r={role:e.Role.View,type:e.EntityType.Link,linkType:e.LinkType.Embed};this.updatePermissions(t,null,r,null,e.UserAction.Share,n,d(i))},x.submitFormLink=function(t,n,i){var r={role:e.Role.Submit,type:e.EntityType.Link,linkType:e.LinkType.Form};this.updatePermissions(t,null,r,null,e.UserAction.Share,n,d(i))},x.makePublic=function(t,n,i,r,o){var a={role:e.Role.View,type:e.EntityType.Public};this.updatePermissions(t,n,a,i,e.UserAction.Share,r,d(o))},x.createLink=function(t,n,i,r,o,a){var s={role:i,type:e.EntityType.Link,linkType:i==e.Role.Edit?e.LinkType.Edit:e.LinkType.View};this.updatePermissions(t,n,s,r,e.UserAction.Share,o,d(a))},x.createPermissionEntity=function(t,n){var i=null;if(t.error())return i;var r=jQuery("<div></div>"),o=t&&t.contact(),a=o&&o.cid();a&&a.indexOf("-")>-1&&(a=null);var s=t.email(),l=t.isGroup()?e.EntityType.Group:a?e.EntityType.User:o&&"FB"===o.sourceId()?e.EntityType.Facebook:e.EntityType.Email;return i={role:n,type:l},s&&l!=e.EntityType.Facebook&&(i.email=r.html(s).text()),l==e.EntityType.User?i.did=a:l==e.EntityType.Group?i.abId=o&&o.id():l==e.EntityType.Facebook&&(i.id=o&&o.id()),i},x.shareToContacts=function(t,n,r,o,a,s,l,c,u){for(var d,h=[],p=0;p<r.length;p++){var g=x.createPermissionEntity(r[p],o);if(null==g){d=!0;break}h.push(g)}d?u&&u(t,{message:i("Sharing.ShareInvalidEmailError")}):0==h.length?u&&u(t,{message:i("Sharing.ShareNoRecipientError")}):f(t,n,h,s,a,!1,null,null,e.UserAction.Share,l,function(e,t){var n,i=h[0];if(t)for(var r=0;r<t.length;r++){var o=t[r];if(i.role===o.role&&i.email===o.email){n=t[r];break}}c&&c(e,n)},u)},x.shareToNetworks=function(t,n,i,r,o,a,s,l){for(var c=[],u=0;u<i.length;u++){var d=i[u],h={role:r,type:e.EntityType.Link,linkType:e.LinkType.Network,linkName:d.id};c.push(h)}f(t,n,c,o,null,!1,null,null,e.UserAction.Share,a,function(e,t){var n,i=c[0];if(t)for(var r=0;r<t.length;r++){var o=t[r];if(i.linkType===o.linkType&&i.role===o.role&&i.type===o.type&&i.linkName===o.linkName){n=t[r];break}}s&&s(e,n)},l)},x.updatePermissions=function(t,i,r,o,a,s,l){var c=r.type==e.EntityType.GroupOwned;delete r.link,f(t,i,c?[]:[r],null,null,c,c?r.role:null,o&&o.suppressNotification,a,o,function(e,t){var i;if(t)for(var o=0;o<t.length;o++){var a=t[o];r.linkType!==a.linkType||r.role!==a.role||r.type!==a.type||null!=r.id&&!n.StringHelpers.caseInsensitiveStringEquals(r.id,a.id)||(i=t[o])}s&&s(e,c?r:i)},l)},x.fetchPermissions=function(e,t,i,r){var o=!r&&_(e);if(o)t(e,o);else{var a=w(e),s=A[e];if(void 0!==s)t&&s.successCallbacks.push(t),i&&s.failureCallbacks.push(i);else{var l={id:e.id,v:Math.random(),mkt:$Config.mkt};e.ownerCid&&(l.cid=e.ownerCid),D(e)&&(l.group=e.group),a&&(l.itemOnly=a),FilesConfig&&FilesConfig.ticket?l.ticket=FilesConfig.ticket:FilesConfig&&FilesConfig.authKey&&(l.authkey=FilesConfig.authKey);var c=FilesConfig.baseApiUrl+"GetPermissions?"+$Utility.serialize(l),u=new n.DataRequest(c,c,null,function(t){y(e,t,a);var n=_(e,!0),i=A[e];delete A[e];for(var r=0;r<i.successCallbacks.length;r++)i.successCallbacks[r](e,n)},function(t){var n=A[e];delete A[e];for(var i=0;i<n.failureCallbacks.length;i++)n.failureCallbacks[i](e,t.error)});u.apiId="SkyDrive_Json_GetPermissions",u.propertyId="SkyDrive";var d={successCallbacks:[],failureCallbacks:[],request:u};void 0!==t&&d.successCallbacks.push(t),void 0!==i&&d.failureCallbacks.push(i),A[e]=d,u.start()}}},x.updateBundle=function(e,t,i,r,o){for(var a={bundleId:e.id},s=[],l=0;l<t.length;l++)s.push(t[l].id);a.items=s,null!=i&&(a.bundleAction=i);var c=Object.toJSON(a),d=FilesConfig.baseApiUrl+"UpdateBundle",f=new n.DataRequest(null,d,c,function(t){r&&r(e,t)},function(t){o&&o(e,t)},u,null,0);f.apiId="SkyDrive_Json_UpdateBundle",f.propertyId="SkyDrive",f.start()},x.getCachedPermissions=function(e){if(e.sharingLevelValue==a){var t={canChange:!0,group:!1,groupUserRole:0,ownerName:e.ownerName,ownerCid:e.ownerCid,permissionScopes:[h(e)]};return t}var n=_(e);return n}}function t(e){this.value=e,this.expires=(new Date).getTime()+o,this.isExpired=function(){return this.expires<(new Date).getTime()}}var n=wLive.Core,i=n.AleHelpers.getPCString,r=0,o=12e4,a=4,s=3e3,l=3006,c=3012,u=6e4;e.Role={Owner:-1,View:1,Edit:2,Submit:3,CoOwner:4},e.GroupRole={View:0,Edit:1},e.EntityType={Email:0,User:1,Group:2,Link:3,Public:4,Friends:5,Facebook:6,Application:7,GroupOwned:99},e.LinkType={Network:1,Embed:3,View:5,Edit:6,Form:7},e.UserAction={Share:0,Manage:1},e.BundleAction={Add:0,Remove:1},e.AllowedActions={Remove:0},e.Expiry={LongedLived:0,ShortLived:1},n.PermissionsProvider=e}()}),define("embed",["doregister","jquery-1.7.2","wliveloaded","alehelpers","errormanager","itemactionhelper","permissionsprovider"],function(){!function(){function e(e){function i(e){j.empty();var t=$f.createLoading(!0);j.html(t),j.show();var n=(e-j.height())/2;j.css("padding-top",Math.ceil(n))}function h(){j.hide()}function p(e,t){if(t){var n=x(e),i=jQuery(_ce("div")).attr({id:"preview"}).width(n),r=jQuery(_ce("div")).attr({id:"column"}).width(a-n);g(i,e),v(r,e,t),jQuery("#mainBody").append(i,r);var o=_ge("generateButton");o&&o.focus()}}function g(e,t){if(H)e.append(H.embedCode),e.children("iframe").attr({id:"preview_iframe",tabindex:"-1"});else{var i,r=o(t)||t.iconType;i=O&&r===d?jQuery(_ce("img")).attr({id:"preview_iframe",src:FilesConfig.foldersImgBaseUrl+"/embed_excel.png",alt:"Excel",tabindex:"-1"}):O&&r===u?jQuery(_ce("img")).attr({id:"preview_iframe",src:FilesConfig.foldersImgBaseUrl+"/embed_ppt.png",alt:"PowerPoint",tabindex:"-1"}):!O||r!==c&&r!==f?jQuery(_ce("iframe")).attr({id:"preview_iframe",tabindex:"-1",scrolling:"no",frameborder:"0",width:""+x(t),height:""+T(t,!0),src:n.ItemActionHelper.itemStringFormat("/embed?{cidQueryString}{resIdQueryString}",t,t.ownerCid,t.group)}):jQuery(_ce("img")).attr({id:"preview_iframe",src:FilesConfig.foldersImgBaseUrl+"/embed_word.png",alt:"Word",tabindex:"-1"}),e.append(i)}}function m(e){O&&(e.html(H.embedCode),e.children("iframe").attr({id:"preview_iframe"}))}function v(e,t,n){var i=jQuery(_ce("div")).attr({id:"instructions"}),o=jQuery(_ce("div")).attr({id:"gen"}),a=jQuery(_ce("div")).attr({id:"disclaimer"}).html(r("Embed.Disclaimer"));y(i,t),w(o,t,n),e.append(i,o,a),C(e,t)}function y(e,t){H?$B.IE?(e.html(r("Embed.CopyInstructions."+I(t)).format('<span id="copyHtml">',"</span>")),jQuery(e).find("span").click(_)):e.html(r("Embed.CopyInstructions."+I(t)).format("","")):e.html(r("Embed.GenerateInstructions."+I(t)))}function _(){document.getElementById("embedTextbox").createTextRange().execCommand("Copy")}function w(e,t,n){if(H){var i=jQuery(_ce("input")).attr({id:"embedTextbox",name:"HTML",type:"text",value:H.embedCode}).width(a-s-x(t));(!$B.SF_iPhone||$B.Mobile)&&i.attr("readonly","readonly"),i.click(function(){b(jQuery(this))}),e.html(i)}else{var o=jQuery(_ce("input")).attr({id:"generateButton","class":"default",name:r("Embed.Generate"),type:"button",value:r("Embed.Generate")}).click(function(){S(t,n)});e.html(o)}}function b(e){e.focus(),e.select()}function C(e){if(U&&H&&H.embedConfiguratorUrl){var t=jQuery(_ce("div")).attr({id:"configurator"});t.html(jQuery(_ce("a")).attr({href:H.embedConfiguratorUrl,target:"_blank"}).html(r("Embed.Configurator"))),e.append(t)}}function S(t,n){jQuery("#generateButton").attr("disabled","disabled"),e.embedLink(t,function(e,t){P(e,t,n)},D)}function k(e){B&&B(),e.dismiss(),W.dispose()}function I(e){var t;return t=e.photo?"Photo":e.folder&&e.folder.covers?"Album":e.folder?"Folder":"File"}function x(e){var t=o(e)||e.iconType;if(e.photo||e.video){var n=e.video?e.video:e.photo,i=320;return n.width>n.height?Math.min(n.width,i):n.height<i?n.width:Math.floor(i*(n.width/n.height))}return e.folder?165:O&&t===d?402:O&&t===u?402:!O||t!==c&&t!==f?98:476}function T(e,t){var n=o(e)||e.iconType;if(e.photo||e.video){var i=e.photo?e.photo:e.video,r=320;return i.height>i.width?Math.min(i.height,r):i.width<r?i.height:Math.floor(r*(i.height/i.width))}return O&&n===d?346:O&&n===u?327:!O||n!==c&&n!==f?t&&e.folder?128:e.folder?139:t?120:125:288}function L(e,i,r){var o=t.FilesConfig.baseApiUrl+"GetEmbedInfo?id="+e.id,a=new n.DataRequest(o,o,null,i,r);a.apiId="SkyDrive_Json_GetEmbedInfo",a.propertyId="SkyDrive",a.start()}function P(e,t,n){return R?(R(t),void 0):(L(e,function(t){E(t),F&&(jQuery("#column").empty(),v(jQuery("#column"),e,n),m(jQuery("#preview"),e),jQuery("div.Footer button").show(),b(jQuery("#embedTextbox")),A())},$),void 0)}function D(){jQuery("#instructions").html(r("Embed.PopoverError")),jQuery("#generateButton").removeAttr("disabled")}function E(e){H=e&&e.embedCode?e:null}function $(e,t){e&&e.error&&e.error.code==l&&t?(e.error.isExpected=!0,t(e)):jQuery("#mainBody").html(r("Embed.PopoverError"))}function A(){sutra(N.find(".Content"),"$Sutra.SkyDrive.EmbedPopover"),sutra(N.find(".UserTitle"),"$Sutra.SkyDrive.EmbedTitle"),sutra(jQuery("#preview"),"$Sutra.SkyDrive.EmbedPreview"),sutra(jQuery("#preview_iframe"),"$Sutra.SkyDrive.EmbedPreviewIframe"),sutra(jQuery("#embedTextbox"),"$Sutra.SkyDrive.EmbedTextbox"),sutra(jQuery("#configurator"),"$Sutra.SkyDrive.EmbedExcelLink"),sutra(jQuery("#generateButton"),"$Sutra.SkyDrive.EmbedGenerateBtn"),sutra(jQuery(F.getButton({buttonName:"close"})),"$Sutra.SkyDrive.EmbedDoneBtn")}var F,N,M,B,R,H,O,U,j,W=this,Q=wLive.Controls.Notifications;W.dispose=function(){F&&(F.dismiss(),F=null)},W.show=function(e,t,n,a,s){function l(e){E(e),m()}U=t,O=n,a&&(B=a),s&&(R=s);var c=function(e,t){jQuery("iframe#preview_iframe").attr({src:""}),jQuery("#CancelIcon").unbind("click"),k(t)};j=jQuery('<div id="embedLoading"></div>');var u=T(e);M=U||o(e)!==d?r("Embed.Done"):r("Embed.Cancel"),e.video&&SkyDrive.UI.VideoDataContext&&SkyDrive.UI.VideoDataContext.pauseAll();var f=jQuery(_ce("div")).attr({id:"mainBody"}).css({"min-height":u}).append(j);F=Q.createModalDialog({buttons:{close:M},title:r("Embed.EmbedDocumentTitle").format(e.name),content:f});var g=jQuery(F);g.bind({"aftershow._dlg":function(){i(u),N=jQuery(F.content()),L(e,l,function(e){$(e,l)})},"afterdismiss._dlg":function(){g&&g.unbind("._dlg"),g=null,F=null},"buttonclick._dlg":c}),F.show();var m=function(){F&&(h(),p(e,F),jQuery("#mainBody").height(function(){var t=jQuery("#column").height(),n=T(e,!0);return t>n?t:(jQuery("#column").height(n),n)}),A())}}}var t=window,n=wLive.Core,i=wLive.Controls,r=n.AleHelpers.getPCString,o=n.SkyDriveItemHelper.getNormalizedExtension,a=795,s=18,l=3017,c="Doc",u="Ppt",d="Xls",f="Pdf";i.Embed=e}()}),define("skydrive_pc_strip_32_ltr",[],function(){window.FilesIS32={InteractiveModeButtonActive:{x:1,y:1,w:97,h:96},InteractiveModeButtonRest:{x:1,y:99,w:97,h:96},InteractiveModeButtonHover:{x:100,y:1,w:97,h:96},mobileUpsell:{x:100,y:99,w:77,h:42},nextHover:{x:100,y:143,w:69,h:40},nextRest:{x:1,y:197,w:69,h:40},previousRest:{x:72,y:197,w:69,h:40},previousHover:{x:199,y:1,w:69,h:40},groupsIcon60:{x:199,y:43,w:60,h:60},video_48:{x:179,y:105,w:48,h:48},processingVideo_48:{x:171,y:155,w:48,h:48},ft_48_Notebook:{x:1,y:239,w:48,h:48},ft_48_Docx:{x:51,y:239,w:48,h:48},ft_48_Pptx:{x:101,y:239,w:48,h:48},ft_48_Xlsx:{x:151,y:205,w:48,h:48},skydrive:{x:221,y:155,w:45,h:40},PanoBackRest:{x:201,y:205,w:41,h:41},PanoBackActive:{x:270,y:1,w:41,h:41},PanoBackHover:{x:261,y:44,w:41,h:41},PanoZoomOutRest:{x:229,y:105,w:40,h:40},PanoZoomOutActive:{x:271,y:87,w:40,h:40},PanoZoomOutHover:{x:271,y:129,w:40,h:40},PanoZoomInRest:{x:268,y:171,w:40,h:40},PanoZoomInActive:{x:244,y:213,w:40,h:40},PanoZoomInHover:{x:1,y:289,w:40,h:40},formLinkIcon_40_White:{x:43,y:289,w:40,h:40},friendsIcon_40:{x:85,y:289,w:40,h:40},formLinkIcon_40:{x:151,y:255,w:40,h:40},embedIcon_40_White:{x:193,y:255,w:40,h:40},publicIcon_40_White:{x:235,y:255,w:40,h:40},publicIcon_40:{x:313,y:1,w:40,h:40},linkIcon_40_White:{x:304,y:44,w:40,h:40},linkIcon_40:{x:313,y:86,w:40,h:40},groupsIcon_40_White:{x:313,y:128,w:40,h:40},groupsIcon_40:{x:310,y:171,w:40,h:40},friendsIcon_40_White:{x:286,y:213,w:40,h:40},embedIcon_40:{x:277,y:255,w:40,h:40},ft_32_NonEmptyFavoriteFolder:{x:127,y:297,w:32,h:32},processingVideo_32:{x:161,y:297,w:32,h:32},ft_32_Txt:{x:195,y:297,w:32,h:32},ft_32_Xlsx:{x:229,y:297,w:32,h:32},ft_32_Video:{x:263,y:297,w:32,h:32},embedIconWhite:{x:319,y:255,w:32,h:32},friendsIconWhite:{x:297,y:297,w:32,h:32},publicIconWhite:{x:1,y:331,w:32,h:32},publicIcon:{x:35,y:331,w:32,h:32},mailIcon:{x:69,y:331,w:32,h:32},friendsIcon:{x:103,y:331,w:32,h:32},formLinkIconWhite:{x:137,y:331,w:32,h:32},formLinkIcon:{x:171,y:331,w:32,h:32},embedIcon:{x:205,y:331,w:32,h:32},linkIconWhite:{x:239,y:331,w:32,h:32},linkIcon:{x:273,y:331,w:32,h:32},ft_32_Zip:{x:307,y:331,w:32,h:32},ft_32_Docx:{x:355,y:1,w:32,h:32},ft_32_Pptx:{x:355,y:35,w:32,h:32},ft_32_Notebook:{x:355,y:69,w:32,h:32},ft_32_Audio:{x:355,y:103,w:32,h:32},ft_32_Blank:{x:355,y:137,w:32,h:32},groupsIcon:{x:352,y:171,w:30,h:30},groupsIconWhite:{x:328,y:213,w:30,h:30},BackToFolderHover:{x:353,y:245,w:30,h:30},PreviousItemRest:{x:331,y:289,w:30,h:30},NextItemPressed:{x:341,y:321,w:30,h:30},PreviousItemHover:{x:1,y:365,w:30,h:30},PreviousItemPressed:{x:33,y:365,w:30,h:30},BackToFolderRest:{x:65,y:365,w:30,h:30},BackToFolderPressed:{x:97,y:365,w:30,h:30},panorama:{x:129,y:365,w:30,h:30},NextItemHover:{x:161,y:365,w:30,h:30},ViewItemInfoPressed:{x:193,y:365,w:30,h:30},ViewItemInfoRest:{x:225,y:365,w:30,h:30},ViewItemInfoHover:{x:257,y:365,w:30,h:30},NextItemRest:{x:289,y:365,w:30,h:30},video_32:{x:321,y:365,w:30,h:30},uploadIconLight:{x:360,y:203,w:26,h:26},videoPause:{x:353,y:353,w:26,h:26},videoPausePressed:{x:389,y:1,w:26,h:26},videoPlay:{x:389,y:29,w:26,h:26},videoPlayPressed:{x:389,y:57,w:26,h:26},videoVolume:{x:389,y:85,w:26,h:26},videoVolumePressed:{x:389,y:113,w:26,h:26},videoMute:{x:389,y:141,w:26,h:26},videoMutePressed:{x:384,y:171,w:26,h:26},videoExpand:{x:388,y:199,w:26,h:26},videoExpandPressed:{x:388,y:227,w:26,h:26},videoCollapse:{x:385,y:255,w:26,h:26},videoCollapsePressed:{x:363,y:283,w:26,h:26},videoSettings:{x:373,y:311,w:26,h:26},videoSettingsPressed:{x:381,y:339,w:26,h:26},videoCloud:{x:381,y:367,w:26,h:26},videoSettingsDisabled:{x:1,y:397,w:26,h:26},videoSettingsHover:{x:29,y:397,w:26,h:26},videoCollapseDisabled:{x:57,y:397,w:26,h:26},videoCollapseHover:{x:85,y:397,w:26,h:26},videoExpandDisabled:{x:113,y:397,w:26,h:26},videoExpandHover:{x:141,y:397,w:26,h:26},videoMuteDisabled:{x:169,y:397,w:26,h:26},videoMuteHover:{x:197,y:397,w:26,h:26},videoVolumeDisabled:{x:225,y:397,w:26,h:26},videoVolumeHover:{x:253,y:397,w:26,h:26},videoPlayDisabled:{x:281,y:397,w:26,h:26},videoPlayHover:{x:309,y:397,w:26,h:26},videoPauseDisabled:{x:353,y:381,w:26,h:26},videoPauseHover:{x:381,y:395,w:26,h:26},uploadIconDark:{x:417,y:1,w:26,h:26},createIconLight:{x:417,y:29,w:26,h:26},createIconDark:{x:417,y:57,w:26,h:26},cancelRest:{x:417,y:85,w:20,h:20},cancelActive:{x:417,y:107,w:20,h:20},addCoOwnersIcon:{x:417,y:129,w:20,h:20},CancelDarkHover:{x:417,y:151,w:20,h:20},CancelLightActive:{x:412,y:173,w:20,h:20},CancelLightRest:{x:416,y:195,w:20,h:20},EditDarkActive:{x:416,y:217,w:20,h:20},EditDarkHover:{x:416,y:239,w:20,h:20},EditLightActive:{x:391,y:283,w:20,h:20},EditLightRest:{x:413,y:261,w:20,h:20},SaveDarkHover:{x:413,y:283,w:20,h:20},SaveDarkRest:{x:401,y:305,w:20,h:20},SaveLightActive:{x:423,y:305,w:20,h:20},SaveLightRest:{x:409,y:327,w:20,h:20},SaveLightHover:{x:409,y:349,w:20,h:20},SaveDarkActive:{x:409,y:371,w:20,h:20},EditLightHover:{x:409,y:393,w:20,h:20},EditDarkRest:{x:1,y:425,w:20,h:20},CancelLightHover:{x:23,y:425,w:20,h:20},CancelDarkRest:{x:45,y:425,w:20,h:20},CancelDarkActive:{x:67,y:425,w:20,h:20},cancelHover:{x:89,y:425,w:20,h:20},skydrive_16Selected:{x:111,y:425,w:18,h:18},goBackNormal:{x:131,y:425,w:18,h:18},goBackHover:{x:151,y:425,w:18,h:18},skydrive_16:{x:171,y:425,w:18,h:18},zoomInHover:{x:191,y:425,w:16,h:16},zoomOutHover:{x:209,y:425,w:16,h:16},zoomOutRest:{x:227,y:425,w:16,h:16},zoomInRest:{x:245,y:425,w:16,h:16},centerRest:{x:263,y:425,w:16,h:16},ft_16_EmptyDocumentFolderSelected:{x:281,y:425,w:16,h:16},ft_16_EmptyAlbumSelected:{x:299,y:425,w:16,h:16},ft_16_Bundle:{x:317,y:425,w:16,h:16},ft_16_BundleWithBorderSelected:{x:335,y:425,w:16,h:16},info_16:{x:353,y:409,w:16,h:16},info_gray_16:{x:353,y:427,w:16,h:16},ft_16_SharedFolderSelected:{x:371,y:423,w:16,h:16},ft_16_Docx:{x:389,y:423,w:16,h:16},ft_16_Pptx:{x:409,y:415,w:16,h:16},blocked16:{x:427,y:415,w:16,h:16},ft_16_SharedGlyphSelected:{x:445,y:1,w:16,h:16},ft_16_Notebook:{x:445,y:19,w:16,h:16},ft_16_Xlsx:{x:445,y:37,w:16,h:16},ft_16_SharedGlyphGray:{x:445,y:55,w:16,h:16},ft_16_SharedGlyph:{x:445,y:73,w:16,h:16},centerHover:{x:439,y:91,w:16,h:16},ft_16_SharedFolder:{x:439,y:109,w:16,h:16},ft_16_BundleSelected:{x:439,y:127,w:16,h:16},ft_16_NonEmptyAlbumSelected:{x:439,y:145,w:16,h:16},ft_16_NonEmptyDocumentFolderSelected:{x:439,y:163,w:16,h:16},ft_16_EmptyFavoriteFolderSelected:{x:438,y:181,w:16,h:16},ft_16_NonEmptyDocumentFolder:{x:438,y:199,w:16,h:16},ft_16_EmptyAlbum:{x:438,y:217,w:16,h:16},ft_16_NonEmptyFavoriteFolderSelected:{x:438,y:235,w:16,h:16},ft_16_NonEmptyAlbum:{x:438,y:253,w:16,h:16},ft_16_EmptyDocumentFolder:{x:435,y:271,w:16,h:16},ft_16_EmptyFavoriteFolder:{x:445,y:289,w:16,h:16},ft_16_NonEmptyFavoriteFolder:{x:445,y:307,w:16,h:16},searchIcon:{x:337,y:397,w:14,h:14},warning:{x:360,y:231,w:12,h:12},checkMark:{x:374,y:231,w:12,h:12},whiteClosedUp11x9:{x:431,y:327,w:9,h:11},freClose:{x:442,y:327,w:11,h:11},freCloseHover:{x:431,y:340,w:11,h:11},collapse11x9:{x:100,y:185,w:11,h:9},expand11x9:{x:113,y:185,w:11,h:9},openUp11x9:{x:126,y:185,w:11,h:9},darkPanelOpenUp11x9:{x:139,y:185,w:11,h:9},whiteOpenUp11x9:{x:152,y:185,w:11,h:10},darkPanelClosedUp11x9:{x:444,y:340,w:9,h:11},closedUp11x9:{x:431,y:353,w:9,h:11},privateIcon:{x:261,y:87,w:8,h:10},privateIconWhite:{x:341,y:353,w:10,h:10},restoreRest:{x:337,y:413,w:10,h:10},restoreHover:{x:442,y:353,w:10,h:10},whiteClosedUp:{x:171,y:143,w:6,h:8},whiteOpenUp:{x:143,y:197,w:8,h:6},openUp:{x:153,y:197,w:8,h:6},darkPanelOpenUp:{x:229,y:147,w:8,h:6},closedUp:{x:143,y:205,w:6,h:8},darkPanelClosedUp:{x:143,y:215,w:6,h:8},sortMenuBullet:{x:328,y:245,w:8,h:8},chevronRightGray:{x:143,y:225,w:6,h:8},chevronRightBlack:{x:346,y:43,w:6,h:8}}}),define("skydrive_pc_strip_8_ltr",[],function(){window.FilesIS8={ft_48_Blank:{x:1,y:1,w:48,h:48},ft_48_NonEmptyFavoriteFolder:{x:51,y:1,w:48,h:48},ft_48_Zip:{x:1,y:51,w:48,h:48},ft_48_Photo:{x:51,y:51,w:48,h:48},ft_48_Txt:{x:101,y:1,w:48,h:48},ft_48_NonEmptyAlbum:{x:101,y:51,w:48,h:48},ft_48_EmptyAlbum:{x:1,y:101,w:48,h:48},ft_48_NonEmptyDocumentFolder:{x:51,y:101,w:48,h:48},ft_48_EmptyDocumentFolder:{x:101,y:101,w:48,h:48},ft_48_Video:{x:151,y:1,w:48,h:48},ft_48_Audio:{x:151,y:51,w:48,h:48},ft_32_NonEmptyDocumentFolder:{x:151,y:101,w:32,h:32},ft_32_EmptyDocumentFolder:{x:1,y:151,w:32,h:32},ft_32_Photo:{x:35,y:151,w:32,h:32},ft_32_NonEmptyAlbum:{x:69,y:151,w:32,h:32},ft_32_EmptyAlbum:{x:103,y:151,w:32,h:32},groups:{x:151,y:135,w:32,h:32},gridIconSelected:{x:1,y:185,w:26,h:26},listIconSelected:{x:29,y:185,w:26,h:26},customIconSelected:{x:57,y:185,w:26,h:26},infoPaneIconSelected:{x:85,y:185,w:26,h:26},infoPaneIcon:{x:113,y:185,w:26,h:26},customIcon:{x:141,y:169,w:26,h:26},listIcon:{x:169,y:169,w:26,h:26},upIcon:{x:201,y:1,w:26,h:26},gridIcon:{x:201,y:29,w:26,h:26},darkPanelOpen:{x:201,y:57,w:20,h:25},lightPanelOpen:{x:201,y:84,w:20,h:25},panelClose:{x:185,y:111,w:20,h:25},error:{x:207,y:111,w:16,h:16},ft_16_Blank:{x:185,y:138,w:16,h:16},ft_16_Zip:{x:207,y:129,w:16,h:16},ft_16_Photo:{x:203,y:147,w:16,h:16},ft_16_Video:{x:197,y:165,w:16,h:16},ft_16_Txt:{x:197,y:183,w:16,h:16},ft_16_Audio:{x:1,y:213,w:16,h:16},redX:{x:19,y:213,w:16,h:16},ppRedX:{x:37,y:213,w:13,h:13},ppSearch:{x:52,y:213,w:13,h:13},ppGreyX:{x:67,y:213,w:13,h:13},close:{x:137,y:151,w:10,h:10}}}),define("skydrive_sharing_strip_8_ltr",[],function(){window.SharingIS={linkedin:{x:1,y:1,w:20,h:20},add:{x:23,y:1,w:20,h:20},weibo:{x:1,y:23,w:20,h:20},twitter:{x:23,y:23,w:20,h:20},facebook:{x:45,y:1,w:20,h:20}}}),define("header_strip_ltr",[],function(){window.HeaderIS={dogfood:{x:2,y:2,w:110,h:110},onenote:{x:116,y:2,w:110,h:110},people:{x:2,y:116,w:110,h:110},sway:{x:116,y:116,w:110,h:110},office:{x:230,y:2,w:110,h:110},word:{x:230,y:116,w:110,h:110},ppt:{x:2,y:230,w:110,h:110},outlook:{x:116,y:230,w:110,h:110},excel:{x:230,y:230,w:110,h:110},onedrive:{x:344,y:2,w:110,h:110},calendar:{x:344,y:116,w:110,h:110}}}),define("inlineerror",["jquery-1.7.2","sutra","alehelpers"],function(){!function(){function e(e,t,n){var r=this;r.render=function(){var r=jQuery('<div class="ine_error"></div>');e.append(r),sutra(r,"$Sutra.SkyDrive.InlineError");var o=jQuery('<div class="ine_text"></div>');n&&t?o.html(t):t?o.text(t):o.text(i),r.append(o),r.append(jQuery('<div class="c_clr"></div>'))}}var t=wLive.Core,n=t.AleHelpers.getPCString,i=n("ReportAbuse.PopoverError");wLive.Controls.InlineError=e}()}),define("loadingspinner",["baseutil","jquery-1.7.2","sutra","alehelpers"],function(){!function(){function e(e,n){var i=this;i.render=function(){n=null==n?t:n;var i=$f&&$f.createLoading({returnMarkup:!0,useTransparentFallback:!0,text:n}),r=jQuery(i);e.append(r),$f.showLoading(r),r.find(".c_loadingText").addClass("t_ctc"),sutra(r,"$Sutra.SkyDrive.LoadingSpinner")}}var t=wLive.Core.AleHelpers.getString("Loading");wLive.Controls.LoadingSpinner=e}()}),define("loadingcue",["loadingspinner"],function(){!function(){function e(e){e.html(n);var a=jQuery(".lcCenter",e),s=jQuery(".lcWrapper",e).hide(),l=new t.LoadingSpinner(s);l.render(),s.css("margin-"+o,-(s.width()/2)),sutra(s,"$Sutra.SkyDrive.LoadingCue");var c=this,u=!1;c.setVisibility=function(e){e?(u||(r?s.stop(!0).delay(i).css("opacity",0).show().animate({opacity:1},500):s.show()),a.offset().top>=jQuery(window).scrollTop()?s.css({position:"absolute"}):s.css({position:"fixed"})):s.stop(!0).hide(),u=e},c.update=function(){c.setVisibility(u)}}var t=wLive.Controls,n='<div class="lcCenter"><div class="lcWrapper"></div></div>',i=250,r=jQuery.support.opacity,o=$B.ltr?"left":"right";t.LoadingCue=e}()}),define("networklink",["wliveloaded","imagetile","alehelpers","skydrive_pc_strip_32_ltr","skydrive_pc_strip_8_ltr","skydrive_sharing_strip_8_ltr","header_strip_ltr"],function(){!function(){var e=JBase.UI.ImageStripHelper,t=wLive.Core.AleHelpers.getPCString;require(["skydrive_sharing_strip_8_ltr"],function(){e.registerStrip(FilesConfig.sharingStripUrl,SharingIS)});var n=2083,i={FB:{url:"https://www.facebook.com/sharer/sharer.php?u={{url}}",customUrl:"https://www.facebook.com/dialog/feed?app_id=30713015083&display=popup&name={{title}}&caption={{summary}}&description={{desc}}&link={{url}}&picture={{img}}&redirect_uri=https://www.facebook.com",icon:"facebook",width:626,height:436,sutra:"NetworkIconFB"},TWITR:{url:"http://twitter.com/share?url={{url}}",customUrl:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}",icon:"twitter",height:300,width:550,sutra:"NetworkIconTWITR"},LI:{url:"http://www.linkedin.com/shareArticle?mini=true&url={{url}}",customUrl:"http://www.linkedin.com/shareArticle?mini=true&title={{title}}&summary={{summary}}&url={{url}}",icon:"linkedin",height:427,width:550,sutra:"NetworkIconLI"},SINWE:{url:"http://service.weibo.com/share/share.php?url={{url}}",customUrl:"http://service.weibo.com/share/share.php?title={{text}}&url={{url}}&pic={{img}}",icon:"weibo",height:400,width:600,sutra:"NetworkIconSINWE"}};defineSubClass("SkyDrive.UI.NetworkLink",JBase.UI.BaseControl,function(){this.icon=this.createChild(JBase.UI.ImageTile)},{shortenButtonText:"",showShortenButton:!1,url:"",network:"",networkUrl:"",networkInfo:null,baseTag:"span",sutraLabel:"",bici:null,onDataContextChanged:function(t){var n=t.item;n.url&&(this.url=n.url),n.network&&(this.network=n.network),n.bici&&(this.bici=n.bici),i.hasOwnProperty(this.network)?(this.networkInfo=i[this.network],this.networkUrl=n.custom?this._generateCustomShareUrl(n,this.networkInfo.customUrl):this._generateShareUrl(this.url,this.networkInfo.url),this.icon.setDataContext(e.getImageInfo(this.networkInfo.icon))):(this.networkInfo=null,this.networkUrl="",this.icon.setDataContext({url:null}))},onActivate:function(e,t){t.anchor&&this.networkInfo&&sutra(t.anchor,"$Sutra.SkyDrive."+this.networkInfo.sutra)},_onClick:function(){this.bici&&this.bici();{var e=window.screenLeft?window.screenLeft:window.screenX?window.screenX:0,t=window.innerWidth||0,n=Math.max(t/2-this.networkInfo.width/2+e,0),i=window.screenTop?window.screenTop:window.screenY?window.screenY:0,r=window.innerHeight||0,o=Math.max(r/2-this.networkInfo.height/2+i,0);window.open(this.networkUrl,"sharing_"+this.network,"resizable, width="+this.networkInfo.width+", height="+this.networkInfo.height+", left="+n+", top="+o)}return!1},_generateShareUrl:function(e,t){var n=t;return n=n.replace("{{url}}",encodeURIComponent(e))},_generateCustomShareUrl:function(e,i){var r=i;if("FB"===e.network){r=r.replace("{{title}}",encodeURIComponent(e.title)),r=r.replace("{{img}}",encodeURIComponent(e.img));var o=encodeURIComponent(e.text),a=encodeURIComponent(e.addon);!$B.IE||r.length+o.length+a.length-"{{summary}}".length-"{{desc}}".length<n?(r=r.replace("{{summary}}",o),r=r.replace("{{desc}}",a)):(r=r.replace("{{summary}}",""),r=r.replace("{{desc}}",""))}else if("TWITR"===e.network)r=r.replace("{{text}}",encodeURIComponent(e.oneline));else if("LI"===e.network){r=r.replace("{{title}}",encodeURIComponent(e.title));var s=encodeURIComponent(t("Sharing.NetworkPostTextFormat").format(e.text,e.addon));r=!$B.IE||r.length+s.length-"{{summary}}".length<n?r.replace("{{summary}}",s):r.replace("{{summary}}","")}else"SINWE"===e.network&&(r=r.replace("{{text}}",encodeURIComponent(e.oneline)),r=r.replace("{{img}}",encodeURIComponent(e.img)));return r=r.replace("{{url}}",encodeURIComponent(e.url))}})}()}),define("networklink.html",["networklink"],function(){SkyDrive.UI.NetworkLink.prototype.onRenderHtml=function(){return"<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><a target="_blank" id="'+htmlAttributeEncode(this.id+"_1")+'"'+generateAttributesString("href",this.url)+">"+this.icon.renderHtml()+"</a></"+this.baseTag+">"},processAnnotations(SkyDrive.UI.NetworkLink,[{id:0},{id:1,attr:["href","url"],childId:"anchor",userActions:{click:"_onClick"}}],[],{})}),define("sharinglink",["networklink.html"],function(){!function(){var e=wLive.Core.AleHelpers.getPCString("Sharing.ShortenLink");defineSubClass("SkyDrive.UI.SharingLink",JBase.UI.BaseControl,function(){var e=this;e.networkLinks=e.createChild(JBase.UI.Repeater,{baseTag:"span",childControl:SkyDrive.UI.NetworkLink})},{shortenButtonText:e,url:"",networks:[],isDisabled:!1,isShortenEnabled:!1,isLinkShortened:!1,isReadOnly:!0,showShortenButton:!1,entity:null,onDataContextChanged:function(e){e.url&&(this.url=e.url),e.entity&&(this.entity=e.entity),e.networks&&(this.networks=e.networks),e.hasOwnProperty("isReadOnly")&&(this.isReadOnly=e.isReadOnly),e.hasOwnProperty("shortenEnabled")&&(this.isShortenEnabled=e.shortenEnabled,this.showShortenButton=this.isShortenEnabled&&!this.isLinkShortened),e.shortenAction&&(this._shortenAction=e.shortenAction),e.disabled&&(this.isDisabled=e.disabled,this.networks=[],this.showShortenButton=!1),this.networkLinks.setDataContext({items:this._buildNetworkLinksDataContext()})},select:function(){var e=this.subElements.linkDisplay;if(e&&e.setSelectionRange){var t=function(){try{e.setSelectionRange(0,9999)}catch(t){}};this.setTimeout(t,0)}},_buildNetworkLinksDataContext:function(){for(var e=[],t=0;t<this.networks.length;t++)e.push({network:this.networks[t],url:this.url});return e},_onDisplayClick:function(){this.select()},_onShortenClick:function(){return this._shortenAction(this.entity,this,bind(this,this._onShortenSuccess),bind(this,this._onShortenFailure)),!1},_onShortenSuccess:function(e){this.isLinkShortened=!0,this.setDataContext({url:e})},_onShortenFailure:function(){},_shortenAction:function(){}})}()}),define("sharinglink.html",["sharinglink"],function(){SkyDrive.UI.SharingLink.prototype.onRenderHtml=function(){return"<"+this.baseTag+sutraAttribute("SkyDrive.PermissionPaneLinkContainer")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><div class="sd_perm_link"><span class="sd_perm_link_url"><input type="text"'+sutraAttribute("SkyDrive.LinkHolder")+' id="'+htmlAttributeEncode(this.id+"_1")+'" class="sd_link_display sd_focusable"'+generateAttributesString("readonly",this.isReadOnly,"value",this.url,"disabled",this.isDisabled)+'></input></span><span class="sd_perm_link_networks">'+this.networkLinks.renderHtml()+'</span><span role="button" id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+generateStyleAttribute("display",this.showShortenButton)+'" class="sd_perm_link_shorten"><a href="#"'+sutraAttribute("SkyDrive.LinkShortenLinkButton")+' id="'+htmlAttributeEncode(this.id+"_3")+'" class="sd_shorten_button">'+htmlEncode(this.shortenButtonText)+'</a></span><div class="sd_perm_clear"></div></div></'+this.baseTag+">"},processAnnotations(SkyDrive.UI.SharingLink,[{id:0},{id:1,attr:["readonly","isReadOnly","value","url","disabled","isDisabled"],childId:"linkDisplay",userActions:{click:"_onDisplayClick"}},{id:2,css:["display","showShortenButton"]},{id:3,attr:["text","shortenButtonText"],childId:"shortenlink",userActions:{click:"_onShortenClick"}}],[],{})}),define("sendform",["doregister","jquery-1.7.2","wliveloaded","alehelpers","errormanager","loadingcue","permissionsprovider","sharinglink.html"],function(){!function(){function e(e){function n(e,n){var r={id:e.id};r.type=C.EntityType.Link,r.linkType=C.LinkType.Form,r.cid=e.ownerCid,t.SkyDriveItemHelper.isGroupItem(e)&&(r.group=e.group);var o=FilesConfig.baseApiUrl+"Shorten?"+$Utility.serialize(r),a=function(e){g||n(e.url)},s=function(){g||(D.hide(),E.text(i("SendSurvey.Error")),E.show())},l=new t.DataRequest(o,o,null,a,s);
l.apiId="SkyDrive_Json_ShortenUrl",l.propertyId="SkyDrive",l.start()}function r(){F.empty();var e=new wLive.Controls.LoadingSpinner(F);e.render(),F.show()}function o(){F.hide()}function a(e,t){g||(p=t,y.show(),v.addClass(M),o(),f(t,e))}function s(e,t){if(!g){D.hide();var n;if($.show(),o(),t&&t.code==N){var r=t.data,a=t.message;if(r&&a){var s=Object.fromJSON(r),l=s.smsUrl,c=s.displayAction;if(l&&c){n=a.encodeHtml()+' <a href="'+l.encodeHtml()+'" target="_blank">'+c.encodeHtml()+"</a>"}E.html(n)}}else E.text(i("SendSurvey.Error"));E.show()}}function l(e){g||(p=null,d(e,p),m&&m.reposition())}function c(e,n){if(!g){p=null;for(var i=n.permissionScopes,r=0;r<i.length;r++)for(var o=i[r],a=t.StringHelpers.caseInsensitiveStringEquals(o.id,e.id),s=o.entities,l=0;l<s.length;l++){var c=s[l];a&&c.type==C.EntityType.Link&&c.linkType==C.LinkType.Form&&(p=c)}d(e,p),m&&m.reposition()}}function u(){if(!g){L.show(),D.hide(),$.hide(),y.hide(),v.removeClass(M);var e=jQuery(_ce("img")).attr({id:"img_element",src:FilesConfig.foldersImgBaseUrl+"/embed_form.png",tabindex:"-1"});P.append(e),E.text(i("SendSurvey.Error")),E.show(),m&&m.reposition()}}function d(t,n){L.show(),E.hide(),o(),D.text(I);var i=jQuery(_ce("img")).attr({id:"img_element",src:FilesConfig.foldersImgBaseUrl+"/embed_form.png",tabindex:"-1"});P.append(i),n?(y.show(),v.addClass(M),$.hide(),f(n,t)):(y.hide(),v.removeClass(M),$.show(),$.click(function(){$.hide(),r(),e.submitFormLink(t,a,s)}),A.html(""),w&&(w.dispose(),w=null))}function f(e,t){w=new SkyDrive.UI.SharingLink,w.setDataContext({shortenEnabled:FilesConfig.urlShorteningEnabled,url:e.link,isReadOnly:!x,shortenAction:function(e,i,r){n(t,r)},entity:e});var i=A[0];setHtml(i,w.renderHtml()),w.activate()}function h(){sutra(_,"$Sutra.SkyDrive.ShareFormDialog"),sutra(jQuery(".UserTitle",_),"$Sutra.SkyDrive.ShareFormTitle"),sutra(P,"$Sutra.SkyDrive.ShareFormIcon"),sutra(D,"$Sutra.SkyDrive.ShareFormText"),sutra(E,"$Sutra.SkyDrive.ShareFormError"),sutra($,"$Sutra.SkyDrive.ShareFormGenerateBtn"),sutra(v,"$Sutra.SkyDrive.ShareFormDoneBtn"),sutra(y,"$Sutra.SkyDrive.ShareFormRemoveBtn")}var p,g,m,v,y,_,w,b=this,C=t.PermissionsProvider,S=(C.Role,wLive.Controls.Notifications),k=i("SendSurvey.Title"),I=i("SendSurvey.Note"),x=$B.SF_iPhone&&!$B.Mobile,T='<div id="sendFormBody"><div id="formIcon"></div><div id ="formNote"><div id="formText" type="text"></div><div id="errorText" type="text"></div><div id="LinkBox"><div id="linkControlHolder"></div><input id="btnGenerate" class="default" type="button" value="'+i("Sharing.CreateLink")+'"></input><div class="sf_loading"></div></div></div></div>',L=jQuery(T),P=jQuery("#formIcon",L),D=jQuery("#formText",L),E=jQuery("#errorText",L),$=jQuery("#btnGenerate",L),A=jQuery("#linkControlHolder",L),F=jQuery(".sf_loading",L),N=204,M="default";b.dispose=function(){w&&(w.dispose(),w=null),m&&(m.dismiss(),m=null),g=!0},b.show=function(t,n){L.hide();var r=function(n,i,r){"close"===r?($.unbind("click"),b.dispose()):"alternate"===r&&(y.hide(),e.deletePermission(t,p,l,u))};m=S.createModalDialog({buttons:{close:i("SendSurvey.DoneButton"),alternate:i("Sharing.RemoveLink")},options:{dismissOnButtonClick:!1},title:k.format(n||t.form&&t.form.title.encodeHtml()||t.name),content:L});var o=jQuery(m);o.bind({"aftershow._dlg":function(){_=jQuery(m.content()),v=jQuery(m.getButton({buttonName:"close"})),y=jQuery(m.getButton({buttonName:"alternate"})),v.parent().append(v.detach()),h(),e.fetchPermissions(t,c,u)},"afterdismiss._dlg":function(){o&&o.unbind("._dlg"),o=null},"buttonclick._dlg":r}),m.show()}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString;n.SendForm=e}()}),define("navitemdatacontext",["jbase","basecontrol","imagetile","wlivemenu"],function(){!function(){defineSubClass("Shared.UI.NavItemDataContext",JBase.DataContext,function(){},{reset:function(){mix(this,{type:"NavLink",html:"",text:"Nav Link",url:"#",target:"",key:"",sutra:"",imageData:null,isEnabled:!0,isVisible:!0,isSelected:!1,isBolded:!1,isImageSelectMode:!1,childItems:null,click:null,chevronDark:!0,showChevron:!0,allowClicks:null,includeSeparator:!1,closeMenuOnClick:null})}})}()}),define("navseparator",["navitemdatacontext"],function(){!function(){defineSubClass("Shared.UI.NavSeparator",JBase.UI.BaseControl,function(){},{baseTag:"span",baseDataContextType:Shared.UI.NavItemDataContext,onDataContextChanged:function(e){this.isVisible=!!e.isVisible}})}()}),define("navseparator.html",["navseparator"],function(){Shared.UI.NavSeparator.prototype.onRenderHtml=function(){return"<"+this.baseTag+' role="presentation" aria-hidden="true" id="'+htmlAttributeEncode(this.id+"_0")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isVisible)+'" class="c-'+this.controlName+" "+this.baseClass+' c_ms"></'+this.baseTag+">"},processAnnotations(Shared.UI.NavSeparator,[{id:0,css:["display","isVisible"]}],[],{})}),define("navlink",["navseparator.html"],function(){!function(){var e;defineSubClass("Shared.UI.NavLink",JBase.UI.BaseControl,function(){e=e||$menu.createChevron($menu.chevronTypes.SmallRightDark,!0),this.thumbsLinkImage=this.createChild(JBase.UI.ImageTile)},{baseTag:"a",baseDataContextType:Shared.UI.NavItemDataContext,sutra:"",onActivate:function(){window.sutra&&this.sutra&&sutra(this.element,this.sutra)},onDataContextChanged:function(t){var n=this;n.navHtml=t.html||($B.rtl?"&rlm;":"")+htmlEncode(t.text)+(t.targetOverlay?t.targetOverlay:""),n.chevronHtml=t.showBCBChevron?e:"",n.showChevron=t.showBCBChevron,n.isSelected=!!t.isSelected,n.url=t.url||"#",n.isBolded=!!t.isBolded,n.displayImage=!!t.imageData||t.isImageSelectMode,n.isImageVisible=t.imageData&&!(t.isImageSelectMode&&!t.isSelected),n.target=t.target||"",n.sutra=t.sutra||"",n.closeMenuOnClick=t.closeMenuOnClick||null,t.imageData&&n.thumbsLinkImage.setDataContext(t.imageData),n.isVisible=!!t.isVisible},_onLinkClicked:function(e){var t=this.dataContext.click;return this.closeMenuOnClick&&window.$menu&&$menu.closeAll(),t?t(e):!0}})}()}),define("navlink.html",["navlink"],function(){Shared.UI.NavLink.prototype.onRenderHtml=function(){return"<"+this.baseTag+sutraAttribute("SkyDrive.SharedNavLink")+' id="'+htmlAttributeEncode(this.id+"_0")+'" style="'+this.baseStyle+" "+generateStyleAttribute("display",this.isVisible)+'" class="c-'+this.controlName+" "+this.baseClass+generateClassAttribute("isSelected",this.isSelected)+'"'+generateAttributesString("href",this.url,"target",this.target)+"><span"+sutraAttribute("SkyDrive.Image")+' id="'+htmlAttributeEncode(this.id+"_1")+'" style="'+generateStyleAttribute("display.inlineblock",this.displayImage)+'" class="navLinkImage'+generateClassAttribute("imageVisible",this.isImageVisible)+'">'+this.thumbsLinkImage.renderHtml()+'</span><span id="'+htmlAttributeEncode(this.id+"_2")+'" class="'+generateClassAttribute("c_rchev",this.showChevron)+'">'+this.chevronHtml+'</span><span id="'+htmlAttributeEncode(this.id+"_3")+'" class="navLinkText'+generateClassAttribute("isBolded",this.isBolded)+'">'+this.navHtml+"</span></"+this.baseTag+">"},processAnnotations(Shared.UI.NavLink,[{id:0,css:["display","isVisible"],attr:["href","url","target","target"],className:["isSelected","isSelected"],userActions:{click:"_onLinkClicked"}},{id:1,css:["display.inlineBlock","displayImage"],className:["imageVisible","isImageVisible"]},{id:2,attr:["html","chevronHtml"],className:["c_rchev","showChevron"]},{id:3,attr:["html","navHtml"],className:["isBolded","isBolded"]}],[],{})}),define("navlinkdisabled",["navlink.html"],function(){!function(){defineSubClass("Shared.UI.NavLinkDisabled",Shared.UI.NavLink,function(){},{baseTag:"span",_onLinkClicked:function(){return this.dataContext.allowClicks===!0}})}()}),define("navitem",["navlinkdisabled"],function(){!function(){defineSubClass("Shared.UI.NavItem",JBase.UI.BaseControl,function(){this.contentControl=this.createChild(JBase.UI.ContentControl,{getControlType:bind(this,this.getControlType)})},{baseTag:"li",baseDataContextType:Shared.UI.NavItemDataContext,onDataContextChanged:function(e){e.baseClass&&(this.baseClass=e.baseClass),this.contentControl.setDataContext(e)},getControlType:function(e){var t=e.type;return"NavLink"==t&&(e.isEnabled||(t+="Disabled"),e.includeSeparator&&(this.includeSeparator=!0)),Shared.UI[t]||t}})}()}),define("navitem.html",["navitem"],function(){Shared.UI.NavItem.prototype.onRenderHtml=function(){return"<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'">'+this.contentControl.renderHtml()+'<span role="presentation" id="'+htmlAttributeEncode(this.id+"_1")+'" style="'+generateStyleAttribute("display",this.includeSeparator)+'" class="c_ms"></span></'+this.baseTag+">"},processAnnotations(Shared.UI.NavItem,[{id:0},{id:1,css:["display","includeSeparator"]}],[],{})}),define("menu",["navitem.html"],function(){!function(){defineSubClass("Shared.UI.Menu",JBase.UI.BaseControl,function(){this.navLinksRepeater=this.createChild(JBase.UI.Repeater,{childControl:Shared.UI.NavItem,baseTag:"ul",baseClass:"uxfa_m c_m t_hovl"}),this.thumbsLinkImage=this.createChild(JBase.UI.ImageTile)},{baseTag:"span",isExpanded:!1,suppressUpdates:!1,menuLoc:0,skipEdgeDetection:!1,subMenuLoc:6,arrowKeysNavigate:!0,_menu:null,baseDataContextType:Shared.UI.NavItemDataContext,sutra:"",onActivate:function(){window.sutra&&this.sutra&&sutra(this.subElements.menuLink,this.sutra)},onDeactivate:function(){this._menu&&(this._menu.dispose(),this._menu=null)},onDataContextChanged:function(e){var t=this,n=e.chevronType||(e.chevronDark?$menu.chevronTypes.SmallDownDark:$menu.chevronTypes.SmallDownLight);t.showChevron=!!e.showChevron;for(var i=e.childItems,r=0;r<i.length;r++){var o=i[r];o.childItems||o.closeMenuOnClick===!1||(o.closeMenuOnClick=!0)}t.navLinksRepeater.setDataContext({items:i}),t.text=e.text||"",t.chevronHtml=" "+($menu.createChevron(n,!0)||""),t.isEnabled=!!e.isEnabled,t.displayImage=!!e.imageData||e.isImageSelectMode,t.isImageVisible=e.imageData&&!(e.isImageSelectMode&&!e.isSelected),t.sutra=e.sutra||"",e.imageData&&t.thumbsLinkImage.setDataContext(e.imageData),t.doOnEndOfRenderFrame("updateMenu",function(){t.isActive&&t._menu&&!t.suppressUpdates&&t._menu.update()})},show:function(){this.isExpanded||(this._menuBind(),this._menu&&this._menu.show(),this.isExpanded=!0,this._updateBindings())},hide:function(){this.isExpanded&&(this._menuBind(),this._menu&&this._menu.hide(),this.isExpanded=!1,this._updateBindings())},_menuClick:function(e){this._menuBind(e),this.isExpanded=this._menu.isOpen();var t=this.dataContext.click;return t&&t(e),e.preventDefault(),!1},_menuBind:function(e){if(this.isActive&&(e=e||{target:this.element,type:"click"},!this._menu)){var t={};t.defaultLoc=this.menuLoc,t.skipEdgeDetection=this.skipEdgeDetection,t.menuEl=this.navLinksRepeater.element,t.sourceEl=this.subElements.menuLink,t.arrowKeysNavigate=this.arrowKeysNavigate,$menu.create(e,this.subMenuLoc,t)&&(this._menu=this.navLinksRepeater.element.binding,this._menu.addStateListener(bind(this,this._onMenuStateChanged))),this.isExpanded=!0,this._updateBindings()}},_onMenuStateChanged:function(){var e=this._menu.isOpen();this.isExpanded!=e&&(this.isExpanded=e,this._updateBindings())}})}(window.originaljQuery||jQuery)}),define("menu.html",["menu"],function(){Shared.UI.Menu.prototype.onRenderHtml=function(){return"<"+this.baseTag+sutraAttribute("SkyDrive.SharedMenu")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><a href="#" role="button" aria-haspopup="true" onclick="return false" id="'+htmlAttributeEncode(this.id+"_1")+'" class="uxfa_ml c_ml"'+generateAttributesString("aria-expanded",this.isExpanded)+'><span id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+generateStyleAttribute("display.inlineblock",this.displayImage)+'" class="navLinkImage'+generateClassAttribute("imageVisible",this.isImageVisible)+'">'+this.thumbsLinkImage.renderHtml()+'</span><span id="'+htmlAttributeEncode(this.id+"_3")+'" class="c_mlu">'+htmlEncode(this.text)+'</span><span role="presentation" aria-hidden="true" id="'+htmlAttributeEncode(this.id+"_4")+'" style="'+generateStyleAttribute("display.inline",this.showChevron)+'" class="c_chev">'+this.chevronHtml+"</span></a><span"+sutraAttribute("SkyDrive.Links")+">"+this.navLinksRepeater.renderHtml()+"</span></"+this.baseTag+">"},processAnnotations(Shared.UI.Menu,[{id:0},{id:1,attr:["aria-expanded","isExpanded"],childId:"menuLink",userActions:{click:"_menuClick",mousedown:"_menuBind"}},{id:2,css:["display.inlineBlock","displayImage"],className:["imageVisible","isImageVisible"]},{id:3,attr:["text","text"]},{id:4,css:["display.inline","showChevron"],attr:["html","chevronHtml"]}],[],{})}),define("droppablenavlink",["menu.html"],function(){!function(){defineSubClass("Shared.UI.DroppableNavLink",Shared.UI.NavLink,function(){},{key:null,processDropCallback:null,processDropLocationCallback:null,removeDropLocationCallback:null,onActivate:function(){this.element.dropTarget=!0,Shared.UI.NavLink.prototype.onActivate.call(this)},onDataContextChanged:function(e){var t=this,n=e.dropTarget;t.key=n.key,t.processDropCallback=n.processDropCallback,t.processDropLocationCallback=n.processDropLocationCallback,t.removeDropLocationCallback=n.removeDropLocationCallback,Shared.UI.NavLink.prototype.onDataContextChanged.call(t,e)},onProcessDrop:function(e,t,n){return this.processDropCallback(e,t,n,this.key)},onProcessDropLocation:function(e,t,n){return this.processDropLocationCallback(e,t,n,this.key)},onRemoveDropLocation:function(){this.removeDropLocationCallback(this.key)}})}()}),define("beforeunloadmanager",["imagetile","jquery-1.7.2","pagestats","alehelpers"],function(){!function(){function e(e){d.bind(c,e),a&&jQuery.isEmptyObject(o)||d.trigger(c,o)}function t(e,t,n){require(["modaldialog","doregister"],function(){var i=wLive.Controls.Notifications.createModalDialog({buttons:{action:r("LeavePageStr"),close:r("Cancel")},title:"",content:e}),o=jQuery(i);o.bind({"aftershow._dlg":function(e,t){var n=jQuery(t.content());sutra(n,"$Sutra.SkyDrive.BeforeUnloadDialog"),sutra(t.getButton({buttonName:"action"}),"$Sutra.SkyDrive.BeforeUnloadContinueButton"),sutra(t.getButton({buttonName:"close"}),"$Sutra.SkyDrive.BeforeUnloadCancelButton")},"afterdismiss._dlg":function(e,t){o&&o.unbind("._dlg"),o=null,t=null},"buttonclick._dlg":function(e,i,r){"action"===r?t():n&&n()}}),i.show()})}function n(e){var t="";return raiseEventWithProcessing(i.BeforeUnloadManager,e?"beforehashchange":"beforeunload",function(e){return!(t=e)},{},!1),t}var i=wLive.Core,r=i.AleHelpers.getPCString,o={},a=!0,s=!1,l=!1,c="navigate",u={},d=jQuery(u);i.BeforeUnloadManager={registerHandler:function(e,t){this.addObjectListener(this,t?"beforehashchange":"beforeunload",e)},unRegisterHandler:function(){this.removeObjectListener(this,"beforehashchange"),this.removeObjectListener(this,"beforeunload")}},mix(i.BeforeUnloadManager,Shared.ObjectEventing),$Do.when("$History.attach",0,function(e,i){var r=n(!0);a=!1,r&&!s?($BSI.navigateTo("#"+$Utility.serialize(o)),l||(l=!0,t(r,function(){setTimeout(function(){l=!1,s=!0,o=i,$BSI.navigateTo("#"+$Utility.serialize(i))},0)},function(){l=!1,s=!1}))):(s=!1,o=i,d.trigger(c,i))}),window.onbeforeunload=function(){var e=n(!1);return e?e:void 0},$Do.register("BeforeUnloadManager.attach",e,!0)}()}),define("legacycontroladapter",["imagetile","errormanager"],function(){!function(){defineSubClass("SkyDrive.UI.LegacyControlAdapter",JBase.UI.BaseControl,function(){this._controlInstance=null},{controlType:null,constructorOption:null,renderOption:null,disposeOnDeactivate:!1,onResize:function(){this._controlInstance&&this._controlInstance.resize&&this._controlInstance.resize()},onActivate:function(){this._updateControl(!0)},onDeactivate:function(){this.disposeOnDeactivate&&this._controlInstance&&(this._controlInstance.dispose(),this._controlInstance=null)},onDataContextChanged:function(){this._updateControl()},_updateControl:function(e){var t=this.dataContext;(this.isActive||e)&&t&&t.item?(this._controlInstance||(this._controlInstance=new this.controlType(jQuery(this.element),wLive.Core.ViewContext.getInstance(),this.constructorOption),this._controlInstance.parent=this),this._controlInstance.render(t.item,this.renderOption)):this._controlInstance&&(this._controlInstance.dispose(),this._controlInstance.parent=null,this._controlInstance=null)},onDispose:function(){this._controlInstance&&(this._controlInstance.dispose(),this._controlInstance=null)}})}()}),define("newcontroladapter",["legacycontroladapter"],function(){!function(){defineClass("SkyDrive.UI.NewControlAdapter",function(e,t){this.element=e?e[0]:null,this._viewContext=t,this._constructorArgs=Array.prototype.slice.call(arguments,2),this._controlInstance=null},{controlType:null,initialize:function(){if(!this._controlInstance&&this.controlType){var e=this._constructorArgs;this._controlInstance=new this.controlType(e[0],e[1],e[2],e[3],e[4],e[5]),this._controlInstance.parent=this}},render:function(e,t){var n=e?{item:e}:{};this.initialize(),this._controlInstance.setDataContext(n,t),this._controlInstance.isActive||(this.element.innerHTML=this._controlInstance.renderHtml(),this._controlInstance.activate())},exposeResources:function(e){this.initialize(),this._controlInstance.exposeResources(e)},isLoaded:function(){return!this._controlInstance||!this._controlInstance.isLoaded||this._controlInstance.isLoaded()},resize:function(){this._controlInstance&&this._controlInstance.resize&&this._controlInstance.resize()},dispose:function(){this._controlInstance&&(this._controlInstance.dispose(),this._controlInstance.parent=null,this._controlInstance=null)}})}()}),define("domhelpers",["dependancies","domutilities"],function(){!function(){wLive.Core.DomHelpers={isInputElement:function(e){return isInputElement(e[0])},setTimeoutZero:function(e){return window.msSetImmediate?(window.msSetImmediate(e),null):window.setTimeout(e,0)}}}()}),define("filetypes",["imagetile","errormanager"],function(){!function(){defineNamespace("SkyDrive.Constants.FileTypes",{access:"access",adobe:"adobe",audio:"audio",excel:"excel",exe:"exe",folder:"folder",file:"file",html:"html",infoPath:"infopath",oneNote:"onenote",pdf:"pdf",picture:"picture",powerPoint:"powerpoint",project:"project",publisher:"publisher",richText:"richtext",text:"text",video:"video",visio:"visio",word:"word",xaml:"xaml",xml:"xml",xps:"xps",zip:"zip"})}()}),define("filetypehelper",["filetypes"],function(){!function(){var e=JBase.UI.ImageStripHelper,t=SkyDrive.Constants.FileTypes,n="v2",i={accdb:t.access,ai:t.adobe,audio:t.audio,doc:t.word,docm:t.word,docx:t.word,dot:t.word,dotm:t.word,dotx:t.word,exe:t.exe,html:t.html,mdb:t.access,mpp:t.project,mpt:t.project,odp:t.powerPoint,ods:t.excel,odt:t.word,one:t.oneNote,onepkg:t.oneNote,onetoc2:t.oneNote,notebook:t.oneNote,pdf:t.pdf,photo:t.picture,pot:t.powerPoint,potm:t.powerPoint,potx:t.powerPoint,ppa:t.powerPoint,ppam:t.powerPoint,pps:t.powerPoint,ppsm:t.powerPoint,ppsx:t.powerPoint,ppt:t.powerPoint,pptm:t.powerPoint,pptx:t.powerPoint,ps:t.adobe,psd:t.adobe,pub:t.publisher,rtf:t.richText,txt:t.text,video:t.video,vdw:t.visio,vsd:t.visio,vsdm:t.visio,vsdx:t.visio,vsl:t.visio,vss:t.visio,vssm:t.visio,vssx:t.visio,vst:t.visio,vstm:t.visio,vstx:t.visio,xaml:t.xaml,xla:t.excel,xlam:t.excel,xll:t.excel,xls:t.excel,xlsb:t.excel,xlsm:t.excel,xlsx:t.excel,xlt:t.excel,xltm:t.excel,xltx:t.excel,xml:t.xml,xps:t.xps,xsn:t.infoPath,zip:t.zip};defineNamespace("SkyDrive.FileTypeHelper",{iconVersion:n,getFileType:function(e){var n="";if(e){var r=e.iconType||"";n=e.folder?t.folder:i[r.toLowerCase()]}return n||t.file},getIconInfo:function(t,i,r,o,a,s){var l;if(t){var c=this.isAdobeFile(t),u=s||(c?"Photo":t.iconType)||"";s||"NonEmptyAlbum"!==u&&"EmptyAlbum"!==u||t.isSpecialFolder||(u="Folder"),"Folder"===u&&(u=t.folder&&!t.folder.totalCount?"Empty":"NonEmpty",u+="DocumentFolder"),FilesConfig.visualUpdatesForSharedContent&&!s&&!t.isBundle&&t.folder&&t.sharingLevelValue!==wLive.Core.JSONConstants.SharingLevel.Private&&(u="SharedFolder");var d="ft_"+i+"_"+u+(t.folder&&r?"Selected":"");if(l=e.getImageInfo(d,o,a),!l&&t.iconType){var f=16===i?"tiny":32===i?"smaller":"small";l={url:FilesConfig.foldersImgBaseUrl+"/icons/"+n+"/"+f+"/"+t.iconType+".png",containerSize:{width:i,height:i},imagePosition:{left:0,top:0},alt:o,title:a}}}return l},isOfficeDocument:function(e){var n=this.getFileType(e);return n===t.word||n===t.excel||n===t.powerPoint||n===t.oneNote||n===t.pdf},isAdobeFile:function(e){var n=this.getFileType(e);return n==t.adobe}})}()}),define("operationmanager",["dependancies","do"],function(){!function(){function e(){var e=this;e.execute=function(e,t){require([e.toLowerCase()+"operation","registeroperations"],function(){$Do.when(i+e,0,t)})},e.register=function(e,t){$Do.register(i+e,function(n){t(e,n)})}}var t=wLive.Core;t.OperationManager=e;var n=new e,i="Operation_";t.OperationManager.getInstance=function(){return n},t.OperationManager.Current=new e}()}),define("placeholderinput",["jquery-1.7.2","wliveloaded"],function(){!function(){function e(e,t){function n(){e.val()==t&&(e.removeClass("pi_placeholder"),e.val(""))}function i(){""==e.val()&&(e.addClass("pi_placeholder"),e.val(t))}var r=this;r.render=function(){return e.length&&"placeholder"in e[0]?(e.attr("placeholder",t),void 0):(e.focus(n),e.blur(i),i(),void 0)}}wLive.Controls.PlaceholderInput=e}()}),define("selectionmanager",["errormanager","baseutil"],function(){!function(){function e(u){function d(e,t){var n=S(t);switch(n){case s:f(e),Q=e;break;case l:h(e,t);break;case a:g(e),Q=e}var i=F.getSelection();W=0===i.selectionCount?-1:e}function f(e){!q&&T(e)&&m(),_(e)}function h(e,t){t.ctrl||(O={},U={},L(Q));for(var n=F.isSelected(E,Q),i=Math.min(Math.min(Q,W),e),r=Math.max(Math.max(Q,W),e),o=Math.max(Math.min(Q,e),0),a=Math.max(Math.max(Q,e),0),s=i;r>=s;s++)s>=o&&a>=s?s!==Q&&(n&&(!G&&!T(s)||G)?v(s):y(s)):(delete O[s],delete U[s])}function p(e){return e=e||{},e.ctrl=V&&e.ctrl,e.shift=V&&e.shift,e}function g(e){var t=F.getSelection(),n=t&&1===t.selectionCount&&F.isSelected(E,e);m(),n||L(e)}function m(){O={},U={},j=!1,W=-1,Q=-1}function v(e){L(e)}function y(e){delete O[e],delete U[e]}function _(e){F.isSelected(E,e)?(delete O[e],delete U[e]):L(e)}function w(e){for(var t=e;null!=O[t];)t--;return t}function b(e){for(var t=e;null!=O[t];)t++;return t}function C(e){var t=!1;e||(t=!0),!i(e,E)&&e&&(t=!0,E=e);var n=u.getSetKey(e?e.key:null);if($!==n&&($=n),e){var r=u.getChildren(e);B||(M=r?r.getGroupings():[]),A=r.getCount()}return t}function S(e){var t=e&&e.ctrl,n=e&&e.shift;return n&&Q>-1?l:t?s:a}function k(e){var t=0;for(var n in R)t++;return t>1&&!i(e,E)?!0:!1}function I(e,t){var n=i(e.parent,t.parent)&&e.relationshipsKey===t.relationshipsKey&&e.inPreselectionMode===t.inPreselectionMode&&e.selectionCount===t.selectionCount;if(n){var r=e.indexes,o=t.indexes;for(var a in r)if(r[a]!==o[a]){n=!1;break}}return n}function x(e){for(var t=M[0].itemGroups,n=0;n<t.length;n++){var i=t[n];if(i.startIndex<=e&&i.endIndex>=e)return n}return-1}function T(e){for(var t in O){if(x(e)!=x(t))return!0;break}return!1}function L(e){O[e]=parseInt(e);var t=u.getChildren(E).peek(e);t&&(U[e]=t)}function P(e,t){var n=F.getSelection();C(t)&&m();var i=e();return I(n,F.getSelection())||D(),i}function D(){N.trigger(e.SelectionChangedEvent,[F.getSelection()])}var E,$,A,F=this,N=jQuery(F),M=[],B=!1,R={},H={},O={},U={},j=!1,W=-1,Q=-1,V=!0,q=!0,G=!0,z=!0,K=0,J=null,X=null;F.dispose=function(){clearTimeout(K),m()},F.setMultiSelectEnabled=function(e){V=e},F.setCrossGroupSelectEnabled=function(e,t){q=e,G=t&&e},F.setSelectionEnabled=function(e){z=e,V=e},F.registerList=function(e,t){R[e]=t,H[t.key]=e},F.unregisterList=function(){H={},R={}},F.clickSelect=function(e,t,n){n=p(n),z&&P(function(){d(t,n),j=n&&n.preselect},e)},F.keyboardSelect=function(e,t,n){return n=p(n),k(e)||!z?!0:P(function(){var e=W,i=n.shift;switch(t){case r:if(-1!==e){var a=i?e-1:w(e);e=Math.max(0,a)}else C(R[0]),e=A-1;break;case o:if(-1!==e){var s=i?e+1:b(e);e=Math.min(A-1,s)}else C(R[0]),e=0;break;default:return!0}return e===W?!0:(n.ctrl=!1,d(e,n),!1)},e)},F.resolveSelection=function(t){var n=e.ResolveSuccess,i=t?u.getChildren(t):null;if(i&&0!==i.getCount()){{var r={};F.getSelection()}if(C(t))n=e.ResolveFailed;else if(i.getMaterializedCount())for(var o in O){var a=U[o];if(!a){n=e.ResolveWaiting;break}var s=a?i.indexOf(a,!1,!0):-1;if(!(s>-1)){n=e.ResolveFailed;break}r[s]=a}else n=e.ResolveWaiting;if(n===e.ResolveSuccess){var l=U[W],c=l?i.indexOf(l,!1,!0):-1,d=U[Q],f=d?i.indexOf(d,!1,!0):-1;P(function(){m();for(var e in r)L(e);Q=f,W=c},t)}else n===e.ResolveFailed&&F.deselectAll()}else F.deselectAll();return n},F.selectAll=function(e){return F.selectRange(e,0,A-1)},F.deselectAll=function(e,t){t?m():P(function(){m()},e)},F.selectRange=function(e,t,n){return k(e)||!V?!0:(P(function(){for(var e=t;n>=e;e++)L(e)},e),!1)},F.deselectRange=function(e,t,n){return k(e)||!V?!0:(P(function(){for(var e=t;n>=e;e++)y(e)},e),!1)},F.getSingleSelectedItem=function(e){var t,n=this.getSelection();if(e=e||E,e&&1===n.selectionCount)for(var i in n.indexes){t=u.getChildren(e).get(i);break}return t},F.multipleSelected=function(){var e=0;for(var t in O)if(O.hasOwnProperty(t)&&(e++,e>1))break;return e>1},F.anySelected=function(){var e=!1;for(var t in O)if(O.hasOwnProperty(t)){e=!0;break}return e},F.getSelection=function(){var e=0,t=-1;for(var n in O)(t>n||-1===t)&&(t=n),e++;var i={parent:E,inPreselectionMode:j,indexes:O,selectionCount:e,firstSelectedIndex:t,lastInteractedIndex:W};return i},F.showSelectionDialog=function(e){var t=this;!X&&e&&require(["modaldialog","doregister"],function(){var i=$f&&$f.createLoading({returnMarkup:!0,useTransparentFallback:!0,text:e});X=wLive.Controls.Notifications.createModalDialog({buttons:{close:n("Cancel")},title:"",content:i});var r=jQuery(X);r.bind({"afterdismiss._dlg":function(){r.unbind(),t.dialog=null},"buttonclick._dlg":function(e,t,n){"close"===n&&J&&(J.cancel(),J=null)}}),X.show()})},F.dismissSelectionDialog=function(){$header&&$header.hideLoading(),clearTimeout(K),K=0,X&&(X.dismiss(),X=null)},F.selectGroupFromIndex=function(e,n,i,r,o){var a=t.DataModel.getInstance(),s=F.getSelection(),l=s.parent,d=l.key,f=u.getSetKey(d);$header.showLoading(),K=setTimeout(function(){$header.hideLoading(),F.showSelectionDialog(o)},c),J=a.ensureGroupCompletelyDownloaded(l,f,e,n).then(function(){F.dismissSelectionDialog();var t=l.getChildren(f),o=t.getGroupings()[e];if(o){var a=o.itemGroups[n];a?(i||F.deselectAll(l,!0),F.isRangeSelected(l,a.startIndex,a.endIndex)?F.deselectRange(l,a.startIndex,a.endIndex):F.selectRange(l,a.startIndex,a.endIndex),r()):Trace.log("Failed to get the  subgroup for: "+d+" at group index "+e+" at subgroup index "+a,"Selection Manager")}else Trace.log("Failed to get the group for: "+d+" at group index "+e,"Selection Manager")},function(){F.dismissSelectionDialog(),Trace.log("Failed to get the selected items for: "+d,"Selection Manager")})},F.getSelectedItems=function(e,n){var i=t.DataModel.getInstance(),r=F.getSelection(),o=r.parent,a=[];for(var s in r.indexes)a.push(s);var l=o.key,d=u.getSetKey(l);$header.showLoading(),K=setTimeout(function(){$header.hideLoading(),F.showSelectionDialog(n)},c),J=i.ensureCompletelyDownloaded(o,d,a).then(function(){F.dismissSelectionDialog();var t=[];for(var n in r.indexes){var i=u.getChildren(o).get(n);i&&t.push(i)}e(t)},function(){F.dismissSelectionDialog(),Trace.log("Failed to get the selected items for: "+l,"Selection Manager")})},F.isSelected=function(e,t){return i(e,E)&&O[t]===t},F.isRangeSelected=function(e,t,n){var r=i(e,E);if(r)for(var o=t;n>=o;o++)if(O[o]!==o){r=!1;break}return r},F.hasPreselectedChild=function(e){return i(e,E)&&j},F.resetPreselectionFlag=function(){j=!1},F.setGroupings=function(e){if(e)M=e,B=!0;else{if(E){var t=u.getChildren(E);M=t?t.getGroupings():[]}else M=[];B=!1}}}var t=wLive.Core,n=t.AleHelpers.getPCString,i=t.SkyDriveItem.areItemsSame,r=38,o=40,a=0,s=1,l=2,c=3e3;e.SelectionChangedEvent="selectionChanged",e.ResolveFailed=-1,e.ResolveWaiting=1,e.ResolveSuccess=2,wLive.Core.SelectionManager=e}()}),define("networksprovider",["wliveloaded","errormanager"],function(){!function(){function e(){function r(e,t){for(var n=0;n<e.length;n++){var i=e[n];try{i&&i(t)}catch(r){}}}function o(e,t){for(var n=[],i=e.length,r=0;i>r;r++){var o=e[r];o.status==t&&n.push(o)}return n}var a,s=this,l=[],c=[];s.clearCache=function(){t=null},s.fetchNetworks=function(e,o,s){if(t)e&&e(t.networks);else if(e&&l.push(e),o&&c.push(o),!a){a=!0;var u={resultSet:i},d=FilesConfig.baseApiUrl+"GetNetworks?"+$Utility.serialize(u),f=new n.DataRequest(d,d,null,function(e){a=!1,t=e,r(l,t.networks),l=[],c=[]},function(e){a=!1;var t=e&&e.error;r(c,t),l=[],c=[]},s);f.apiId="SkyDrive_Json_GetNetworks",f.propertyId="SkyDrive",f.start()}},s.getConnectedNetworks=function(t){var n=o(t,e.Status.Connected),i=o(t,e.Status.Error);return jQuery.merge(n,i),n},s.getUpsellNetworks=function(t){return o(t,e.Status.None)},s.findTargetNetwork=function(e,t){for(var n,i=0;i<e.length;i++)if(e[i].id===t){n=e[i];break}return n},s.hasOffer=function(e,t){if(e){var n=e.offers;if(n)for(var i=0;i<n.length;i++)if(n[i]===t)return!0}return!1},s.getContactSyncLastSuccessTime=function(e){return e.contactSyncSuccess&&e.contactSyncSuccess.match(/EndTime: .* Success\./)[0]},s.areRequiredNetworkOffersPresent=function(e,t){for(var n=0;n<t.length;n++)if(!s.hasOffer(e,t[n]))return!1;return!0}}var t,n=wLive.Core,i=1;e.Status={None:0,Connected:1,Error:2},n.NetworksProvider=e}()}),define("sharinghelper",["imagetile","jquery-1.7.2","droppablenavlink","wliveloaded","actionmanager","alehelpers","beforeunloadmanager","newcontroladapter","errormanager","domhelpers","filetypehelper","imagestrip","inlineerror","loadingcue","operationmanager","permissionsprovider","placeholderinput","selectionmanager","sharinglink.html","networksprovider","skydrive_pc_strip_32_ltr","skydrive_pc_strip_8_ltr","skydrive_sharing_strip_8_ltr","header_strip_ltr","doregister"],function(){!function(){function e(e,t,n){var o=jQuery('<div class="sd_pop_wrapper"></div>');require(["modaldialog","doregister","sharedialog"],function(){function a(){l&&l.dismiss(),l=null}function s(){l&&l.reposition()}var l=r.Notifications.createModalDialog({content:o[0]}),c=jQuery(l);c.bind({"aftershow._dlg":function(){var c=new i.PermissionsProvider(u.callerCid),d=new r.ShareDialog(o,c,e,t,u,a,s,n);d.render(),jQuery(".UserArea").on("click",".sd_cancel",function(){a()}),l.reposition()},"afterdismiss._dlg":function(){jQuery(".ModalDialog").unbind("onclose._dlg"),c&&c.unbind("._dlg"),c=null,l=null,g=!1}}),l.show(),g=!0})}function t(e,t,i,r,o,a,s){n(function(){var n=window.$icm.createNonContactIC(a,t,{namespace:"Folders_SharingList",userTileUrl:e,name:o});s.html(n.render()),n.activate()})}function n(e){require(["ic"],function(){$Do.when("$icm",0,e)})}var i=wLive.Core,r=wLive.Controls,o=i.AleHelpers.getPCString,a=i.ImageStrip,s=i.PermissionsProvider,l=s.EntityType,c=s.LinkType,u=wLive.Core.ViewContext.getInstance(),d="SharingListExpandedTemplate",f="SharingDialogPermissionTemplate",h="sharingListIc",p="click",g=!1;i.SharingHelper={icSize:{Medium:1,XLarge:2},showSharingDialog:function(t,n,i){if(i=i||{},n&&n.selectionCount>FilesConfig.maxBundleItemCount)u.errorManager.add({$element:jQuery("<div>"+o("Sharing.BundleSelectionOverLimitError").format(FilesConfig.maxBundleItemCount,n.selectionCount)+"</div>"),priority:1,type:4});else if(t&&t.isSpecialFolder&&4===t.sharingLevelValue&&!i.ignoreWarning&&t.isViewerOwner()){var a={buttons:{action:o("Sharing.SpecialFolder.Button"),alternate:o("Sharing.SpecialFolder.ShareButton")},content:jQuery("<p>"+o("Sharing.SpecialFolder.Msg1")+"</p><p>"+o("Sharing.SpecialFolder.Msg2")+"</p>"),title:o("Sharing.SpecialFolder.Header")},s=r.Notifications.createModalDialog(a),l=jQuery(s);l.bind({"aftershow._dlg":function(){},"afterdismiss._dlg":function(){l&&l.unbind("._dlg"),l=null,s=null,g=!1
},"buttonclick._dlg":function(n,r,o){"alternate"===o&&e(t,null,i),s.dismiss()}}),s.show(),g=!0}else e(t,n,i)},renderTileForEntity:function(e,i,r,o,s,u){var p=this,g=null,m=e.name,v=e.type,y=e.did,_=e.icon,w=m,b=p.icSize.XLarge==s?f:d;if(v==l.User)e.did?(g=h+e.id,o&&n(function(){window.$icm.createICsFromCids(b,[[e.did,g]],o,{namespace:"Folders_SharingList",showICCard:!0})})):p.loadDefaultIc(e,b,i);else if(v==l.Email||v==l.Facebook)p.loadDefaultIc(e,b,i);else if(v==l.Group&&_)t(_,w,e.id,y,m,b,i);else if(v==l.Link||v==l.Public||v==l.Friends||v==l.Group||v==l.GroupOwned){var C;if(_&&_.url)C=jQuery("<img/>"),C.attr("src",_.url),C.attr("height",r),C.attr("width",r);else{var S;v==l.Link?S=e.linkType!=c.Embed?e.linkType!=c.Form?"linkIcon":"formLinkIcon":"embedIcon":v==l.Friends?S="friendsIcon":v==l.Group||v==l.GroupOwned?(S="groupsIcon",S=60==r?S+"60":S):S="publicIcon",S=u?S+"White":S,C=jQuery(a.getImage(S,w,w))}C.addClass("ips_ic_icon"),C.attr("alt",w),C.attr("title",w),i.append(C)}return g},loadDefaultIc:function(e,n,i){t(null,e.email,e.id,e.did,e.name,n,i)},buildScopeLinkHeaderHref:function(e,t,n,r){null==r&&(r=!1);var o,a=i.SkyDriveItem.getItemKey(t.id,n.ownerCid,n.group),s=e.dataModel&&e.dataModel.getItem(a,!0);if(!FilesConfig.isWacSharing&&s&&t.id==e.viewParams.id&&i.StringHelpers.caseInsensitiveStringEquals(e.callerCid,n.ownerCid))o="#";else{var l=Number(e.actionId)+1,c=t.refId&&!r?t.id.split("!")[0]:n.ownerCid;o=n.group?"/?cid={0}&id={1}&action=Share&actionId={2}&group={3}".format(c.encodeUrl(),(r?t.refId:t.id).encodeUrl(),l,n.group):"/?cid={0}&id={1}&action=Share&actionId={2}".format(c.encodeUrl(),(r?t.refId:t.id).encodeUrl(),l)}return o},buildScopeLinkHeaderCallback:function(e,t,n,r,o){null==o&&(o=!1);var a,s=i.SkyDriveItem.getItemKey(o?t.refId:t.id,n.ownerCid,n.group),l=e.dataModel&&e.dataModel.getItem(s,!0);return a=!FilesConfig.isWacSharing&&l&&t.id==e.viewParams.id&&i.StringHelpers.caseInsensitiveStringEquals(e.callerCid,n.ownerCid)?function(){return e.selectionManager.deselectAll(),r&&r(),i.SharingHelper.showSharingDialog(l),!1}:function(){e.selectionManager&&e.selectionManager.deselectAll(),r&&r()}},buildScopeLinkHeader:function(e,t,n,r,o,a,s){var l=t.name||t.id,c='<a href="'+i.SharingHelper.buildScopeLinkHeaderHref(e,t,n)+'" class="'+o+'">'+l.encodeHtml()+"</a>",u='<div class="'+a+'">'+r.format(c)+"</div>",d=jQuery(u),f=jQuery("a",d);return f.bind(p,i.SharingHelper.buildScopeLinkHeaderCallback(e,t,n,s)),d}},mix(i.SharingHelper,Shared.ObjectEventing),i.SharingHelper.addObjectListener(i.BeforeUnloadManager,"beforehashchange",function(){g&&wLive&&wLive.Controls&&wLive.Controls.Notifications&&wLive.Controls.Notifications.getQueue().reset()})}()}),define("permissionentitycontrol",["sharinghelper"],function(){!function(){function e(e,t,n,a,v,y,_,w,b){function C(){var t=jQuery(".ips_ic_details .ips_ic_role",D);if(!x())return D.addClass("ips_link_entity"),t.remove(),void 0;var n=e.role;sutra(t,"$Sutra.SkyDrive.InfoPaneSharingEntityRole"),t.text(T(n))}function S(){var t=jQuery(".ips_ic_details .ips_ic_name",D);t.text(e.name),t.attr("type",e.type),sutra(t,"$Sutra.SkyDrive.InfoPaneSharingEntityName")}function k(e){var t=e.name,n=e.type,r=e.did,a=e.icon,s=t;if(n==c.User)P=f+e.id;else if(n==c.Email)L.loadIcFromEmail(e.email);else if(n==c.Facebook)L.loadDefaultIc();else if(n==c.Group&&a)I(a,s,e.id,r,t,E);else if(n==c.Link||n==c.Public||n==c.Friends||n==c.Group||$){var l;if(a&&a.url)l=jQuery("<img/>"),l.attr("src",a.url),l.attr("height",p),l.attr("width",g);else{var d;n==c.Link?d=e.linkType!=u.Embed?e.linkType!=u.Form?"linkIcon_40":"formLinkIcon_40":"embedIcon_40":n==c.Friends?d="friendsIcon_40":n==c.Group||$?(d="groupsIcon_40",$&&(s=i("Sharing.GroupMembersHeader"))):d="publicIcon_40",d=M?d+"_White":d,l=jQuery(o.getImage(d,s,s))}l.addClass("ips_ic_icon"),l.attr("alt",s),l.attr("title",s),E.append(l)}}function I(e,t,n,i,r,o){var a=window.$icm.createNonContactIC(d,t,{namespace:h,userTileUrl:e,name:r});o.html(a.render()),a.activate()}function x(){var t=e.type;return!(t==c.Link&&(e.linkType==u.View||e.linkType==u.Edit))}function T(e){var t="CanView";if($)e==l.Edit&&(t="CanEdit"),t="GroupMembers"+t;else if(e==s.Edit)t="CanEdit";else if(e==s.Submit)t="CanSubmit";else if(e==s.Owner)t="Owner";else if(e==s.CoOwner)return r("GF.Sharing.CoOwner");return i("Sharing."+t)}var L=this;b=b||{};var P,D,E,$,A=n.id,F=n.name,N=A.replace("!",""),M=b.dt;L.getIcId=function(){return P},L.icReady=function(e){E.html(e.render()),e.activate()},L.loadDefaultIc=function(){I(null,e.email,e.id,e.did,e.name,E)},L.loadIcFromEmail=function(e){var t=$pwc&&$pwc.getPersonsByEmail(e)[0];if(t){var n=window.$icm.createICForPerson(d,t.getId(),{namespace:h,toolTipType:"none"});E.html(n.render()),n.activate()}else this.loadDefaultIc()},L.getEntityContainer=function(){return D},L.render=function(){$=e.type==c.GroupOwned,D=jQuery('<li class="ips_entity"><a href="#" onclick="return false;"><div class="ips_ic"></div><div class="ips_ic_details"><div class="ips_ic_name"></div><div class="ips_ic_role"></div></div><div class="c_clr"></div></a></li>'),sutra(D,"$Sutra.SkyDrive.InfoPaneSharingEntity"),v.append(D),E=jQuery(".ips_ic",D),k(e),$||S(),C(),D.attr({entityId:e.id,scopeId:N}),w&&D.bind(m,{entity:e,scopeId:A,scopeName:F,scope:n,canChange:y,selectedTab:D,ignoreWarning:!0},w)}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString,r=t.AleHelpers.getSkyString,o=t.ImageStrip,a=t.PermissionsProvider,s=a.Role,l=a.GroupRole,c=a.EntityType,u=a.LinkType,d="SharingListTemplate",f="sharingListIc",h="Folders_SharingList",p=(FilesConfig.foldersImgBaseUrl+"/categoryIcon.png",o.getImage("openUp",null,null),o.getImage("darkPanelOpenUp",null,null),40),g=40,m="click";n.PermissionEntityControl=e}()}),define("permissionscopecontrol",["permissionentitycontrol"],function(){!function(){function e(e,n,a,s,l,c,u,d,f,h){function p(e,t,i,r,o){var a=new wLive.Controls.PermissionEntityControl(r,s,l,n,i,u,d,o,h);a.render();var c=a.getIcId();return c&&(b[c]=a,null!=r.did?e.push([r.did,c]):t.push([r.id,c])),a}function g(n){if(t.StringHelpers.caseInsensitiveStringEquals(s.id,l.id)||c)h.showPropertiesTitle&&n.append('<div class="ips_scope_header">'+_+"</div>");else if(l.canChange===!1)n.append('<div class="ips_scope_header">'+y.format(l.name)+"</div>");else if(v())n.append('<div class="ips_scope_header">'+y.format(l.name)+"</div>");else{var i=function(){h&&h.ct&&h.ct.close&&h.ct.close()},o=r.buildScopeLinkHeader(e,l,s,y,"ips_scope_link","ips_scope_header",i);n.append(o),sutra(o,"$Sutra.SkyDrive.InfoPaneSharingScopeHeader")}}function m(e,t){var n=b[e];n&&(t?n.icReady(t):n.loadDefaultIc())}function v(){return null!=l.allowedActions&&Array.prototype.indexOf.call(l.allowedActions,wLive.Core.PermissionsProvider.AllowedActions.Remove)>=0}var y=i("Sharing.ScopeHeaderFormat"),_=i("Sharing.Permissions"),w=this,b={};h=h||{},w.render=function(){var e=jQuery('<li class="ips_scope"></li>');a.append(e),sutra(e,"$Sutra.SkyDrive.InfoPaneSharingScope"),g(e);var t=jQuery("<ul></ul>");e.append(t),sutra(t,"$Sutra.SkyDrive.InfoPaneSharingEntities");var n,i=[],r=[],s=[];if(v()){var c=function(e){e.data.controlsToSelect=s,f(e)};n=c,t.addClass("ips_scope_linked_entities")}else n=f;for(var u=0;u<l.entities.length;u++){var d=p(i,r,t,l.entities[u],n);s.push(d.getEntityContainer())}for(var h=0;h<r.length;h++){{r[h][0]}m(r[h][1],null)}window.$icm&&window.$icm.createICsFromCids(o,i,m,{namespace:"Folders_SharingList",showICCard:!0}),a.closest(".ModalDialog").length&&jQuery(".ips_ic_remove:first").focus()}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString,r=t.SharingHelper,o="SharingListExpandedTemplate";n.PermissionScopeControl=e}()}),define("sharinglist",["permissionscopecontrol"],function(){!function(){function e(e,g,m,v,y){function _(n){if($=setTimeout(function(){C()},h),FilesConfig.allowReshareForEditors&&e.callerCid&&!e.tokenHasBeenRedeemed&&n.tokenNeedsRedeeming&&FilesConfig.authKey){var i=Object.toJSON({id:n.id,authKey:FilesConfig.authKey}),r=function(){e.tokenHasBeenRedeemed=!0,b()},o=new t.DataRequest(p,p,i,r,b);o.apiId="SkyDrive_Json_RedeemPermissionToken",o.propertyId="SkyDrive",o.start()}else b()}function w(){H&&window.$icm&&(window.$icm.removeAllICsByNamespace(o),H=!1)}function b(){m.fetchPermissions(F,S,P,B)}function C(){w(),E=null,g.empty();var e=new wLive.Controls.LoadingSpinner(g);e.render()}function S(t,n){if(t.id==F.id){if(clearTimeout($),clearTimeout(A),x(n))return k(jQuery(".ips_commands",g)),E=n,void 0;E=n,D=jQuery("<div></div>"),D.insertAfter(g).hide();var o=jQuery('<div class="ips_commands"></div>');k(o),D.append(o);var a=FilesConfig.hcid,s=a==t.ownerCid||r.isOwnerOrCoOwner(t)||e.isSuper,l=n&&n.permissionScopes;if(w(),s&&l&&1==l.length&&l[0].entities&&0==l[0].entities.length)L(i("Sharing.PermissionNotShared"),!0),F.sharingLevelValue=u;else{H=!0,T(n);var c=n&&n.sharingLevel;c&&!y.hc&&L(c)}I(),M&&M()}}function k(n){if(n.empty(),!y.hc)for(var r=y.fs(F)&&F.folder?"Folder":"",o=[s,l],c=0;c<o.length;c++){var u=o[c],d=e.actionManager.getAction(u,F);if(d){var f=t.ActionManager.setATagAction(d,null,e.infoPaneBiciLoc),h=u==s&&F.form?a:u,p=i(h+r+"Command");f.text(p),sutra(f,"$Sutra.SkyDrive."+u+"Command");var g=jQuery('<div class="ipc_container"></div>').append(f);n.append(g)}}}function I(){D.show(),g.remove(),sutra(D,"$Sutra.SkyDrive.InfoPaneSharing"),g=D}function x(e){if(!e||!E||e.permissionScopes.length!=E.permissionScopes.length)return!1;if(e.permissionScopes.length&&e.permissionScopes[0].id==F.id&&e.permissionScopes[0].entities.length||1==e.permissionScopes.length&&e.permissionScopes[0].entities&&0==e.permissionScopes[0].entities.length)return!1;for(var t=0;t<e.permissionScopes.length;t++)if(Object.toJSON(e.permissionScopes[t].entities)!=Object.toJSON(E.permissionScopes[t].entities))return!1;return!0}function T(n){var i=jQuery('<ul class="ips_list"></ul>');sutra(i,"$Sutra.SkyDrive.InfoPaneSharingScopes"),i.addClass("ips_extended"),D.append(i);for(var r=n&&n.permissionScopes,o=r?r.length:0,a=0;o>a;a++){var s=r[a],l=n.canChange&&t.StringHelpers.caseInsensitiveStringEquals(s.id,F.id);if(s.entities.length){var c=y;c.showPropertiesTitle=y.hc;var u=new wLive.Controls.PermissionScopeControl(e,m,i,F,s,!n.canChange,l,R,v,c);u.render()}}o>1&&r[0].entities&&0==r[0].entities.length&&jQuery("li:first-child",i).addClass("ips_scope_first"),i.append(jQuery('<div class="c_clr"></div>'))}function L(e,t){y.hc&&D.append('<div class="ips_scope_header t_ctc">'+d+"</div>");var n=jQuery('<div class="t_ctc ips_level"></div>').text(e);if(sutra(n,"$Sutra.SkyDrive.InfoPaneSharingSimpleSharingLevel"),v&&!t){var i=F&&F.name;n.bind(c,{entity:null,scopeName:i},v)}D.append(n)}function P(e){if(e.id==F.id){w(),g.empty(),clearTimeout($);var t=i("Sharing.GetPermissionsError"),r=jQuery('<div class="ips_error"></div>');g.append(r);var o=new n.InlineError(r,t);o.render()}}var D,E,$,A,F,N,M,B,R=this,H=!1;R.render=function(e,n,r){e=e||F,r=r||{},M=r.getPermissionsCallback,B=r.skipCache;var o=r.quickRender,a=t.SkyDriveItem.areItemsSame(e,F,!0);F=e,N=n,clearTimeout(A),clearTimeout($);var s=e?e.isRecycled?e.folder?i("Sharing.PrivateFolder"):i("Sharing.PrivateFile"):null:i("Sharing.MultipleFilesPrivate");return s?(D=jQuery("<div></div>"),D.insertAfter(g).hide(),L(s),I(),void 0):(a||o?_(e):A=setTimeout(_(e),f),void 0)},R.dispose=function(){clearTimeout($),clearTimeout(A),w(),D&&D.empty()}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString,r=t.SkyDriveItemHelper,o="Folders_SharingList",a="ShareWorkbook",s="Share",l="SendSurvey",c="click",u=4,d=i("Sharing.Permissions"),f=100,h=1e3,p=FilesConfig.baseApiUrl+"RedeemPermissionToken";n.SharingList=e,defineSubClass("SkyDrive.UI.SharingList",SkyDrive.UI.LegacyControlAdapter,function(){var e=this,i={fs:function(t){return t===e.dataContext.item}};e.controlType=function(r,o){var a=new t.PermissionsProvider(o.callerCid),s=bind(e,e._onPermissionsEntityClick);return n.SharingList.apply(this,[o,r,a,s,i])}},{_onPermissionsEntityClick:function(e){raiseEvent(this,"permissionsEntityClick",e.data,!0)}}),$Do.register("SharingList")}()}),define("directnetworksprovider",["sharinglist"],function(){!function(){var e;window.require?require(["skydrive_sharing_strip_8_ltr"],function(){e=JBase.UI.ImageStripHelper,e.registerStrip(FilesConfig.sharingStripUrl,SharingIS)}):(e=JBase.UI.ImageStripHelper,e.registerStrip(FilesConfig.sharingStripUrl,SharingIS));var t={FB:{url:"https://www.facebook.com/sharer/sharer.php?u={{url}}",icon:"facebook",width:626,height:436,sutra:"NetworkIconFB"},TWITR:{url:"http://twitter.com/share?url={{url}}",icon:"twitter",height:300,width:550,sutra:"NetworkIconTWITR"},LI:{url:"http://www.linkedin.com/shareArticle?mini=true&url={{url}}",icon:"linkedin",height:300,width:550,sutra:"NetworkIconLI"},SINWE:{icon:"weibo",height:400,width:600,url:"http://service.weibo.com/share/share.php?url={{url}}",sutra:"NetworkIconSINWE"}};defineSubClass("wLive.Core.DirectNetworksProvider",JBase.UI.BaseControl,function(){},{getLinks:function(e,n,i){for(var r=jQuery(_ce("div")),o=0;o<n.length;o++){var a=n[o];t.hasOwnProperty(a)&&r.append(this._buildNetworkLink(a,e,i))}return r},_generateShareUrl:function(e,t){var n=t;return n=n.replace("{{url}}",encodeURIComponent(e))},_buildNetworkLink:function(e,n,i){var r=t[e],o=jQuery('<a target="_blank" />'),a=this._generateShareUrl(n,r.url);o.attr("href",a),o.click(function(t){t.preventDefault();{var n=window.screenLeft||0,i=window.innerWidth||0,o=Math.max(i/2-r.width/2+n,0),s=window.screenTop||0,l=window.innerHeight||0,c=Math.max(l/2-r.height/2+s,0);window.open(a,"sharing_"+e,"resizable, width="+r.width+", height="+r.height+", screenX="+o+", screenY="+c)}}),sutra(o,"$Sutra.SkyDrive."+r.sutra);var s=this._buildNetworkIcon(r.icon);return s&&(o.html(s.renderHtml()),i.push(s)),o},_buildNetworkIcon:function(t){var n=null;return t&&(n=new JBase.UI.ImageTile,require(["skydrive_sharing_strip_8_ltr"],function(){var i=e.getImageInfo(t);n.setDataContext(i)})),n}})}()}),define("facebookprovider",["directnetworksprovider"],function(){!function(){var e=wLive.Core,t="https://graph.facebook.com",n="Facebook",i=6e4,r=wLive.Core.ViewContext.getInstance(),o=null,a=0,s="GetDownloadUrl",l=FilesConfig.useNewGetDownloadUrlApi;defineClass("wLive.Core.FacebookProvider",function(){this.baseUrl=r.viewParams.alturl||FilesConfig.facebookGraphApiUrl||t},{_network:null,setNetwork:function(e){this._network=e},getAlbums:function(){if(!o||a+i<(new Date).getTime()){var e=this._callGraphApi("me/albums","Facebook_GetAlbums",{limit:200},!1),t=function(t,n){e.then(function(e){o=e&&e.data,a=(new Date).getTime(),t(o)},n)},n=function(){e.cancel()};return new Shared.Promise(t,n)}return new Shared.Promise(function(e){return e(o)},function(){})},createAlbum:function(e,t,n){function i(e,t){s.then(function(t){o=null,e(t&&t.id)},t)}function r(){s.cancel()}var a={name:e,message:t,privacy:n&&"{'value':'{0}'}".format(n)},s=this._callGraphApi("me/albums","Facebook_CreateAlbum",a,!0);return new Shared.Promise(i,r)},addEmbeddedAuthUrlsToItems:function(e){var t=this;return l||e.length<=50?t._callGetDownloadUrl(e):t._callGetDownloadUrl(e.slice(0,50)).then(function(){return t._callGetDownloadUrl(e.slice(50,e.length))})},_callGetDownloadUrl:function(t){function n(n,i){d=new e.DataRequest(u,u,f,function(e){for(var i=0;i<t.length;i++){var r=t[i];r.urls.embeddedAuth=l?e.items[i].downloadUrl:e.DownloadUrls[r.id]}n(t)},i),d.apiId="SkyDrive_Json_GetDownloadUrl",d.propertyId="SkyDrive",d.start()}function i(){d&&d.abort()}for(var o=[],a=0;a<t.length;a++)o.push(t[a].id);var c={resid:o.join(","),cid:r.callerCid,open:!0},u=l?FilesConfig.baseApiUrl+s:"/{0}?".format(s)+$Utility.serialize(c),d=null,f=l?Object.toJSON({ids:o,streamName:"jpeg"}):null;return new Shared.Promise(n,i)},getUploadPhotosBatch:function(e,t){for(var n=[],i=t+"/photos?url={0}&name={1}",r=0;r<e.length;r++){var o=e[r];n.push({method:"POST",relative_url:i.format(encodeURIComponent(o.urls.embeddedAuth),encodeURIComponent(o.caption||""))})}var a={batch:JSON.stringify(n),access_token:this._network&&this._network.clientToken};return a},publishVideo:function(e,t){wLive.Core.OperationManager.Current.execute("PublishVideo",{items:[e],targetItem:e,accessToken:this._network&&this._network.clientToken,description:t})},_callGraphApi:function(t,i,r,o){function a(t,r){d=new e.DataRequest(u,u,o?c:null,t,r,null,null,1,!0),d.apiId=i,d.propertyId=n,d.parseError=function(e,t){var n={};try{var i=Object.fromJSON(e.responseText);n=i&&i.error||{}}catch(r){}var o={error:{code:n.code?(n.type||"")+n.code:"HTTP_"+e.status,message:n.message,status:t,debugMessage:"(xhr status "+e.status+") xhr.responseText: "+e.responseText,stackTrace:""}};return o},d.start()}function s(){d&&d.abort()}var l=r||{};l.access_token=l.access_token||this._network&&this._network.clientToken;var c=$Utility.serialize(l),u=this.baseUrl+"/"+encodeURIComponent(t)+(o?"":"?"+c),d=null;return new Shared.Promise(a,s)}})}()}),define("searchshared",["wliveloaded"],function(){!function(){function e(e,t,n){var i=this;i.key=e,i.weight=t,i.order=n}function t(){function e(e,t,n){var i,l=[t].concat(t.split(" ")),c=new Array(e.length+2),u="(^|\\s"+(n?"|@":"")+(n?"":"|["+s.escapeRegex()+"]")+")";for(i=0;i<c.length;i++)c[i]=0;var d=$B&&$B.IE&&$B.V<=8;for(i=0;i<l.length;i++)for(var f=l[i],h=o.accent.fold(d?e:o.japanese.map(e)).replace(new RegExp(u+"("+o.accent.fold(d?f:o.japanese.map(f)).escapeRegex()+")","ig"),"$1"+r+"$2"+a),p=0,g=0,m=0;-1!=(p=h.indexOf(r,g));){g=h.indexOf(a,g+1),m+=2;for(var v=p-m+2;g-m+1>v;v++)c[v+1]=1}var y=[];for(i=1;i<c.length;i++)c[i]!=c[i-1]&&y.push(i-1);var _=0;for(i=0;i<y.length;i++)_=y[i]+i,e=e.substr(0,_)+(i%2?a:r)+e.substr(_);return e}var t=this,n='<strong class="CL_Matched_Text t_elnk">',i="</strong>",r="",a="",s=" !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",l=new RegExp("["+s.escapeRegex()+"]","ig");t.accent=new function(){var e=this,t={a:/[\xE0-\xE4]/gi,e:/[\xE8-\xEB]/gi,i:/[\xED-\xEF]/gi,o:/[\xF3-\xF5]/gi,u:/[\xF9-\xFC]/gi,n:/\xF1/gi,y:/\xFF/gi,c:/\xE7/gi,s:/[\u015A-\u0161]/gi},n=/[\xE0-\xE4\xE8-\xEB\xED-\xEF\xF3-\xF5\xF9-\xFC\xF1\xFF\xE7\u015A-\u0161]/gi;e.fold=function(e){if(e.search(n)>=0){e=e.toLowerCase();for(var i in t)e=e.replace(t[i],i)}return e}},t.getSuffixStringsFor=function(e){var t=[],n=null,i=null;if(e)for(t.push(n=e.lTrim());-1!=(i=n.search(l));)t.push(n=n.substring(i+1).lTrim());return t},t.isHighlighted=function(e){return e&&e.indexOf(n)-1},t.makeBold=function(t,s,l){var c=$B&&$B.IE&&$B.V<=8,u=!c&&o.korean.match(t)?o.korean.highlight(t,s):e(t,s,l);return u.encodeHtml().replace(new RegExp(r.encodeHtml(),"g"),n).replace(new RegExp(a.encodeHtml(),"g"),i)},t.japanese=new function(){function e(){var e=["(["];for(var t in i)e.push(t);return e.push("])"),new RegExp(e.join(""),"g")}function t(){for(var e=["(["],t=0,n=o.length;n>t;t++)e.push(o[t]);return e.push("])"),new RegExp(e.join(""),"g")}var n=this,i={:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"a",:"b",:"c",:"d",:"e",:"f",:"g",:"h",:"i",:"j",:"k",:"l",:"m",:"n",:"o",:"p",:"q",:"r",:"s",:"t",:"u",:"v",:"w",:"x",:"y",:"z",:"A",:"B",:"C",:"D",:"E",:"F",:"G",:"H",:"I",:"J",:"K",:"L",:"M",:"N",:"O",:"P",:"Q",:"R",:"S",:"T",:"U",:"V",:"W",:"X",:"Y",:"Z"},r={0:{val:"",regex:/^[\u304B]{1}[\u309B]{1}$/gi},1:{val:"",regex:/^[\u304D]{1}[\u309B]{1}$/gi},2:{val:"",regex:/^[\u304F]{1}[\u309B]{1}$/gi},3:{val:"",regex:/^[\u3051]{1}[\u309B]{1}$/gi},4:{val:"",regex:/^[\u3053]{1}[\u309B]{1}$/gi},5:{val:"",regex:/^[\u3055]{1}[\u309B]{1}$/gi},6:{val:"",regex:/^[\u3057]{1}[\u309B]{1}$/gi},7:{val:"",regex:/^[\u3059]{1}[\u309B]{1}$/gi},8:{val:"",regex:/^[\u305B]{1}[\u309B]{1}$/gi},9:{val:"",regex:/^[\u305D]{1}[\u309B]{1}$/gi},10:{val:"",regex:/^[\u305F]{1}[\u309B]{1}$/gi},11:{val:"",regex:/^[\u3061]{1}[\u309B]{1}$/gi},12:{val:"",regex:/^[\u3064]{1}[\u309B]{1}$/gi},13:{val:"",regex:/^[\u3066]{1}[\u309B]{1}$/gi},14:{val:"",regex:/^[\u3068]{1}[\u309B]{1}$/gi},15:{val:"",regex:/^[\u306F]{1}[\u309B]{1}$/gi},16:{val:"",regex:/^[\u3072]{1}[\u309B]{1}$/gi},17:{val:"",regex:/^[\u3075]{1}[\u309B]{1}$/gi},18:{val:"",regex:/^[\u3078]{1}[\u309B]{1}$/gi},19:{val:"",regex:/^[\u307B]{1}[\u309B]{1}$/gi},20:{val:"",regex:/^[\u306F]{1}[\u309C]{1}$/gi},21:{val:"",regex:/^[\u3072]{1}[\u309C]{1}$/gi},22:{val:"",regex:/^[\u3075]{1}[\u309C]{1}$/gi},23:{val:"",regex:/^[\u3078]{1}[\u309C]{1}$/gi},24:{val:"",regex:/^[\u307B]{1}[\u309C]{1}$/gi},25:{val:"",regex:/^[\u30AB]{1}[\u309C]{1}$/gi},26:{val:"",regex:/^[\u30AD]{1}[\u309C]{1}$/gi},27:{val:"",regex:/^[\u30AF]{1}[\u309C]{1}$/gi},28:{val:"",regex:/^[\u30B1]{1}[\u309C]{1}$/gi},29:{val:"",regex:/^[\u30B3]{1}[\u309C]{1}$/gi},30:{val:"",regex:/^[\u30B5]{1}[\u309C]{1}$/gi},31:{val:"",regex:/^[\u30B7]{1}[\u309C]{1}$/gi},32:{val:"",regex:/^[\u30B9]{1}[\u309C]{1}$/gi},33:{val:"",regex:/^[\u30BB]{1}[\u309C]{1}$/gi},34:{val:"",regex:/^[\u30BD]{1}[\u309C]{1}$/gi},35:{val:"",regex:/^[\u30BF]{1}[\u309C]{1}$/gi},36:{val:"",regex:/^[\u30C1]{1}[\u309C]{1}$/gi},37:{val:"",regex:/^[\u30C4]{1}[\u309C]{1}$/gi},38:{val:"",regex:/^[\u30C6]{1}[\u309C]{1}$/gi},39:{val:"",regex:/^[\u30C8]{1}[\u309C]{1}$/gi},40:{val:"",regex:/^[\u30CF]{1}[\u309B]{1}$/gi},41:{val:"",regex:/^[\u30D2]{1}[\u309B]{1}$/gi},42:{val:"",regex:/^[\u30D5]{1}[\u309B]{1}$/gi},43:{val:"",regex:/^[\u30D8]{1}[\u309B]{1}$/gi},44:{val:"",regex:/^[\u30DB]{1}[\u309B]{1}$/gi},45:{val:"",regex:/^[\u30CF]{1}[\u309C]{1}$/gi},50:{val:"",regex:/^[\uFF76]{1}[\uFF9E]{1}$/gi},51:{val:"",regex:/^[\uFF77]{1}[\uFF9E]{1}$/gi},52:{val:"",regex:/^[\uFF78]{1}[\uFF9E]{1}$/gi},53:{val:"",regex:/^[\uFF79]{1}[\uFF9E]{1}$/gi},54:{val:"",regex:/^[\uFF7A]{1}[\uFF9E]{1}$/gi},55:{val:"",regex:/^[\uFF7B]{1}[\uFF9E]{1}$/gi},56:{val:"",regex:/^[\uFF7C]{1}[\uFF9E]{1}$/gi},57:{val:"",regex:/^[\uFF7D]{1}[\uFF9E]{1}$/gi},58:{val:"",regex:/^[\uFF7E]{1}[\uFF9E]{1}$/gi},59:{val:"",regex:/^[\uFF7F]{1}[\uFF9E]{1}$/gi},60:{val:"",regex:/^[\uFF80]{1}[\uFF9E]{1}$/gi},61:{val:"",regex:/^[\uFF81]{1}[\uFF9E]{1}$/gi},62:{val:"",regex:/^[\uFF82]{1}[\uFF9E]{1}$/gi},63:{val:"",regex:/^[\uFF83]{1}[\uFF9E]{1}$/gi},64:{val:"",regex:/^[\uFF84]{1}[\uFF9E]{1}$/gi},65:{val:"",regex:/^[\uFF8A]{1}[\uFF9E]{1}$/gi},66:{val:"",regex:/^[\uFF8B]{1}[\uFF9E]{1}$/gi},67:{val:"",regex:/^[\uFF8C]{1}[\uFF9E]{1}$/gi},68:{val:"",regex:/^[\uFF8D]{1}[\uFF9E]{1}$/gi},69:{val:"",regex:/^[\uFF8E]{1}[\uFF9E]{1}$/gi},70:{val:"",regex:/^[\uFF8A]{1}[\uFF9F]{1}$/gi},71:{val:"",regex:/^[\uFF8B]{1}[\uFF9F]{1}$/gi},72:{val:"",regex:/^[\uFF8C]{1}[\uFF9F]{1}$/gi},73:{val:"",regex:/^[\uFF8D]{1}[\uFF9F]{1}$/gi},74:{val:"",regex:/^[\uFF8E]{1}[\uFF9F]{1}$/gi}},o=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],a=e(),s=t();n.map=function(e){if(e.search(s)>=0){e=e.replace(a,function(e){return i[e]});for(var t in r)e=e.replace(r[t].regex,r[t].val)}return e}},t.korean=new function(){function t(e){return String.fromCharCode(e)}function n(){var e=["(["];for(var t in d)e.push(t);return e.push("])"),new RegExp(e.join(""),"g")}var i=this,r=new RegExp("([\\uAC00-\\uD7AF])","g"),o=44032,s=4352,l=4449,c=4519,u=a,d={:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},f=n(d),h=new RegExp("([\\u1100-\\u1112][\\u1161-\\u1175][\\u11A8-\\u11C2]{0,1})","g"),p=new RegExp("([\\u1100-\\u1112]"+u+"{0,1}[\\u1161-\\u1175]"+u+"{0,1}[\\u11A8-\\u11C2]{0,1})","g");i.expand=function(e){return e=e.replace(f,function(e){return d[e]}),e.replace(r,function(e){var n=e.charCodeAt(0)-o,i=Math.floor(n/588),r=Math.floor((n-588*i)/28),a=n%28;return t(i+s)+t(r+l)+(a?t(a+c):"")})},i.highlight=function(n,r){var o=e(i.expand(n),i.expand(r),0);return o.replace(p,function(e){return e.replace(u,"")+(e.match(u)?u:"")}).replace(h,function(e){var n=e.charCodeAt(0)-s,i=e.charCodeAt(1)-l,r=e.length>2?e.charCodeAt(2)-c:0;return t(588*n+28*i+r+44032)})},i.match=function(e){return e.match(r)}}}function n(e){function t(e){return function(t,n){for(var i=0,r=0;i<e.length&&!(r=e[i++](t,n)););return r}}function n(e,t){return v.compareParents(e.obj,t.obj)}function i(e,t){return e.bucket-t.bucket}function r(e,t){return y(e.obj,t.obj)}function a(e,t){return _(e.obj).length-_(t.obj).length}function s(e,t){return t.weight-e.weight}function l(e){for(var t,n=0;n<h.autoCompleteTokens.length;)t=c(h.autoCompleteTokens[n]),-1==e.indexOf(t)?h.autoCompleteTokens.splice(n,1):(e=e.replace(t,""),n++)}function c(e){return e}function u(e){return e=d(e),e.toLowerCase().trim().replace(m," ")}function d(e){for(var t=0;t<h.autoCompleteTokens.length;t++)e=e.replace(c(h.autoCompleteTokens[t]),"");return e}function f(e){var t=e;return $B&&$B.IE&&$B.V<=8||(t=o.korean.expand(o.japanese.map(e))),p.matchPrefix(o.accent.fold(t))}var h=this,p=null,g=[],m=/\s+/g,v=e,y=v.comparer,_=v.matchField;h.autoCompleteTokens=[],h.getMatches=function(e,o){l(e);var c,d=u(e),h=[],p=null,g=null;if(""==d)return{result:[],query:e};for(p=f(d),c=0;c<p.length;c++)g=p[c],h.push({obj:g.obj,weight:_(g.obj).toLowerCase()==d?g.weight+1.5:g.weight,bucket:0});var m=d.split(" ");if(m.length>1)for(c=0;c<m.length;c++){p=f(m[c]);for(var y=0;y<p.length;y++)g=p[y],h.push({obj:g.obj,weight:g.weight-.1*Math.abs(c+1-g.order),bucket:c+1})}var w=[];if(h.length){var b=v.compareParents?[n]:[];b.addRange([r,i]),h.sort(t(b));var C=null,S=null,k=null,I=null,x=m.length>1?m.length:0,T=function(e){C=e,S=C.bucket,k=0==S?0:1},L=function(){(!I||v.isValid(I.obj,C.obj))&&k==x&&w.push(I=C)};for(T(h[0]),c=1;c<h.length;c++)g=h[c],r(C,g)?(L(),T(g)):(C.weight=C.weight+g.weight,S!=g.bucket&&(S=g.bucket,k++));L()}var P=v.finalSortFunction?v.finalSortFunction:a;w.sort(t([s,P])),w.length=Math.min(w.length,o);var D=new Array(w.length);for(c=0;c<w.length;c++)D[c]=w[c].obj;return{result:D,query:e}},h.normalizeTerm=function(e){return e=u(e),$B&&$B.IE&&$B.V<=8||(e=o.korean.expand(o.japanese.map(e))),e=o.accent.fold(e)},h.initialize=function(e,t,n){function i(){for(var c=Math.min(e.length,l+s),u=l;c>u;u++){var d=e[u],f=v.getKeysAndWeights(d);t&&(r=[]);for(var h=0;h<f.length;h++){var m=f[h],y=m.key.toLowerCase().trim();a||(y=o.korean.expand(o.japanese.map(y)));var _=p.insert(o.accent.fold(y),{obj:e[u],weight:m.weight,order:m.order});t&&r.push(_)}t&&(g[v.getUniqueKey(d)]=r)}c<e.length?(l=c,setTimeout(i,a?0:100)):(p.sort(),n&&n())}p=p||new $Trie;var r=null,a=$B&&$B.IE&&$B.V<=8,s=n?100:e.length,l=0;i()},h.remove=function(e){p=p||new $Trie;for(var t=0,n=e.length;n>t;t++){var i=e[t],r=g[i];if(r){for(var o=0,a=r.length;a>o;o++)p.remove(r[o]);delete g[i]}}}}var i=window,r=i.wLive;r.Search=r.Search||{},r.Search.RankSearchKeyWeight=e;var o=r.Search.Helpers=new t;r.Search.Indexer=n,$Do.register("wlxsearchshared")}()}),define("namespaces",["wliveloaded","searchshared"],function(){!function(){var e=window.wLive,t=e.ContactList=e.ContactList||{};t.Controls=t.Controls||{},t.Core=t.Core||{}}()}),define("alphabethelper",["namespaces"],function(){!function(){function e(e){function n(){if(f){var e=f.alphabet;if(e&&e.length>0){d||(u.push(r),c[r]=-1);for(var t=0;t<a.length;t++)for(var n=a[t],o=n[0];o<=n[1];o++)c[String.fromCharCode(o)]=-1;for(var l=0,h=0,p=e.length;p>h;h++){var g=e[h];u.push(g),c[g]=++l}d?(u.push(r),c[r]=++l):u.push(i),c[i]=++l,s=l}}}var s,l=this,c=[],u=[],d=e,f=t.$Config.ContactListV2;l.getAlphabetLetter=function(e){var t;return e?(t=e.substring(0,1).toUpperCase(),c[t]?(t>=" "&&"@">=t||t>="["&&"`">=t||t>="{"&&"~">=t)&&(t=r):t=i):t=i,t},l.compareString=function(e,t,n){var i=c[l.getAlphabetLetter(e)]||s,r=c[l.getAlphabetLetter(t)]||s;return i>r?n?-1:1:r>i?n?1:-1:(e||"").localeCompare(t||"")},l.getAlphabet=function(){return u},l.getDigitsLetter=function(){return r},l.getNonAlphabetLetter=function(){return i},l.getFavoritesLetter=function(){return o},l.supportsAlphabet=function(){return u&&u.length>0},l.getLetterTitleAttr=function(e){return e!=i?e.encodeHtml():""},l.getLetterHtml=function(e){return e!==i?e.encodeHtml():'<span class="GlobeIcon cl_ImgStrip">&nbsp;</span>'},n()}var t=window,n=t.wLive,i="@",r="#",o="*",a=[[32,64],[91,96],[123,126]];n.ContactList.Core.AlphabetHelper=e}()}),define("factory",["alphabethelper"],function(){!function(e){function t(e){var t=this;t._settings=e}function n(e){this._settings=e}function i(e){var t=this;t._settings=e}function r(e){var t=this;t._settings=e}var o=window,a=e,s=o.wLive=o.wLive||{},l=s.ContactList=s.ContactList||{},c=l.ViewModels=s.ContactList.ViewModels||{},u=(l.Controls=s.ContactList.Controls||{},c.SearchablePropertyTypes={name:0,otherName:1,company:2,email:3});c.SearchableProperties=[{properties:["firstName","lastName"],type:u.name,prefixRank:[1.5,1]},{properties:["displayName","name","nickName","sortName","yomiFirstName","yomiLastName"],type:u.otherName,prefixRank:[1,.75]},{properties:["company","yomiCompanyName"],type:u.company,prefixRank:[1,.75]},{properties:["email"],type:u.email,prefixRank:[1,.75]}];var d,f=c.ContactType=new $Flags("Person",0,"Category",1,"Group",2,"PicwEmail",3),h=c.DisplayNameType=new $Flags("Nickname",0,"Email",1,"Phone",2),p="DisplayNameType";$Do.when("$pwc",0,function(){d=o.$pwc}),c.PersonFactory=t,t.prototype={createContacts:function(e){return this._getEmailContactsFromPerson(e)},_getEmailContactsFromPerson:function(e){for(var t=this._createCommonModelFromPerson(e),n=e.getContactEmails(),i=n.length,r=[],o=0;i>o;o++)r.push(this._createContactFromCommonModel(t,n[o]));return 0===i&&this._settings.includePeopleWithoutEmails&&r.push(this._createContactFromCommonModel(t,"")),r},_createCommonModelFromPerson:function(e){function t(e){for(var t=[e.mobile,e.home,e.home2,e.work,e.work2],n=null,i=0,r=t.length;r>i&&!(n=t[i]);i++);return n}var n={Id:e.getId(),Cid:e.getCid(),HexCid:e.getHexCid(),Name:e.getFullName(),Company:e.getCompanyName(),NickName:e.getNickname(),Phone:t(e.getPhones()),UserTile:e.getUserTile(),IsFavorite:e.getIsFavorite(),CategoryIds:e.getCategoryIds(),PwcObject:e};return n},_setDisplayAndSortNameWithFallback:function(e){var t,n,i,r=this._settings,o=e.PwcObject;if(t=e.Name){var a=d.names,s=o.getNameType(),l=o.isLastNameFirst(),c=!l&&r.sortOrder,u=!l&&r.displayOrder,f=o.getFirstName(),g=o.getLastName(),m=o.getYomiFirstName(),v=o.getYomiLastName(),y=!(!m&&!v),_=y?m:f,w=y?v:g;i=a.formatName(s,c?"sortNameReverse":"sortName",null,_,null,w,null),n=a.formatName(s,u?"displayNameReverse":"displayName",null,f,null,g,null),e.ReverseName=u
}else(t=e.NickName)?e[p]=h.Nickname:(t=e.Company)?i=o.getYomiCompanyName():(t=e.Email)?e[p]=h.Email:(t=e.Phone)&&(e[p]=h.Phone);n=n||t,e.ListDisplayName=n,e.DisplayName=t,e.SortName=i?i.toLowerCase():n?n.toLowerCase():""},_createContactFromCommonModel:function(e,t){var n=a.extend({},e,{Email:t,Type:f.Person});return this._setDisplayAndSortNameWithFallback(n),new s.ContactList.ViewModels.Contact(n)}},c.DirectMessageFactory=n,n.prototype=a.extend({},t.prototype,{createContacts:function(e){return this._getEmailContactsFromPerson(e).concat(this._getFacebookContactsFromPerson(e))},_getFacebookContactsFromPerson:function(e){for(var t=this._createCommonModelFromPerson(e),n=e.getContacts(),i=[],r=0;r<n.length;r++)"FB"===n[r].getSourceId()&&(t.Id=n[r].getObjectId(),t.SourceId=n[r].getSourceId(),i.push(this._createContactFromCommonModel(t,GetString("live.shared.skydrive.pc.Sharing.FacebookContactEmail"))));return i}}),c.GroupFactory=i,i.prototype={createContacts:function(e){return[new s.ContactList.ViewModels.Contact(this._createModel(e))]},_createModel:function(e){var t=e.getName();return{Id:e.getId(),Cid:e.getCid(),HexCid:e.getHexCid(),Type:f.Group,DisplayName:t,ListDisplayName:t,SortName:t,PwcObject:e}}},c.CategoryFactory=r,r.prototype={createContacts:function(e){return[new s.ContactList.ViewModels.Contact(this._createModel(e))]},_createModel:function(e){var t=e.getName();return{Id:e.getId(),Type:f.Category,IsFavoriteCategory:e.getIsFavorite(),DisplayName:t,ListDisplayName:t,SortName:t,PwcObject:e}}}}(window.originaljQuery||jQuery)}),define("contact",["factory"],function(){!function(e){function t(n){function i(){void 0===a.model.PicwOrder&&(a.model.PicwOrder=s)}function r(t,n){return void 0===n?n=a.model[t]:e.observable(a.model).setProperty(t,n),n}function o(e){var t=a.pwcObject();return t&&t[e]?t[e]():null}var a=this;a.model=n,a.$model=e(a.model),a.type=function(){return r("Type")},a.isInPicw=function(){return a.picwOrder()<s},a.clientId=function(){return a.email()+":"+a.id()+":"+a.type()},a.id=function(){return r("Id")},a.cid=function(){return r("Cid")},a.hexCid=function(){return r("HexCid")},a.displayName=function(){return r("DisplayName")},a.listDisplayName=function(){return r("ListDisplayName")},a.name=function(){return r("Name")},a.company=function(){return r("Company")},a.yomiCompanyName=function(){return o("getYomiCompanyName")},a.nickName=function(){return r("NickName")},a.sortName=function(){return r("SortName")},a.firstName=function(){return o("getFirstName")},a.lastName=function(){return o("getLastName")},a.nameType=function(){return o("getNameType")},a.reverseName=function(){return!!r("ReverseName")},a.yomiFirstName=function(){return o("getYomiFirstName")},a.yomiLastName=function(){return o("getYomiLastName")},a.picwOrder=function(e){return r("PicwOrder",e)},a.email=function(){return r("Email")},a.sourceId=function(){return r("SourceId")},a.userTile=function(e){return r("UserTile",e)},a.isFavorite=function(){return r("IsFavorite")},a.isFavoriteCategory=function(){return r("IsFavoriteCategory")},a.categoryIds=function(){return r("CategoryIds")||[]},a.isSelected=function(e){return r("IsSelected",e)},a.pwcObject=function(){return r("PwcObject")},a.bindPropertyChange=function(e){a.$model.bind("propertyChange",e)},a.unbindPropertyChange=function(e){a.$model.unbind("propertyChange",e)},a.equals=function(e){return e instanceof t&&e.id()===a.id()},a.dispose=function(){a.$model.unbind()},i()}function n(){function e(e){return e.displayName()}function t(e){return r.Search.Helpers.getSuffixStringsFor(e)}function n(e,n,i,r){for(var o=t(n),a=i.length-1,s=0,l=o.length;l>s;s++)e.push(new u(o[s],i[Math.min(s,a)],r)),r++;return r}function i(e,t,n,i){e.push(new u(t,n||.75,1));var r="",o=t.split("@");o.length>0&&(r=o[o.length-1]),r&&e.push(new u(r,i||.5,1))}var o=this;o.matchField=function(e){return e.displayName()},o.getKeysAndWeights=function(e){for(var t=[],r=1,o=s-e.picwOrder()+100,a=0,u=c.length;u>a;a++){for(var d=c[a],f=(d.names||[],d.properties||[]),h=d.type,p=d.prefixRank,g=[o-(5-p[0]),o-(5-p[1])],m=[],v=0,y=f.length;y>v;v++)m.push(e[f[v]]());for(var _=0,w=m.length;w>_;_++){var b=m[_];b&&(h===l.email?i(t,b,g[0],g[1]):r=n(t,b,g,r))}}return t},o.autoComplete=function(t){return e(t)},o.isValid=function(){return!0},o.compareParents=null,o.comparer=function(e,t){var n=e.clientId(),i=t.clientId(),r=0;return n>i?r=1:i>n&&(r=-1),r}}var i=window,r=i.wLive,o=r.ContactList,a=o.ViewModels,s=1e6,l=a.SearchablePropertyTypes,c=a.SearchableProperties,u=(a.ContactTypeToSchemaMap,r.Search.RankSearchKeyWeight);a.Contact=t,a.ContactsHelper=n}(window.originaljQuery||jQuery)}),define("flatcontactsdatamodel",["contact"],function(){!function(e){function t(t){function r(){if(P){var e=f();C=e.contacts.sort(l.alphabeticalComparer),T=e.emailHash,x=e.idHash,L=e.personsEmails,b=a.syncKey,g(),m.$.triggerHandler(c.initialize)}else d()}function d(){P||D||(D=!0,v=new w.personFactory(w),y=new w.groupFactory(w),_=new w.categoryFactory(w),$Do.when("$pwc",0,function(){a=n.$pwc,a.callWhenReady(function(){P=!0,D=!1,r()})}))}function f(){var e,t={contacts:[],emailHash:{},idHash:{},personsEmails:{}},n=a.persons,i=a.groups,r=a.categories,o=w.personFilterFn,s=w.groupFilterFn,l=w.categoryFilterFn;if(w.includePeople)for(var c=n.length;c--;)e=n[c],e.isHidden()||!w.includeMeContact&&e.isMe()||o&&!o(e)||h(e,t,v);if(w.includeGroups)for(var u=i.length;u--;)(!s||s(i[u]))&&h(i[u],t,y);if(w.includeCategories)for(var d=r.length;d--;)(!l||l(r[d]))&&h(r[d],t,_);return t}function h(e,t,n){var r=n.createContacts(e);r=i.isArray(r)?r:[r];for(var o=0;o<r.length;o++)r[o].sortName()&&p(r[o],t)}function p(e,t){var n=t.emailHash,i=t.personsEmails,r=e.email();t.contacts.push(e),t.idHash[e.clientId()]=e,r&&(r=r.toLowerCase(),n[r]||(n[r]=e),i[e.id()]||(i[e.id()]=[]),i[e.id()].push(r))}function g(){for(var e=[],t=C.clone(),n=I||[],i=0;i<n.length;i++){var r=n[i].toLowerCase(),o=T[r];if(o)o.picwOrder(i),(0===E||e.length<E)&&e.push(o);else if(w.createContactsFromUnmatchedPicwEmails){var a=new s.ViewModels.Contact({Id:i,Type:s.ViewModels.ContactType.PicwEmail,DisplayName:"",Email:r,SortName:"",PicwOrder:i});(0===E||e.length<E)&&e.push(a),t.push(a)}}S=e,k=t.sort(l.picwAlphaComparer)}var m=this;m.$=i(m);var v,y,_,w=i.extend({},u,t),b=null,C=[],S=[],k=[],I=w.picwEmails,x={},T={},L={},P=!1,D=!1,E=w.maxPicwEntries;m.doWhenInitialized=function(e){if(P)e();else{var t=function(){m.$.unbind(c.initialize,t),e()};m.$.bind(c.initialize,t)}},m.dispose=function(){m.$.unbind()},m.reinitializeIfStale=function(){D||a.syncKey===b||r()},m.setPicwEmails=function(e){e.join(";")!==I.join(";")&&m.doWhenInitialized(function(){I=e,r()})},m.removePicwContact=function(e){var t=null;if(e.isInPicw()){var n=e.picwOrder();t=I[n],t&&(I.splice(n,1),r())}return t},m.getAlphabetHelper=function(){return o},m.getContactsByCategory=function(e){var t=[],n={};return i.each(C,function(r,o){var a=o.id();n[a]||-1===i.inArray(e,o.categoryIds())||(t.push(o),n[a]=!0)}),t},m.getContactByClientId=function(e){return x[e]},m.getContactByEmail=function(e){return e?T[e.toLowerCase()]:void 0},m.getContactByName=function(e){if(e&&""!==e){e=e.toLowerCase();for(var t=0,n=C.length;n>t;t++){var i=C[t].name()||"",r=C[t].displayName()||"";if(e===i.toLowerCase()||e===r.toLowerCase())return C[t]}}},m.getEmailsOfPerson=function(e){return L[e]},m.getContacts=function(){return C.clone()},m.getPicwContacts=function(t,n){var i=S.clone();if(e.isArray(n)){for(var r={},o=0;o<n.length;o++)r[n[o].clientId()]=n;for(var a=[],s=0;s<i.length;s++)r[i[s].clientId()]||a.push(i[s]);i=a}return t&&t>0&&i.length>t&&(i=i.splice(0,t)),i},m.getMergedContacts=function(){return k.clone()},r()}var n=window,i=e,r=n.wLive,o=new wLive.ContactList.Core.AlphabetHelper,a=null,s=r.ContactList,l=s.ViewModels.SortHelpers={alphabeticalComparer:function(e,t){return o.compareString(e.sortName(),t.sortName(),!1)},picwComparer:function(e,t){return e.picwOrder()-t.picwOrder()},picwAlphaComparer:function(e,t){var n=l.picwComparer(e,t);return 0!==n?n:l.alphabeticalComparer(e,t)}};s.ViewModels.FlatContactsDataModel=t;var c=t.Events={initialize:"initialize"},u={sortOrder:null,displayOrder:null,picwEmails:[],createContactsFromUnmatchedPicwEmails:!0,maxPicwEntries:0,includeMeContact:!0,includePeople:!0,includeGroups:!0,includeCategories:!0,includePeopleWithoutEmails:!1,personFilterFn:null,groupFilterFn:null,categoryFilterFn:null,personFactory:s.ViewModels.PersonFactory,groupFactory:s.ViewModels.GroupFactory,categoryFactory:s.ViewModels.CategoryFactory}}(window.originaljQuery||jQuery)}),define("virtualizedgrid",["flatcontactsdatamodel"],function(){!function(e){function t(t,n,i,r,o,u){function _(){R=z.containerHeight||N.innerHeight(),H=z.containerWidth||N.innerWidth(),O=0!==z.maxColumns?z.maxColumns:Math.round(Math.floor(H/J)),U=Math.round(Math.ceil(R/K)),j=U*O,W=j*z.renderPages,Q=U*z.renderPages*K}function w(){st=!0}function b(){st=!1,P(),$.render()}function C(e,t){if(!Z){var n=t.change;if("insert"===n)G.processInsertedItems(t.index,t.items);else if("remove"===n)G.processRemovedItems(t.index,t.items);else{if("move"===n)throw new Error("Move is not supported");"refresh"===n&&S()}st||(P(),$.render())}}function S(){for(var e=0,t=rt.length;t>e;e++)rt[e].remove();rt=[],ot=[],G.init(et,rt,ot),P(),$.render()}function k(t){var n=e(t.target);return $.getItemForEvent(n)}function I(e){var t=k(e);t.mouseover&&t.mouseover(e)}function x(e){var t=k(e);t.mouseout&&t.mouseout(e)}function T(e){var t=k(e);t.mousedown&&t.mousedown(e)}function L(e){var t=k(e);t.click&&t.click(e)}function P(){var e=B.innerHeight(),t=Math.ceil(rt.length/O)*K;e!=t&&N.css({height:t+"px"})}function D(){$.render()}function E(){var e,t,n,i=A.scrollTop()-it,r=Math.floor(i/K)*O,o=Math.ceil(i/K)*O;if(r===Y||-1===Y?(e=r,t=e+W):r>Y?(e=r,t=e+W):Y>r&&(t=r+j,e=t-W),t>rt.length){var a=t-rt.length;t-=a,e-=a}return 0>e&&(e=0),Y=r,V&&(n=V>i?-1:i>V?1:0),V=i,{startIndex:e,endIndex:t,firstVisibleIndex:o,scrollTop:i,dir:n}}var $=this;$.$=e(this),l++;var A,F=s+l,N=t;A=u?u:t.parent();var M=document.createElement("ul");N.append(M),N.css("overflow","hidden");var B=e(M);B.attr("role","listbox").prop("id",F.replace(/\W/g,"_")),sutra(B,o||"$Sutra.Shared.ContactsList");var R,H,O,U,j,W,Q,V,q,G,z=e.extend({height:51,width:100,padding:{top:0,right:0,bottom:0,left:0},renderPages:3,maxColumns:1,itemClass:"",alphabetHelper:null,fadeBackground:!0},r||{}),K=z.height+z.padding.top+z.padding.bottom,J=z.width+z.padding.left+z.padding.right,X=-1,Y=-1,Z=!1,et=n,tt="."+z.itemClass,nt="li"+tt,it=-1,rt=new Array(et.length),ot=[],at=i,st=!1;_(),G=z.letterHeader&&z.alphabetHelper?new a.ContactList.Controls.LetterHeaderGridLayout($,A,at,z.alphabetHelper,z.fadeBackground):new a.ContactList.Controls.ListGridLayout($,at),G.init(et,rt,ot),P(),A.bind(g+F,D);var lt=e([et]);lt.bind(m+F,C),lt.bind(v+F,w),lt.bind(y+F,b),z.supportsHover&&(N.delegate(tt,f,I),N.delegate(tt,h,x)),N.delegate(tt,d,T),N.delegate(tt,p,L),$.isVisible=function(e){if(st)return!1;q=q||E();var t=Math.floor(q.startIndex/O)*K;return e>=t&&t+Q>=e},$.hide=function(){N.hide()},$.closeLetterPicker=function(){G&&G.closeLetterPicker&&G.closeLetterPicker()},$.show=function(){N.show()},$.setVisibility=function(e){A.css("overflow",e?"auto":"hidden"),N.css("visibility",e?"visible":"hidden")},$.createTile=function(t,n,i,r,o,a){var s=[];if(s.push('<li id="'),s.push((F+t).replace(/\W/g,"_").encodeHtmlAttribute()),s.push('" role="option" class="'),s.push(z.itemClass),o)for(var l=0,u=o.length;u>l;l++)s.push(" "),s.push(o[l]);if(s.push('" style="top:'),s.push(n),s.push("px; left:"),s.push(i),s.push("px"),a)for(var d in a)d&&(s.push(";"),s.push(d),s.push(":"),s.push(a[d]));s.push('" data-'),s.push(c),s.push('="'),s.push(t.encodeHtmlAttribute()),s.push('">'),s.push(r),s.push("</li>");var f=e(s.join(""));return f.data(c,t),sutra(f,"$Sutra.Shared.ContactsListItem"),B.append(f),f},$.getTileCount=function(){return rt.length},$.getTileCountPerPage=function(){return j},$.getTile=function(e){return e<rt.length?rt[e]:null},$.getTileIndex=function(e){for(var t=rt.length-1;t>=0;t-=1)if(rt[t]===e)return t;return-1},$.getAriaListId=function(){return B.prop("id")},$.resize=function(){_(),$.render(),G.resize()},$.getScrollData=function(){return q},$.render=function(){0>it&&(it=N.offset().top-A.offset().top),q=E();var e,t=q.startIndex,n=0,i=Math.floor(t/O)*K,r=t,o=rt.length,a=q.scrollTop;G.onRender&&G.onRender(t,i,n);for(var s=0;W>s;s++)o>r&&(e=r%O,r!=t&&(0==e?(i+=K,n=0):n+=z.width),rt[r++].render(r,i,n,a));X=t},$.scrollTo=function(e){var t=Math.floor(e/O)*K;A.scrollTop(t)},$.isItemVisible=function(e){var t=Math.floor(e/O)*K,n=A.scrollTop()-it;return t>=n&&t+K<=n+A.height()},$.getItemForEvent=function(e){var t=e.closest(nt),n=t.data(c);return ot[n]},$.dispose=function(){Z||(Z=!0,$.closeLetterPicker(),G.dispose(),A.unbind(F),z.supportsHover&&(N.undelegate(tt,f,I),N.undelegate(tt,h,x)),N.undelegate(tt,d,T),N.undelegate(tt,p,L),N.empty(),lt.unbind(F),$.$.unbind(),ot=rt=N=A=B=G=lt=$=$.$=null)}}function n(e,t,n,r,o){function s(e){return r.getAlphabetLetter(e.sortName())}function l(){y.setVisibility(!0)}function c(e,t){y.setVisibility(!0),y.scrollTo(p.indexOf(g[i(t.letter)])),setTimeout(function(){y.$.triggerHandler("clickLetter",t)},0)}function d(e){var t=new a.ContactList.Controls.LetterGridTile(i(e),e,y,v,r);return g[t.uniqueId]=t,t}function f(e,t){for(var n=-1,i=e,r=p.length;r>i;i++)if(!(p[i]instanceof a.ContactList.Controls.LetterGridTile)&&p[i].itemEquals(t)){n=i;break}return n}var h,p,g,m,v=this,y=e,_=n,w=new a.ContactList.Controls.LetterPicker(t,r,o);w.$.bind("letterClick",c),w.$.bind("close",l),v.showLetterPicker=function(){y.setVisibility(!1);for(var e=r.getAlphabet(),t=[],n=0,o=e.length;o>n;n++)g[i(e[n])]&&t.push(e[n]);w.show(t)},v.closeLetterPicker=function(){w.close()},v.init=function(e,t,n){if(h=e,p=t,g=n,m=e.length,h.length>0)for(var i,r=-1,o=0,a=0,l=0,c=h.length;c>l;l++){var u=s(h[l]);r!=u&&(r=u,i=p[o++]=d(u,a),a+=2);var f=_.createTile(y,h[l]);p[o++]=f,g[f.uniqueId]=f,i.itemsCount++}},v.onRender=function(){},v.processInsertedItems=function(e,t){var n,r,o=[],a="";n=h.length>0&&m-1>e?0===e?0:f(e,h[e-1])+1:p.length;for(var l=0,c=t.length;c>l;l++){var v=s(t[l]);if(v!=a)if(r=g[i(v)],a=v,r){var w=p.indexOf(r);w>=n&&(o.push(r),p.splice(w,1))}else r=d(v,0),o.push(r);var b=_.createTile(y,t[l]);o.push(b),g[b.uniqueId]=b,r.itemsCount++}u.apply(p,[n,0].concat(o))},v.processRemovedItems=function(e,t){for(var n=0,r=t.length;r>n;n++){var o=f(e,t[n]),a=p.splice(o,1);a[0].remove(),delete g[a.uniqueId];var l=s(t[n]),c=g[i(l)];0===--c.itemsCount&&(c.remove(),p.splice(p.indexOf(c,e),1),delete g[c.uniqueId])}},v.resize=function(){w.resize()},v.dispose=function(){w.dispose()}}function i(e){return e}function r(e,t){var n,i,r,o=this,a=e;o.init=function(e,o,s){n=e,i=o,r=s;for(var l=0,c=n.length;c>l;l++){var u=t.createTile(a,n[l]);i[l]=u,r[u.uniqueId]=u}},o.processInsertedItems=function(e,n){for(var o=[],s=0,l=n.length;l>s;s++){var c=t.createTile(a,n[s]);o.push(c),r[c.uniqueId]=c}u.apply(i,[e,0].concat(o))},o.processRemovedItems=function(e,t){for(var n=i.splice(e,t.length),o=0,a=n.length;a>o;o++)delete r[n[o].uniqueId],n[o].remove()},o.resize=function(){},o.dispose=function(){var e;if(i&&(e=i.length))for(var t=0;e>t;t++)delete r[i[t].uniqueId],i[t].remove(),i[t]=null}}var o=window,a=o.wLive,s=".VirtualizedGrid",l=0,c="unique-id",u=[].splice,d="mousedown",f="mouseover",h="mouseout",p="click",g="scroll",m="arrayChange",v="beginBatchUpdate",y="endBatchUpdate";a.ContactList.Controls.VirtualizedGrid=t,a.ContactList.Controls.LetterHeaderGridLayout=n,a.ContactList.Controls.ListGridLayout=r}(window.originaljQuery||jQuery)}),define("letterpicker",["virtualizedgrid"],function(){!function(e){function t(t,i,s){function l(){s&&m.addClass(r),v.addClass(r)}function c(){h.close()}function u(t){for(var r=[],o=0,a=p.length;a>o;o++){var s=p[o];r.push('<div class="Letter '),-1!==t.indexOf(s)?r.push("Enabled t_bci"):r.push("Disabled"),r.push('" title="'+s.encodeHtml()+'">'),r.push(i.getLetterHtml(s)),r.push("</div>")}y.html(r.join("")),n.$Sutra&&e(".Letter",y).each(function(){sutra(e(this),"$Sutra.Shared.ContactsLetterPickerLetter")})}function d(t){l();var n=e(t.target).closest(".Letter").attr("title");h.$.triggerHandler("letterClick",{letter:n})}function f(){var e=t.offset();return{top:e.top,left:e.left,width:t.innerWidth(),height:t.innerHeight()}}var h=this;h.$=e(h);var p=i.getAlphabet(),g=e("body");if(s)var m=e(o).addClass(r).addClass("UI_Dialog_BG").css({position:"absolute",width:e(n).width(),height:e(n).height()}).appendTo(g);var v=e(o).addClass(r).addClass("LetterPickerContainer").css(e.extend({overflow:"auto",position:"absolute"},f())).appendTo(g),y=e(o).addClass("LetterPicker");sutra(v,"$Sutra.Shared.ContactsLetterPicker"),v.append(y),y.delegate(".Enabled",a,d),s&&m.bind(a,c),h.show=function(e){u(e),h.resize(),s&&m.removeClass(r),v.removeClass(r)},h.close=function(){l(),h.$.triggerHandler("close",null)},h.resize=function(){s&&m.css({width:e(n).width(),height:e(n).height()}),v.css(f())},h.dispose=function(){h.$.unbind(),y.undelegate(".Enabled",a,d),s&&(m.unbind(a,c),m.remove()),v.remove()}}var n=window,i=n.wLive,r="Hidden",o="<div>",a="click";i.ContactList.Controls.LetterPicker=t}(window.originaljQuery||jQuery)}),define("lettergridtile",["letterpicker"],function(){!function(e){function t(e,t,n,i,r){var o=this;o._letter=t,o._grid=n,o.uniqueId=e,o._layout=i,o._alphabetHelper=r}var n=window,i=n.wLive;i.ContactList.Controls.LetterGridTile=t,t.prototype={uniqueId:null,_grid:null,_$container:null,_layout:null,_top:-1,_left:-1,_letter:"",itemsCount:0,render:function(e,t,i){var r=this;r._$container?((t!==r._top||i!==r._left)&&(r._$container.css({top:t+"px",left:i+"px"}),r._top=t,r._left=i),r._renderUpdates()):(r._onBeforeRender(),r._$container=r._grid.createTile(r.uniqueId,t,i,r._getHtml(),r._getCssClasses(),r._getStyles()),r._top=t,r._left=i,n.$Sutra&&r._setupSutraTags())},_onBeforeRender:e.noop,_renderUpdates:e.noop,_getHtml:function(){var e=this;return'<div class="Letter t_bci">'+e._alphabetHelper.getLetterHtml(e._letter)+"</div>"},_setupSutraTags:function(){var t=this;sutra(e(".Letter",t._$container),"$Sutra.Shared.ContactsListLetterTile")},_getCssClasses:e.noop,_getStyles:e.noop,click:function(){var e=this;e._layout.showLetterPicker()},remove:function(){var e=this;e._$container&&(e._$container.empty(),e._$container=null),e.dispose()},dispose:e.noop}}(window.originaljQuery||jQuery)}),define("contactlistthrottle",["lettergridtile"],function(){!function(){var e=window,t=e.wLive,n={};t.cpThrottle=function(e,t,i){n[e]&&clearTimeout(n[e]),n[e]=setTimeout(function(){i(),delete n[e]},t)}}()}),define("contactlistregister",["contactlistthrottle"],function(){$Do.register("WLXContactListV2")}),define("contactpickernamespaces",["wliveloaded","jquery.views","contactlistregister"],function(){!function(){{var e=window.wLive||{},t=e.ContactPickerV2=e.ContactPickerV2||{};t.ViewModels=e.ContactPickerV2.ViewModels||{},t.Controls=e.ContactPickerV2.Controls||{}}}()}),define("selectedcontact",["contactpickernamespaces"],function(){!function(e){function t(i,s,l,c){function u(){if(f.model=l||{},f.options=c||{},i&&(f.model.DisplayName=i.name(),f.model.Email=i.email(),s&&f.model.Email||(f.model.SelectionText=i.raw())),s){if(s.displayName()&&(f.displayName(s.displayName()),f.model.SelectionText||f.model.Email||f.selectionText(s.displayName())),s.email()){var t=new o.EmailAddressParser(s.email());(t.email()||s.sourceId())&&f.email(s.email()),s.displayName()&&(t.email()||s.sourceId())||f.displayName(s.email())}f.contact(s)}f.$model=e(f.model),f.model.Error=f.contactRequiresEmail()&&!f.model.Email}function d(t,n){return void 0===n?n=f.model[t]:e.observable(f.model).setProperty(t,n),n}var f=this;f.id=function(e){return d("Id",void 0===e?e:e.toString())},f.displayName=function(e){return 0===arguments.length?f.model.DisplayName?d("DisplayName",e):f.model.Email?d("Email",e):d("SelectionText",e):d("DisplayName",e)},f.hasUserTile=function(){return s&&s.userTile()},f.userTileHtml=function(){var e="",t=f.contact();if(t&&t.userTile()){var n=f.ic=$icm.createICForPerson("CPV2_addressWell",t.id(),{toolTipType:"none",hidePresence:!0});e=n.render()}return e},f.selectionText=function(e){return 0!==arguments.length||f.model.SelectionText?d("SelectionText",e):f.model.Email},f.email=function(e){return d("Email",e)},f.editing=function(e){return!!d("Editing",e)},f.hideDelete=function(){return!!f.options.hideDelete},f.error=function(e){return!!d("Error",e)},f.contact=function(e){return d("Contact",e)},f.isCategory=function(){var e=f.contact();return!(!e||e.type()!==a.ViewModels.ContactType.Category)},f.isGroup=function(){var e=f.contact();return!(!e||e.type()!==a.ViewModels.ContactType.Group)},f.contactRequiresEmail=function(){return!(f.isCategory()||f.isGroup())},f.isSameContact=function(e){var t=f.contact();return!(!t||!t.equals(e&&e.contact()))},f.tooltip=function(){var e;if(f.error())e=n.$Config.ContactPickerV2.InvalidAddress;else{var t=f.displayName(),i=f.email();e=i&&t!==i?t+" <"+i+">":t}return e},f.bindPropertyChange=function(e){f.$model.bind("propertyChange",e)},f.unbindPropertyChange=function(e){f.$model.unbind("propertyChange",e)},f.errorClass=function(){return f.error()?"cp_error":""},f.ctnrDivClass=function(){return f.isCategory()?"cp_ctnrExp":"cp_ctnr"},f.serialize=function(){var e=f.displayName().replace(/"/g,'\\"');if(f.isCategory()||f.isGroup())return'"'+e+'"';var t=f.email();return t?'"'+e+'" <'+t+">":e},f.clone=function(){for(var e,n={},i=0,o=r.length;o>i;i++)e=r[i],n[e]=f.model[e];return new t(null,null,n)},u()}var n=window,i=n.wLive,r=["DisplayName","Email","SelectionText","Error","Contact"],o=i.ContactPickerV2,a=i.ContactList;o.ViewModels.SelectedContact=t}(window.originaljQuery||jQuery)}),define("emailaddressparser",["selectedcontact"],function(){!function(e){function t(t){function n(){r(t)}function i(t,n){return void 0===n?n=s[t]:e.observable(s).setProperty(t,n),n}function r(e){var t;if(a.raw(e),e){e=e.replace(/\u200e|\u200f/g,""),e=e.trim();for(var n,i=new RegExp(o,"gi"),r=d.None,s=d.None;null!=(currMatch=i.exec(e));){var l=currMatch[0],u=l.charAt(0),f=l.charAt(l.length-1);if(s="<"===u&&">"===f?d.Bracketed:'"'===u&&'"'===f?d.Quoted:d.Bare,s>r&&(n=currMatch,r=s,s===d.Bracketed))break}var h=e;if(n){t=n[0];var p=n.index,g=p+t.length,m=p>0?e.substr(0,p).trim():"",v=g<e.length?e.substr(g):"",y=c.exec(t);t=y[1],"'"===t.charAt(0)&&v&&"'"===v.charAt(0)&&(t=t.slice(1),v=v.slice(1).trim()),h=""===m?v:m,a.email(t.trim())}h=h.replace(/^\s*"\s*/,"").trim(),h.length>1&&"/"!==h.charAt(h.length-2)&&(h=h.replace(/\s*"$/,"")),h=h.replace(/\//g,""),""!==h&&h!==t&&a.name(h)}}var a=this,s={};a.email=function(e){return i("Email",e)},a.name=function(e){return i("Name",e)},a.raw=function(e){return i("Raw",e)},n()}function n(e){for(var t=e.split(u),n=t.length-1;n>=0;n--)t[n]=t[n].trim(),0===t[n].length&&t.splice(n,1);return t}var i=window,r=i.wLive||{},o="(?:[<\"]\\s*)?[a-z0-9\\u0080-\\uFFFF!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9\\u0080-\\uFFFF!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9\\u0080-\\uFFFF](?:[a-z0-9\\u0080-\\uFFFF-]*[a-z0-9\\u0080-\\uFFFF])?\\.)+[a-z0-9\\u0080-\\uFFFF](?:[a-z0-9\\u0080-\\uFFFF-]*[a-z0-9\\u0080-\\uFFFF])?(?:\\s*[>\"])?",a=new RegExp(o,"i"),s="[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@((?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)",l=new RegExp(s,"i"),c=/^[<"]?([^<>"]*)[>"]?$/,u=/[,;](?=(?:[^"]*"[^"]*")*(?![^"]*"))/,d={None:0,Quoted:1,Bare:2,Bracketed:3},f=r.ContactPickerV2=r.ContactPickerV2||{};wLive.ContactPickerV2.EmailAddressParser=t,f.EmailAddressParser.isValidEmailSyntax=function(e,t){return e?!!(t?l:a).exec(e.trim()):!1},wLive.ContactPickerV2.EmailAddressParser.parse=function(e){if(!e)return[];for(var t=n(e),i=[],r=0,o=t.length;o>r;r++)i.push(new f.EmailAddressParser(t[r]));return i},wLive.ContactPickerV2.EmailAddressParser.endsWithDelimiter=function(e){if(e){var t=e.split(u);return!t[t.length-1].trim()}return!1}}(window.originaljQuery||jQuery)}),define("contactpickermodel",["emailaddressparser"],function(){!function(e){function t(e,t,n){function c(){b=i.extend({},l,t),i.each(n||[],function(e,t){y.selectContacts(t)}),_=b.errorOnDomains.split(";"),w.$.bind(o.ViewModels.FlatContactsDataModel.Events.initialize,d)}function u(e,t){return e?w.getContactByEmail(e):w.getContactByName(t)}function d(){for(var e=0,t=C.length;t>e;e++){var n=C[e];n.contact()||(contact=u(n.email(),n.displayName()),contact&&y.modifySelectedContact(new a.EmailAddressParser(n.selectionText()),n,!0))}y.$.triggerHandler(s.initialize)}function f(e){var t=!1;return i.each(C,function(n,i){return e.isSameContact(i)?(t=!0,!1):void 0}),t}function h(e){var t=e.lastIndexOf("@"),n=e.substring(t+1).trim().toLowerCase();return-1!==i.inArray(n,_)}function p(e){var t=e.email();return e.contactRequiresEmail()&&!t||!e.contact()&&h(t)}function g(e,t){var n=e.target.Id,i=y.getSelectedContactById(n);y.$.triggerHandler(s.editedContact,{model:y,contacts:[i],contact:i,change:t}),k[n]=i,r.cpThrottle("cpRefreshDirty"+I,20,m)}function m(){var e=[];for(var t in k){var n=k[t],r=y.indexOfSelectedContactId(t);i.observable(C).move(r,r,1),e.push(n)}k={},y.$.triggerHandler(s.refreshedContacts,{model:y,contacts:[e]})}function v(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];if(i.isCategory())for(var r=y.getContactsByCategoryContact(i),o=0;o<r.length;o++)t.push(new a.ViewModels.SelectedContact(null,r[o]));else t.push(i)}return t}var y=this;y.$=i(y);var _,w=e,b={},C=[],S=0,k={},I=Math.random().toString();y.getAlphabetHelper=function(){return w.getAlphabetHelper()},y.getContactList=function(){return w.getContacts()},y.getMergedContactList=function(){return w.getMergedContacts()},y.getPicwContactList=function(e,t){return w.getPicwContacts(e,t)},y.selectContacts=function(e,t,n){i.isArray(e)||(e=[e]),t="number"==typeof t?t:C.length;var r=[],o=[],a=[],l=[],c=b.selectionMaximum;return b.autoExpandCategories&&(e=v(e)),i.each(e,function(e,t){b.allowFreeformEntry||t.contact()?!b.allowDuplicateSelection&&f(t)?a.push(t):c>0&&C.length+r.length>=c?l.push(t):(t.id(++S),t.bindPropertyChange(g),r.push(t)):o.push(t)}),r.length>0&&(i.observable(C).insert(t,r),y.$.triggerHandler(s.selectedContacts,{model:y,contacts:r,context:n})),o.length>0&&y.$.triggerHandler(s.freeformContactRejected,{model:y,contacts:o,context:n}),a.length>0&&y.$.triggerHandler(s.duplicateContactRejected,{model:y,contacts:a,context:n}),l.length>0&&y.$.triggerHandler(s.tooManyContactsRejected,{model:y,contacts:l,context:n}),r},y.addSelectedContact=function(e,t,n){return y.addSelectedContacts([e],t,n)},y.addSelectedContacts=function(e,t,n){for(var i=[],r=0;r<e.length;r++){var o=e[r],s=u(o.email(),o.name()),l=new a.ViewModels.SelectedContact(o,s);l.error(l.contactRequiresEmail()&&!l.email()),i.push(l)}return y.selectContacts(i,t,n)},y.modifySelectedContact=function(e,t,n){var i=t.contact();i||(i=u(e.email(),e.name()));var r,o;e&&(r=e.name(),o=e.email(),t.selectionText(e.raw())),t.displayName(i&&i.displayName()?i.displayName():r),n&&r&&t.displayName(r),t.email(i&&i.email()?i.email():o),t.error(p(t)),t.contact(i)},y.refreshContacts=function(){m()},y.contactExists=function(e){if(!e)return!1;var t=u(e.email(),e.name());return!!t},y.getContactsByCategory=function(e){return w.getContactsByCategory(e)},y.getContactsByCategoryContact=function(e){var t=e.contact(),n=t.id();return y.getContactsByCategory(n)},y.deselectContactByIndex=function(e){var t=null;return e>=0&&(selectedContact=C[e],selectedContact.unbindPropertyChange(g),i.observable(C).remove(e,1),y.$.triggerHandler(s.deselectedContacts,{model:y,contacts:[selectedContact]})),t},y.deselectContactBySelectedContactId=function(e){return y.deselectContactByIndex(y.indexOfSelectedContactId(e))},y.indexOfSelectedContactId=function(e){var t=-1;return i.each(C,function(n,i){return e===i.id()?(t=n,!1):void 0}),t},y.getSelectedContactByIndex=function(e){return C[e]},y.getSelectedContactById=function(e){return y.getSelectedContactByIndex(y.indexOfSelectedContactId(e))},y.selectedContacts=function(e){var t=e?C:C.clone();return t},y.countSelected=function(){return C.length},y.canAddMoreContacts=function(){var e=b.selectionMaximum;return 0===e||y.countSelected()<e},y.serializeSelection=function(){var e=[];return i.each(C,function(t,n){e.push(n.serialize())}),e.join("; ")},y.dispose=function(){if(y){for(var e=0;e<C.length;e++)C[e].unbindPropertyChange(g);y.$.unbind(),w.$.unbind(o.ViewModels.FlatContactsDataModel.Events.initialize,d),C=w=_=b=y=y.$=null}},c()}var n=window,i=e,r=n.wLive,o=r.ContactList,a=r.ContactPickerV2;a.ViewModels.ContactPickerModel=t;var s=t.Events={initialize:"initialize",selectedContacts:"selectedContacts",deselectedContacts:"deselectedContacts",editedContact:"editedContact",refreshedContacts:"refreshedContacts",freeformContactRejected:"freeformContactRejected",duplicateContactRejected:"duplicateContactRejected",tooManyContactsRejected:"tooManyContactsRejected"},l={allowDuplicateSelection:!0,selectionMaximum:0,allowFreeformEntry:!0,autoExpandCategories:!1,errorOnDomains:"home.com;attbi.com;example.com;hotmail.co;yaho.com;hotmai.com;yahoo.co;yahoomail.com;direcway.com;homail.com;ims-ms-daemon;local.transport;ethome.net.tw;ethome.net.tw;hotmil.com;hotmial.com;yhoo.com;collegeclub.com;sbcglobal.com;hotamil.com;yaoo.com;yahoo.net;yhaoo.com;mail.hotmail.com;passport.com;kimo.com.tw;yahooo.com;yahho.com;ol.com;gateway.net;hotmail.com.mx;otmail.com;htomail.com;aol.co;altavista.com;hotmaill.com;taiwan.com;hotmail.con;ahoo.com;hotmail.om;hotmail.net;hormail.com;hotail.com;hotamail.com;yahoo.om;homtail.com;msn.net;sprint.ca;angelfire.com;cm1.ethome.net.tw;yohoo.com;a0l.com;alo.com;msn.de;gmail.co"}}(window.originaljQuery||jQuery)}),define("contactlisttile",["contactpickermodel"],function(){!function(e){function t(e,t,n,i,r){var o=this;o._grid=e,o._contact=t,o.uniqueId=t.clientId(),o._searchQuery=n,o._useListDisplayName=i,o._showRemoveButtons=r}var n=window,i=e,r=n.wLive,o=r.ContactList,a=o.ViewModels,s=r.ContactPickerV2,l=(s.ViewModels,"CL_Hov t_cp_hov"),c="CL_Sel",u=n.$Config.imgsBase+"ic/groupsnmxl.png",d=a.ContactType,f=a.SearchableProperties,h=a.SearchablePropertyTypes;s.Controls.ContactListTile=t,t.prototype={uniqueId:null,_grid:null,_$container:null,_top:-1,_left:-1,_isDirty:!1,_contact:null,_pendingUpdates:null,_propertyChangeProxy:null,render:function(e,t,n){var i=this;i._$container?((t!==i._top||n!==i._left)&&(i._$container.css({top:t,left:n}),i._top=t,i._left=n),i._renderUpdates()):(i._onBeforeRender(),i._$container=i._grid.createTile(i.uniqueId,t,n,i._getHtml(),i._getCssClasses(),i._getStyles()),i._top=t,i._left=n,i._ic&&i._ic.activate(i._$container.find(".c_ic")))},_searchQuery:null,_onBeforeRender:function(){var e=this;e._propertyChangeProxy=function(t,n){e.onPropertyChange(t,n)},e._contact.bindPropertyChange(e._propertyChangeProxy)},_makeBold:function(e,t,n){return r.Search.Helpers.makeBold(e,t,n)},_getHtml:function(){var e=this,t=e._contact,n=[],r=e._useListDisplayName?t.listDisplayName():t.displayName(),o=t.email()||"",a={displayName:null,fieldHtml:null};if(r===o&&(o=""),e._searchQuery){r=e._makeBold(r,e._searchQuery,!1);var s=r!==e._makeBold(t.displayName(),"",!1),l=o||"";o=e._makeBold(l,e._searchQuery,!0);var c=o!==e._makeBold(l,"",!0);if(!c&&!s)for(var u=0;u<f.length;u++){var d=f[u],h=d.properties,p=d.type;if(e._findHiddenMatches(h,p,t,a)){r=a.displayName||r;break}}}else r=r.encodeHtml(),o=o.encodeHtml();return n=i.templates("#cp_contactListTileTemplate").render({displayNameHtml:r,hasUserTile:function(){return!0},userTileHtml:e._getUserTileHtml(),emailHtml:o,hidden:a.fieldHtml?a:null,removeButtonEnabled:e._showRemoveButtons})},_findHiddenMatches:function(e,t,i,r){for(var o=this,a=0;a<e.length;a++){var s=e[a],l=i[s]()||"",c=o._makeBold(l,o._searchQuery,t===h.email);if(c!==l.encodeHtml()){if(t===h.name){var u=i.firstName()||"",d=i.lastName()||"",u="firstName"===s?c:u.encodeHtml(),d="lastName"===s?c:d.encodeHtml();
r.displayName=n.$pwc.names.formatName(i.nameType(),i.reverseName()?"displayNameReverse":"displayName",null,u,null,d,null)}else r.fieldHtml=c;return!0}}return!1},_getUserTileHtml:function(){var e=this,t=e._contact,n=null;if(t.type()===d.Person)n=$icm.createICForPerson("CPV2_contactList",t.id(),{showICCard:!0});else{var i={};(t.type()===d.Category||t.type()===d.Group)&&(i.userTileUrl=u),n=$icm.createNonContactIC("CPV2_contactList","",i)}return e._ic=n,n&&n.render()||""},_getCssClasses:function(){return this._contact.isSelected()?["CL_Sel"]:void 0},_getStyles:e.noop,_renderUpdates:function(){var e=this;if(e._pendingUpdates){var t=e._pendingUpdates.IsSelected;void 0!==t&&e._$container.toggleClass(c,t),e._pendingUpdates=null}},onPropertyChange:function(e,t){var n=this;n._pendingUpdates=n._pendingUpdates||{},n._pendingUpdates[t.path]=t.value,n._grid.isVisible(n._top)&&n._renderUpdates()},mouseover:function(){this._$container.toggleClass(l,!0)},mouseout:function(e){this._$container.toggleClass(l,!1),this.triggerEvent(e,"mouseoutContact")},mousedown:function(e){this.triggerEvent(e,"mousedownContact")},click:function(e){this.triggerEvent(e,"clickContact")},triggerEvent:function(e,t){var n=this,i={contact:n._contact,tile:n,target:e.target};setTimeout(function(){n._grid&&n._grid.$.triggerHandler(t,i)},0)},remove:function(){var e=this;e._$container&&(e._$container.empty(),e._$container=null),e._ic&&window.$icm&&($icm.removeIC(e._ic),e._ic=null),e.dispose()},dispose:function(){var e=this;e._propertyChangeProxy&&(e._person&&e._person.unbindPropertyChange(e._propertyChangeProxy),e._propertyChangeProxy=null),e._grid=e._contact=e._searchQuery=null},itemEquals:function(e){return this._contact.equals(e)}}}(window.originaljQuery||jQuery)}),define("searchcontrol",["contactlisttile"],function(){!function(e){function t(){}function n(n,i,a){function s(e){m?e():$Do.when("wlxsearchshared",0,function(){$Do.when("$pwc",0,function(){$pwc.callWhenReady(function(){p||(u=new o.Search.Indexer(v),u.initialize(a.getMergedContactList(),!1,function(){m=!0,e()}))})})})}function l(e){o.cpThrottle("SearchControl",100,function(){if(e.keyCode!==f&&e.keyCode!==h){var t=c.getQuery(e.target);c.show(t)}})}var c=this;c.$=e(c);var u,p,g=r(n).delegate(i,d,l),m=!1,v=new wLive.ContactList.ViewModels.ContactsHelper;c.dispose=function(){p||(p=!0,g.undelegate(),c.$.unbind(),c=c.$=g=null)},c.getQuery=function(e){return r(e).val()},c.show=function(e){s(function(){if(!p){var n=new t;if(n.query=e,e&&""!==e){var i=u.getMatches(e,25);n.contacts=i.result}else n.contacts=[];c.$.triggerHandler("search",n)}})}}{var i=window,r=e,o=i.wLive,a=o.ContactList,s=(a.Controls,a.ViewModels),l=o.ContactPickerV2,c=l.Controls,u=(l.ViewModels,".SearchControl"),d="keyup"+u,f=9,h=27;s.SearchablePropertyTypes,s.SearchableProperties}c.SearchResults=t,t.prototype={contacts:[],query:""},c.SearchControl=n}(window.originaljQuery||jQuery)}),define("selectedcontact.control",["searchcontrol"],function(){!function(e){"use strict";function t(){function t(e){e.ic&&e.ic.activate()}function n(e){e.ic&&window.$icm&&($icm.removeIC(e.ic),e.ic=null)}var i="cp_inputContactTemplate",r={templateId:i,template:e.templates("#"+i),attr:"html",init:function(e){this.data=e.ctx.selectedContact},render:function(){n(this.data)},onAfterLink:function(){t(this.data)},onDispose:function(){n(this.data)}};e.views.tags({cp_selectedContactControl:r})}$Do.when("CPV2_templates",0,t)}(window.originaljQuery||jQuery)}),define("contactpickerv2",["selectedcontact.control"],function(){!function(e){function t(e){for(var t in tt)if(tt[t]===e)return!0;return!1}function n(s,l,tt){function lt(){ct(),Kn=l,Kn.$.bind(st.selectedContacts,bn),Kn.$.bind(st.refreshedContacts,bn),Kn.$.bind(st.initialize,It),Yn=Kn.getContactList(),ti=e(s),ni=ti.find("."+F),ti.addClass("t_cpv2 cpv2"),ti.on("focusin.cpv2",Ut).on("focusout.cpv2",jt).on("copy.cpv2",_t),ht(),dt(),ei.assignLegacyAutomationIds&&oi.attr("id",ti.attr("id")+"$InputBox"),e(i).bind("resize",Ln),vi&&_i&&vi.bind("keydown",Vt),Rn()}function ct(){pi=I*ei.maxLinesInAddressWell;var t=ei.maxHeight;yi="object"==typeof t||"string"==typeof t?e(t):null,e.isPlainObject(ei.toggleContactListTransitions)||(ei.toggleContactListTransitions=nt)}function ut(){var t=e(M);if(0==t.length)throw"Expected '"+M+"' on '"+window.location.href+"', but none was found."}function dt(){ut(),ii=e("<div/>",{"class":"cp_inputContainer"}).appendTo(ti).delegate(O,"click",Ht).delegate(j,"focusin",$t).delegate(j,"click",At).delegate(U,"click",Ft).delegate(U,"keydown",Jt).delegate(U,"focusin",Nt).delegate(U,"mousedown",Mt).delegate(U,"mouseout",Bt).delegate(U,"focusout",Rt).delegate(H,"dblclick",un).delegate(G,"keyup",bt).delegate(G,"paste",wt).delegate(G,"keydown",Wt).delegate(G,"keypress",Qt).delegate(q,$B.IE&&$B.V<=8?"focus":"focusin",Ot).link(e.templates(M),{selectedContacts:Kn.selectedContacts(!0),ariaLabel:ei.ariaLabel}),ri=ii.find(W),ui=ii.find(V),oi=ii.find(G);var t=St(ni,!0);oi.val(t),0===Kn.selectedContacts(!0).length?Sn(oi):Cn(oi),Xn=new Z.Controls.SearchControl(s,G,Kn),Xn.$.bind("search",wn),i.document.activeElement===ni[0]&&zn.setFocus(),ni.hide(),di=e("<textarea>",{tabIndex:"-1",autocomplete:"off","class":"cliparea"}).appendTo(ti)}function ft(t){var n=e(t);St(n),n.val("")}function ht(){ai=e("<div/>",{"class":"cp_clist"}).hide().html(e.templates("#cp_contactListContainerTemplate").render({})).appendTo(ti),sutra(ai,"$Sutra.Shared.ContactPicker"),li=ai.find(".VirtualizedGrid"),si=ai.find(".GridContainer"),ci=ai.find(Q)}function pt(t){Mn(!0),Dn(),Jn=new r.ContactList.Controls.VirtualizedGrid(li,Yn,zn,{letterHeader:t,alphabetHelper:Kn.getAlphabetHelper(),itemClass:"CL_Row",containerHeight:e(window).height(),supportsHover:!0,maxColumns:1,height:60,fadeBackground:!1},null,ai),Jn.render(),Jn.$.bind("clickContact",xt),Jn.$.bind("clickLetter",Tt),Jn.$.bind("mousedownContact",Lt),Jn.$.bind("mouseoutContact",Pt),Bn(!0),setTimeout(function(){In()},0),ci.toggleClass(P,!!(mi!==X||Zn&&""!==Zn)),Jn.scrollTo(0),Gt()}function gt(e,t){for(var n=0;e.length;)e.charAt(0)===t&&(n+=1),e=e.slice(1);return n}function mt(t){var n=e(t.target),i=n.val(),r=gt(i,'"')%2,o=t.which===a&&!(t.ctrlKey||t.shiftKey),s=!o,l=o;if(n[0]===oi[0]&&!Kn.canAddMoreContacts())return setTimeout(function(){oi.val(""),zn.$.triggerHandler(at.maxSelectedContactsReached)},0),!1;if("keypress"===t.type&&!r){l=!1;for(var u=t.charCode||t.keyCode,d=0;d<c.length;d++)if(u===c[d]){l=!0;break}}return l&&yt(t,s),l}function vt(e,t){var n=!1;if(!t){var i=e.val();i.length>0&&(0>gi||!Jn||i!==Zn)&&Xn.show(i),$Do.when("wlxsearchshared",0,function(){Si&&gi>=0&&Jn&&(fn(e,Jn.getTile(gi)._contact),n=!0)})}$Do.when("wlxsearchshared",0,function(){!Si||!t&&n||(ft(e),setTimeout(function(){Si&&(zn.setFocus(!1),En())},0))})}function yt(t,n){vt(e(t.target),n),t.stopPropagation()}function _t(){Si.triggerHandler(at.userAction,{type:rt.copy,input:ot.none})}function wt(t){setTimeout(function(){ft(t.target),Sn(e(t.target)),Si.triggerHandler(at.userAction,{type:rt.paste,input:ot.none})},0)}function bt(t){Sn(e(t.target))}function Ct(e){var t=(e.hasClass(D),e.val());if(!t||0===t.length)return[];t=t.replace(/[\r\n]+/g,T);var n=Z.EmailAddressParser.parse(t);return e.val(""),Cn(e),n}function St(e,t){var n=e.hasClass(D)||e.hasClass(F),i=(Et(e),Ct(e)),r="";t&&i.length>0&&!Z.EmailAddressParser.endsWithDelimiter(e.val())&&(r=i.pop().raw());var o;if(!n){var a,s=e.view();do a=s.data,s=s.parent;while(!a&&s);a&&(o=Kn.indexOfSelectedContactId(a.id()))}var l={entryPt:it.freeform},c=Kn.addSelectedContacts(i,o,l);return n||Kn.deselectContactByIndex(o+c.length),r}function kt(e,t){var n=e.data;if(n&&n.editing()!==t){$selectedContactElt=_n(ri,n.id());var i=$selectedContactElt.width();return n.editing(t),setTimeout(function(){if(Kn.refreshContacts(),t){var e=Dt();e.css("min-width",i),Sn(e),Xn.show(n.selectionText()),zn.setFocus(!1)}},0),n}}function It(){ln()&&En()}function xt(t,n){if(Jn){var i=n.contact,r=n.tile;if(e(n.target).closest(".CL_Remove").length>0)Si.triggerHandler(at.removeContactListEntry,[n]);else{""===oi.val()&&(Kt(gi,Jn.getTileCount()),gi=Jn.getTileIndex(r),zt(gi));var o=Dt();fn(o,i)}}}function Tt(){zn.setFocus()}function Lt(e,t){var n=t.tile;n._$container.toggleClass(A,!0)}function Pt(e,t){if(Jn){var n=t.tile;gi&&Jn.getTile(gi)!==n&&n._$container.toggleClass(A,!1)}}function Dt(){var e=ii.find(z);return 0===e.length&&(e=oi),e}function Et(t){return e(t).closest(H)}function $t(){hi=!1}function At(t){var n=e.view(t.target).data;hn(n.id(),{input:ot.mouse}),zn.setFocus(),t.preventDefault()}function Ft(t){var n=e.view(t.target).data;n&&pn(n,_n(oi,n.id())),t.preventDefault()}function Nt(){hi=!1}function Mt(t){var n=e.view(t.target).data;if(!fi||n!==fi.contact){var i=Et(t.target);i.addClass(L)}}function Bt(t){var n=e.view(t.target).data;if(!fi||n!==fi.contact){var i=Et(t.target);i.removeClass(L)}}function Rt(e){var t=Et(e.target);fi.$contactElt&&t[0]===fi.$contactElt[0]&&gn()}function Ht(t){var n=e.view(t.target).data;if(n.isCategory()){var i=n.id(),r=Kn.getContactsByCategoryContact(n);fn(e(t.target),r,Kn.indexOfSelectedContactId(i)),hn(i,{type:rt.expandCategory,input:ot.mouse}),zn.setFocus()}t.preventDefault()}function Ot(t){gn(),wi&&Zn===e(t.target).val()&&Dt()[0]===oi[0]||En()}function Ut(){hi&&!ri.hasClass(N)&&setTimeout(zn.setFocus,0),ri.addClass(N),hi=!0,tn(),en()}function jt(){setTimeout(function(){document.activeElement&&cn()||ri&&ri.removeClass(N)},50),bi=setTimeout(function(){Ci&&!cn()&&(tn(),zn.completeUserEntry(),zn.hideContactList()),Ci=!0},1e3)}function Wt(t){var n=e(t.target).hasClass(D),i=n?""===e(t.target).val():!1;if(!Xt(t))switch(t.keyCode){case _:if(!n)return kt(e.view(t.target),!1),setTimeout(function(){zn.setFocus(!1),En()},0),t.stopPropagation(),!1;if(!i)return setTimeout(function(){e(t.target).val("")},0),En(),t.stopPropagation(),!1;if(wi)return zn.hideContactList(),t.stopPropagation(),!1;break;case h:case d:if(i&&mn())return t.stopPropagation(),!1;break;case m:return qt(1,!0),t.stopPropagation(),!1;case g:return qt(-1,!0),t.stopPropagation(),!1;case y:if(Jn)return qt(Jn.getTileCountPerPage(),!0),t.stopPropagation(),!1;break;case v:if(Jn)return qt(-Jn.getTileCountPerPage(),!0),t.stopPropagation(),!1;break;case u:var r=!0;if(i?zn.hideContactList():(yt(t),r=!1),!t.shiftKey&&!r)return setTimeout(function(){zn.setFocus(!1),En()},0),t.stopPropagation(),!1;if(t.shiftKey&&vi&&_i)return setTimeout(function(){vi.focus()},0),t.stopPropagation(),!1;break;default:return!mt(t)}}function Qt(e){mt(e)}function Vt(e){return e.keyCode!==u||e.shiftKey?void 0:(zn.setFocus(!1),e.stopPropagation(),!1)}function qt(e,t){if(!Jn)return!1;var n=e/Math.abs(e),i=gi+e,r=Jn.getTileCount(),o=!1;for(gi>0&&0>i?i=zt(0)||1===gi?0:1:r-1>gi&&i>=r&&(i=r-1);i>=0&&r>i;){if(zt(i)){o=!0;break}i+=n}return o?(Kt(gi,r),gi=i):t&&(0>n?(Kt(gi,r),gi=Jn.getTileCount(),o=qt(-1,!1)):(Kt(gi,r),gi=-1,o=qt(1,!1))),o}function Gt(){if(Jn){var e=ii.find(z);if(0===e.length||i.document.activeElement===oi[0])""!==oi.val()?(gi=-1,qt(1,!1)):(Kt(gi,Jn.getTileCount()),gi=-1);else{var t=e.view().data.contact();if(t){for(var n=Yn.length-1;n>=0;n-=1)if(Yn[n]===t){gi=n,zt(n);break}}else gi=-1,qt(1,!1)}}}function zt(e){if(Jn){var t=!1,n=Jn.getTile(e);if(Jn.isItemVisible(e)||(Jn.scrollTo(e),Jn.render()),n._contact&&n._$container){n._$container.addClass(A);var i=Dt();i.attr("aria-activedescendant",n._$container.prop("id")),t=!0}return t}}function Kt(e,t){if(Jn&&e>=0&&t>e){var n=Jn.getTile(e);n._$container&&n._$container.toggleClass(A,!1)}}function Jt(t){var n=e.view(t.target).data.id(),i={input:ot.key};if(!Xt(t))switch(t.keyCode){case d:return mn()||vn()||zn.setFocus(!0),hn(n,i),t.stopPropagation(),!1;case f:vn()||zn.setFocus(!0),hn(n,i);break;case h:mn();break;case p:vn()||(gn(),zn.setFocus(!0));break;case a:dn(t.target,i);break;case _:zn.setFocus(!0),t.stopPropagation();break;case u:if(t.shiftKey&&vi&&_i)return vi.focus(),t.stopPropagation(),!1}}function Xt(e){var t=!1;if(e.metaKey||e.ctrlKey){var n=e.keyCode===C,i=Yt();if(!i.hasText||n)switch(e.keyCode){case w:Zt(),t=!0;break;case b:Zt(function(){fi.contact&&(hn(fi.contact.id(),{input:ot.key}),zn.setFocus())}),t=!0}}return t}function Yt(){var e=!1,t=-1,n=-1,r=document.activeElement;if("selectionStart"in r&&(t=r.selectionStart,n=r.selectionEnd,e=n-t>0),!e){var o=i.$f.getSelectedText();if(e=!!o.text,e&&-1===t&&o.parentElement()===r&&"value"in r){var a=o.text.length;o.moveStart("character",-r.value.length),n=o.text.length,t=n-a}}return{hasText:e,start:t,end:n}}function Zt(e){var t=fi.contact;if(t){var n=fi.$contactElt,i=t.serialize();di.val(i).focus().select(),setTimeout(function(){pn(t,n),e&&e()},0)}}function en(){e(document.body).on("mousedown click dblclick",rn)}function tn(){nn(),e(document.body).off("mousedown click dblclick",rn)}function nn(){bi&&clearTimeout(bi),bi=0,Ci=!0}function rn(t){if(t&&t.target){var n=t.target,i=e(n);if(i.closest(".LetterPickerContainer").length>0)return Ci=!1,void 0;if(i.closest(R).length>0)return Ci=!1,void 0;if(vi&&sn(vi[0],i[0]))return Dt()[0]===oi[0]?zn.completeUserEntry():(on(),setTimeout(function(){zn.setFocus(!1)},0)),Ci=!1,void 0;if(i.hasClass(E)&&an(i))return Ci=!1,void 0;if(on(),"mousedown"!==t.type&&cn()||"mousedown"===t.type&&t.target===document.activeElement)return Ci=!1,void 0;zn.completeUserEntry(),zn.hideContactList()}}function on(){var e=ii.find(z);0!==e.length&&vt(e,!1)}function an(e){return sn(ti,e)}function sn(t,n){return 1===e(n).closest(t).length}function ln(){return wi||cn()}function cn(){return an(document.activeElement)}function un(e){dn(e.target,{input:ot.mouse})}function dn(t,n){kt(e.view(t),!0),n&&Si.triggerHandler(at.userAction,e.extend({type:rt.editContact,input:ot.none},n))}function fn(t,n,i){t.hasClass($)||(t=oi);var r,o=t.hasClass(D),a=(Et(t),Ct(t));a.length>0&&(r=a[0]),Cn(oi),e.isArray(n)||(n=[n]);var s=0;if(!o){var l=kt(t.view(),!1);l.contact(n[0]),Kn.modifySelectedContact(r,l,!1),s=1}for(var c=[];s<n.length;s++)c.push(new Z.ViewModels.SelectedContact(r,n[s]));var u=Zn?it.autocomplete:mi===Y?it.contactpicker:it.relevancy;Kn.selectContacts(c,i,{entryPt:u});var d=!(t[0]===oi[0]&&0===t.val());t.val(""),gn(),setTimeout(function(){ei.excludeSelectedFromFrequentList&&mi===X&&En(!0),zn.setFocus(d),In()},0)}function hn(t,n){var i=Kn.getSelectedContactById(t);i===fi.contact&&(fi={}),Kn.deselectContactBySelectedContactId(t),ei.excludeSelectedFromFrequentList&&mi===X&&wi&&En(!0),Sn(),setTimeout(In,0),n&&Si.triggerHandler(at.userAction,e.extend({type:rt.deleteContact,input:ot.none},n))}function pn(e,t){gn(),e.editing()||(fi={contact:e,$contactElt:t},t.addClass(L),t.find(U).focus(),zn.hideContactList())}function gn(){fi.$contactElt&&(fi.$contactElt.removeClass(L),fi={})}function mn(){var t=!1;if(fi.contact&&fi.$contactElt){var n=Kn.indexOfSelectedContactId(fi.contact.id())-1;if(n>=0){var i=Kn.getSelectedContactByIndex(n),r=e(fi.$contactElt.prevAll(H)[0]);pn(i,r),t=!0}}else{var o=yn();o.contact&&o.$contactElt&&(pn(o.contact,o.$contactElt),t=!0)}return t}function vn(){if(!fi.contact||!fi.$contactElt)return!1;var t=Kn.indexOfSelectedContactId(fi.contact.id());if(t<Kn.selectedContacts(!0).length-1){t+=1;var n=Kn.getSelectedContactByIndex(t),i=e(fi.$contactElt.nextAll(H)[0]);return pn(n,i),!0}return!1}function yn(){var e=Kn.selectedContacts(!0),t=e.length-1,n=null,i=null;return t>=0&&(n=e[t],i=_n(oi,n.id()),i[0]||(i=ii.find(z).closest(H))),{contact:n,$contactElt:i}}function _n(t,n){var i=e(t).closest(B);return i.find(H+"[cid='"+n+"']")}function wn(t,n){if(i.document.activeElement&&Dt()[0]===oi[0]){var r=e(i.document.activeElement);if(!r.hasClass($))return}var o=Dt();return o[0]===oi[0]||mi!==X&&mi!==J||""!==o.val()?(Zn===n.query&&Jn&&wi||(""===n.query?En():An(n.query,n.contacts.sort(et.ViewModels.SortHelpers.picwComparer)),Gt()),void 0):(zn.hideContactList(),void 0)}function bn(){setTimeout(function(){Sn(oi)},0)}function Cn(e,t){t=t||parseInt(e.css("min-width"),10)||0;var n=Math.max(t,Pn(e.val())),i=ri[0].clientWidth;return 0!==i&&(n=Math.min(n,i-k)),e.width(n),n}function Sn(e){if(e&&Cn(e),oi){var t=ri[0].clientWidth;if(0!==t){var n=ri.position().left,i=n+t-k,r=yn();if(r.$contactElt){var o=r.$contactElt.position().left;$B.rtl?i=o-k:i-=o+r.$contactElt[0].clientWidth}var a=!1;k>i&&(i=t-k,a=!0),oi.width(0),i=Cn(oi,i),ri.css("max-height",pi+"px"),setTimeout(function(){a&&ri[0]&&(i=ri[0].clientWidth-k),oi&&(oi.width(0),oi.width(i),wi&&Dn(),kn())},0)}}}function kn(){var t=e(i.document.activeElement).closest(G);t=t.length>0?t:oi;var n=t[0],r=ri.scrollTop(),o=0;if(n){for(;n&&n!==ri[0];)o+=n.offsetTop,n=n.offsetParent;(r>o||o>r+ri.height())&&ri.scrollTop(o)}}function In(){var e=xn(),t=Math.max(S,ri.innerWidth());return ai.width(t),ai.height(e),e=Tn(e),Jn&&Jn.resize(),{width:t,height:e}}function xn(){var e=ei.maxHeight;if(yi&&yi.length>0){var t=parseInt(yi.css("padding-bottom"),10),n=ti.offset().top+ti.outerHeight()-yi.offset().top;e=yi.innerHeight()-n-t}else{var i=ai.outerHeight()-ai.innerHeight();e=e&&e>0?e-ii.outerHeight()-i:Number.MAX_VALUE;var r=$f.getLocation(ii[0]),o=$f.clientHeight(),a=-1!=r.addScrollTop?$f.scrollTop():0;e=Math.min(o+a-r.bottom-i-ei.contactListBottomMargin,e)}return e=Math.max(x,e)}function Tn(e){return e=Math.min(e,si.outerHeight()),ai.height(e),e}function Ln(){var e=ei.shouldRefreshLayoutCb;(!e||e())&&In()}function Pn(e){ui.text(e);var t=ui.innerWidth();return ui.text(""),t+k}function Dn(){i.$f.dockIt(ai[0],ii[0],0,-1,1)}function En(e){var t=[],n=!1;if(mi===J)n=!0;else{var i=null;if(ei.excludeSelectedFromFrequentList&&mi==X){var r=Kn.selectedContacts();i=[];for(var o=0;o<r.length;o++){var a=r[o].contact();a&&i.push(a)}}t=mi===X?Kn.getPicwContactList(ei.numFrequentContactsShownLimit,i):Kn.getContactList(),Zn="",t.length>0?!e&&wi&&$n(t,Yn)||(Fn(),Yn=t,pt(mi===Y)):n=!0}n&&(Fn(),Yn=t,zn.hideContactList())}function $n(e,t){var n=e===t;if(e&&t&&!n&&e.length===t.length){n=!0;for(var i=0;i<e.length;i++)if(e[i]!==t[i]){n=!1;break}}return n}function An(e,t){Fn(),Yn=t,Zn=e,Yn.length>0?pt(!1):zn.hideContactList()}function Fn(){Jn&&Jn.dispose(),Jn=null,Yn=null,gi=-1}function Nn(e){var n=Dt(),i=n.length>0?n.val():oi.val(),r=mi;mi="undefined"==typeof e?ei.toggleContactListTransitions[mi]:e,t(mi)||(mi=Y),""===i||mi===Y?En(mi!==r):n.keyup(),Jn&&(Mn(!0),Bn(!0),Dn())}function Mn(e){ai.toggle(e).attr("aria-hidden",!e),wi=e}function Bn(e){if(ii.find(G).attr("aria-expanded","false").removeAttr("aria-owns").removeAttr("aria-activedescendant"),e){var t=Dt();t.attr("aria-owns",Jn.getAriaListId()).attr("aria-expanded","true")}}function Rn(){n._dragDropContext=null,ii.on("dragenter"+K,Vn).on("dragover"+K,qn).on("drop"+K,Gn),Kn.$.on(st.selectedContacts+K,Hn).on(st.refreshedContacts+K,Hn).on(st.editedContact+K,Hn).on(st.initialize+K,Hn),Hn()}function Hn(){var e=ii.find(H).off(K).on("dragstart"+K,jn).on("dragend"+K,Wn).on("drag"+K,Qn);e.length>0&&e[0].dragDrop&&e.on("mousemove"+K,Un)}function On(){ii.off(K),ii.find(H).off(K),Kn.$.off(K)}function Un(e){var t=e.target;t.dragDrop&&1===e.button&&t.dragDrop()}function jn(t){var i=e.view(t.target).data;Si.triggerHandler(at.dragStart),zn.hideContactList();var r=t.originalEvent.dataTransfer;if(r.setData("Text",i.serialize()),!r.setDragImage)var o=e("<div />",{"class":"cpv2_dragtip t_blc"}).text(i.displayName()).css("position","absolute").css("visibility","hidden").css("z-index","10000000").appendTo("body");n._dragDropContext={contact:i,picker:zn,dropped:!1,$dragEffectNode:o}}function Wn(){setTimeout(function(){var e=n._dragDropContext;n._dragDropContext=null,e.$dragEffectNode&&e.$dragEffectNode.remove(),e.dropped&&Kn.deselectContactBySelectedContactId(e.contact.id())},1)}function Qn(e){var t=n._dragDropContext.$dragEffectNode,i=e.originalEvent;t&&t.css("visibility","visible").offset({top:i.pageY+5,left:i.pageX+5})}function Vn(){zn.hideContactList()}function qn(e){n._dragDropContext&&e.preventDefault()}function Gn(e){var t=n._dragDropContext;if(t){if(t.picker!==zn){t.dropped=!0;var i=Kn.selectContacts([t.contact.clone()],null,{entryPt:it.freeform});if(i.length>0){var r=i[0];pn(r,_n(oi,r.id()))}else zn.setFocus()}e.preventDefault()}}var zn=this,Kn=null,Jn=null,Xn=null,Yn=[],Zn="",ei=e.extend({},o,tt||{}),ti=null,ni=null,ii=null,ri=null,oi=null,ai=null,si=null,li=null,ci=null,ui=null,di=null,fi={contact:null,$contactElt:null},hi=!0,pi=105,gi=-1,mi=ei.showContactListOnFocus,vi=ei.$toggleButton,yi=null,_i=ei.handleButtonFocus,wi=!1,bi=0,Ci=!0,Si=zn.$=e(zn);zn.createTile=function(t,n){return new Z.Controls.ContactListTile(t,n,Zn,mi===Y&&!Zn,e.inArray(mi,ei.enableRemoveButtonForModes)>=0&&!Zn)},zn.toggleContactList=function(e){Nn(e),zn.setFocus(!1)},zn.hideContactList=function(){Jn&&Jn.closeLetterPicker(),wi&&(Mn(!1),Bn(!1)),gi=-1,mi=ei.showContactListOnFocus},zn.addFreeformSelection=function(e){oi.val(e),ft(oi)},zn.refreshLayout=function(){Ln(),Sn()},zn.setFocus=function(e){var t=Dt();Sn(t);try{t.focus()}catch(n){return}var i=t[0];if(i.createTextRange){var r=i.createTextRange();r.moveStart("character",i.value.length),r.collapse(),r.select()}else{var o=i.value;i.value="",i.value=o}e&&t.keyup()},zn.completeUserEntry=function(){return ft(oi)},zn.hasIncompleteUserEntry=function(){return!!oi.val()},zn.resetSettings=function(t){var n=ei;delete t.$toggleButton,ei=e.extend({},ei,t||{}),ct();var i=ei.showContactListOnFocus;i!==n.showContactListOnFocus&&i!==mi&&(mi=i,!Zn&&ln()&&En()),zn.refreshLayout()},zn.dispose=function(){Si&&(Fn(),On(),Si.unbind(),ii.unbind(),oi.unbind(),ai.remove(),wi=!1,tn(),ti.off(".cpv2"),Kn.$.unbind(st.selectedContacts,bn),Kn.$.unbind(st.refreshedContacts,bn),Kn.$.unbind(st.initialize,It),e(i).unbind("resize",Ln),vi&&_i&&vi.unbind("keydown",Vt),Xn&&(Xn.$.unbind("search",wn),Xn.dispose()),ti.empty(),fi&&(fi.contact=fi.$contactElt=null),Xn=ei=s=ti=ni=ii=ri=oi=ai=si=li=Si=ci=ui=di=vi=yi=null)},lt()}var i=window,r=i.wLive,o={maxHeight:400,contactListBottomMargin:60,maxLinesInAddressWell:3,showContactListOnFocus:X,toggleContactListTransitions:null,numFrequentContactsShownLimit:0,excludeSelectedFromFrequentList:!1,handleButtonFocus:!1,$toggleButton:null,shouldRefreshLayoutCb:null,enableRemoveButtonForModes:[],assignLegacyAutomationIds:!1,ariaLabel:i.$Config.ContactPickerV2?i.$Config.ContactPickerV2.DefaultAriaLabel:""},a=13,s=44,l=59,c=[s,l],u=9,d=8,f=46,h=37,p=39,g=38,m=40,v=33,y=34,_=27,w=67,b=88,C=86,S=200,k=35,I=35,x=60,T="; ",L="cp_selected t_bci",P="CL_RelatedHidden",D="cp_primaryInput",E="cp_editInput",$="cp_anyInput",A="CL_Highlight t_bci",F="cp_textarea",N="Focus",M="#cp_inputTemplate",B=".cpv2",R=".cp_clist",H=".cp_Contact",O="a.cp_exp",U="a.cp_ctBtn",j="a.cp_remBtn",W=".cp_inputArea",Q=".CL_Related",V=".cp_textRuler",q="."+D,G="."+$,z="."+E,K=".cpdd",J=0,X=1,Y=2,Z=r.ContactPickerV2,et=r.ContactList,tt=n.ListMode={none:J,related:X,full:Y},nt=n.DefaultTransitions={};nt[J]=X,nt[X]=Y,nt[Y]=X;var it=n.EntryPoints={relevancy:1,autocomplete:2,contactpicker:3,freeform:4},rt=n.UserActionType={deleteContact:1,editContact:2,expandCategory:3,copy:4,paste:5},ot=n.UserActionInput={none:0,mouse:1,key:2},at=n.Events={userAction:"userAction",removeContactListEntry:"removeContactListEntry",dragStart:"dragStart",maxSelectedContactsReached:"maxSelectedContactsReached"},st=Z.ViewModels.ContactPickerModel.Events;Z.Controls.ContactPicker=n,$Do.register("WLXContactPickerV2")}(window.originaljQuery||jQuery)}),define("emailpane",["facebookprovider","contactpickerv2"],function(){!function(){function e(e,M,B,R,H,O){function U(){var t=Date.now();if(!Ct){var n=jQuery(o);n.bind("selectedContacts",nt),n.bind("deselectedContacts",nt),n.bind("editedContact",nt);var i,r,s,f=FilesConfig.fbDirectMessageEnabled&&kt,h=!0,p=!1,g=function(){h&&p&&et()};if(f&&(s=u("Sharing.MessageShareSubtitleFacebookManage").format('<a href="'+St.addLink+'" target="_blank">',"</a>")),H)i=u("Sharing.MessageShareHeaderFormatNoQuotations").format(H.selectionCount),r=f?u("Sharing.MessageShareSubtitleEmailOrFacebookPlural")+" "+s:u("Sharing.MessageShareSubtitleEmailPlural");else if(R&&R.groupFolderType==l.GroupFolderType.MountPoint){var m=function(e,t){i=t?d("GF.Sharing.EmailOnBehalfOf").format(t.ownerName):u("Sharing.MessageShareHeaderFormat").format(O.getName()),ct.text(i),h=!0,g()},v=function(){i=u("Sharing.MessageShareHeaderFormat").format(O.getName()),ct.text(i),h=!0,g()};h=!1,M.fetchPermissions(R,m,v,!1),r=u("Sharing.MessageShareSubtitleEmailSingular")}else{if(R&&R.photo)i=u("Sharing.MessageShareHeaderSingularPhoto");else{var y=R&&R.extension;i=u("Sharing.MessageShareHeaderFormat").format(O.getName()+(y?y:""))}r=f?u("Sharing.MessageShareSubtitleEmailOrFacebookSingular")+" "+s:u("Sharing.MessageShareSubtitleEmailSingular")}ct.text(i),sutra(ct,"$Sutra.SkyDrive.EmailPaneHeader"),ut.html(r),pt=jQuery(".sd_email_error",e);{e.find(".sd_email_to_label").text(u("Sharing.ToLabel"))}wt=jQuery(".sd_email_message",e);var _=new c.PlaceholderInput(wt,L);_.render(),sutra(wt,"$Sutra.SkyDrive.EmailPaneMessageInput"),wt.bind("keyup",function(){tt()}),bt&&wt.val(bt);var w=jQuery(".sd_email_perms",e),b=jQuery(".sd_email_statement",e),C=jQuery("#sd_email_roles",w),S=jQuery(".sd_email_can_edit",w),k=jQuery(".sd_email_signin_req",e);if(gt=jQuery("#sd_email_can_edit",S),mt=jQuery("#sd_email_roles",w),mt.attr("title",u("Sharing.RecipientPermissionsTitle")),_$roleNotes=jQuery(".sd_email_notes",e),yt=jQuery("#sd_email_signin_req",k),_t=jQuery("#sd_email_statement",e),sutra(gt,"$Sutra.SkyDrive.EmailPaneRecipientsCanEdit"),sutra(mt,"$Sutra.SkyDrive.EmailPaneRoles"),sutra(_$roleNotes,"$Sutra.SkyDrive.EmailPaneNotes"),sutra(yt,"$Sutra.SkyDrive.EmailPaneRecipientsMustSignIn"),sutra(ft,"$Sutra.SkyDrive.EmailPaneShare"),sutra(ht,"$Sutra.SkyDrive.EmailPaneCancel"),sutra(_t,"$Sutra.SkyDrive.EmailPaneStatement"),jQuery("option",mt).each(function(){var e=jQuery(this),t="c"===e.attr("value")?"$Sutra.SkyDrive.EmailPaneRoleCoOwner":"$Sutra.SkyDrive.EmailPaneRoleView";sutra(e,t)}),jQuery("option",yt).each(function(){var e=jQuery(this),t="y"===e.attr("value")?"$Sutra.SkyDrive.EmailPaneRecipientsMustSignInYes":"$Sutra.SkyDrive.EmailPaneRecipientsMustSignInNo";sutra(e,t)}),jQuery("#sd_email_signin_req_n",k).text(u("Sharing.SignInNotRequired")),jQuery("#sd_email_signin_req_y",k).text(u("Sharing.SignInRequired")),Tt&&!Lt)S.hide(),jQuery("#sd_email_coowner",w).text(d("GF.Sharing.RecipientsAreCoOwner")),jQuery("#sd_email_view",w).text(u("Sharing.RecipientsCanView")),mt.change(Y),vt=mt;else{C.hide();var I=jQuery("#sd_email_can_edit_y",S),x=jQuery("#sd_email_can_edit_n",S);I.text(u("Sharing.RecipientsCanEdit")),x.text(u("Sharing.RecipientsCanView")),sutra(I,"$Sutra.SkyDrive.EmailPaneRecipientsCanEditYes"),sutra(I,"$Sutra.SkyDrive.EmailPaneRecipientsCanEditNo"),vt=gt}var T=function(e){Dt=!0,e.preventDefault(),b.hide(),w.show(),k.show()};w.hide(),k.hide(),_t.click(T),vt.change(J),J(),X(),ft.val(u("Sharing.Share")),ft.click(rt),sutra(jQuery(".cp_inputContainer",e),"$Sutra.SkyDrive.EmailPaneToLine"),p=!0,g(),a.setFocus(!1),_$characterCounter=jQuery(".sd_email_char_cntr",e),tt(),"function"==typeof O.updateLayout&&O.updateLayout(),FilesConfig.fbDirectMessageEnabled&&!kt&&V(),Qos.logData(A,F,t,null,null,null,Date.now())}}function j(e){$Do.when("WLXContactPickerV2",0,function(){Ct||W(e)})}function W(e){if(!Ct){Q();var t={};e&&(t.personFactory=wLive.ContactList.ViewModels.DirectMessageFactory,t.personFilterFn=function(e){return!e.isFanPage()}),s=new wLive.ContactList.ViewModels.FlatContactsDataModel(t),o=new wLive.ContactPickerV2.ViewModels.ContactPickerModel(s,{autoExpandCategories:!0}),a=new wLive.ContactPickerV2.Controls.ContactPicker(jQuery("#sharingContactPicker"),o,{excludeSelectedFromFrequentList:!0,maxHeight:250,showContactListOnFocus:wLive.ContactPickerV2.Controls.ContactPicker.ListMode.none}),setTimeout(U,0)}}function Q(){a&&(a.dispose(),a=null),o&&(o.dispose(),o=null),s&&(s.dispose(),s=null);var e=jQuery(".sd_contact_picker");e.empty(),e.append(T)}function V(){dt.html(u("Sharing.FacebookContactSyncUpsellText").format('<a href="#" class="sd_facebook_upsell_link">',"<a/>"));var t=jQuery(".sd_facebook_upsell_link",e);t.bind("click",function(){var e=St.addLink+"&view=popup&brand=onedrive&scenarios=status_publish,media_publish&biciid=onedrivefbmessage&closenoredirect=true";return window.open(e,"addNetwork","width=720px,height=520px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",!0),z(),!1})}function q(){var t=jQuery(".sd_facebook_upsell_line",e);t.hide()}function G(){var t=jQuery(".sd_facebook_upsell_line",e);t.show()}function z(){function e(n){if(!Ct){var o=B.findTargetNetwork(n,"FB"),a=B.areRequiredNetworkOffersPresent(o,h);if(!i)if(o&&(a||r!==B.getContactSyncLastSuccessTime(o)))if(a){var s=jQuery(".sd_contact_sync_success");s.text(u("Sharing.FacebookContactSyncCompletedText")),clearTimeout(It),$pwc.client.deltaSync(function(){W(!0),q(),et(),O.enableMenuTabs(),Pt=!1},t)}else t();else o?K(e,t):t()}}function t(){Ct||(et(),G(),O.enableMenuTabs(),it(u("Sharing.FacebookContactSyncTimeoutText")),Pt=!1)}it(),Z(u("Sharing.FacebookContactSyncText")),q(),O.disableMenuTabs();var n=jQuery(".sd_loading");n.bind("click",function(){et(),G(),O.enableMenuTabs(),n.unbind("click",this)});var i,r;Pt||(Pt=!0,St&&(r=B.getContactSyncLastSuccessTime(St)),K(e,t),It=setTimeout(function(){i=!0,t()},g))}function K(e,t){xt=setTimeout(function(){B.clearCache(),B.fetchNetworks(e,t)},p)}function J(){var e=jQuery("option:selected",vt).text();_t.text(e)}function X(){if(!H){var e=R&&(R.photo||R.folder)?"n":"y",t=function(){Dt||(gt.val(e),gt.change())},n=function(n,i){e=i&&"edit"===i.defaultPermissionsLevel?"y":"n",t()};t(),M.fetchPermissions(R,n,void 0,!1)}}function Y(){"c"===mt.attr("value")?(_$roleNotes.text(P),yt.val("y"),yt.attr("disabled","disabled")):(_$roleNotes.text(""),yt.removeAttr("disabled"))}function Z(e){Qos.start(E),st.empty();var t=new wLive.Controls.LoadingSpinner(st,e);t.render(),st.show(),ct.hide(),ut.hide(),dt.hide(),lt.hide(),ft.hide(),Qos.end()}function et(){Qos.start($),ct.show(),ut.show(),dt.show(),lt.show(),ft.show(),st.hide(),Qos.end()}function tt(){var e=wt.val().length;e>y-v&&(_$characterCounter.show(),sutra(_$characterCounter,"$Sutra.SkyDrive.CharacterCounter")),e>y?(_$characterCounter.addClass("char_cnt_error"),ft.prop("disabled",!0),sutra(_$characterCounter,"$Sutra.SkyDrive.CharacterCounterError")):(_$characterCounter.removeClass("char_cnt_error"),ft.prop("disabled",!1),sutra(_$characterCounter,"$Sutra.SkyDrive.CharacterCounter")),_$characterCounter.text(u("Sharing.NetworkCharacterCounterFormat").format(e,y))}function nt(){var e=o.selectedContacts().length,t=e>I,n=t?u("Sharing.MaxContacts").format(I):"";t?ft.attr(f,f):ft.removeAttr(f),it(n)}function it(e){if(pt.empty(),e){var t=new c.InlineError(pt,e);t.render(),pt.show()}else pt.hide()}function rt(){t=Date.now(),it();var e=H?"Sharing.SharingFormatNoQuotations":"Sharing.SharingFormat";a.completeUserEntry(),O.showLoading(u(e).format(O.getName())),O.disableMenuTabs(),n=Tt&&!Lt?"c"===mt.attr("value")?l.PermissionsProvider.Role.CoOwner:l.PermissionsProvider.Role.View:"y"===gt.attr("value")?l.PermissionsProvider.Role.Edit:l.PermissionsProvider.Role.View,i="y"===yt.attr("value");var s=wt.val();s=s==L?null:s,pt.empty(),pt.hide();var c=o.selectedContacts();r=c.length,R?M.shareToContacts(R,null,c,n,i,s,null,at,ot):N.selectionManager.getSelectedItems(function(e){M.shareToContacts(null,e,c,n,i,s,{bundleName:O.getBundleName()},at,ot)})}function ot(e,t,n){if(!Ct){var i=t.message,r=!1;if(n){for(var a,s=0,l=0,d=0;d<n.length;d++){var f=n[d],h=f.entity;if(f.status&&f.status!=_){if(s++,f.errorCode==S){var p=f.uniqueError;a=p.message,r=!0}}else{l++;for(var g=o.selectedContacts(),m=0;m<g.length;m++){var v=g[m],y=v.contact();if(h.email==v.email()||y&&(h.did==y.cid()||h.abId==y.id())){o.deselectContactBySelectedContactId(v.id());break}}}}i=a?a:0==l?u("Sharing.ShareErrorAllFailed"):u("Sharing.ShareErrorSomeFailed").format(s)}var I=function(e){var n=t.data,o=t.message;if(n&&o){var a=Object.fromJSON(n),s=a.displayAction,l=a[e];l&&s&&(i=o.encodeHtml()+' <a href="'+l.encodeHtmlAttribute()+'" target="_blank">'+s.encodeHtml()+"</a>",r=!0)
}};if(t&&t.code==w&&I("hipUrl"),t&&t.code==C&&I("url"),t&&t.code==b){var x=t.message;x&&(i=x.format('<a target="_top" href="http://'+FilesConfig.gLinkDomain+'/8SESkyDrive/VerifyAccount">',"</a>"),r=!0)}t&&t.code==k&&(i=u("Sharing.SharingBlockedLinkGenerationError")),nt();var T=new c.InlineError(pt,i,r);T.render(),pt.show(),O.hideLoading(),O.enableMenuTabs()}}function at(e,o){if(!Ct){var a={shareStartDate:t,itemCount:O.getItemCount(),role:n,signInRequired:i,numContacts:r};O.onShareSuccessCallback(e,o,a)}}var st,lt,ct,ut,dt,ft,ht,pt,gt,mt,vt,yt,_t,wt,bt,Ct,St,kt,It,xt,Tt=FilesConfig.isUserInGfRamp&&R&&R.folder&&!R.isBundle,Lt=FilesConfig.upgradeEditorsToCoOwners,Pt=!1,Dt=!1,Et=this;Et.render=function(t){Qos.start(D),bt=t,sutra(e,"$Sutra.SkyDrive.ShareDialogEmailPane"),e.html(x),lt=jQuery(".sd_email_content",e),st=jQuery(".sd_loading",e),ft=jQuery(".sd_email_share",e),ct=jQuery(".sd_header",e),dt=jQuery(".sd_facebook_upsell_line",e),ut=jQuery(".sd_subheader_text",e),ht=jQuery(".sd_cancel",e),ht.val(u("Sharing.Close")),Z(u("Loading")),FilesConfig.fbDirectMessageEnabled?B.fetchNetworks(function(e){St=B.findTargetNetwork(e,"FB"),B.areRequiredNetworkOffersPresent(St,h)&&(kt=!0),j(kt)},function(){j()},m):j(),Qos.end()},Et.getUserMessage=function(){var e=wt&&wt.val();return e&&e!=L?e:""},Et.dispose=function(){Ct=!0,clearTimeout(It),clearTimeout(xt),Q()}}var t,n,i,r,o,a,s,l=wLive.Core,c=wLive.Controls,u=l.AleHelpers.getPCString,d=l.AleHelpers.getSkyString,f="disabled",h=["ContactAgg","StatusPublish"],p=2e3,g=6e4,m=3e3,v=100,y=FilesConfig.emailPaneMaxMessageLength,_=0,w=3006,b=3009,C=3020,S=3101,k=9006,I=20,x='<h2 class="sd_header"></h2><h3 class="sd_subheader"><span class="sd_subheader_text"></span> <span class="sd_facebook_upsell_line"></span></h3><form><div class="sd_email_content"><div><div class="sd_email_to_label"></div><div class="sd_contact_picker"></div><div class="sd_contact_sync_success"></div><div class="c_clr"></div></div><textarea class="sd_email_message"></textarea><div class="sd_email_char_cntr"></div><div class="sd_email_statement"><a href="#" id="sd_email_statement" /></div><div class="sd_email_perms"><select id="sd_email_roles" name="sd_email_roles"><option id="sd_email_view" value="v" selected="selected"></option><option id="sd_email_coowner" value="c"></option></select><div class="sd_email_can_edit"><select id="sd_email_can_edit" name="sd_email_can_edit"><option id="sd_email_can_edit_n" value="n" selected="selected"></option><option id="sd_email_can_edit_y" value="y"></option></select></div></div><div class="sd_email_signin_req"><select id="sd_email_signin_req" name="sd_email_signin_req"><option id="sd_email_signin_req_n" value="n" selected="selected"></option><option id="sd_email_signin_req_y" value="y"></option></select></div><div class="sd_email_notes t_cstc"></div><div class="sd_email_error"></div><div class="sd_buffer_bottom"></div></div><div class="sd_loading"></div><div class="sd_btns"><input class="sd_email_share default" type="button" /><input class="sd_cancel" type="button" /></div></form>',T='<div class="sd_email_to_line cpv2 t_cpv2" id="sharingContactPicker"><textarea rows="1" cols="60" class="cp_textarea"></textarea></div>',L=u("Sharing.PersonalMessagePlaceholder"),P=d("GF.Sharing.CoOwnerNotes"),D="SkyDriveWeb_Internal_Control_EmailPane_Render",E="SkyDriveWeb_Internal_Control_EmailPane_ShowLoading",$="SkyDriveWeb_Internal_Control_EmailPane_HideLoading",A="SkyDriveWeb_Internal_Control_EmailPane_RefreshPane",F="SkyDrive",N=l.ViewContext.getInstance();c.EmailPane=e}()}),define("facebookpane",["emailpane"],function(){!function(){function e(e){return wLive.Core.AleHelpers.getPCString("Sharing."+e)}var t,n=["ClientPublish"],i=2e3,r=36e4,o=e("FacebookPublishHeaderSingle"),a=e("FacebookPublishVideoHeaderSingle"),s=e("FacebookPublishHeaderMultiple"),l=e("FacebookPublishedHeader"),c=e("FacebookVideoPublishedHeader"),u="https://www.facebook.com",d=$B.ltr?"{0} ({1})":"{0} ({1})",f='<a target="_blank" href="{0}Connect?appid=FB">{1}</a>'.format(FilesConfig.findServicesUrl,e("FacebookManageLink").encodeHtml()),h='<a target="_blank" href="{0}">'+e("FacebookLink")+"</a>",p=e("FacebookVideoPublishedMessage"),g=e("FacebookPublishedMessage"),m="SkyDriveWeb_Internal_Control_FacebookPane_Publish",v=0;defineSubClass("SkyDrive.UI.FacebookPane",JBase.UI.BaseControl,function(e,n){this.loadingHtml=$f&&$f.createLoading({returnMarkup:!0,useTransparentFallback:!0}),this._facebookProvider=new wLive.Core.FacebookProvider,this._networksProvider=e,this._shareDialog=n,t=t||wLive.Core.ViewContext.getInstance()},{apiIdBase:"SkyDriveWeb_Internal_Control_FacebookPane",albumNameText:e("FacebookAlbumName"),albumNamePlaceholderText:e("FacebookAlbumNamePlaceholder"),shareWithText:e("FacebookShareWith"),publishingHtml:"",albumPlaceholderText:e("FacebookAlbumDescPlaceholder"),everyoneOptionText:e("FacebookEveryone"),allFriendsOptionText:e("FacebookFriends"),selfOptionText:e("FacebookSelf"),customOptionText:e("FacebookCustom"),goToFacebookText:e("FacebookLink"),chooseAlbumHtml:e("FacebookHelperText").format(f),createNewAlbumText:e("FacebookNewAlbum"),publishBtnText:e("FacebookPublish"),cancelBtnText:e("Close"),upsellText:e("FacebookPublishUpsell"),errorText:e("FacebookPublishTimeoutText"),errorLinkText:e("FacebookPublishTimeoutLinkText"),publishVideoHtml:e("FacebookVideoHelperText").format(f),showUpsell:!0,showNewAlbumOptions:!1,showAlbumSelector:!0,showChooseAlbum:!1,facebookUrl:u,showMessage:!1,publishBtnDisabled:!0,showPublishButton:!0,headerText:"",items:null,isPolling:!1,showError:!1,showErrorLink:!0,errorLinkUrl:"",isAlbumSelectorDisabled:!0,showLoading:!1,showPublishVideo:!1,isPublishVideoFlow:!1,_albums:null,_unfilteredAlbums:null,_network:null,onDataContextChanged:function(e){this.items=e.item,this.isPublishVideoFlow=1==this.items.length&&this.items[0].video,this.isPublishVideoFlow?(this.headerText=a.format(this.items[0]?this.items[0].name+(this.items[0].extension||""):""),this.publishingHtml=p.format(h.format(this.facebookUrl))):(this.publishingHtml=g.format(h.format(this.facebookUrl)),this.headerText=this.items.length>1?s.format(this.items.length):o.format(this.items[0]?this.items[0].name+(this.items[0].extension||""):""))},onActivate:function(){this._networksProvider.fetchNetworks(bind(this,this._onNetworksFetched),bind(this,this._onGetNetworksFailure));var e=this.isPublishVideoFlow?this.subElements.videoNote:this.subElements.albumNote,t=new wLive.Controls.PlaceholderInput(jQuery(e),this.albumPlaceholderText);t.render()},_onSelectedAlbumChange:function(){1==this.subElements.albumSelector.selectedIndex?(this.publishBtnDisabled=!0,this.showNewAlbumOptions=!0,this.showAlbumSelector=!1):this.publishBtnDisabled=!1,this._updateBindings()},_onAlbumNameChange:function(){var e=!!this.subElements.albumNameField.value;e==this.publishBtnDisabled&&(this.publishBtnDisabled=!this.publishBtnDisabled,this._updateBindings())},_onPublishClick:function(){Qos.logData(m,"SkyDrive",Date.now(),null,null,null,Date.now());var e=this;if(this.showNewAlbumOptions){var t=e.subElements.privacySelector,n=e.subElements.albumNameField.value,i=e.subElements.albumNote.value,r=t[t.selectedIndex].value;e._facebookProvider.createAlbum(n,i,r).then(bind(e,e._publishToAlbum),bind(e,e._onFacebookFailure))}else if(e.isPublishVideoFlow){var o=e.subElements.videoNote.value;e._facebookProvider.publishVideo(e.items[0],o),e.showMessage=!0,e.showPublishVideo=!1,e.headerText=c,e.showPublishButton=!1,e.showError=!1,e.facebookUrl=u,e._updateBindings()}else if(e._albums){var a=e.subElements.albumSelector,s=e._albums[a.selectedIndex-2];e._publishToAlbum(s.id,s.link)}},_onUpsellLinkClick:function(){return this._openUpsellWindow(),v=(new Date).getTime()+r,this.isPolling=!0,this._updateBindings(),this._networksProvider.clearCache(),this._networksProvider.fetchNetworks(bind(this,this._onNetworksFetched),bind(this,this._onGetNetworksFailure)),!1},_onErrorLinkClick:function(){return this._openUpsellWindow(!0),!1},_openUpsellWindow:function(e){var t="&view=popup&brand=onedrive&scenarios=status_publish,media_publish&biciid={0}&closenoredirect=true".format(this.isPublishVideoFlow?"onedrivePubVideo":"onedrivePubPhotos")+(e?"&authz=true":""),n=this._network.addLink+t;window.open(n,"addNetwork","width=720px,height=520px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",!0)},_onNetworksFetched:function(e){if(this._network=this._networksProvider.findTargetNetwork(e,"FB"),t.viewParams.alturl||this._networksProvider.areRequiredNetworkOffersPresent(this._network,n))this.isPublishVideoFlow?this._enablePublishVideo():this._enableChooseAlbum();else if(this.isPolling){var r=this;this.setTimeout(function(){(new Date).getTime()<v?(r._networksProvider.clearCache(),r._networksProvider.fetchNetworks(bind(r,r._onNetworksFetched),bind(r,r._onGetNetworksFailure))):(r.isPolling=!1,r._updateBindings())},i)}},_enableChooseAlbum:function(){var e=this;e.showUpsell=!1,e.showChooseAlbum=!0,e.isPolling=!1,e.showLoading=!0,e._updateBindings(),e._facebookProvider.setNetwork(e._network),e._fetchAlbums()},_enablePublishVideo:function(){var t=this,n=t.items[0],i=n.video,r="",o=(i.width||1)/(i.height||1);i.duration>12e5?r=e("FacebookVideoTooLongError"):.5624>o||o>1.78?r=e("FacebookVideoBadAspectError"):n.size>1024e6&&(r=e("FacebookVideoTooLargeError")),r?(t.showErrorLink=!1,t.errorText=r,t.showError=!0):(t.showPublishVideo=!0,t.publishBtnDisabled=!1),t.showUpsell=!1,t.isPolling=!1,t._updateBindings(),t._facebookProvider.setNetwork(t._network)},_fetchAlbums:function(){var e=this;this._facebookProvider.getAlbums().then(function(t){e._unfilteredAlbums=t,e._albums=[];for(var n=0;n<t.length;n++){var i=t[n];if(i.can_upload||"app"!=i.type){var r=document.createElement("option");r.text=d.format(i.name||"",i.count||0),r.value=i.id,e.subElements.albumSelector.options.add(r),e._albums.push(i)}}e.isAlbumSelectorDisabled=!1,e.showLoading=!1,e._updateBindings()},function(t){e.showChooseAlbum=!1,e.showLoading=!1,e._onFacebookFailure(t)})},_publishToAlbum:function(e,t){var n=Date.now(),i=this;i._facebookProvider.addEmbeddedAuthUrlsToItems(i.items).then(function(){wLive.Core.OperationManager.Current.execute("PublishToFacebook",{items:i.items,albumId:e,facebookProvider:i._facebookProvider})},bind(i,i._onFacebookFailure)),i.showMessage=!0,i.showChooseAlbum=!1,i.headerText=l,i.showPublishButton=!1,i.showError=!1,t&&(i.facebookUrl=t,i.publishingHtml=g.format(h.format(t))),i._updateBindings(),Qos.logData(m,"SkyDrive",n,null,null,null,Date.now())},_onFacebookFailure:function(){this.showError=!0,this._updateBindings()},_onGetNetworksFailure:function(){this.showError=!0,this._updateBindings()}}),defineSubClass("wLive.Controls.FacebookPane",SkyDrive.UI.NewControlAdapter,function(){},{controlType:SkyDrive.UI.FacebookPane})}()}),define("facebookpane.html",["facebookpane"],function(){SkyDrive.UI.FacebookPane.prototype.onRenderHtml=function(){return"<"+this.baseTag+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><h2 id="'+htmlAttributeEncode(this.id+"_1")+'" class="sd_header">'+htmlEncode(this.headerText)+'</h2><div id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+generateStyleAttribute("display",this.showChooseAlbum)+'" class="sd_content"><h3 id="'+htmlAttributeEncode(this.id+"_3")+'" class="sd_subheader">'+this.chooseAlbumHtml+'</h3><div id="'+htmlAttributeEncode(this.id+"_4")+'" class="albumName sd_link_desc">'+htmlEncode(this.albumNameText)+'</div><select id="'+htmlAttributeEncode(this.id+"_5")+'" style="'+generateStyleAttribute("display.inlineblock",this.showAlbumSelector)+'" class="albumSelector"'+generateAttributesString("disabled",this.isAlbumSelectorDisabled)+'><option selected="true" disabled="true" id="'+htmlAttributeEncode(this.id+"_6")+'">'+htmlEncode(this.albumNamePlaceholderText)+'</option><option value="create" id="'+htmlAttributeEncode(this.id+"_7")+'">'+htmlEncode(this.createNewAlbumText)+'</option></select><div id="'+htmlAttributeEncode(this.id+"_8")+'" style="'+generateStyleAttribute("display",this.showNewAlbumOptions)+'"><input type="text" id="'+htmlAttributeEncode(this.id+"_9")+'" class="albumNameField"></input><textarea id="'+htmlAttributeEncode(this.id+"_10")+'" class="albumNote"></textarea><div id="'+htmlAttributeEncode(this.id+"_11")+'" class="sd_link_desc">'+htmlEncode(this.shareWithText)+'</div><select id="'+htmlAttributeEncode(this.id+"_12")+'" class="privacySelector"><option value="" id="'+htmlAttributeEncode(this.id+"_13")+'">'+htmlEncode(this.customOptionText)+'</option><option value="EVERYONE" id="'+htmlAttributeEncode(this.id+"_14")+'">'+htmlEncode(this.everyoneOptionText)+'</option><option value="ALL_FRIENDS" id="'+htmlAttributeEncode(this.id+"_15")+'">'+htmlEncode(this.allFriendsOptionText)+'</option><option value="SELF" id="'+htmlAttributeEncode(this.id+"_16")+'">'+htmlEncode(this.selfOptionText)+'</option></select></div></div><div id="'+htmlAttributeEncode(this.id+"_17")+'" style="'+generateStyleAttribute("display",this.showPublishVideo)+'" class="sd_content"><h3 id="'+htmlAttributeEncode(this.id+"_18")+'" class="sd_subheader">'+this.publishVideoHtml+'</h3><textarea id="'+htmlAttributeEncode(this.id+"_19")+'" class="videoNote"></textarea></div><div id="'+htmlAttributeEncode(this.id+"_20")+'" style="'+generateStyleAttribute("display",this.showMessage)+'"><h3 id="'+htmlAttributeEncode(this.id+"_21")+'" class="sd_subheader">'+this.publishingHtml+'</h3></div><div id="'+htmlAttributeEncode(this.id+"_22")+'" style="'+generateStyleAttribute("display",this.showUpsell)+'"><a href="#" id="'+htmlAttributeEncode(this.id+"_23")+'">'+htmlEncode(this.upsellText)+'</a></div><div id="'+htmlAttributeEncode(this.id+"_24")+'" style="'+generateStyleAttribute("display.inlineblock",this.showLoading)+'" class="sd_loading">'+this.loadingHtml+'</div><div id="'+htmlAttributeEncode(this.id+"_25")+'" style="'+generateStyleAttribute("display.inlineblock",this.showError)+'" class="sd_error'+generateClassAttribute("topError",this.isPublishVideoFlow)+'"><span id="'+htmlAttributeEncode(this.id+"_26")+'">'+htmlEncode(this.errorText)+'</span><a href="#" id="'+htmlAttributeEncode(this.id+"_27")+'" style="'+generateStyleAttribute("display.inlineblock",this.showErrorLink)+'">'+htmlEncode(this.errorLinkText)+'</a></div><div class="sd_btns"><input type="button" id="'+htmlAttributeEncode(this.id+"_28")+'" style="'+generateStyleAttribute("display.inlineblock",this.showPublishButton)+'" class="default"'+generateAttributesString("value",this.publishBtnText,"disabled",this.publishBtnDisabled)+'></input><input type="button" id="'+htmlAttributeEncode(this.id+"_29")+'" class="sd_cancel"'+generateAttributesString("value",this.cancelBtnText)+"></input></div></"+this.baseTag+">"},processAnnotations(SkyDrive.UI.FacebookPane,[{id:0},{id:1,attr:["text","headerText"]},{id:2,css:["display","showChooseAlbum"]},{id:3,attr:["html","chooseAlbumHtml"]},{id:4,attr:["text","albumNameText"]},{id:5,css:["display.inlineBlock","showAlbumSelector"],attr:["disabled","isAlbumSelectorDisabled"],childId:"albumSelector",userActions:{change:"_onSelectedAlbumChange"}},{id:6,attr:["text","albumNamePlaceholderText"]},{id:7,attr:["text","createNewAlbumText"]},{id:8,css:["display","showNewAlbumOptions"]},{id:9,childId:"albumNameField",userActions:{change:"_onAlbumNameChange",keydown:"_onAlbumNameChange"}},{id:10,childId:"albumNote"},{id:11,attr:["text","shareWithText"]},{id:12,childId:"privacySelector"},{id:13,attr:["text","customOptionText"]},{id:14,attr:["text","everyoneOptionText"]},{id:15,attr:["text","allFriendsOptionText"]},{id:16,attr:["text","selfOptionText"]},{id:17,css:["display","showPublishVideo"]},{id:18,attr:["html","publishVideoHtml"]},{id:19,childId:"videoNote"},{id:20,css:["display","showMessage"]},{id:21,attr:["html","publishingHtml"]},{id:22,css:["display","showUpsell"]},{id:23,attr:["text","upsellText"],childId:"upsellLink",userActions:{click:"_onUpsellLinkClick"}},{id:24,css:["display.inlineBlock","showLoading"],attr:["html","loadingHtml"],childId:"loading"},{id:25,css:["display.inlineBlock","showError"],className:["topError","isPublishVideoFlow"]},{id:26,attr:["text","errorText"]},{id:27,css:["display.inlineBlock","showErrorLink"],attr:["text","errorLinkText"],childId:"errUpsellLink",userActions:{click:"_onErrorLinkClick"}},{id:28,css:["display.inlineBlock","showPublishButton"],attr:["value","publishBtnText","disabled","publishBtnDisabled"],childId:"publishBtn",userActions:{click:"_onPublishClick"}},{id:29,attr:["value","cancelBtnText"]}],[],{})}),define("linkpane",["facebookpane.html"],function(){!function(){function e(e,w,b,C,S,k,I){function x(e){if(!Y){for(var t=0;t<e.length;t++){var n=e[t];n&&n.id&&at.push(n.id)}for(st=!0,t=0;t<et.length;t++)et[t]()}}function T(e){st?e():et.push(e)}function L(e){void 0!==e&&null!==e&&Q.val(e),I.hideLoading(),K&&F(a.View,K),J&&F(a.Edit,J),X&&F(s,X),B(),"function"==typeof I.updateLayout&&I.updateLayout()}function P(){it[a.View]=D(i("Sharing.ViewLinkTitle"),"$Sutra.SkyDrive.ViewLink"),ot[a.View]=A(a.View,i("Sharing.ViewLinkTitle"),"$Sutra.SkyDrive.LinkSectionNewLinkOptionView"),rt[a.View]=$(a.View,i("Sharing.ViewLinkDescription"),"$Sutra.SkyDrive.LinkSectionNewLinkDescriptionView"),it[a.Edit]=D(i("Sharing.EditLinkTitle"),"$Sutra.SkyDrive.EditLink"),ot[a.Edit]=A(a.Edit,i("Sharing.EditLinkTitle"),"$Sutra.SkyDrive.LinkSectionNewLinkOptionEdit"),rt[a.Edit]=$(a.Edit,i("Sharing.EditLinkDescription"),"$Sutra.SkyDrive.LinkSectionNewLinkDescriptionEdit"),it[s]=D(i("Sharing.PublicViewLinkTitle"),"$Sutra.SkyDrive.PublicLink"),ot[s]=A(s,i("Sharing.PublicViewLinkTitle"),"$Sutra.SkyDrive.LinkSectionNewLinkOptionPublic"),rt[s]=$(s,i("Sharing.PublicViewLinkDescription"),"$Sutra.SkyDrive.LinkSectionNewLinkDescriptionPublic")}function D(e,t){var n=jQuery('<div class="sd_link_container"></div>'),i=jQuery('<div class="sd_link_title"></div>').text(e);return n.append(i),n.hide(),sutra(n,t),sutra(i,"$Sutra.SkyDrive.LinkSectionTitle"),U.append(n),n}function E(){j=jQuery(_),W=jQuery("#sd_new_link_toggle",j),V=jQuery("#sd_new_link_select",j),Q=jQuery("select",j),q=jQuery(".sd_link_type_descriptions",j),G=jQuery(".sd_new_link_loading",j),z=jQuery("input.sd_link_choose",j);var t=jQuery("a",W),n=new JBase.UI.ImageTile,r=jQuery("#sd_new_link_toggle_text",t),o=jQuery("#sd_new_link_toggle_icon",t);jQuery("label",V).text(i("Sharing.CreateLinkSelectLabel")),n.setDataContext(u),o.html(n.renderHtml()),r.text(i("Sharing.CreateAdditionalLink")),t.click(function(e){e.preventDefault(),W.hide(),V.show(),Q.focus()}),z.val(i("Sharing.CreateLink")),z.click(function(e){e.preventDefault(),z.attr("disabled","disabled"),O(parseInt(Q.val(),10))}),Q.change(function(){jQuery(".sd_option_description",q).hide(),jQuery("#sd_option_description"+Q.val()).show()}),j.hide(),e.append(j),n.activate(),sutra(q,"$Sutra.SkyDrive.LinkSectionDescriptions"),sutra(z,"$Sutra.SkyDrive.LinkCreateLinkButton"),sutra(Q,"$Sutra.SkyDrive.LinkSectionNewLinkSelect"),sutra(t,"$Sutra.SkyDrive.LinkSectionNewLinkToggle")}function $(e,t,n){var i=jQuery("<div />");return i.attr("id","sd_option_description"+e),i.addClass("sd_option_description"),i.text(t),sutra(i,n),q.append(i),i}function A(e,t,n){var i=jQuery("<option />");return i.text(t),i.val(e),sutra(i,n),Q.append(i),i}function F(e,t){if(t){rt[e].remove(),ot[e].remove();var n;if(t.link)n=t.link;else{var i="";!C||k&&k!=C.id||!C.photo&&!C.video||(i="&v="+r.ViewType.Self),n=FilesConfig.sharingBaseUrl+"?resid="+(k||C.id)+i}var o=new SkyDrive.UI.SharingLink;o.setDataContext({shortenEnabled:FilesConfig.urlShorteningEnabled,url:n,isReadOnly:!h,shortenAction:R,entity:t}),lt.push(o);var a=function(){o.setDataContext({networks:at})};T(a);var s=it[e],l=ce("div");if(s[0].appendChild(l),setHtml(l,o.renderHtml()),s.append(l),s.show(),o.activate(),ct){var c={itemCount:I.getItemCount(),type:e};Qos.logData(m,y,tt,null,null,c,Date.now()),ct=!1}}}function N(e,n){if(!Y){for(var i=n.permissionScopes,r=0;r<i.length;r++){var a=i[r],s=t.StringHelpers.caseInsensitiveStringEquals(a.id,e.id);if(s)for(var l=a.entities,c=0;c<l.length;c++){var u=l[c];u.type==o.EntityType.Link?u.linkType==o.LinkType.View?K=u:u.linkType==o.LinkType.Edit&&(J=u):u.type==o.EntityType.Public&&(X=u)}}L(f[n.defaultPermissionsLevel])}}function M(){if(!Y){I.hideLoading();var t=jQuery("<div></div>");e.append(t);var n=new wLive.Controls.InlineError(t,i("Sharing.GetPermissionsError"));n.render()}}function B(){var e=0;K&&e++,J&&e++,X&&e++,0===e?(W.hide(),V.show(),Q.focus()):3>e?(W.show(),V.hide()):(W.hide(),V.hide()),j.show(),Q.change()}function R(e,n,i){var r=Date.now(),a={id:k||C.id};e.type==c.Public?a.type=o.EntityType.Public:e.role==l.View?(a.type=o.EntityType.Link,a.linkType=o.LinkType.View):e.role==l.Edit?(a.type=o.EntityType.Link,a.linkType=o.LinkType.Edit):(a.type=o.EntityType.Link,a.linkType=e.linkType),a.cid=C.ownerCid,t.SkyDriveItemHelper.isGroupItem(C)&&(a.group=C.group);var s=FilesConfig.baseApiUrl+"Shorten?"+$Utility.serialize(a),u=new t.DataRequest(s,s,null,function(e){var t=e.url;i(t),n.select();var o={type:a.type,linkType:a.linkType};Qos.logData(v,y,r,null,null,o,Date.now())},function(e){e.error.code==p&&I.renderPermissionsList(C,S,{skipCache:!0}),H(e.error.message)});u.apiId="SkyDrive_Json_ShortenUrl",u.propertyId="SkyDrive",u.start()}function H(e){if(Z.empty(),e){var t=new n.InlineError(Z,e);t.render(),Z.show()}else Z.hide()}function O(e){function r(e,t,n,i){n==s?w.makePublic(e,t,i,o,l):w.createLink(e,t,n,i,o,l)}function o(t,n){Y||(C=C||t,G.empty(),z.removeAttr("disabled"),e===a.View?K=n:e===a.Edit?J=n:e===s&&(void 0!==k&&null!==k||void 0!==C&&null!==C||(k=t.id),X=n),F(e,n),B(),I.updateUIWithNewPermission(t,n))}function l(e,t){if(!Y){G.empty(),z.removeAttr("disabled");var n;switch(t.code){case g:n=i("Sharing.SharingBlockedLinkGenerationError");break;default:n=t.message?t.message:i("Sharing.LinkGenerationError")}H(n)}}tt=Date.now(),ct=!0;var c=new n.LoadingSpinner(G,"");if(c.render(),sutra(c,"$Sutra.SkyDrive.LoadingSpinner"),H(null),C)r(C,null,e,null);else{var u={bundleName:I.getBundleName()};t.ViewContext.getInstance().selectionManager.getSelectedItems(function(t){r(null,t,e,u)})}}var U,j,W,Q,V,q,G,z,K,J,X,Y,Z,et,tt,nt=this,it={},rt={},ot={},at=[],st=!1,lt=[],ct=!1;nt.render=function(){var t;if(S)t=i("Sharing.GetLinkHeaderFormatNoQuotations").format(S.selectionCount);else if(C&&C.photo)t=i("Sharing.GetLinkHeaderSingularPhoto");else{var n=C&&C.extension;t=i("Sharing.GetLinkHeaderFormat").format(I.getName()+(n?n:""))}sutra(e,"$Sutra.SkyDrive.ShareDialogLinkPane");var r=jQuery('<h2 class="sd_header"></h2>').text(t);e.append(r);var o=jQuery('<h3 class="sd_subheader"></h3>').text(i("Sharing.GetLinkSubtitle"));e.append(o),U=jQuery('<div class="sd_link_sections"></div>'),sutra(U,"$Sutra.SkyDrive.LinkSections"),e.append(U),C&&!w.hasCachedData(C)&&I.showLoading(),E(),P(),$buffer=jQuery('<div class="sd_buffer_bottom"></div>'),e.append($buffer),Z=jQuery('<div class="sd_error"></div>'),e.append(Z);var a=jQuery('<div class="sd_btns"></div>');e.append(a);var s=jQuery('<input class="sd_cancel" type="button" />');s.val(i("Sharing.Close")),a.append(s),sutra(s,"$Sutra.SkyDrive.LinkPaneCancel"),et=[],C?w.fetchPermissions(C,N,M):S&&L(f[d]),b.fetchNetworks(x)},nt.dispose=function(){Y=!0;for(var e=0;e<lt.length;e++)lt[e].dispose()}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString,r=t.JSONConstants,o=t.PermissionsProvider,a=o.Role,s=(t.ImageStrip,0),l=o.Role,c=(o.GroupRole,o.EntityType),u=(o.LinkType,JBase.UI.ImageStripHelper.getImageInfo("add")),d="view",f={"public":s,view:a.View,edit:a.Edit},h=(i("Sharing.EmbedInstructions"),i("Sharing.Saving"),$B.SF_iPhone&&!$B.Mobile),p=3e3,g=9006,m="SkyDriveWeb_Internal_Control_LinkPane_CreateLink",v="SkyDriveWeb_Internal_Control_LinkPane_ShortenLink",y="SkyDrive",_='<div class="sd_new_link"><div id="sd_new_link_toggle"><a href="#" role="button"><div id="sd_new_link_toggle_icon"></div><div id="sd_new_link_toggle_text"></div></a></div><form id="sd_new_link_select"><label for="sd_link_type"></label><select class="sd_link_type" id="sd_link_type" aria-controls="sd_link_type_descriptions"></select><div class="sd_link_type_descriptions" id="sd_link_type_descriptions" aria-live="polite"></div><div class="sd_link_choose_wrapper"><div class="sd_link_choose_button"><input class="sd_link_choose sd_focusable default" type="button" /></div><div class="sd_new_link_loading"></div><div class="c_clr"></div></div></form></div>';n.LinkPane=e,window.wLive.Core.ShortenResponse=function(){},window.wLive.Core.ShortenResponse.prototype={url:""}}()}),define("networkpane",["linkpane"],function(){!function(){function e(e,f,h,p,g,m){function v(){var e=[];for(var n in Q)e.push(Q[n]);m.showLoading(i("Sharing.PostingFormat").format(m.getName())),m.disableMenuTabs();var r=N.prop("checked")?t.PermissionsProvider.Role.Edit:t.PermissionsProvider.Role.View,o=H.val();if(o=o==c?null:o,M.empty(),M.hide(),p)f.shareToNetworks(p,null,e,r,o,null,_,y);else{var a=t.PageController.getInstance().getViewContext();a.selectionManager.getSelectedItems(function(t){f.shareToNetworks(null,t,e,r,o,{bundleName:m.getBundleName()},_,y)})}}function y(e,t,a){if(!U){var s=t.message,l=!1;if(a){for(var c,u=0,f=0,h=0;h<a.length;h++){var p=a[h],g=p.entity;if(p.status&&p.status!=r){if(u++,p.errorCode&&p.errorCode==o)for(var v=0;v<$.length;v++){var y=$[v];if(y.id==g.linkName){var _=p.uniqueError;if(c=_.message,l=!0,y.status=d.Error,_&&_.data){var w=Object.fromJSON(_.data);y.connectLink=w.url}delete Q[g.linkName],W--;break}}}else f++,delete Q[g.linkName],W--}s=c?c:0==f?i("Sharing.PostErrorAllFailed"):i("Sharing.PostErrorSomeFailed").format(u)}T(),C();var b=new n.InlineError(M,s,l);b.render(),M.show(),m.hideLoading(),m.enableMenuTabs()}}function _(e,t){U||m.onShareSuccessCallback(e,t)}function w(e){if(!U){m.hideLoading(),$=h.getConnectedNetworks(e);var t,n=h.getUpsellNetworks(e);if(0==$.length){var r=i("Sharing.NoneConnectedUpsellFormat").format('<a class="c_ml" href="#" onclick="return false;">',"</a>"),o=jQuery('<span class="sd_net_upsell"></span>').html(r);sutra(o,"$Sutra.SkyDrive.NetworkPaneNoNetworksUpsell"),t=jQuery("a",o),A.append(o)}else{F=jQuery('<ul class="sd_post_netlist"></ul>'),sutra(F,"$Sutra.SkyDrive.NetworkIcons"),C(),A.append(F);var a=jQuery('<div class="sd_post_uplink"></div>');n.length>0?(t=jQuery('<a class="c_ml" href="#" onclick="return false;"></a>').text(i("Sharing.ConnectMenu")),t.append(jQuery('<span class="c_chev">&nbsp;&#9660;</span>'))):(t=jQuery('<a class="c_ml" target="_blank"></a>').text(i("Sharing.ManageMyServices")),t.attr("href",FilesConfig.manageServicesUrl),t.bind(u,b)),a.append(t),A.append(a),A.append('<div class="c_clr"></div>')}if(n.length>0){var s=L(n);A.append(s),sutra(t,"$Sutra.SkyDrive.NetworkPaneConnectMenuLink"),sutra(s,"$Sutra.SkyDrive.NetworkPaneConnectMenu");var l=0;t.click(function(e){l||$menu.create(e,1,{menuEl:s[0]}),l=1})}T(),H.focus(),"function"==typeof m.updateLayout&&m.updateLayout()}}function b(){h.clearCache(),m.close()}function C(){F.empty();for(var e=$.length,t=Math.min(a,e),n=0;t>n;n++){var i=$[n],r=S(i);F.append(r)}F.append('<div class="c_clr"></div>')}function S(e){var t=jQuery('<li class="sd_post_netop"></li>'),n=jQuery('<input type="checkbox" />'),r=jQuery("<label></label>"),o=jQuery("<img />");o.attr("alt",e.name),o.attr("src",e.iconSmall);var a="sd_net_box_"+e.id;if(e.status==d.Error){n.prop("disabled",!0);var s=i("Sharing.NetworkErrorTooltipFormat").format(e.name);o=jQuery('<a target="_blank" href="#" title="'+s.encodeHtmlAttribute()+'"></a>').append(o),o.bind(u,{msg:e.connectLink?e.connectLink:FilesConfig.manageServicesUrl},D)}else Q[e.id]&&n.prop("checked",!0);return n.attr("id",a),r.attr("for",a),r.append(o),t.append(n),t.append(r),sutra(n,"$Sutra.SkyDrive.NetworkIcon"+e.id),n.click(function(){n.prop("checked")?Q[e.id]||(Q[e.id]=e,W++):Q[e.id]&&(delete Q[e.id],W--),T(),k(),I(),x()}),t}function k(){var e=-1;for(var t in Q){var n=Q[t].postMax;(-1==e||e>n)&&(e=n)}V=e}function I(){q=0;for(var e in Q){var t=Q[e].shortLinkLimit;t&&t>q&&(q=t)}}function x(){var e=H.val().length+q;V>0?(e>V-l&&(O.show(),sutra(O,"$Sutra.SkyDrive.CharacterCounter")),e>V?(O.addClass("char_cnt_error"),B.prop("disabled",!0),sutra(O,"$Sutra.SkyDrive.CharacterCounterError")):(O.removeClass("char_cnt_error"),B.prop("disabled",!1),sutra(O,"$Sutra.SkyDrive.CharacterCounter")),O.text(i("Sharing.NetworkCharacterCounterFormat").format(e,V))):(unsutra(O),O.hide())}function T(){var e=0==W;B.prop("disabled",e)}function L(e){for(var t=Math.min(s,e.length),n=jQuery('<ul class="c_m t_hovl"></ul>'),r=0;t>r;r++){var o=e[r],a=jQuery('<li class="sd_post_upsell"></li>'),l=jQuery('<a href="#" target="_blank"></a>'),c=jQuery('<img class="sd_post_upicon" />');c.attr("alt",o.name),c.attr("src",o.iconSmall),l.bind(u,{msg:o.addLink},P),l.append(c),l.append(jQuery("<span></span>").text(o.name)),a.append(l),n.append(a)}var d=jQuery('<a target="_blank"></a>').text(i("Sharing.FindMoreServices")),f=jQuery('<a target="_blank"></a>').text(i("Sharing.ManageMyServices"));return d.attr("href",FilesConfig.findServicesUrl),d.bind(u,b),f.attr("href",FilesConfig.manageServicesUrl),f.bind(u,b),e.length>0&&n.append('<li class="c_ms"></li>'),n.append(jQuery("<li></li>").append(d)),n.append(jQuery("<li></li>").append(f)),n}function P(e){var t=e.data.msg+"&view=popup&brand=skydrive&scenarios=status_publish&biciid=skydrivepub&closenoredirect=true";return window.open(t,"addNetwork","width=720px,height=520px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",!0),b(),!1}function D(e){var t=e.data.msg;return window.open(t,"fixNetwork","width=450px,height=525px,status=no,toolbar=no,resizeable=yes,menubar=no,scrollbars=yes",!0),b(),!1}function E(t){if(!U){m.hideLoading(),e.empty();var i=new n.InlineError(e,t.message);i.render()}}var $,A,F,N,M,B,R,H,O,U,j=this,W=0,Q={},V=-1,q=23;j.render=function(t){var r;if(g)r=i("Sharing.NetworkPostHeaderFormatNoQuotations").format(g.selectionCount);else{var o=p&&p.extension;r=i("Sharing.NetworkPostHeaderFormat").format(m.getName()+(o?o:""))}sutra(e,"$Sutra.SkyDrive.ShareDialogNetworkPane");var a=jQuery('<h2 class="sd_header"></h2>').text(r);sutra(a,"$Sutra.SkyDrive.NetworkPaneHeader"),M=jQuery('<div class="sd_post_error"></div>'),M.hide(),A=jQuery('<div class="sd_net_line"></div>');var s=jQuery('<div class="sd_message_cntr"><textarea class="sd_post_message"></textarea><div class="sd_char_cntr"></div></div>');H=s.find(".sd_post_message"),O=s.find(".sd_char_cntr");var l=new n.PlaceholderInput(H,c);l.render(),sutra(H,"$Sutra.SkyDrive.NetworkPaneMessageInput"),H.bind("keyup",function(){x()}),t&&H.val(t);var u=jQuery('<div class="sd_post_can_edit"><input id="sd_post_can_edit" type="checkbox" /><label for="sd_post_can_edit"></label></div>');N=jQuery("input",u),jQuery("label",u).text(i("Sharing.RecipientsCanEdit")),sutra(N,"$Sutra.SkyDrive.NetworkPaneRecipientsCanEdit"),B=jQuery('<input class="sd_post_share default" type="button" />'),B.val(i("Sharing.Post")),B.click(v),sutra(B,"$Sutra.SkyDrive.NetworkPanePost"),R=jQuery('<input class="sd_cancel" type="button" />'),R.val(i("Sharing.Close"));var d=jQuery("<form></form>");d.append(A),d.append(s),d.append(u),d.append(M);var f=jQuery('<div class="sd_btns"></div>');d.append(f),f.append(B),f.append(R),sutra(R,"$Sutra.SkyDrive.NetworkPaneCancel"),e.append(a),e.append(d),m.showLoading(),h.fetchNetworks(w,E)},j.getUserMessage=function(){var e=H&&H.val();return e&&e!=c?e:""},j.dispose=function(){H.unbind("keyup"),U=!0}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString,r=0,o=3101,a=5,s=5,l=30,c=i("Sharing.PersonalMessagePlaceholder"),u="click",d=t.NetworksProvider.Status;n.NetworkPane=e}()}),define("permissionpane",["networkpane"],function(){!function(){function e(e,_,w,b,C,S,k,I,x,T,L,P){function D(e){var t=k.type==d.GroupOwned?u:c;tt=new Shared.UI.Menu;var n=[],o="";k.role==t.Edit?(o=i("Sharing.CanEdit"),n.push(new Shared.UI.NavItemDataContext({text:i("Sharing.ChangeToView"),isSelected:!1,click:function(){return tt.hide(),M(t.View),!1
}}))):it&&k.role==c.CoOwner?o=r("GF.Sharing.CoOwner"):(o=i("Sharing.CanView"),n.push(new Shared.UI.NavItemDataContext({text:i("Sharing.ChangeToEdit"),isSelected:!1,click:function(){return tt.hide(),M(t.Edit),!1}}))),n.push(new Shared.UI.NavItemDataContext({text:i("Sharing.StopSharing"),isSelected:!1,click:function(){return tt.hide(),H(),!1}}));var a=new Shared.UI.NavItemDataContext({text:o,childItems:n});tt.setDataContext(a),e.html(tt.renderHtml()),tt.activate()}function E(){if(!Y){var n=T||P.getName(),a=jQuery(".sd_header",e);a.text(n);var s=jQuery(".sd_header_sec",e),h=jQuery(".sd_subheader",e),p=jQuery(".sd_entity_name",e),g=jQuery(".sd_email",e),m=jQuery(".sd_perm_perms",e),_=jQuery(".sd_perm_menu",e);G=jQuery(".sd_perm_remove",e),Z=jQuery(".sd_ic",e);var w=jQuery(".sd_link_title",e),x="";if(w.hide(),h.hide(),g.hide(),p.hide(),s.hide(),k){var E=k.type==d.Public||k.type==d.Link&&!(k.linkType==f.Network),N=E?s:p,B=k.name;B?N.text(B):b.group&&N.text(i("Sharing.GroupMembersHeader"));var R=k.email;if(R&&B!=R&&(g.text(R.toLowerCase()),g.show()),N.show(),k.type==d.Facebook&&(h.text(i("Sharing.FacebookFriendSubheader")),h.show()),K=jQuery(".sd_perm_error",e),et=jQuery(".sd_perm_edit_spinner",e),et.hide(),o.renderTileForEntity(k,Z,80,A,o.icSize.XLarge,!1),J=jQuery("#sd_perm_perms",m),it&&k.role==c.CoOwner?(jQuery("label",m).text(r("GF.Sharing.CoOwner")),J.attr("checked",!0),J.attr("disabled",!0)):jQuery("label",m).text(i("Sharing.CanEdit")),k.type==d.GroupOwned&&k.role==u.Edit||k.type!=d.GroupOwned&&k.role==c.Edit?(J.attr("checked",!0),x=i("Sharing.CanEdit")):x=k.role==c.CoOwner?r("GF.Sharing.CoOwner"):k.role==c.Owner?i("Sharing.Owner"):i("Sharing.CanView"),I&&k.role!=c.Owner&&!E){D(_),G.hide(),m.hide();var O=new wLive.Controls.LoadingSpinner(et,y);O.render()}else if(I&&k.role!=c.Owner&&E){G.val(i("Sharing.RemoveLink")),G.click(H),J.change(M);var U=new wLive.Controls.LoadingSpinner(et,y);U.render()}else G.hide(),m.hide(),_.text(x);if(b.group&&G.hide(),(E||k.role==c.Owner)&&m.hide(),$()&&(L.canChange===!1?h.text(i("Sharing.NoAccess")):j(h,E?i("Sharing.PermissionsPaneRedirect"):i("Sharing.PermissionsPaneRedirectForPerson")),h.show()),E){Z.hide(),X=jQuery(".sd_perm_link",e),w.show().text(F());var Q=S.actionManager.getAction("Share",b);if(k.linkType==f.Embed){var V=S.actionManager.getAction("Embed",b);if(V){var q=t.ActionManager.setATagAction(V,null,"ShareDialog",function(e,t){return P.close(),t()});q.text(v),sutra(q,"$Sutra.SkyDrive.EmbedCommand"),X.append(q)}else X.text(i("Sharing.EmbedVisitor"))}else $()?(N.hide(),_.text(""),W(k,X,!1,null)):Q&&W(k,X,!0,null)}}else{var tt=FilesConfig.hcid,nt=!b||tt==b.ownerCid||l.isOwnerOrCoOwner(b)||S.isSuper;if(nt){var rt=C||b&&b.isBundle?i("Sharing.MultipleFilesPrivate"):b.folder?i("Sharing.PrivateFolder"):i("Sharing.PrivateFile");s.text(rt)}Z.hide(),m.hide(),G.hide()}z=jQuery(".sd_done",e),z.val(i("Sharing.Close")),z.click(P.close),sutra(a,"$Sutra.SkyDrive.PermissionPaneHeader"),sutra(G,"$Sutra.SkyDrive.PermissionPaneRemove"),sutra(m,"$Sutra.SkyDrive.PermissionPaneRecipientsCanEdit"),sutra(z,"$Sutra.SkyDrive.PermissionPaneDone"),P.hideLoading(),"function"==typeof P.updateLayout&&P.updateLayout()}}function $(){return!t.StringHelpers.caseInsensitiveStringEquals(b.id,x)}function A(e,t){t?(Z.html(t.render()),t.activate()):o.loadDefaultIc(k,h,Z)}function F(){var e="";switch(k.type){case d.Email:case d.User:e=k.role==c.Owner?i("Sharing.Owner"):i("Sharing.SharedByEmail");break;case d.Link:if(k.linkType==f.View)e=i("Sharing.ViewLinkTitle");else if(k.linkType==f.Edit)e=i("Sharing.EditLinkTitle");else if(k.linkType==f.Network&&k.linkName){var t=P.getNetworkName(k.linkName);t&&(e=i("Sharing.SharedToNetwork").format(t))}break;case d.Public:e=i("Sharing.PublicViewLinkTitle");break;case d.Group:e=i("Sharing.SharedToGroup");break;case d.Friends:e=i("Sharing.SharedToFriends");break;case d.GroupOwned:default:e=""}return e}function N(e){if(K.empty(),e){var t=new n.InlineError(K,e);t.render(),K.show()}else K.hide()}function M(e){return N(),P.disableMenuTabs(),et.show(),k.role=e,K.empty(),K.hide(),_.updatePermissions(b,null,k,{suppressNotification:!0},t.PermissionsProvider.UserAction.Manage,B,R),!1}function B(){P.enableMenuTabs(),P.renderPermissionsList(b,C),P.selectPermission(k&&k.id)}function R(){et.hide(),k.role==c.Edit?(k.role=c.View,J.attr("checked",!1)):(k.role=c.Edit,J.attr("checked",!0)),P.enableMenuTabs(),N(i("Sharing.EditPermissionsFailure"))}function H(){N(),P.disableMenuTabs(),K.empty(),K.hide(),_.deletePermission(b,k,O,U)}function O(){P.enableMenuTabs(),P.renderPermissionsList(b,C),P.selectPermission(k.id)}function U(){P.enableMenuTabs(),N(i("Sharing.EditPermissionsFailure"))}function j(e,t){var n=function(){P&&P.close()},i=o.buildScopeLinkHeader(S,L,b,t,"","",n);e.html(i)}function W(e,t,i,r){if(r){var o=new n.InlineError(t,r);o.render()}var s;if(e.link)s=e.link;else{var l="";x&&x!=b.id||!b.photo&&!b.video||(l="&v="+a.ViewType.Self),s=FilesConfig.sharingBaseUrl+"?resid="+(x||b.id)+l}var c=jQuery(".sd_perm_link_url",t),u={url:s,disabled:!i,shortenEnabled:FilesConfig.urlShorteningEnabled&&i,shortenAction:Q,entity:e,isReadOnly:!p};nt=new SkyDrive.UI.SharingLink,nt.setDataContext(u);var d=function(){nt.setDataContext({networks:rt})};q(d),setHtml(c.get(0),nt.renderHtml()),nt.activate(),i&&nt.select()}function Q(e,n,i){var r={id:x||b.id};e.type==d.Public?r.type=s.EntityType.Public:e.role==c.View?(r.type=s.EntityType.Link,r.linkType=s.LinkType.View):e.role==c.Edit?(r.type=s.EntityType.Link,r.linkType=s.LinkType.Edit):(r.type=s.EntityType.Link,r.linkType=e.linkType),r.cid=b.ownerCid,t.SkyDriveItemHelper.isGroupItem(b)&&(r.group=b.group);var o=FilesConfig.baseApiUrl+"Shorten?"+$Utility.serialize(r),a=new t.DataRequest(o,o,null,function(e){var t=e.url;i(t),n.select()},function(e){e.error.code==g&&P.renderPermissionsList(b,C,{skipCache:!0}),N(e.error.message)});a.apiId="SkyDrive_Json_ShortenUrl",a.propertyId="SkyDrive",a.start()}function V(e){if(!Y){for(var t=0;t<e.length;t++){var n=e[t];n&&n.id&&rt.push(n.id)}for(ot=!0,t=0;t<at.length;t++)at[t]()}}function q(e){ot?e():at.push(e)}var G,z,K,J,X,Y,Z,et,tt,nt,it=FilesConfig.isUserInGfRamp&&b&&b.folder,rt=[],ot=!1,at=[],st=this;st.render=function(){sutra(e,"$Sutra.SkyDrive.ShareDialogPermissionPane"),e.html(m),E(),w.fetchNetworks(V)},st.dispose=function(){Y=!0,nt&&nt.dispose()}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString,r=t.AleHelpers.getSkyString,o=t.SharingHelper,a=t.JSONConstants,s=t.PermissionsProvider,l=t.SkyDriveItemHelper,c=s.Role,u=s.GroupRole,d=s.EntityType,f=s.LinkType,h="SharingDialogPermissionTemplate",p=$B.SF_iPhone&&!$B.Mobile,g=3e3,m='<h2 class="sd_header perm_header"></h2><div class="sd_header_sec"></div><div class="sd_subheader"></div><div class="sd_permission_redirect"></div><div class="sd_ic"></div><div class="sd_display_info"><div class="sd_entity_name"></div><div class="sd_email"></div><div class="sd_perm_menu"></div></div><form class="sd_permission_pane"><div class="sd_perm_perms"><input id="sd_perm_perms" type="checkbox" /><label for="sd_perm_perms"></label></div><div class="sd_perm_edit_spinner"></div><div class="sd_link_title"></div><div class="sd_perm_link"><span class="sd_perm_link_url"></span><span class="sd_perm_link_shorten"></span></div><div class="sd_perm_error"></div><div class="sd_btns"><input class="sd_perm_remove" type="button" /><input class="sd_done default" type="button" /></div></form>',v=i("Sharing.EmbedInstructions"),y=i("Sharing.Saving");n.PermissionPane=e}()}),define("bundleremovalpane",["permissionpane"],function(){!function(){var e=wLive.Core.AleHelpers.getPCString("Sharing.RemoveItemFromBundle"),t=wLive.Core.AleHelpers.getPCString("Sharing.RemoveItemFromBundleAction"),n=wLive.Core.AleHelpers.getPCString("Sharing.RemoveItemFromBundleNavigateToFolder"),i=wLive.Core.AleHelpers.getPCString("Sharing.RemoveItemFromBundleNavigateToFolderAction"),r=wLive.Core.AleHelpers.getString("LoadGenericError"),o=wLive.Core.AleHelpers.getPCString("Sharing.Close");defineSubClass("SkyDrive.UI.BundleRemovalPane",JBase.UI.BaseControl,function(){},{removeCopy:"",removeLinkText:t,showRemoveLink:!1,navigateCopy:"",navigateLinkText:i,navigateAction:null,navigateHref:"",showNavigateLink:!1,errorText:r,showError:!1,closeButtonText:o,title:"",scopeName:null,permissionsProvider:null,scope:null,sharingDialog:null,viewContext:null,onDataContextChanged:function(t){t.container&&(this.myContainer=t.container),t.item&&(this.item=t.item),t.scopeName&&(this.scopeName=t.scopeName),t.permissionsProvider&&(this.permissionsProvider=t.permissionsProvider),t.scope&&(this.scope=t.scope,this.removeCopy=e.format(this.scope.name),this.navigateCopy=n.format(this.scope.name)),t.sharingDialog&&(this.sharingDialog=t.sharingDialog),t.viewContext&&(this.viewContext=t.viewContext),this.title=this.calculateTitle(),this.calculateRemoveVsNavigate()},onClick:function(){return this.removeItem(),!1},onNavigateClick:function(){var e=function(){this.sharingDialog&&this.sharingDialog.close()};wLive.Core.SharingHelper.buildScopeLinkHeaderCallback(this.viewContext,this.scope,this.item,bind(this,e),!0)()},close:function(){},onActivate:function(){},calculateTitle:function(){var e="";return e=this.item&&this.item.name?this.item.extension?this.item.name+this.item.extension:this.item.name:this.scopeName},calculateRemoveVsNavigate:function(){this.item&&this.scope&&(this.showRemoveLink=this.item.id==this.scope.refId,this.showNavigateLink=!this.showRemoveLink,this.showNavigateLink&&(this.navigateHref=wLive.Core.SharingHelper.buildScopeLinkHeaderHref(this.viewContext,this.scope,this.item,!0)))},removeItem:function(){this.sharingDialog&&this.sharingDialog.disableMenuTabs(),this.showError=!1,this._updateBindings(),this.permissionsProvider.updateBundle(this.scope,[this.item],wLive.Core.PermissionsProvider.BundleAction.Remove,bind(this,this.removeItemSuccess),bind(this,this.removeItemFailure))},removeItemSuccess:function(){this.sharingDialog&&this.sharingDialog.enableMenuTabs(),this.sharingDialog.renderPermissionsList(this.item,null,{skipCache:!0}),this.sharingDialog.selectPermission("0")},removeItemFailure:function(){this.sharingDialog&&this.sharingDialog.enableMenuTabs(),this.showError=!0,this._updateBindings()}})}()}),define("bundleremovalpane.html",["bundleremovalpane"],function(){SkyDrive.UI.BundleRemovalPane.prototype.onRenderHtml=function(){return"<"+this.baseTag+sutraAttribute("SkyDrive.ShareDialogBundleRemovalPane")+' id="'+htmlAttributeEncode(this.id+"_0")+'"'+(this.baseStyle?' style="'+this.baseStyle+'"':"")+' class="c-'+this.controlName+" "+this.baseClass+'"><h2 id="'+htmlAttributeEncode(this.id+"_1")+'" class="sd_header">'+htmlEncode(this.title)+'</h2><p><span id="'+htmlAttributeEncode(this.id+"_2")+'" style="'+generateStyleAttribute("display",this.showRemoveLink)+'"><span id="'+htmlAttributeEncode(this.id+"_3")+'">'+htmlEncode(this.removeCopy)+'</span>&nbsp;<a href="#"'+sutraAttribute("SkyDrive.BundleRemovalRemoveLink")+' id="'+htmlAttributeEncode(this.id+"_4")+'">'+htmlEncode(this.removeLinkText)+'</a>.</span><span id="'+htmlAttributeEncode(this.id+"_5")+'" style="'+generateStyleAttribute("display",this.showNavigateLink)+'"><span id="'+htmlAttributeEncode(this.id+"_6")+'">'+htmlEncode(this.navigateCopy)+"</span>&nbsp;<a"+sutraAttribute("SkyDrive.BundleRemovalNavigateLink")+' id="'+htmlAttributeEncode(this.id+"_7")+'"'+generateAttributesString("href",this.navigateHref)+">"+htmlEncode(this.navigateLinkText)+'</a>.</span></p><div id="'+htmlAttributeEncode(this.id+"_8")+'" style="'+generateStyleAttribute("display",this.showError)+'" class="sd_error">'+htmlEncode(this.errorText)+'</div><div class="sd_btns"><input type="button"'+sutraAttribute("SkyDrive.ShareDialogCloseButton")+' id="'+htmlAttributeEncode(this.id+"_9")+'" class="sd_cancel"'+generateAttributesString("value",this.closeButtonText)+"></input></div></"+this.baseTag+">"},processAnnotations(SkyDrive.UI.BundleRemovalPane,[{id:0},{id:1,attr:["text","title"]},{id:2,css:["display","showRemoveLink"],childId:"showRemoveLink"},{id:3,attr:["text","removeCopy"],childId:"removeCopy"},{id:4,attr:["text","removeLinkText"],childId:"bundleRemovalLink",userActions:{click:"onClick"}},{id:5,css:["display","showNavigateLink"],childId:"showNavigateLink"},{id:6,attr:["text","navigateCopy"],childId:"navigateCopy"},{id:7,attr:["text","navigateLinkText","href","navigateHref"],childId:"bundleNavigateLink",userActions:{click:"onNavigateClick"}},{id:8,css:["display","showError"],attr:["text","errorText"],childId:"removeError"},{id:9,attr:["value","closeButtonText"],childId:"closeButton",userActions:{click:"close"}}],[],{})}),define("sharedialog",["bundleremovalpane.html"],function(){!function(){function e(e,y,_,w,b,C,S,k){function I(e){_&&_.key===e.key&&(Z.renderPermissionsList(_,w,O),Z.selectPermission(F&&F.id))}function x(e){W.hasClass(at)||(L(e.data.controlsToSelect||e.data.selectedTab),F=e.data.entity,N=e.data.canChange,M=e.data.scope,B=e.data.scopeId,R=e.data.scopeName,Z.setVisiblePane(u.Permission))}function T(e,t){W.hasClass(at)||(L(e),Z.setVisiblePane(t))}function L(e){if(jQuery(".ips_entity",W).removeClass(st),z.removeClass(st),e){var t;if(e instanceof Array){if(0==e.length)return;for(var n=0;n<e.length;n++){var i=jQuery(e[n]).addClass(st);0==n&&(t=i)}}else t=jQuery(e).addClass(st);var r=t.position();if(r){var o=r.top,a=W.height(),s=W.scrollTop();o>a-c&&W.scrollTop(s+o-a+c)}}}function P(e){var n=e.which;return 27==n?(Z.close(),!1):t.DomHelpers.isInputElement(jQuery(e.target))||37!=n&&38!=n&&39!=n&&40!=n?void 0:!1}function D(e){return e.replace("!","")}function E(){if(!J){var e=jQuery("<span></span>");sutra(e,"$Sutra.SkyDrive.NetworkIcons");var t=rt._buildNetworkIcon("facebook");e.append(t.renderHtml()),G.append(e),t.activate()}}var $,A,F,N,M,B,R,H,O,U,j,W,Q,V,q,G,z,K,J,X,Y,Z=this,et=jQuery(b.dataModel),tt=S,nt=u.Email,it=new t.NetworksProvider,rt=new t.DirectNetworksProvider,ot=!1,at="sd_menu_disabled",st="sd_menu_selected";k=k||{},k.selectedEntity&&(nt=u.Permission,F=k.selectedEntity,N=k.selectedEntityCanChange,M=k.selectedEntityScope,B=k.selectedEntityScopeId,R=k.selectedEntityScopeName),Z.render=function(){if(!ot){var r=Date.now();ot=!0;var a=jQuery(d);sutra(a,"$Sutra.SkyDrive.ShareDialog"),W=jQuery(".sd_menu",a),sutra(W,"$Sutra.SkyDrive.ShareDialogMenu"),_$shareSubheader=jQuery(".sd_menu_subheader",W).text(i("Sharing.Share")),Q=jQuery(".sd_menu_sendemail",W).text(i("Sharing.SendMessage")).parent().click(function(){T(this,u.Email)}),V=jQuery(".sd_menu_getlink",W).text(i("Sharing.GetALink")).parent().click(function(){T(this,u.Link)}),q=jQuery(".sd_menu_postto",W).text(i("Sharing.PublishToLink")+" ").parent().parent().click(function(){T(this,u.Network)}),G=jQuery(".sd_menu_oh",q),z=jQuery(".sd_menu_tab",W),_$permissionsContainer=jQuery(".sd_menu_perms div",W),sutra(Q,"$Sutra.SkyDrive.ShareDialogMenuEmailPaneTab"),sutra(V,"$Sutra.SkyDrive.ShareDialogMenuLinkPaneTab"),sutra(q,"$Sutra.SkyDrive.ShareDialogMenuNetworkPaneTab"),j=jQuery(".sd_loading",a),U=jQuery(".sd_content",a),j.hide(),w&&b.selectionManager.getSelectedItems(function(e){Y=e});var s=!0,c=Y||[_];if(!_||!_.video||!FilesConfig.publishVideoEnabled)for(var h=0;h<c.length;h++)if(!c[h]||!c[h].photo||c[h].video){s=!1;break}Z._itemCount=c.length,s?q.show():q.hide();var p=null,g=_&&b.actionManager.getAction("Share",_)||w;g||(z.hide(),_$shareSubheader.hide(),nt=u.Permission,p=function(){Z.selectPermission("0")}),a.bind(o,P),e.append(a),Qos.logData(f,v,r,null,null,{itemCount:Z.getItemCount()},Date.now()),s&&E(),FilesConfig.managedAccount?(V.hide(),q.hide()):it.fetchNetworks(function(e){H=e},null,l),F&&B&&(p=function(){var e=jQuery('.ips_entity[entityId="'+F.id+'"][scopeId="'+D(B)+'"]',W);L(e)}),O={hc:!0,dt:!1,ct:Z},p&&(O.getPermissionsCallback=p),A=new wLive.Controls.SharingList(b,_$permissionsContainer,y,x,O),Z.renderPermissionsList(_,w,O),et.bind(t.DataModel.dataChangedEvent,I)}var m=function(e){$=e,"function"==typeof e.renderHtml&&"function"==typeof e.activate?(setHtml(U[0],e.renderHtml()),U.show(),e.activate()):e.render(nt==u.Network?Y||[_]:K)};if($&&$.dispose(),U.empty(),nt==u.Link)m(new n.LinkPane(U,y,it,_,w,B,Z,rt));else if(nt==u.Network)m(new n.FacebookPane(U,b,it,Z));else if(nt==u.Email)m(new n.EmailPane(U,y,it,_,w,Z));else{var C=w?Z.getName():R;if(null!=M&&null!=M.allowedActions&&Array.prototype.indexOf.call(M.allowedActions,wLive.Core.PermissionsProvider.AllowedActions.Remove)>=0){var S=new SkyDrive.UI.BundleRemovalPane;S.setDataContext({permissionScope:M,item:_,scopeName:C,scope:M,sharingDialog:Z,permissionsProvider:y,viewContext:b}),m(S)}else m(new n.PermissionPane(U,y,it,_,w,b,F,N,B,C,M,Z))}},Z.renderPermissionsList=function(e,t,n){n=n||{},n.quickRender=!0,A.render(e,t,n)},Z.selectPermission=function(e,t){var n;if(e&&(t=t||_.id,n=jQuery('.ips_entity[entityId="'+e+'"][scopeId="'+D(t)+'"]',W)),n&&n.length>0)n.trigger(a);else{var i=jQuery(".ips_entity",W);i.length>0?jQuery(i[0]).trigger(a):(F=null,T(null,u.Permission))}},Z.getNetworkName=function(e){var t;if(H)for(var n=0;n<H.length;n++){var i=H[n];if(i.id==e){t=i.name;break}}return t},Z.setVisiblePane=function(e){if(e!=nt||e==u.Permission){var t=$&&$.getUserMessage&&$.getUserMessage();K=void 0!==t?t:K,nt=e,Z.render()}},Z.updateLayout=function(){tt&&tt()},Z.close=function(){if(Qos.start(h),$.dispose(),et.unbind(t.DataModel.dataChangedEvent,I),C(),e.empty(),_&&_.isBundle&&!w&&_.sharingLevelValue==s){var n=b.itemProvider.peekParent(_),i=new Object;if(i.deletionType=2,i.rootPathName=3,i.skipDialog=!0,t.OperationManager.Current.execute("Delete",{items:[_],targetItem:n,options:i,hideFromProcessWindow:_.isBundle}),n&&!n.isPlaceholder){n.invalidate(),n.expire();var r=b.actionManager;r.doAction(r.getAction("ViewItem",n))}}J=!0,Qos.end()},Z.showLoading=function(e){Qos.start(p),j.empty();var t=new wLive.Controls.LoadingSpinner(j,e);t.render(),j.show(),U.hide(),Qos.end()},Z.hideLoading=function(){Qos.start(g),j.hide(),U.show(),Qos.end()},Z.enableMenuTabs=function(){W.removeClass(at)},Z.disableMenuTabs=function(){W.addClass(at)},Z.setItem=function(e){_=e},Z.getName=function(){return X||(X=_&&_.name||w&&i("Sharing.MessageShareHeaderItemCountFormat").format(w.selectionCount)),X},Z.setNewPermissionName=function(){w&&(X=i("Sharing.MessageShareHeaderItemCountFormat").format(w.selectionCount))},Z.getBundleName=function(){var e="";if(w){var t=w.parent,n="Items",o=i("Sharing.BundleNameShared"),a=new Date,s=a.getMonth()+1,l=i("Sharing.BundleNameDate").format(s,a.getDate(),a.getFullYear());if(Y){for(var c=!0,u=!0,d=0;d<Y.length;d++){var f=Y[d];if(f.photo&&!f.video)u=!1;else{if(!SkyDrive.FileTypeHelper.isOfficeDocument(f)){u=!1,c=!1;break}c=!1}}c?n="Photos":u&&(n="Documents")}!t||r.isRootItem(t)||t.isSpecialFolder||(o=i("Sharing.BundleNameFolderName").format(t.name,"{0}","{1}")),e=o.format(i("Sharing.BundleNameType"+n),l)}return e},Z.updateUIWithNewPermission=function(e,t,n){if(Z.hideLoading(),n){var i=n.shareStartDate;delete n.shareStartDate,Qos.logData(m,v,i,null,null,n,Date.now())}Z.enableMenuTabs(),_&&_.sharingLevelValue==s&&(_.sharingLevelValue=0),(!_||e)&&Z.setItem(e),Z.renderPermissionsList(e,w)},Z.onShareSuccessCallback=function(e,t,n){Z.setNewPermissionName(),Z.updateUIWithNewPermission(e,t,n),Z.selectPermission(t&&t.id)},Z.getItemCount=function(){return Z._itemCount}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString,r=t.SkyDriveItemHelper,o="keydown",a="click",s=4,l=3e3,c=50,u={Email:1,Network:2,Link:3,Permission:4,BundleRemoval:5};e.Panes=u;var d='<div class="sd_pop_body"><ul class="sd_menu" role="menu"><div class="sd_menu_subheader"></div><li class="sd_menu_tab sd_menu_selected"><a href="#" role="menuitem" class="sd_menu_sendemail" onclick="return false"></a></li><li class="sd_menu_tab"><a href="#" role="menuitem" class="sd_menu_getlink" onclick="return false"></a></li><li class="sd_menu_tab"><span class="sd_menu_oh"><a href="#" role="menuitem" class="sd_menu_postto" onclick="return false"></a></span></li><div class="sd_menu_perms"><div></div></div></ul><div class="sd_scroll_wrapper"><div class="sd_contents"><div class="sd_loading"></div><div class="sd_content"></div></div></div><div class="c_clr"></div></div>',f="SkyDriveWeb_Internal_Control_ShareDialog_Render",h="SkyDriveWeb_Internal_Control_ShareDialog_Dispose",p="SkyDriveWeb_Internal_Control_ShareDialog_ShowLoading",g="SkyDriveWeb_Internal_Control_ShareDialog_HideLoading",m="SkyDriveWeb_Internal_Control_EmailPane_Share",v="SkyDrive";n.ShareDialog=e,$Do.register("wLive.Controls.ShareDialog")}()}),define("postmessagehandler",["alehelpers"],function(){!function(){function e(){function e(e){var n=e.originalEvent||e,I=$Wac.getWacIframeDomain();if(I&&$Wac.domainsAreEqual(I,n.origin)){it=n.origin;var x=jQuery.parseJSON(n.data),T=x[i],L=x[r];switch(T){case o:ot.trigger(F,L);break;case a:ot.trigger(N,L);break;case s:t(M,L);break;case l:t(B,L);break;case c:t(R,L);break;case u:t(R,L);break;case d:ot.trigger(H,L);break;case f:ot.trigger(O,L);break;case h:ot.trigger(U,L);break;case p:t(j,L);break;case g:t(W,L);break;case y:ot.trigger(Q,L);break;case m:t(V,L);break;case v:ot.trigger(q,L);break;case _:ot.trigger(G,L);break;case w:$Do.when("$WLXIM.UserSignedIn",0,function(){$WLXIM.registerWacChat(rt)});break;case k:ot.trigger(k,L);break;case b:ot.trigger(z,L);break;case C:ot.trigger(K,L);break;case S:ot.trigger(J,L)}}}function t(e,t){$Do.when("ale_Office",0,function(){ot.trigger(e,t)})}function Z(){$BSI.navigateTo(WacConfig.CloseUrl)}function et(){$BSI.navigateTo(WacConfig.FilePropertiesUrl)}function tt(e,t){$Wac.sendWacMessage(e,t,it)}function nt(e,t){$Wac.handleWacAppLoadingStatus(e,t,it)}var it,rt=this,ot=jQuery(rt),at=X+n++;Y.bind("message"+at,e),ot.bind(F+at,Z),ot.bind(N+at,et),ot.bind(Q+at,nt),$Do.register("WacPostMessageHandler"),$Do.when("WacPostMessageHandlersAttached",0,function(){for(var t=0;t<$Wac.queuedMessages.length;t++)e($Wac.queuedMessages[t]);tt($)}),rt.sendWebImFirstIncomingMessage=function(){tt(A,{isSend:!1})},rt.sendWebImFirstOutgoingMessage=function(){tt(A,{isSend:!0})},rt.sendBlurFocus=function(){tt(I)},rt.sendGrabFocus=function(){tt(x)},rt.sendCanEmbed=function(e){tt(T,{HostEmbeddedViewUrl:e})},rt.sendCheckPolicyResponse=function(e){tt("CheckPolicyResponse",e||{})},rt.sendWebimReady=function(e,t){tt(L,{UnreadCount:e,PaneState:t})},rt.sendWebimUnreadCountChanged=function(e,t){tt(P,{UnreadCount:e,PaneState:t})},rt.sendWebimPaneStateChanged=function(e){tt(D,{PaneState:e})},rt.sendWebimGiveFocus=function(e,t){tt(E,{Direction:e,PaneState:t})},rt.dispose=function(){Y.unbind(at),ot.unbind(at)}}var t=wLive.Core,n=0,i="MessageId",r="Values",o="UI_Close",a="UI_FileProperties",s="UI_Sharing",l="UI_FileEmbed",c="UI_CopyAndEdit",u="UI_RedeemForCommenting",d="UI_SignIn",f="UI_ReplyWithChanges",h="UI_FileVersions",p="UI_ShareForm",g="UI_OpenInClient",m="UI_ReportAbuse",v="CheckPolicy",y="App_LoadingStatus",_="File_Rename",w="VerifyWebImReady",b="StartGroupChat",C="ToggleMessagingPane",S="WebImTakeFocus",k="RegisterThreadId",I="BlurFocus",x="GrabFocus",T="CanEmbed",L="WebImReady",P="WebImUnreadCountChanged",D="WebImPaneStateChanged",E="WebImGiveFocus",$="Host_PostmessageReady",A="WebImFirstMessage",F=e.WacCloseEvent="Close",N=e.WacFilePropertiesEvent="FileProperties",M=e.WacShareEvent="Share",B=e.WacFileEmbedEvent="FileEmbed",R=e.WacCopyEditEvent="CopyEdit",H=e.WacSignInEvent="SignIn",O=e.WacReplyEvent="Reply",U=e.WacFileVersionsEvent="FileVersions",j=e.WacShareFormEvent="ShareForm",W=e.WacOpenInClientEvent="OpenInClient",Q=e.WacLoadingStatusEvent="AppLoadingStatus",V=e.WacReportAbuseEvent="ReportAbuse",q=e.WacCheckPolicyEvent="CheckPolicy",G=e.WacRenameFileEvent="RenameFile",z=e.WacStartGroupChatEvent="StartGroupChat",K=e.WacToggleMessagingPaneEvent="ToggleMessagingPane",J=e.WacWebImTakeFocusEvent="WebImTakeFocus",X=".postMessageHandler",Y=jQuery(window);t.PostMessageHandler=e}()}),define("officepagecontroller",["wliveloaded","doregister","jquery-1.7.2","alehelpers","jbase","basecontrol","actionmanager","datarequest","imagestrip","validateconfig","viewcontext","ticketredeemer","bicihelpers","errormanager","embed","skydrive_pc_strip_32_ltr","skydrive_pc_strip_8_ltr","skydrive_sharing_strip_8_ltr","header_strip_ltr","inlineerror","itemactionhelper","loadingcue","permissionsprovider","sendform","sharedialog","postmessagehandler"],function(){!function(){function e(e,n,a,l,c,u,d){function f(){p.addObjectListener(v,r.DataModel.dataChangedEvent,h);var e=v.getItem(y);e&&h(e)}function h(e){if(!_&&y===e.key){for(var t=0;t<s.length;t++)w.push(new o[s[t]](m,g,e));$Do.register("WacPostMessageHandlersAttached"),p.removeObjectListener(v,r.DataModel.dataChangedEvent)}}var p=this,g=new r.PostMessageHandler,m=t(),v=new r.DataModel(e,a,l,c,u),y=r.SkyDriveItem.getItemKey(WacConfig.viewParams.id,WacConfig.viewParams.cid,WacConfig.viewParams.group,WacConfig.viewParams.qt,WacConfig.viewParams.did),_=!1;d&&v.processResponse(d,y),$Do.when("NotificationControls",0,function(){i=o.Notifications,i&&i.getQueue().start()});var w=[];p.dispose=function(){i&&i.getQueue().reset(),g.dispose();for(var e=0;e<w.length;e++)w[e].dispose();v.dispose(),_=!0},p.getPostMessageHandler=function(){return g},mix(p,Shared.ObjectEventing),f()}function t(){var e={callerCid:$Config.hcid,tokenHasBeenRedeemed:!1,notifications:i,actionManager:{getAction:function(e,t){if("Share"==e&&t.commands&&!t.group){var n=t.commands.split(","),i=jQuery.inArray("sh",n);if(-1!=i)return 1}else if("Embed"==e&&t.commands&&(n=t.commands.split(","),i=jQuery.inArray("em",n),-1!=i))return 1;return null}}};return e}function n(){var e=Object.fromJSON(WacConfig.GetItemsResponse),t=new wLive.Core.OfficePageController(FilesConfig.baseApiUrl,FilesConfig.canary,FilesConfig.appId,FilesConfig.hcid,$Config.mkt,FilesConfig.dataPageSize,e);return a.bind("unload",function(){t.dispose()}),t}var i,r=wLive.Core,o=wLive.Controls,a=jQuery(window),s=["CopyEditHandler","ShareHandler","EmbedHandler","OpenInClientHandler","VersionHistoryHandler","ShareFormHandler","SignInHandler","RenameFileHandler"];r.OfficePageController=e;var l;r.OfficePageController.getInstance=function(){return l},require(["postmessagehandler","copyedithandler","sharehandler","embedhandler","openinclienthandler","versionhistoryhandler","shareformhandler","signinhandler","renamefilehandler"],function(){l=n()})}()}),define("versionhistoryhandler",["officepagecontroller"],function(){!function(){function e(e,o,a){function s(){var t=new n.TicketRedeemer(e);t.show(l())}function l(){var e={item:a,action:{url:WacConfig.FileVersionUrl},authkey:FilesConfig.authKey,callback:function(){$BSI.navigateTo(WacConfig.FileVersionUrl)},onHide:function(){o.sendGrabFocus()},onShow:function(){o.sendBlurFocus()}};return e}var c=this,u=jQuery(o),d=r+i++;u.bind(t.PostMessageHandler.WacFileVersionsEvent+d,s),c.dispose=function(){u.unbind(d)}}var t=wLive.Core,n=wLive.Controls,i=0,r=".versionHistoryHandler";n.VersionHistoryHandler=e}()}),define("copyedithandler",["versionhistoryhandler"],function(){!function(){function e(e,l,c){function u(n,i){i&&(f=i[r],h=i[o]);var a=new t.TicketRedeemer(e);a.show(d())}function d(){var e=f===a?WacConfig.ViewUrl:WacConfig.EditUrl;h&&(e+=h);var t={item:c,action:{url:e},authkey:FilesConfig.authKey,callback:function(){$BSI.navigateTo(e)},onHide:function(){l.sendGrabFocus()},onShow:function(){l.sendBlurFocus()}};return t}var f,h,p=this,g=jQuery(l),m=s+i++;g.bind(n.PostMessageHandler.WacCopyEditEvent+m,u),p.dispose=function(){g.unbind(m)}}var t=wLive.Controls,n=wLive.Core,i=0,r="targetWacAction",o="wdparams",a="View",s=".copyEditHandler";t.CopyEditHandler=e}()}),define("signinhandler",["copyedithandler"],function(){!function(){function e(e,l,c){function u(n,i){i&&(f=i[r],h=i[o]);var s;if(s=f===a?WacConfig.ViewUrl:WacConfig.EditUrl,h&&(s+=h),FilesConfig.authKey){var l=new t.TicketRedeemer(e);l.show(d(s))}else{var c=FilesConfig.signInUrl+"&ru="+s.encodeUrl()+"&wreply="+s.encodeUrl();$BSI.navigateTo(c,"_top")}}function d(e){var t={item:c,action:{url:e},authkey:FilesConfig.authKey,callback:function(){$BSI.navigateTo(e)},onHide:function(){l.sendGrabFocus()},onShow:function(){l.sendBlurFocus()}};return t}var f,h,p=this,g=jQuery(l),m=s+i++;g.bind(n.PostMessageHandler.WacSignInEvent+m,u),p.dispose=function(){g.unbind(m)}}var t=wLive.Controls,n=wLive.Core,i=0,r="targetWacAction",o="wdparams",a="View",s=".signInHandler";t.SignInHandler=e}()}),define("renamefilehandler",["signinhandler"],function(){!function(){function e(e,t,a){function s(e,t){var n;t&&(n=t[r]),n&&($f.updateTitle(WacConfig.PageTitleType.format(n)),a.expire(),a.invalidate())}var l=this,c=jQuery(t),u=o+i++;c.bind(n.PostMessageHandler.WacRenameFileEvent+u,s),l.dispose=function(){c.unbind(u)}}var t=wLive.Controls,n=wLive.Core,i=0,r="NewName",o=".renameFileHandler";t.RenameFileHandler=e}()}),define("openinclienthandler",["renamefilehandler"],function(){!function(){function e(e,o,a){function s(){var t=new n.TicketRedeemer(e);t.show(l())}function l(){var e={item:a,action:{url:c()},authkey:FilesConfig.authKey,callback:function(){$BSI.navigateTo(c())},onHide:function(){o.sendGrabFocus()},onShow:function(){o.sendBlurFocus()}};return e}function c(){return WacConfig.FilePropertiesUrl+"&action="+WacConfig.OpenInClientAction}var u=this,d=jQuery(o),f=r+i++;d.bind(t.PostMessageHandler.WacOpenInClientEvent+f,s),u.dispose=function(){d.unbind(f)}}var t=wLive.Core,n=wLive.Controls,i=0,r=".openInClientHandler";n.OpenInClientHandler=e}()}),define("shareformhandler",["openinclienthandler"],function(){!function(){function e(e,o,a){function s(i,r){t.BiciHelpers.reportClickAction("SF","WAC","WAC");var o=r&&r.SurveyTitle;if(!c){var s=new t.PermissionsProvider(e.callerCid),l=new n.SendForm(s);l.show(a,o)}}var l=this,c=!1,u=jQuery(o),d=r+i++;u.bind(t.PostMessageHandler.WacShareFormEvent+d,s),l.dispose=function(){u.unbind(d),c=!0}}var t=wLive.Core,n=wLive.Controls,i=(t.AleHelpers.getPCString,0),r=".shareFormHandler";n.ShareFormHandler=e}()}),define("sharehandler",["shareformhandler"],function(){!function(){function e(e,c,u){function d(){t.BiciHelpers.reportClickAction("SH","WAC","WAC"),g()}function f(){var r=new t.PermissionsProvider(e.callerCid);r.fetchPermissions(u,function(){!D&&w&&p(r)},function(){var e=i("Sharing.GetPermissionsError"),t=jQuery('<div class="ips_error"></div>'),r=new n.InlineError(t,e);r.render(),P=jQuery(o),P.find(".sd_header").text(I),P.find(".ips_list").hide(),P.find(".sd_shareMore").hide(),P.find(".sd_done").val(k).click(y),t.insertBefore(P.find(".ips_list")),_(P),m()},!0)}function h(){l||(l=!0,$Do.isRegistered("Bucket3.css")||window.$Network.fetchCSS(FilesConfig.bucket3CssLocation,function(){$Do.register("Bucket3.css")},void 0,"Gfx_Css_FilesBucket3_Download","Gfx"))}function p(t){h(),$Do.wE("Bucket3.css",0,function(){var i=jQuery('<div class="sd_pop_wrapper"></div>');_(i);var r=new n.ShareDialog(i,t,u,null,e,y);r.render(),m(),D=!0,sutra(i.closest(".ModalDialog"),"$Sutra.SkyDrive.WacSharing")})}function g(){if(w&&(w.dismiss(),w=null),L=jQuery('<div style="min-height:270px;"></div>'),w=b&&b.createModalDialog({content:L[0]})){var e=jQuery(w);e.bind({"beforeshow._dlg":function(){C=jQuery(".ModalDialog"),C.hide()},"aftershow._dlg":function(){c.sendBlurFocus(),f(),jQuery(".UserArea").on("click",".sd_cancel",function(){y()}),w&&w.reposition()},"afterdismiss._dlg":function(){jQuery(".UserArea").off("click",".sd_cancel"),E=!1,C.unbind("onclose._dlg"),e&&e.unbind("._dlg"),e=null,w=null},"buttonclick._dlg":v}),w.show(),b.getQueue().start()}}function m(){w&&!E&&(E=!0,C.show())}function v(){return y(),!0}function y(){w&&(w.dismiss(),w=null),D=!1,E=!1,c.sendGrabFocus()}function _(e){w&&(jQuery(".UserContent").html(e),setTimeout(function(){w.reposition()},0))}var w,b,C,S=this,k=i(s+"Done"),I=(i("Cancel"),i(s+"ShareMore"),i(s+"CurrentPermissions")),x=jQuery(c),T=a+r++;$Do.when("NotificationControls",0,function(){b=n.Notifications});var L,P,D=!1,E=!1,$=u.invalidate;u.invalidate=function(){$&&$.apply(u),u._dataModel.getItem(u.key),w&&f()
},x.bind(t.PostMessageHandler.WacShareEvent+T,d),S.dispose=function(){x.unbind(T),u.invalidate=$}}var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString,r=($B.rtl?"right":"left",$B.rtl?"left":"right",0),o='<div class="sd_pop_wrapper wac_permissions"><div class="sd_content"><div class="sd_datacontainer"><h2 class="sd_header"></h2><ul class="ips_list"></ul></div><br /><br /><div class="sd_btns"><input class="sd_shareMore default" type="button" /><input class="sd_done" type="button" /></div></div></div>',a=".shareHandler",s="Office.Sharing.",l=!1;n.ShareHandler=e}()}),define("embedhandler",["sharehandler"],function(){!function(){function e(e,a,s){function l(){t.BiciHelpers.reportClickAction("EM","WAC","WAC"),s.expire=function(){},s.invalidate=function(){},p||(f=new i(e.callerCid),FilesConfig.shouldSendCanEmbed?f.fetchPermissions(s,c,d,!0):d())}function c(e,n){for(var r,o=n.permissionScopes,s=0;s<o.length;s++){var l=o[s];if(t.StringHelpers.caseInsensitiveStringEquals(l.id,e.id)){for(var c=l.entities,f=0;f<c.length;f++){var h=c[f];if(h.type==i.EntityType.Link&&h.linkType==i.LinkType.Embed){r=u(h);break}}break}}r?a.sendCanEmbed(r):d()}function u(e){return e.link+"&em=2"}function d(){var e=function(){a.sendGrabFocus()},t=FilesConfig.shouldSendCanEmbed&&function(e){n.dispose(),a.sendCanEmbed(u(e))},n=new v(f);a.sendBlurFocus();var i=-1!=s.commands.indexOf("em,2");n.show(s,!1,i,e,t)}var f,h=this,p=!1,g=jQuery(a),m=o+r++,v=n.Embed;g.bind(t.PostMessageHandler.WacFileEmbedEvent+m,l),h.dispose=function(){g.unbind(m),p=!0}}var t=wLive.Core,n=wLive.Controls,i=t.PermissionsProvider,r=0;n.EmbedHandler=e;var o=".embedHandler"}()}),define("ipadzoom",[],function(){!function(){function e(e){for(var t=e.getElementsByTagName("meta"),n=0;n<t.length;n++)if("viewport"==t[n].name){t[n].content=FilesConfig.isWac?"width=device-width, initial-scale=1.0, maximum-scale=4.0, minimum-scale=1.0, user-scalable=yes":"width=device-width, initial-scale=1.0, maximum-scale=1.01, minimum-scale=0.99, user-scalable=yes";break}}function t(){if("undefined"==typeof t.iframe&&(t.iframe=document.getElementById("sdx_ow_iframe"),t.windowWidth=t.windowHeight=0),t.windowWidth!=window.innerWidth||t.windowHeight!=window.innerHeight){var e=t.iframe.style;e.width=screen.width+"px",e.height=screen.height+"px",window.scrollTo(0,1),t.windowWidth=window.innerWidth,t.windowHeight=window.innerHeight,e.width=t.windowWidth+"px",e.height=t.windowHeight+"px"}}if($B.SF_iPhone&&!$B.Mobile?setTimeout(function(){e(document),e(window.parent.document)},100):$B.SF_iPhone&&FilesConfig.isWac&&window.addEventListener("load",function(){setTimeout(function(){t()},1e3)}),$B.Mobile&&FilesConfig.isWac&&$B.IE&&$B.V>=10){document.body.style.msContentZooming="none";var n=document.getElementById("sdx_ow_iframe");n&&(n.style.msTouchAction="none")}$B.Mobile&&FilesConfig.isWac&&"onpageshow"in window&&(window.onpageshow=function(e){e.persisted&&(document.body.style.display="none",location.reload())})}()}),define("Wac_s_Office",function(){});